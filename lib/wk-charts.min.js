angular.module("wk.chart",[]),angular.module("wk.chart").constant("d3OrdinalScales",["ordinal","category10","category20","category20b","category20c"]),angular.module("wk.chart").constant("wkChartMargins",{top:10,left:50,bottom:40,right:20,topBottomMargin:{axis:25,label:18},leftRightMargin:{axis:40,label:20},minMargin:8,"default":{top:8,left:8,bottom:8,right:10},axis:{top:25,bottom:25,left:40,right:40},label:{top:18,bottom:18,left:20,right:20},dataLabelPadding:{hor:5,vert:5}}),angular.module("wk.chart").constant("d3Shapes",["circle","cross","triangle-down","triangle-up","square","diamond"]),angular.module("wk.chart").constant("axisConfig",{labelFontSize:"1.6em",x:{axisPositions:["top","bottom"],axisOffset:{bottom:"height"},axisPositionDefault:"bottom",direction:"horizontal",measure:"width",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{top:"1em",bottom:"-0.8em"}},y:{axisPositions:["left","right"],axisOffset:{right:"width"},axisPositionDefault:"left",direction:"vertical",measure:"height",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{left:"1.2em",right:"1.2em"}}}),angular.module("wk.chart").constant("d3Animation",{duration:300}),angular.module("wk.chart").constant("maxTicks",200),angular.module("wk.chart").constant("templateDir","templates/"),angular.module("wk.chart").constant("formatDefaults",{date:"%x",number:",.2f"}),angular.module("wk.chart").constant("barConfig",{padding:.1,outerPadding:0}),function(){function e(e,t,r){var a=e.translate(),n=Math.atan2(t[1]-a[1],t[0]-a[0])-Math.atan2(r[1]-a[1],r[0]-a[0]);return[Math.cos(n/2),0,0,Math.sin(n/2)]}function t(e,t){var r=(e.translate(),e.invert(t));return r&&isFinite(r[0])&&isFinite(r[1])&&o(r)}function r(e){var t=.5*e[0]*c,r=.5*e[1]*c,a=.5*e[2]*c,n=Math.sin(t),i=Math.cos(t),o=Math.sin(r),l=Math.cos(r),s=Math.sin(a),u=Math.cos(a);return[i*l*u+n*o*s,n*l*u-i*o*s,i*o*u+n*l*s,i*l*s-n*o*u]}function a(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=t[0],l=t[1],s=t[2],c=t[3];return[r*o-a*l-n*s-i*c,r*l+a*o+n*c-i*s,r*s-a*c+n*o+i*l,r*c+a*s-n*l+i*o]}function n(e,t){if(e&&t){var r=s(e,t),a=Math.sqrt(l(r,r)),n=.5*Math.acos(Math.max(-1,Math.min(1,l(e,t)))),i=Math.sin(n)/a;return a&&[Math.cos(n),r[2]*i,-r[1]*i,r[0]*i]}}function i(e){return[Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),1-2*(e[1]*e[1]+e[2]*e[2]))*u,Math.asin(Math.max(-1,Math.min(1,2*(e[0]*e[2]-e[3]*e[1]))))*u,Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),1-2*(e[2]*e[2]+e[3]*e[3]))*u]}function o(e){var t=e[0]*c,r=e[1]*c,a=Math.cos(r);return[a*Math.cos(t),a*Math.sin(t),Math.sin(r)]}function l(e,t){for(var r=0,a=e.length,n=0;a>r;++r)n+=e[r]*t[r];return n}function s(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}var c=Math.PI/180,u=180/Math.PI;d3.geo.zoom=function(){var o,l,s=d3.dispatch("zoomstart","zoom","zoomend"),c=d3.behavior.zoom().on("zoomstart",function(){var d=d3.mouse(this),f=r(o.rotate()),h=t(o,d);h&&(l=h),u.call(c,"zoom",function(){o.scale(d3.event.scale);var r=d3.mouse(this),c=n(l,t(o,r));o.rotate(i(f=c?a(f,c):a(e(o,d,r),f))),d=r,s.zoom.apply(this,arguments)}),s.zoomstart.apply(this,arguments)}).on("zoomend",function(){u.call(c,"zoom",null),s.zoomend.apply(this,arguments)}),u=c.on;return c.projection=function(e){return arguments.length?c.scale((o=e).scale()):o},d3.rebind(c,s,"on")}}(),angular.module("wk.chart").directive("brush",["$log","selectionSharing","behavior",function(e){var t;return t=0,{restrict:"A",require:["^chart","^?layout","?x","?y"],scope:{brushExtent:"=",selectedValues:"=",selectedDomain:"=",selectedDomainChange:"&",brushStart:"&",brushEnd:"&"},link:function(r,a,n,i){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x;return e.log("brush-scope",r.$id),v=t++,l=i[0].me,c=null!=(w=i[1])?w.me:void 0,d=null!=(k=i[2])?k.me:void 0,h=null!=(b=i[3])?b.me:void 0,f=void 0,y=void 0,x=void 0,p=void 0,m=!d&&!h,g=void 0,e.log("creating brush scope",r.$id),o=l.behavior().brush,s=l||c,d||h?(o.x(d),o.y(h)):(u=s.scales().getScales(["x","y"]),o.x(u.x),o.y(u.y)),o.active(!0),n.$observe("brush",function(e){return o.brushGroup(_.isString(e)&&e.length>0?e:void 0)}),r.$watch("brushExtent",function(e,t){return _.isArray(e)&&0===e.length&&_.isArray(t)&&0!==t.length?o.clearBrush():void 0}),o.events().on("brushStart."+v,function(){return n.brushStart?(r.brushStart(),r.$apply()):void 0}),o.events().on("brush."+v,function(e,t,a){return n.brushExtent&&(r.brushExtent=e),n.selectedValues&&(r.selectedValues=t),n.selectedDomain&&(r.selectedDomain=a),r.selectedDomainChange({domain:a}),r.$apply()}),o.events().on("brushEnd."+v,function(e,t,a){return n.brushEnd?(r.brushEnd({domain:a}),r.$apply()):void 0}),l.lifeCycle().on("drawChart.brush",function(e){return o.data(e)}),s.lifeCycle().on("destroy.brush",function(){return o.events().on("."+v,null),l.lifeCycle().on("."+v,null),r.$destroy(),e.log("destroying brush scope",r.$id)})}}}]),function(){var e=function(t,r){var a=t.nodeType;if(3==a)r.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"));else if(1==a){if(r.push("<",t.tagName),t.hasAttributes())for(var n=t.attributes,i=0,o=n.length;o>i;++i){var l=n.item(i);r.push(" ",l.name,"='",l.value,"'")}if(t.hasChildNodes()){r.push(">");for(var s=t.childNodes,i=0,o=s.length;o>i;++i)e(s.item(i),r);r.push("</",t.tagName,">")}else r.push("/>")}else{if(8!=a)throw"Error serializing XML. Unhandled node of type: "+a;r.push("<!--",t.nodeValue,"-->")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){for(var t=[],r=this.firstChild;r;)e(r,t),r=r.nextSibling;return t.join("")},set:function(e){for(;this.firstChild;)this.removeChild(this.firstChild);try{var t=new DOMParser;t.async=!1,sXML="<svg xmlns='http://www.w3.org/2000/svg'>"+e+"</svg>";for(var r=t.parseFromString(sXML,"text/xml").documentElement,a=r.firstChild;a;)this.appendChild(this.ownerDocument.importNode(a,!0)),a=a.nextSibling}catch(n){throw new Error("Error parsing XML string")}}}),Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})}(),angular.module("wk.chart").directive("brushed",["$log","selectionSharing","timing",function(e,t){var r;return r=0,{restrict:"A",require:["^chart","?^layout","?x","?y","?rangeX","?rangeY"],link:function(a,n,i,o){var l,s,c,u,d,f,h,y,p,g,v,m,w,k,b;return e.log("brushed-scope",a.$id),g=r++,c=o[0].me,u=null!=(v=o[1])?v.me:void 0,h=null!=(m=o[2])?m.me:void 0,y=null!=(w=o[3])?w.me:void 0,d=null!=(k=o[4])?k.me:void 0,f=null!=(b=o[5])?b.me:void 0,l=h||y||d||f,p=void 0,s=function(e,t){var r,a,n,i,o;if(l){for(e.length>0?l.domain(e).scale().domain(e):(l.domain(void 0),l.scale().domain(l.getDomain(c.getData())),l.isOrdinal()&&(t=[0,l.scale().domain().length-1])),i=c.layouts(),o=[],a=0,n=i.length;n>a;a++)r=i[a],r.scales().getKind(l.kind()).id()===l.id()&&o.push(r.lifeCycle().brush(l,!0,t));return o}},i.$observe("brushed",function(e){return _.isString(e)&&e.length>0?(p=e,t.register(p,s)):p=void 0}),c.lifeCycle().on("destroy."+g,function(){return t.unregister(p,s),c.lifeCycle().on("."+g,null)})}}}]),angular.module("wk.chart").run(["$templateCache",function(e){e.put("templates/legend.html",'\n<div ng-style="legendStyle" ng-show="showLegend" class="wk-chart-legend">\n  <div ng-show="title" class="legend-title">{{title}}</div>\n  <ul class="list-unstyled">\n    <li ng-repeat="legendRow in legendRows track by legendRow.value" class="wk-chart-legend-item">\n      <svg ng-if="!legendRow.path" class="wk-chart-legend-svg-box">\n        <rect ng-style="legendRow.color" x="0" y="0" width="50" height="50"></rect>\n      </svg>\n      <svg ng-if="legendRow.path" style="width:15px;height:17px;">\n        <path ng-attr-d="{{legendRow.path}}" transform="translate(8,9)"></path>\n      </svg><span> &nbsp;{{legendRow.value}}</span>\n    </li>\n  </ul>\n</div>'),e.put("templates/patterns.html",'\n<pattern id="largeDotsPattern" x="0" y="0" width="12" height="12" patternUnits="userSpaceOnUse">\n  <circle cx="5" cy="5" r="5" fill="#ffffff"></circle>\n</pattern>\n<mask id="largeDots">\n  <rect x="0" y="0" width="100%" height="100%" fill="url(#largeDotsPattern)"></rect>\n</mask>\n<pattern id="smallDotsPattern" x="0" y="0" width="5" height="5" patternUnits="userSpaceOnUse">\n  <circle cx="2" cy="2" r="2" fill="#ffffff"></circle>\n</pattern>\n<mask id="smallDots">\n  <rect x="0" y="0" width="100%" height="100%" fill="url(#smallDotsPattern)"></rect>\n</mask>\n<pattern id="stripesPattern" x="0" y="0" width="4" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">\n  <rect width="2" height="100%" fill="#ffffff"></rect>\n</pattern>\n<mask id="stripes">\n  <rect x="0" y="0" width="100%" height="100%" fill="url(#stripesPattern)"></rect>\n</mask>\n<linearGradient id="lgrad-1f77b4" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#1f77b4;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#15537d;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-1f77b4" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#1f77b4;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#15537d;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-aec7e8" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#aec7e8;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#798ba2;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-aec7e8" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#aec7e8;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#798ba2;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-ff7f0e" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#ff7f0e;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b25809;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-ff7f0e" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#ff7f0e;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b25809;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-ffbb78" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#ffbb78;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b28254;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-ffbb78" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#ffbb78;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b28254;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-2ca02c" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#2ca02c;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#1e701e;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-2ca02c" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#2ca02c;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#1e701e;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-98df8a" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#98df8a;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6a9c60;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-98df8a" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#98df8a;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6a9c60;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-d62728" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#d62728;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#951b1c;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-d62728" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#d62728;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#951b1c;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-ff9896" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#ff9896;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b26a69;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-ff9896" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#ff9896;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b26a69;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-9467bd" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#9467bd;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#674884;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-9467bd" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#9467bd;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#674884;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-c5b0d5" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#c5b0d5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#897b95;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-c5b0d5" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#c5b0d5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#897b95;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-8c564b" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#8c564b;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#623c34;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-8c564b" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#8c564b;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#623c34;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-c49c94" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#c49c94;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#896d67;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-c49c94" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#c49c94;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#896d67;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-e377c2" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#e377c2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#9e5387;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-e377c2" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#e377c2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#9e5387;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-f7b6d2" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#f7b6d2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#ac7f93;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-f7b6d2" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#f7b6d2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#ac7f93;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-7f7f7f" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#7f7f7f;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#585858;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-7f7f7f" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#7f7f7f;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#585858;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-c7c7c7" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#c7c7c7;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#8b8b8b;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-c7c7c7" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#c7c7c7;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#8b8b8b;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-bcbd22" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#bcbd22;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#838417;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-bcbd22" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#bcbd22;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#838417;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-dbdb8d" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#dbdb8d;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#999962;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-dbdb8d" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#dbdb8d;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#999962;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-17becf" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#17becf;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#108590;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-17becf" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#17becf;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#108590;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-9edae5" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#9edae5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6e98a0;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-9edae5" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#9edae5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6e98a0;stop-opacity:1"></stop>\n</radialGradient>'),e.put("templates/toolTip.html",'\n<div ng-style="tooltipStyle" ng-hide="ttHide" class="wk-chart-tooltip">\n  <table class="table table-condensed table-bordered">\n    <thead ng-show="headerValue">\n      <tr>\n        <th colspan="2">{{headerName}}</th>\n        <th>{{headerValue}}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="(name,value) in layers track by name">\n        <!--td(ng-style="value.color", ng-class="value.class")\n        svg(ng-if="value.path", style="width:15px;height:17px;")\n            path(ng-attr-d="{{value.path}}",transform="translate(8,9)")\n        -->\n        <td class="wk-chart-tt-svg-box">\n          <svg ng-if="!value.path" class="wk-chart-svg-box">\n            <rect ng-style="value.color" x="0" y="0" width="50" height="50"></rect>\n          </svg>\n          <svg ng-if="value.path" style="width:15px;height:17px;">\n            <path ng-attr-d="{{value.path}}" transform="translate(8,9)"></path>\n          </svg>\n        </td>\n        <td>{{name}}</td>\n        <td>{{value.value}}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>')}]),function(){this.ResizeSensor=function(e,t){function r(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;t>e;e++)this.q[e].call()}}function a(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function n(e,t){if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new r,e.resizedAttached.add(t);e.resizeSensor=document.createElement("div"),e.resizeSensor.className="wk-chart-resize-sensor";var n="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;",i="position: absolute; left: 0; top: 0;";e.resizeSensor.style.cssText=n,e.resizeSensor.innerHTML='<div class="wk-chart-resize-sensor-expand" style="'+n+'"><div style="'+i+'"></div></div><div class="wk-chart-resize-sensor-shrink" style="'+n+'"><div style="'+i+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),{fixed:1,absolute:1}[a(e,"position")]||(e.style.position="relative");var o,l,s=e.resizeSensor.childNodes[0],c=s.childNodes[0],u=e.resizeSensor.childNodes[1],d=(u.childNodes[0],function(){c.style.width=s.offsetWidth+10+"px",c.style.height=s.offsetHeight+10+"px",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,o=e.offsetWidth,l=e.offsetHeight});d();var f=function(){e.resizedAttached.call()},h=function(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener(t,r)};h(s,"scroll",function(){(e.offsetWidth>o||e.offsetHeight>l)&&f(),d()}),h(u,"scroll",function(){(e.offsetWidth<o||e.offsetHeight<l)&&f(),d()})}if("[object Array]"===Object.prototype.toString.call(e)||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements)for(var i=0,o=e.length;o>i;i++)n(e[i],t);else n(e,t)}}(),angular.module("wk.chart").directive("chart",["$log","chart","$filter",function(e,t,r){var a;return a=0,{restrict:"E",require:"chart",scope:{data:"=",filter:"="},controller:["$scope",function(e){return this.me=t(),this.me.scope(e)}],link:function(t,a,n,i){var o,l,s,c,u,d;return e.log("chart-scope",t.$id),s=i.me,l=!1,c=void 0,a.addClass(s.id()),u=void 0,d=void 0,s.container().element(a[0]),s.lifeCycle().configure(),s.lifeCycle().on("scopeApply.chart",function(){return t.$apply()}),s.lifeCycle().on("editSelected.chart",function(){return attr.editSelected?t.$apply():void 0}),n.$observe("animationDuration",function(e){return e&&_.isNumber(+e)&&+e>=0?s.animationDuration(e):void 0}),n.$observe("header",function(e){return s.title(e?e:void 0)}),n.$observe("headerStyle",function(e){return e?s.titleStyle(t.$eval(e)):void 0}),n.$observe("subHeader",function(e){return s.subTitle(e?e:void 0)}),n.$observe("subHeaderStyle",function(e){return e?s.subTitleStyle(t.$eval(e)):void 0}),n.$observe("backgroundStyle",function(e){return e?s.backgroundStyle(t.$eval(e)):void 0}),t.$watch("filter",function(e){if(e){if(d=e,u)return s.lifeCycle().newData(r("filter")(u,d))}else if(d=void 0,u)return s.lifeCycle().newData(u)}),n.$observe("deepWatch",function(e){return l=void 0!==e&&"false"!==e?!0:!1,c&&c(),c=t.$watch("data",o,l)}),n.$observe("edit",function(e){return s.editMode(""===e||"true"===e?!0:!1)}),o=function(e){if(e){if(u=e,_.isArray(u)&&0===u.length)return;return s.lifeCycle().newData(d?r("filter")(e,d):e)}},c=t.$watch("data",o,l),a.on("$destroy",function(){return c&&c(),s.lifeCycle().on(".chart",null),s.container().element(void 0),e.log("Destroying chart"),s.lifeCycle().destroy(),t.$destroy()})}}}]),function(){function e(e){var t=document.querySelectorAll("svg image"),r=t.length;0==r&&e();for(var a=0;a<t.length;a++)!function(t){if(t.getAttribute("xlink:href")){var a=t.getAttribute("xlink:href").value;if(/^http/.test(a)&&!new RegExp("^"+window.location.host).test(a))throw new Error("Cannot render embedded images linking to external hosts.")}var n=document.createElement("canvas"),i=n.getContext("2d"),o=new Image;o.src=t.getAttribute("xlink:href"),o.onload=function(){n.width=o.width,n.height=o.height,i.drawImage(o,0,0),t.setAttribute("xlink:href",n.toDataURL("image/png")),r--,0==r&&e()}}(t[a])}function t(){for(var e="",t=document.styleSheets,r=0;r<t.length;r++){var a=t[r].cssRules;if(null!=a)for(var n=0;n<a.length;n++){var i=a[n];"undefined"!=typeof i.style&&(e+=i.selectorText+" { "+i.style.cssText+" }\n")}}var o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML="<![CDATA[\n"+e+"\n]]>";var l=document.createElement("defs");return l.appendChild(o),l}var r="undefined"!=typeof exports&&exports||this,a='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';r.svgAsDataUri=function(n,i,o){i=i||1,e(function(){var e=document.createElement("div"),l=n.cloneNode(!0),s=parseInt(l.getAttribute("width")||l.style.width||r.getComputedStyle(n).getPropertyValue("width")),c=parseInt(l.getAttribute("height")||l.style.height||r.getComputedStyle(n).getPropertyValue("height")),u="http://www.w3.org/2000/xmlns/";l.setAttribute("version","1.1"),l.setAttributeNS(u,"xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(u,"xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("width",s*i),l.setAttribute("height",c*i),l.setAttribute("viewBox","0 0 "+s+" "+c),e.appendChild(l),l.insertBefore(t(l),l.firstChild);var d=a+e.innerHTML,f="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(d)));o&&o(f)})},r.saveSvgAsPng=function(e,t,a){r.svgAsDataUri(e,a,function(e){var r=new Image;r.src=e,r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height;var a=e.getContext("2d");a.drawImage(r,0,0);var n=document.createElement("a");n.download=t,n.href=e.toDataURL("image/png"),document.body.appendChild(n),n.click()}})}}(),angular.module("wk.chart").directive("layout",["$log","layout","container",function(e,t){var r;return r=0,{restrict:"AE",require:["layout","^chart"],controller:["$element",function(){return this.me=t()}],link:function(e,t,r,a){var n,i;return i=a[0].me,n=a[1].me,i.chart(n),t.addClass(i.id()),n.addLayout(i),n.container().addLayout(i),i.container(n.container())}}}]),describe("chartGen Test Suite",function(){beforeEach(module("wk.chart"));var e,t;beforeEach(inject(function(r,a){e=r,t=a})),it("creates the element",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined()}),it("adds a layout and chart type",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;r.addLayout("line"),expect(r.layouts[0]).toBeDefined()}),it("adds a property to the layout x axis",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;r.addLayout("line"),expect(r.layouts[0]).toBeDefined();var a=r.layouts[0];a.dimensions.x.property="abcde",expect(a.dimensions.x.property).toEqual("abcde"),expect(a.dimensions.x.acceptedValues("domainRange")).toEqual(["min","max","extent","total"]),expect(a.dimensions.x.validate("domainRange","min")).toBeTruthy(),expect(a.dimensions.x.validate("domainRange","aaa")).toBeFalsy()}),it("generates Markup",function(){t('<chart-generator properties="chartDescription", markup="markup"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;console.log("setting data"),r.data="chartData",r.tooltips$set=!0,r.tooltipsTemplate="url",e.$digest(),r.filter="filterString",r.addDimension("color"),r.dimensions.color.property="farbe",r.dimensions.color.legend$set=!0,r.dimensions.color.legend="top-left",r.dimensions.color.valuesLegend$set=!1,r.addLayout("barStacked"),r.addLayout("areaStacked"),expect(r.layouts[0]).toBeDefined(),expect(r.layouts.length).toBe(2);var a=r.layouts[0];a.dimensions.y.property="abcde",a.padding=10;var n=r.layouts[1];n.areaStacked="zero",e.$apply(r),console.log(e.markup),expect(e.markup).toBeTruthy()})}),angular.module("wk.chart").directive("printButton",["$log",function(e){return{require:"chart",restrict:"A",link:function(t,r,a,n){var i,o;return i=n.me,o=function(){var t;return t=d3.select(i.container().element()).select("div.wk-chart"),t.append("button").attr("class","wk-chart-print-button").style({position:"absolute",top:0,right:0}).text("Print").on("click",function(){var r;return e.log("Clicked Print Button"),r=t.select("svg.wk-chart").node(),saveSvgAsPng(r,"print.png",5)})},i.lifeCycle().on("drawChart.print",o)}}}]),describe("chartGen Test Suite",function(){beforeEach(module("wk.chart"));var e,t,r,a;beforeEach(inject(function(n,i,o,l){e=n,t=i,r=o,a=l})),it("should inject modelTypes",function(){expect(r).not.toBeUndefined(),expect(r.chart.properties.title).toEqual("string"),expect(r.dimension.x.properties.property).toEqual("list")}),it("creates a model instance",function(){var e=a.create();e.data="abcde",e.title="efg",expect(e.data).toEqual("abcde"),expect(e.validate("data","anything")).toBeTruthy(),expect(e.title).toEqual("efg")}),it("adds and removes a dimension",function(){var e=a.create();expect(e.dimensions).toEqual({}),e.addDimension("x"),expect(e.dimensions.x).toBeDefined(),e.removeDimension("x"),expect(e.dimensions).toEqual({})}),it("can access properties and functions in dimensions",function(){var e=a.create();e.addDimension("x"),expect(e.dimensions).toBeDefined(),e.dimensions.x.showLabel=!0,expect(e.dimensions.x.showLabel).toBeTruthy(),expect(e.dimensions.x.validate("type","linear")).toBeTruthy(),expect(e.dimensions.x.validate("type","nonsense")).toBeFalsy(),expect(e.dimensions.x.acceptedValues("domainRange")).toEqual(["min","max","extent","total"])}),it("adds and removes a layout",function(){var e=a.create();expect(e.layouts).toEqual([]);var t=e.addLayout("line");expect(e.layouts.length).toBe(1),e.removeLayout(t),expect(e.layouts.length).toBe(0)}),it("can access properties and functions in layouts",function(){var e=a.create();e.addLayout("line");var t=e.layouts[0];expect(t).toBeDefined(),expect(t.dimensions.x).toBeDefined();var r=t.dimensions.x;r.reset=!0,expect(r.reset).toBeTruthy(),expect(r.validate("type","linear")).toBeTruthy(),expect(r.validate("type","nonsense")).toBeFalsy(),expect(r.acceptedValues("domainRange")).toEqual(["min","max","extent","total"]),expect(r.validate("domainRange","min")).toBeTruthy(),expect(r.validate("domainRange","nono")).toBeFalsy(),expect(r.validate("domain","[sbx]")).toBeTruthy(),expect(r.validate("domain","sbx]")).toBeFalsy()}),it("can add and remove a dimension for a layout",function(){var e=a.create();e.addLayout("line");var t=e.layouts[0];expect(t).toBeDefined(),expect(t.dimensions.x).toBeDefined(),t.addDimension("size"),expect(t.dimensions.size).toBeDefined(),t.removeDimension("size"),expect(t.dimensions.size).toBeUndefined()}),it("can access layout properties",function(){var e=a.create();e.addLayout("bars");var t=e.layouts[0];expect(_.has(t,"padding")).toBeTruthy(),expect(t.validate("padding",10)).toBeTruthy(),expect(t.validate("padding","abc")).toBeFalsy()}),it('handles layout values (e.g. areaStacked="wiggle" correctly',function(){var e=a.create();e.addLayout("areaStacked");var t=e.layouts[0];expect(t).toBeDefined(),expect(_.has(t,"areaStacked")).toBeTruthy(),expect(t.validate("areaStacked","wiggle")).toBeTruthy(),expect(t.validate("areaStacked","totalKrumm")).toBeFalsy()}),it("can access decorator attributes",function(){var e=a.create();e.tooltips$set=!0,expect(e.tooltips$set).toBeTruthy(),expect(e.validate("tooltips",!0)).toBeTruthy(),e.tooltipsTemplate="url",expect(e.tooltipsTemplate).toEqual("url")})}),angular.module("wk.chart").directive("selection",["$log",function(e){var t;return t=0,{restrict:"A",scope:{selectedDomain:"=",selectedDomainChange:"&"},require:"layout",link:function(r,a,n,i){var o,l,s;return e.log("selection-scope",r.$id),o=i.me,s=void 0,l=t++,r.$watch("selectedDomain",function(e){return _.isArray(e)&&0===e.length?(s.clearSelection(),r.selectedDomainChange({domain:[]})):void 0}),o.lifeCycle().on("configure.selection"+l,function(){return s=o.behavior().selected,s.layout(o),s.active(!0),s.on("selected.selection"+l,function(e){return r.selectedDomain&&(r.selectedDomain=e),r.selectedDomainChange({domain:e}),r.$apply()}),o.lifeCycle().on("destroy.selection"+l,function(){return s.on(".selection"+l,null),o.lifeCycle().on(".selection"+l,null),r.$destroy()})})}}}]),angular.module("wk.chart").directive("tooltips",["$log","behavior",function(e){return{restrict:"A",require:"chart",link:function(t,r,a,n){var i;return i=n.me,e.log("tooltips-scope",t.$id),a.$observe("tooltips",function(e){return i.toolTipTemplate(""),void 0===e||""!==e&&"true"!==e?e.length>0&&"false"!==e?(i.toolTipTemplate(e),i.showTooltip(!0)):i.showTooltip(!1):i.showTooltip(!0)}),a.$observe("tooltipStyle",function(e){return e?i.tooltipStyle(t.$eval(e)):void 0
})}}}]),angular.module("wk.chart").factory("dataManagerFactory",["$log",function(){var e,t;return t=function(e,t,r){var a,n,i,o,l,s,c,u,d,f,h,y;if(l=0,o=0,h=e.length-1,f=t.length-1,d=Math.max(h,f),y=[],s=0,r){for(;h>=l&&f>=o;){for((u=t.indexOf(e[l]))>=0?(y.push({iOld:l,iNew:u,key:e[l]}),s=l,l++):(y.push({deleted:!0,iOld:l,key:e[l],atBorder:0===o,lowBorder:0===o}),l++);e.indexOf(t[o])<0&&f>=o;)y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:0===l,lowBorder:0===l}),o++;o++}for(;h>=l;)(u=t.indexOf(e[l]))>=0?(y.push({iOld:l,iNew:u,key:e[l]}),s=l,l++):(y.push({deleted:!0,iOld:l,key:e[l],atBorder:!0,highBorder:!0}),l++);for(;f>=o;)e.indexOf(t[o])<0?(y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:!0,highBorder:!0}),o++):o++}else{for(;h>=l&&f>=o;)e[l]===t[o]?(y.push({iOld:l,iNew:Math.min(o,f),key:e[l]}),s=l,l++,o++):e.indexOf(t[o],l)>=0?(y.push({deleted:!0,iOld:l,key:e[l],atBorder:0===o,lowBorder:0===o}),l++):(y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:0===l,lowBorder:0===l}),o++);for(;h>=l;)y.push({deleted:!0,iOld:l,key:e[l],atBorder:!0,highBorder:!0}),l++;for(;f>=o;)y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:!0,highBorder:!0}),o++}for(i=y.length-1,a=!0,c=t.length-1;i>=0;)n=y[i],n.deleted?(n.iSucc=c,n.succKey=t[c]):(c=n.iNew,a=!1),i--;return y},e=function(){var e,r,a,n,i,o,l,s,c,u,d,f,h,y,p;return i=[],n=[],c=[],s=[],u=void 0,p=void 0,h=[],d=[],f=[],y=void 0,o=!0,l=!1,a={},a.data=function(e,r){return i=n,c=s,f=d,d=p.layerKeys(e),n=_.clone(e),s=u.value(e),"time"===u.scaleType()&&(s=s.map(function(e){return+e})),h=t(c,s,r),y=t(f,d),a},a.isInitial=function(){return 0===i.length},r=function(){return function(){var e,t,r,a,l,s,u;for(u=[],l=c[0],e=!0,s=void 0,r=void 0,a=0,t=function(e){return o?l:e.key};a<h.length;)r=h[a],void 0!==r.iOld?(u.push({added:!1,key:r.key,targetKey:r.key,data:i[r.iOld],targetData:i[r.iOld],newData:n[r.iNew]}),l=r.key,s=r.iOld,e=!1):u.push({added:!0,atBorder:r.atBorder,lowBorder:r.lowBorder,highBorder:r.highBorder,targetKey:r.atBorder&&!o?r.key:l,key:r.key,data:r.atBorder?n[r.iNew]:i[s],targetData:n[r.iNew],newData:n[r.iNew]}),a++;return u}}(this),a.animationStartLayers=function(){var e;return e=r(),y.map(function(t){return{layerKey:void 0===t.iOld?d[t.iNew]:t.key,added:t.added,values:e.map(function(e){return{key:e.key,targetKey:e.targetKey,layerKey:t.key,layerAdded:t.added,added:e.added,atBorder:e.atBorder,lowBorder:e.lowBorder,highBorder:e.highBorder,value:p.layerValue(e.data,t.key),targetValue:t.added?p.layerValue(e.newData,t.key)||0:p.layerValue(e.targetData,t.key)||0,data:e.data}})}})},e=function(){return function(){var e,t,r,a,l,c,u;for(u=[],l=s[s.length-1],c=void 0,e=!0,a=h.length-1,t=function(e){return o?l:e.key};a>=0;)r=h[a],void 0!==r.iNew?(u.unshift({deleted:!1,key:r.key,targetKey:r.key,data:n[r.iNew],targetData:n[r.iNew],oldData:i[r.iOld]}),l=r.key,c=r.iNew,e=!1):u.unshift({deleted:!0,atBorder:r.atBorder,lowBorder:r.lowBorder,highBorder:r.highBorder,targetKey:r.atBorder&&!o?r.key:l,key:r.key,data:n[c],targetData:i[r.iOld],oldData:i[r.iOld]}),a--;return u}}(this),a.animationEndLayers=function(){var t;return t=e(),y.map(function(e){return{layerKey:e.key,deleted:e.deleted,values:t.map(function(t){return{key:t.key,targetKey:t.targetKey,layerKey:e.key,layerDeleted:e.deleted,deleted:t.deleted,atBorder:t.atBorder,lowBorder:t.lowBorder,highBorder:t.highBorder,value:t.deleted&&t.atBorder?p.layerValue(t.targetData,e.key):p.layerValue(t.data,e.key),targetValue:e.deleted?p.layerValue(t.oldData,e.key)||0:p.layerValue(t.targetData,e.key)||0,data:t.targetData}})}})},a.keyScale=function(e){return 0===arguments.length?u:(u=e,o=e.isOrdinal(),a)},a.valueScale=function(e){return 0===arguments.length?p:(p=e,l="rangeX"===e.kind()||"rangeY"===e.kind(),a)},a}}]),angular.module("wk.chart").directive("area",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return d=l.me,D=void 0,x={},S=!1,w=!1,A=!1,y=0,k="area"+i++,s=void 0,f=void 0,b=0,C=.5,m=a(),h=n(),v=r(),g=function(e,t,r,a,n){return m.keyScale(r).valueScale(a).data(e),m.isInitial()?void 0:(f=m.animationStartLayers(),u.apply(this,[!1,f,t,r,a,n]))},p=function(e,t,r,a,n){return h.active(S),f=m.animationEndLayers(),u.apply(this,[!0,f,t,r,a,n])},u=function(e,t,r,a,n,i){var o,l,c,u;return u=function(e){var t,r,a;return r=d3.select(this),r.style(w),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},y=a.isOrdinal()?a.scale().rangeBand()/2:0,D&&(D.data(t),v.layout(t)),s=d3.svg.area().x(function(e){return a.scale()(e.targetKey)}).y(function(e){return n.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).y1(function(){return n.scale()(0)}),A&&s.interpolate("cardinal"),l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),o=l.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-area-path").attr("d",function(e){return s(e.values)}).style("opacity",b).style("pointer-events","none"),c=l.select(".wk-chart-area-path").attr("transform","translate("+y+")").each(u),c=e?c.transition().duration(r.duration):c,c.attr("d",function(e){return s(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:C}),l.exit().remove(),h.x(function(e){return a.scale()(e.targetKey)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}).y(function(e){return n.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(a.scale()),l.call(h,e)},c=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return s(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),h.brush(this,t),v.brushRange(t)):(r.attr("d",function(e){return s(e.values)}),h.brush(this))},d.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),D=d.behavior().tooltip,v.keyScale(x.x).valueScale(x.y).colorScale(x.color).value(function(e){return e.value}),D.markerScale(x.x),D.on("enter."+k,v.enter),D.on("moveData."+k,v.moveData),D.on("moveMarker."+k,v.moveMarkers)}),d.lifeCycle().on("brushDraw."+k,c),d.lifeCycle().on("animationStartState."+k,g),d.lifeCycle().on("animationEndState."+k,p),d.lifeCycle().on("destroy."+k,function(){return d.lifeCycle().on("."+k,null),D.on("."+k,null)}),o.$observe("markers",function(e){return S=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("spline",function(e){return A=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?w=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("areaStacked",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(t,o,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M,O,K;return f=s.me,b=d3.layout.stack(),v="zero",h=null,B=!1,O=!1,x=[],c=void 0,A=void 0,K=void 0,$={},m=void 0,g=0,D="areaStacked"+i++,M=.5,C=a(),p=n(),y=void 0,S=r(),b.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.value}).x(function(e){return e.targetKey}),k=function(e,t,r,a,n){return C.keyScale(r).valueScale(a).data(e),C.isInitial()?void 0:(y=C.animationStartLayers(),d.apply(this,[!1,y,t,r,a,n]))},w=function(e,t,r,a,n){return p.active(B),y=C.animationEndLayers(),d.apply(this,[!0,y,t,r,a,n])},d=function(t,r,a,n,i,o){var l,s,u,d;return u=function(e){var t,r,a;return r=d3.select(this),r.style(A),a=o.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},x=b(r),g=n.isOrdinal()?n.scale().rangeBand()/2:0,e.log("offset",g),K&&(K.data(r),S.layout(r)),h||(h=this.selectAll(".wk-chart-layer")),"expand"===v?(m=i.scale().copy(),m.domain([0,1])):m=i.scale(),c=d3.svg.area().x(function(e){return n.scale()(e.targetKey)}).y0(function(e){return m(e.y0+e.y)}).y1(function(e){return m(e.y0)}),O&&c.interpolate("cardinal"),h=h.data(x,function(e){return e.layerKey}),l=h.enter().append("g").attr("class","wk-chart-layer"),l.append("path").attr("class","wk-chart-area-path").style("pointer-events","none").style("opacity",0),s=h.select(".wk-chart-area-path").attr("transform","translate("+g+")").each(u),d=t?s.transition().duration(a.duration):s,d.attr("d",function(e){return c(e.values)}).style("opacity",M),h.exit().remove(),p.x(function(e){return n.scale()(e.targetKey)+(n.isOrdinal()?n.scale().rangeBand()/2:0)}).y(function(e){return m(e.y+e.y0)}).color(function(e){var t;return t=o.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(n.scale()),h.call(p,t)},u=function(e,t){return h=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(h.attr("d",function(e){return c(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),p.brush(this,t),S.brushRange(t)):(h.attr("d",function(e){return c(e.values)}),p.brush(this))},f.lifeCycle().on("configure",function(){return $=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),K=f.behavior().tooltip,S.keyScale($.x).valueScale($.y).isStacked(!0).colorScale($.color).value(function(e){return e.y+e.y0}),K.markerScale($.x),K.on("enter."+D,S.enter),K.on("moveData."+D,S.moveData),K.on("moveMarker."+D,S.moveMarkers)}),f.lifeCycle().on("brushDraw."+D,u),f.lifeCycle().on("animationStartState."+D,k),f.lifeCycle().on("animationEndState."+D,w),f.lifeCycle().on("destroy."+D,function(){return f.lifeCycle().on("."+D,null),K.on("."+D,null)}),l.$observe("areaStacked",function(e){return v="zero"===e||"silhouette"===e||"expand"===e||"wiggle"===e?e:"zero",b.offset(v),f.lifeCycle().update()}),l.$observe("markers",function(e){return B=""===e||"true"===e?!0:!1,f.lifeCycle().update()}),l.$observe("spline",function(e){return O=""===e||"true"===e?!0:!1,f.lifeCycle().update()}),l.$observe("areaStyle",function(e){return e?A=t.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("areaStackedVertical",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M;return d=l.me,w=d3.layout.stack(),g="zero",f=null,D=!1,S={},B=!1,k=[],s=void 0,M=void 0,A={},p=0,C="areaStackedVert"+i++,$=.5,x=a(),y=n(),b=r(),h=void 0,w.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.value}).x(function(e){return e.targetKey}),m=function(e,t,r,a,n){return x.keyScale(a).valueScale(r).data(e),x.isInitial()?void 0:(h=x.animationStartLayers(),u.apply(this,[!1,h,t,r,a,n]))},v=function(e,t,r,a,n){return y.active(D),h=x.animationEndLayers(),u.apply(this,[!0,h,t,r,a,n])},u=function(e,t,r,a,n,i){var o,l,c,u,d;return u=function(e){var t,r,a;return r=d3.select(this),r.style(S),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},k=w(t),p=n.isOrdinal()?n.scale().rangeBand()/2:0,M&&(M.data(t),b.layout(t)),f||(f=this.selectAll(".wk-chart-layer")),"expand"===g?(c=a.scale().copy(),c.domain([0,1])):c=a.scale(),s=d3.svg.area().x(function(e){return-n.scale()(e.targetKey)}).y0(function(e){return c(e.y0+e.y)}).y1(function(e){return c(e.y0)}),B&&s.interpolate("cardinal"),f=f.data(k,function(e){return e.layerKey}),o=f.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-area-path").style("pointer-events","none").style("opacity",0),l=f.select(".wk-chart-area-path").attr("transform","translate("+p+")rotate(-90)").each(u),d=e?l.transition().duration(r.duration):l,d.attr("d",function(e){return s(e.values)}).style("opacity",$),f.exit().remove(),y.x(function(e){return c(e.y+e.y0)}).y(function(e){return n.scale()(e.targetKey)+(n.isOrdinal()?n.scale().rangeBand()/2:0)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(n.scale()).isVertical(!0),f.call(y,e)},c=function(e,t){return f=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(f.attr("d",function(e){return s(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),y.brush(this,t),b.brushRange(t)):(f.attr("d",function(e){return s(e.values)}),y.brush(this))},d.lifeCycle().on("configure",function(){return A=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).domainCalc("extent"),M=d.behavior().tooltip,b.keyScale(A.y).valueScale(A.x).isStacked(!0).colorScale(A.color).value(function(e){return e.y+e.y0}),M.markerScale(A.y),M.on("enter."+C,b.enter),M.on("moveData."+C,b.moveData),M.on("moveMarker."+C,b.moveMarkers)}),d.lifeCycle().on("brushDraw."+C,c),d.lifeCycle().on("animationStartState."+C,m),d.lifeCycle().on("animationEndState."+C,v),d.lifeCycle().on("destroy."+C,function(){return d.lifeCycle().on("."+C,null),M.on("."+C,null)}),o.$observe("areaStackedVertical",function(e){return g="zero"===e||"silhouette"===e||"expand"===e||"wiggle"===e?e:"zero",w.offset(g),d.lifeCycle().update()}),o.$observe("markers",function(e){return D=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("spline",function(e){return B=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?S=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("areaVertical",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B;return d=l.me,$=void 0,B=void 0,k=void 0,S={},D=!1,C=!1,w={},y=0,s=void 0,b="areaVertical"+i++,A=.5,f=void 0,x=0,m=a(),h=n(),v=r(),g=function(e,t,r,a,n){return m.keyScale(a).valueScale(r).data(e),m.isInitial()?void 0:(f=m.animationStartLayers(),u.apply(this,[!1,f,t,r,a,n]))},p=function(e,t,r,a,n){return h.active(C),f=m.animationEndLayers(),u.apply(this,[!0,f,t,r,a,n])},u=function(e,t,r,a,n,i){var o,l,c,u;return u=function(e){var t,r,a;return r=d3.select(this),r.style(w),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},y=n.isOrdinal()?n.scale().rangeBand()/2:0,$&&($.data(t),v.layout(t)),s=d3.svg.area().x(function(e){return-n.scale()(e.targetKey)}).y(function(e){return a.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).y1(function(){return a.scale()(0)}),D&&s.interpolate("cardinal"),l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),o=l.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-area-path").attr("d",function(e){return s(e.values)}).style("opacity",x).style("pointer-events","none"),c=l.select(".wk-chart-area-path").attr("transform","translate(0,"+y+")rotate(-90)").style("pointer-events","none"),c.each(u),c=e?c.transition().duration(r.duration):c,c.attr("d",function(e){return s(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:A}),l.exit().remove(),h.isVertical(!0).x(function(e){return a.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).y(function(e){return n.scale()(e.targetKey)+(n.isOrdinal()?n.scale().rangeBand()/2:0)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(n.scale()),l.call(h,e)},c=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return s(e.values.slice(t[0],t[1]+1))}).attr("transform","translate(0,"+e.scale().rangeBand()/2+")rotate(-90)"),h.brush(this,t),v.brushRange(t)):(r.attr("d",function(e){return s(e.values)}),h.brush(this))},d.lifeCycle().on("configure",function(){return S=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),$=d.behavior().tooltip,v.keyScale(S.y).valueScale(S.x).colorScale(S.color).value(function(e){return e.value}),$.markerScale(S.y),$.on("enter."+b,v.enter),$.on("moveData."+b,v.moveData),$.on("moveMarker."+b,v.moveMarkers)}),d.lifeCycle().on("brushDraw."+b,c),d.lifeCycle().on("animationStartState."+b,g),d.lifeCycle().on("animationEndState."+b,p),d.lifeCycle().on("destroy."+b,function(){return d.lifeCycle().on("."+b,null),$.on("."+b,null)}),o.$observe("markers",function(e){return C=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("spline",function(e){return D=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?w=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("bars",["$log","utils","barConfig","dataLabelFactory","dataManagerFactory","tooltipHelperFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return v=c.me,S="bars"+o++,f=null,d=0,u=0,C={},A=void 0,x={},y=_.clone(r,!0),b=n(),k=i(),p=a(),D=void 0,w=function(e,t,r,a,n){var i;return b.keyScale(a).valueScale(r).data(e,!0),b.isInitial()?void 0:(i=b.animationStartLayers(),g.apply(this,[!1,i,t,r,a,n]))},m=function(e,t,r,a,n){var i;return i=b.animationEndLayers(),p.duration(t.duration).active(v.showDataLabels()),g.apply(this,[!0,i,t,r,a,n])},g=function(e,t,r,a,n,i){var o,l,s,c,u,d,h,g;return h=function(e){var t,r,a;return r=d3.select(this),r.style(x),a=0===i.property().length?i.scale()(e.layerKey):i.map(e.data),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},g=!i.property()&&i.isOrdinal(),k.colorByKey(g),f||(f=this.selectAll(".wk-chart-layer")),o=n.scale().rangeBand(),s=o/(1-y.padding)*y.padding,l=o/(1-y.outerPadding)*y.outerPadding,u=function(e){if(n.reverse()){if(e.deleted&&e.highBorder)return o+s/2;if(e.deleted)return-s/2;if(e.added&&e.atBorder)return o+s/2;if(e.added)return-s/2}else{if(e.deleted&&e.highBorder)return-s/2;if(e.deleted)return o+s/2;if(e.added&&e.atBorder)return-s/2;if(e.added)return o+s/2}return 0},f=f.data(t[0].values,function(e){return e.key}),c=f.enter().append("g").attr("class","wk-chart-layer").attr("transform",function(e){return"translate("+a.scale()(0)+", "+(n.scale()(e.targetKey)+u(e))+")"}),c.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(e){return e.added||e.deleted?0:o}).style("opacity",0).call(D.tooltip).call(A),(e?f.transition().duration(r.duration):f).attr("transform",function(e){return"translate("+a.scale()(0)+", "+(n.scale()(e.targetKey)+u(e))+") scale(1,1)"}),d=f.select("rect").each(h),(e?d.transition().duration(r.duration):d).attr("height",function(e){return e.added||e.deleted?0:o}).attr("width",function(e){return Math.abs(a.scale()(0)-a.scale()(e.targetValue))}).style("opacity",1),f.exit().remove(),f.call(p,e,v.dataLabelStyle())},h=function(e){return f.attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()}),p.brush(f)},v.lifeCycle().on("configure",function(){return C=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(y).scaleType("ordinal"),D=v.behavior().tooltip,A=v.behavior().selected,k.keyScale(C.y).valueScale(C.x).colorScale(C.color).value(function(e){return e.value}),D.on("enter."+S,k.enter),p.keyScale(C.y).valueScale(C.x)}),v.lifeCycle().on("brushDraw."+S,h),v.lifeCycle().on("animationStartState."+S,w),v.lifeCycle().on("animationEndState."+S,m),v.lifeCycle().on("destroy."+S,function(){return v.lifeCycle().on("."+S,null),D.on("."+S,null)}),s.$observe("padding",function(e){var a;return"false"===e?(y.padding=0,y.outerPadding=0):"true"===e?y=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(y.padding=a[0]/100,y.outerPadding=a[0]/100),2===a.length&&(y.padding=a[0]/100,y.outerPadding=a[1]/100))),C.y.rangePadding(y),v.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?v.showDataLabels(!1):("true"===e||""===e)&&v.showDataLabels("x"),v.lifeCycle().update()}),s.$observe("labelStyle",function(t){return t&&v.dataLabelStyle(e.$eval(t)),v.lifeCycle().update()}),s.$observe("barStyle",function(t){return t?x=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("barClustered",["$log","utils","barConfig","dataManagerFactory","tooltipHelperFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"^layout",link:function(o,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M;return v=c.me,D="clusteredBar"+i++,w=null,A={},h=void 0,f=0,d=0,u=0,y=_.clone(r,!0),C=a(),S=n(),m=!0,x=d3.layout.stack(),x.values(function(e){return e.values}).y(function(e){return e.layerDeleted||e.layerAdded||e.deleted||e.added?0:u}).x(function(e){return e.layerKey}),M=void 0,B=void 0,$={},b=function(e,t,r,a,n){var i;return C.keyScale(a).valueScale(r).data(e,!0),C.isInitial()?void 0:(i=C.animationStartLayers(),g.apply(this,[!1,i,t,r,a,n]))},k=function(e,t,r,a,n){var i;return i=C.animationEndLayers(),g.apply(this,[!0,i,t,r,a,n])},g=function(t,r,a,n,i,o){var l,s,c,p,g,v,k,b;return k=function(e){var t,r,a;return r=d3.select(this),r.style(A),a=o.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},g=r.filter(function(e){return!e.added&&!e.deleted}).map(function(e){return e.layerKey}),c=i.scale().rangeBand(),h=d3.scale.ordinal().domain(g).rangeBands([0,c],0,0),u=h.rangeBand(),p=c/(1-y.padding)*y.padding,l=c/(1-y.outerPadding)*y.outerPadding,v=function(e){if(i.reverse()){if(e.deleted&&e.highBorder)return c+p/2;if(e.deleted)return-p/2;if(e.added&&e.atBorder)return c+p/2;if(e.added)return-p/2}else{if(e.deleted&&e.highBorder)return-p/2;if(e.deleted)return c+p/2;if(e.added&&e.atBorder)return-p/2;if(e.added)return c+p/2}return 0},b=x(r),e.log(b),w||(w=this.selectAll(".wk-chart-layer")),w=w.data(b,function(e){return e.layerKey}),w.enter().append("g").attr("class","wk-chart-layer"),w.exit().remove(),s=w.selectAll(".wk-chart-rect").data(function(e){return e.values},function(e){return e.layerKey+"|"+e.key}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).call(M.tooltip).call(B),s.each(k),(t?s.transition().duration(a.duration):s).attr("y",function(e){return i.scale()(e.targetKey)+e.y0+v(e)}).attr("height",function(e){return e.y}).attr("width",function(e){return Math.abs(n.scale()(e.targetValue)||0)}).attr("x",function(e){return Math.min(n.scale()(0),n.scale()(e.targetValue))}).style("opacity",1),s.exit().remove(),m=!1,f=p,d=l},p=function(e,t){var r,a;return h.rangeBands([0,e.scale().rangeBand()],0,0),a=h.rangeBand(),r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("y",function(t){var r;return(r=e.scale()(t.targetKey))>=0?r+h(t.layerKey):-1e3}).attr("height",function(){return a}),S.brushRange(t)):void 0},v.lifeCycle().on("configure",function(){return $=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(y).scaleType("ordinal"),this.layerScale("color"),M=v.behavior().tooltip,M.on("enter."+D,S.enter),B=v.behavior().selected,S.keyScale($.y).valueScale($.x).colorScale($.color).value(function(e){return e.value})}),v.lifeCycle().on("brushDraw."+D,p),v.lifeCycle().on("animationStartState."+D,b),v.lifeCycle().on("animationEndState."+D,k),v.lifeCycle().on("destroy."+D,function(){return v.lifeCycle().on("."+D,null),M.on("."+D,null)}),s.$observe("padding",function(e){var a;return"false"===e?(y.padding=0,y.outerPadding=0):"true"===e?y=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(y.padding=a[0]/100,y.outerPadding=a[0]/100),2===a.length&&(y.padding=a[0]/100,y.outerPadding=a[1]/100))),$.y.rangePadding(y),v.lifeCycle().update()}),s.$observe("barStyle",function(e){return e?A=o.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("barStacked",["$log","utils","barConfig","dataManagerFactory","tooltipHelperFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,o,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return f=s.me,k="stackedBar"+i++,h=null,S=void 0,b={},x=void 0,w={},u=_.clone(r,!0),m=a(),v=n(),g=d3.layout.stack(),g.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.targetValue}).x(function(e){return e.targetKey}),p=function(e,t,r,a,n){var i;return m.keyScale(a).valueScale(r).data(e,!0),m.isInitial()?void 0:(i=m.animationStartLayers(),d.apply(this,[!1,i,t,r,a,n]))},y=function(e,t,r,a,n){var i;return i=m.animationEndLayers(),d.apply(this,[!0,i,t,r,a,n])},d=function(e,t,r,a,n,i){var o,l,s,c,d,f;return d=function(e){var t,r,a;return r=d3.select(this),r.style(w),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},h||(h=this.selectAll(".wk-chart-layer")),l=n.scale().rangeBand()/(1-u.padding)*u.padding,f=g(t),h=h.data(f,function(e){return e.layerKey}),o=n.scale().rangeBand(),c=function(e){if(n.reverse()){if(e.deleted&&e.highBorder)return o+l/2;if(e.deleted)return-l/2;if(e.added&&e.atBorder)return o+l/2;if(e.added)return-l/2}else{if(e.deleted&&e.highBorder)return-l/2;if(e.deleted)return o+l/2;if(e.added&&e.atBorder)return-l/2;if(e.added)return o+l/2}return 0},h.enter().append("g").attr("class","wk-chart-layer"),h.exit().remove(),s=h.selectAll(".wk-chart-rect"),s=s.data(function(e){return e.values},function(e){return e.key.toString()+"|"+e.layerKey.toString()}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).style("opacity",0).call(S.tooltip).call(x),s.each(d),(e?s.transition().duration(r.duration):s).attr("x",function(e){return a.scale()(e.y0)}).attr("width",function(e){return a.scale()(e.y)}).attr("height",function(e){return e.added||e.deleted?0:o}).attr("y",function(e){return n.scale()(e.targetKey)+c(e)}).style("opacity",1),s.exit().remove()},c=function(e,t){var r;return r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("y",function(t){var r;return(r=e.scale()(t.key))>=0?r:-1e3}).attr("height",function(){return e.scale().rangeBand()}),v.brushRange(t)):void 0},f.lifeCycle().on("configure",function(){return b=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(u).scaleType("ordinal"),this.layerScale("color"),S=f.behavior().tooltip,x=f.behavior().selected,S.on("enter."+k,v.enter),v.keyScale(b.y).valueScale(b.x).colorScale(b.color).value(function(e){return e.value})}),f.lifeCycle().on("brushDraw."+k,c),f.lifeCycle().on("animationStartState."+k,p),f.lifeCycle().on("animationEndState."+k,y),f.lifeCycle().on("destroy."+k,function(){return f.lifeCycle().on("."+k,null),S.on("."+k,null)}),l.$observe("padding",function(e){var a;return"false"===e?(u.padding=0,u.outerPadding=0):"true"===e?u=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(u.padding=a[0]/100,u.outerPadding=a[0]/100),2===a.length&&(u.padding=a[0]/100,u.outerPadding=a[1]/100))),b.y.rangePadding(u),f.lifeCycle().update()}),l.$observe("barStyle",function(t){return t?w=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("boxPlot",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return h=c.me,x="boxPlot"+o++,b={},D=void 0,C=void 0,S={},A=!1,g=0,y=void 0,d=_.clone(r,!0),k=a(),p=n(),w=i(),m=function(e,t,r,a,n){return k.keyScale(r).valueScale(a).data(e,!0),k.isInitial()?void 0:(y=k.animationStartLayers(),f.apply(this,[!1,y,t,r,a,n]))},v=function(e,t,r,a,n){return p.active(A),y=k.animationEndLayers(),f.apply(this,[!0,y,t,r,a,n])},f=function(e,t,r,a,n,i){var o,l,s,c,u,f,h,y,p,v,m,k,x,S,A,$,B,M,O,K,L,P,V;for($=function(e,t){return e.each(function(e){var r,a,n;return a=d3.select(this),a.style(b),n=i.scale()(e[t].property),"string"==typeof n?a.style({fill:n,stroke:n}):(r=n.color,n.fill=r,a.style(n))})},l=a.scale().rangeBand(),o=l/(1-d.padding)*d.padding,g=n.isOrdinal()?l/2:0,D&&(D.data(t),w.layout(t)),g=function(e){return e.deleted&&e.atBorder?l:e.deleted?-o/2:e.added&&e.atBorder?l+o/2:e.added?-o/2:0},A=[],u=0,M=!1,B=!1,3===t.length?x=["lq","med","uq"]:5===t.length&&(x=["min","lq","med","uq","max"],M=B=!0),y=n.property();u<t[0].values.length;){for(S={},S.key=t[0].values[u].key,S.targetKey=t[0].values[u].targetKey,S.data=t[0].values[u].data,S.added=t[0].values[u].added,S.deleted=t[0].values[u].deleted,f=P=0,V=x.length;V>P;f=++P)k=x[f],S[k]={},S[k].val=t[f].values[u].targetValue,S[k].property=y[f];A.push(S),u++}return s=this.selectAll(".wk-chart-box").data(A,function(e){return e.key}),c=s.enter().append("g").attr("class","wk-chart-box wk-chart-selectable").attr("transform",function(e){return"translate("+(a.scale()(e.targetKey)+g(e))+")"}).classed("wk-chart-hidden",!0).style("opacity",0).call(C),c.append("rect").attr("class","wk-chart-box-uq wk-chart-selectable").classed("wk-chart-hidden",!0).style("opacity",0).style("fill","white").style("stroke","black").call(D.tooltip),c.append("rect").attr("class","wk-chart-box-lq  wk-chart-selectable").classed("wk-chart-hidden",!0).style("opacity",0).style("fill","white").style("stroke","black").call(D.tooltip),c.append("line").attr("class","wk-chart-box-med").classed("wk-chart-hidden",!0).style({opacity:0}),c.append("line").attr("class","wk-chart-box-lw").classed("wk-chart-hidden",!0).style({opacity:0}),c.append("line").attr("class","wk-chart-box-lw-conn").classed("wk-chart-hidden",!0).style({opacity:0,"stroke-dasharray":"2.2"}),c.append("line").attr("class","wk-chart-box-uw").classed("wk-chart-hidden",!0).style({stroke:"black",opacity:0}),c.append("line").attr("class","wk-chart-box-uw-conn").classed("wk-chart-hidden",!0).style({opacity:0,"stroke-dasharray":"2.2"}),(e?s.transition().duration(r.duration):s).attr("transform",function(e){return"translate("+(a.scale()(e.targetKey)+g(e))+")"}).style("opacity",function(e){return e.deleted?0:1}),K=s.select(".wk-chart-box-uq").call($,"uq"),(e?K.transition().duration(r.duration):K).attr("y",function(e){return n.scale()(e.uq.val)}).attr("height",function(e){return Math.abs(n.scale()(e.uq.val)-n.scale()(e.med.val))}).attr("width",function(e){return e.added||e.deleted?0:l}).style("opacity",1),p=s.select(".wk-chart-box-lq").call($,"lq"),(e?p.transition().duration(r.duration):p).attr("y",function(e){return n.scale()(e.med.val)}).attr("height",function(e){return Math.abs(n.scale()(e.med.val)-n.scale()(e.lq.val))}).attr("width",function(e){return e.added||e.deleted?0:l}).style("opacity",1),m=s.select(".wk-chart-box-med").call($,"med"),(e?m.transition().duration(r.duration):m).attr("x1",.2*-l).attr("x2",function(e){return e.added||e.deleted?0:1.3*l}).attr("y1",function(e){return n.scale()(e.med.val)}).attr("y2",function(e){return n.scale()(e.med.val)}).style({opacity:1,"stroke-width":2}),h=s.select(".wk-chart-box-lw").call($,"min"),(e?h.transition().duration(r.duration):h).attr("x1",0).attr("x2",function(e){return e.added||e.deleted?0:l}).attr("y1",function(e){return M?n.scale()(e.min.val):0}).attr("y2",function(e){return M?n.scale()(e.min.val):0}).style({opacity:1,"stroke-width":3}).style("visibility",M?"visible":"none"),v=s.select(".wk-chart-box-lw-conn"),(e?v.transition().duration(r.duration):v).attr("x1",function(e){return e.added||e.deleted?0:l/2}).attr("x2",function(e){return e.added||e.deleted?0:l/2}).attr("y1",function(e){return M?n.scale()(e.lq.val):0}).attr("y2",function(e){return M?n.scale()(e.min.val):0}).style("opacity",1).style("stroke","black").style("visibility",M?"visible":"none"),O=s.select(".wk-chart-box-uw").call($,"max"),(e?O.transition().duration(r.duration):O).attr("x1",0).attr("x2",function(e){return e.added||e.deleted?0:l
}).attr("y1",function(e){return B?n.scale()(e.max.val):0}).attr("y2",function(e){return B?n.scale()(e.max.val):0}).style({opacity:1,"stroke-width":3}).style("visibility",B?"visible":"none"),L=s.select(".wk-chart-box-uw-conn"),(e?L.transition().duration(r.duration):L).attr("x1",function(e){return e.added||e.deleted?0:l/2}).attr("x2",function(e){return e.added||e.deleted?0:l/2}).attr("y1",function(e){return B?n.scale()(e.uq.val):0}).attr("y2",function(e){return B?n.scale()(e.max.val):0}).style("opacity",1).style("stroke","black").style("visibility",B?"visible":"none"),s.exit().remove()},u=function(e){return this.selectAll(".wk-chart-rect").attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.targetKey))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return S=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(d).scaleType("ordinal"),D=h.behavior().tooltip,w.keyScale(S.x).valueScale(S.y).colorScale(S.color).value(function(e){return e.value}),C=h.behavior().selected,D.on("enter."+x,w.enter)}),h.lifeCycle().on("brushDraw."+x,u),h.lifeCycle().on("animationStartState."+x,m),h.lifeCycle().on("animationEndState."+x,v),h.lifeCycle().on("destroy."+x,function(){return h.lifeCycle().on("."+x,null),D.on("."+x,null)}),s.$observe("padding",function(e){var a;return"false"===e?(d.padding=0,d.outerPadding=0):"true"===e?d=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(d.padding=a[0]/100,d.outerPadding=a[0]/100),2===a.length&&(d.padding=a[0]/100,d.outerPadding=a[1]/100))),S.x.rangePadding(d),h.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?h.showDataLabels(!1):("true"===e||""===e)&&h.showDataLabels("y"),h.lifeCycle().update()}),s.$observe("boxStyle",function(t){return t?b=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("bubble",["$log","utils",function(){var e;return e=0,{restrict:"A",require:"layout",link:function(t,r,a,n){var i,o,l,s,c,u,d;return o=n.me,d=void 0,c={},s="bubble"+e++,u=void 0,l=function(e){var t,r,a;a=[];for(t in c)r=c[t],a.push(this.layers[r.axisLabel()]={value:r.formattedValue(e),color:"color"===t?{fill:"string"==typeof r.map(e)?r.map(e):r.map(e).color}:{fill:"none"}});return a},i=function(e,t,r,a,n,i){var o,l;return l=function(e){var t,r,a;return r=d3.select(this),a=n.map(e),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},o=this.selectAll(".wk-chart-bubble").data(e,function(e){return n.value(e)}),o.enter().append("circle").attr("class","wk-chart-bubble wk-chart-selectable").style("opacity",0).call(d.tooltip).call(u),o.each(l).transition().duration(t.duration).attr({r:function(e){return i.map(e)},cx:function(e){return r.map(e)},cy:function(e){return a.map(e)}}).style("opacity",1),o.exit().transition().duration(t.duration).style("opacity",0).remove()},o.lifeCycle().on("configure",function(){return c=this.getScales(["x","y","color","size"]),this.getKind("y").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0),d=o.behavior().tooltip,u=o.behavior().selected,d.on("enter."+s,l)}),o.lifeCycle().on("drawChart."+s,i),o.lifeCycle().on("destroy."+s,function(){return o.lifeCycle().on("."+s,null),d.on("."+s,null)})}}}]),angular.module("wk.chart").directive("column",["$log","utils","barConfig","dataManagerFactory","dataLabelFactory","tooltipHelperFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C;return p=c.me,b="column"+o++,d=null,x={},S=void 0,f=_.clone(r,!0),w=a(),m=i(),h=n(),C=void 0,k={"stroke-width":1},v=function(e,t,r,a,n){var i;return w.keyScale(r).valueScale(a).data(e,!0),w.isInitial()?void 0:(i=w.animationStartLayers(),y.apply(this,[!1,i,t,r,a,n]))},g=function(e,t,r,a,n){var i;return i=w.animationEndLayers(),h.duration(t.duration).active(p.showDataLabels()),y.apply(this,[!0,i,t,r,a,n])},y=function(e,t,r,a,n,i){var o,l,s,c,u,y,g;return y=function(e){var t,r,a;return r=d3.select(this),r.style(k),a=0===i.property().length?i.scale()(e.layerKey):i.map(e.data),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},g=!i.property()&&i.isOrdinal(),m.colorByKey(g),d||(d=this.selectAll(".wk-chart-layer")),l=a.scale().rangeBand(),o=l/(1-f.padding)*f.padding,c=function(e){if(a.reverse()){if(e.deleted&&e.highBorder)return-o/2;if(e.deleted)return l+o/2;if(e.added&&e.atBorder)return-o/2;if(e.added)return l+o/2}else{if(e.deleted&&e.highBorder)return l;if(e.deleted)return-o/2;if(e.added&&e.atBorder)return l+o/2;if(e.added)return-o/2}return 0},d=d.data(t[0].values,function(e){return e.key}),s=d.enter().append("g").attr("class","wk-chart-layer").attr("transform",function(e){return"translate("+a.scale()(e.targetKey)+")"}),s.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("width",function(e){return e.added||e.deleted?0:l}).style("opacity",0).call(C.tooltip).call(S),(e?d.transition().duration(r.duration):d).attr("transform",function(e){return"translate("+(a.scale()(e.targetKey)+c(e))+")"}),u=d.select("rect").each(y),(e?u.transition().duration(r.duration):u).attr("width",function(e){return e.added||e.deleted?0:l}).attr("height",function(e){return Math.abs(n.scale()(0)-n.scale()(e.targetValue))}).attr("y",function(e){return Math.min(n.scale()(0),n.scale()(e.targetValue))}).style("opacity",1),d.call(h,e,p.dataLabelStyle()),d.exit().remove()},u=function(e){return d.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("width",function(){return e.scale().rangeBand()}),h.brush(d)},p.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(f).scaleType("ordinal"),C=p.behavior().tooltip,S=p.behavior().selected,m.keyScale(x.x).valueScale(x.y).colorScale(x.color).value(function(e){return e.value}),h.keyScale(x.x).valueScale(x.y),C.on("enter."+b,m.enter)}),p.lifeCycle().on("brushDraw."+b,u),p.lifeCycle().on("animationStartState."+b,v),p.lifeCycle().on("animationEndState."+b,g),p.lifeCycle().on("destroy."+b,function(){return p.lifeCycle().on("."+b,null),C.on("."+b,null)}),s.$observe("padding",function(e){var a;return"false"===e?(f.padding=0,f.outerPadding=0):"true"===e?f=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(f.padding=a[0]/100,f.outerPadding=a[0]/100),2===a.length&&(f.padding=a[0]/100,f.outerPadding=a[1]/100))),x.x.rangePadding(f),p.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?p.showDataLabels(!1):("true"===e||""===e)&&p.showDataLabels("y"),p.lifeCycle().update()}),s.$observe("labelStyle",function(t){return t&&p.dataLabelStyle(e.$eval(t)),p.lifeCycle().update()}),s.$observe("columnStyle",function(t){return t?k=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("columnClustered",["$log","utils","barConfig","dataManagerFactory","tooltipHelperFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"^layout",link:function(o,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M;return v=c.me,D="clusteredColumn"+i++,A={},w=null,h=void 0,d=0,u=0,f=0,y=_.clone(r,!0),C=a(),S=n(),m=!0,x=d3.layout.stack(),x.values(function(e){return e.values}).y(function(e){return e.layerDeleted||e.layerAdded||e.deleted||e.added?0:f}).x(function(e){return e.layerKey}),M=void 0,B=void 0,$={},b=function(e,t,r,a,n){var i;return C.keyScale(r).valueScale(a).data(e,!0),C.isInitial()?void 0:(i=C.animationStartLayers(),g.apply(this,[!1,i,t,r,a,n]))},k=function(e,t,r,a,n){var i;return i=C.animationEndLayers(),g.apply(this,[!0,i,t,r,a,n])},g=function(t,r,a,n,i,o){var l,s,c,p,g,v,k,b;return k=function(e){var t,r,a;return r=d3.select(this),r.style(A),a=o.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},g=r.filter(function(e){return!e.added&&!e.deleted}).map(function(e){return e.layerKey}),p=n.scale().rangeBand(),h=d3.scale.ordinal().domain(g).rangeBands([0,p],0,0),f=h.rangeBand(),c=p/(1-y.padding)*y.padding,l=p/(1-y.outerPadding)*y.outerPadding,v=function(e){if(n.reverse()){if(e.deleted&&e.highBorder)return c/2;if(e.deleted)return p+c/2;if(e.added&&e.atBorder)return c/2;if(e.added)return p+c/2}else{if(e.deleted&&e.highBorder)return p;if(e.deleted)return 0-c/2;if(e.added&&e.atBorder)return p+c/2;if(e.added)return 0-c/2}return 0},b=x(r),e.log(b),w||(w=this.selectAll(".wk-chart-layer")),w=w.data(b,function(e){return e.layerKey}),w.enter().append("g").attr("class","wk-chart-layer"),w.exit().remove(),s=w.selectAll(".wk-chart-rect").data(function(e){return e.values},function(e){return e.layerKey+"|"+e.key}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).call(M.tooltip).call(B),s.each(k),(t?s.transition().duration(a.duration):s).attr("x",function(e){return n.scale()(e.targetKey)+e.y0+v(e)}).attr("width",function(e){return e.y}).attr("height",function(e){return Math.abs(i.scale()(0)-i.scale()(e.targetValue))}).attr("y",function(e){return Math.min(i.scale()(0),i.scale()(e.targetValue))}).style("opacity",1),s.exit().remove(),m=!1,d=c,u=l},p=function(e,t){var r,a;return h.rangeBands([0,e.scale().rangeBand()],0,0),a=h.rangeBand(),r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("x",function(t){var r;return(r=e.scale()(t.targetKey))>=0?r+h(t.layerKey):-1e3}).attr("width",function(){return a}),S.brushRange(t)):void 0},v.lifeCycle().on("configure",function(){return $=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(y).scaleType("ordinal"),this.layerScale("color"),M=v.behavior().tooltip,M.on("enter."+D,S.enter),B=v.behavior().selected,S.keyScale($.x).valueScale($.y).colorScale($.color).value(function(e){return e.value})}),v.lifeCycle().on("brushDraw."+D,p),v.lifeCycle().on("animationStartState."+D,b),v.lifeCycle().on("animationEndState."+D,k),v.lifeCycle().on("destroy."+D,function(){return v.lifeCycle().on("."+D,null),M.on("."+D,null)}),s.$observe("padding",function(e){var a;return"false"===e?(y.padding=0,y.outerPadding=0):"true"===e?y=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(y.padding=a[0]/100,y.outerPadding=a[0]/100),2===a.length&&(y.padding=a[0]/100,y.outerPadding=a[1]/100))),$.y.rangePadding(y),v.lifeCycle().update()}),s.$observe("columnStyle",function(e){return e?A=o.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("columnStacked",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"layout",link:function(e,n,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return f=s.me,k="stackedColumn"+o++,h=null,w={},S=void 0,b={},x=void 0,u=_.clone(r,!0),m=a(),v=i(),g=d3.layout.stack(),g.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.targetValue}).x(function(e){return e.targetKey}),p=function(e,t,r,a,n){var i;return m.keyScale(r).valueScale(a).data(e,!0),m.isInitial()?void 0:(i=m.animationStartLayers(),d.apply(this,[!1,i,t,r,a,n]))},y=function(e,t,r,a,n){var i;return i=m.animationEndLayers(),d.apply(this,[!0,i,t,r,a,n])},d=function(e,t,r,a,n,i){var o,l,s,c,d,f;return d=function(e){var t,r,a;return r=d3.select(this),r.style(w),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},l=a.scale().rangeBand(),o=l/(1-u.padding)*u.padding,c=function(e){if(a.reverse()){if(e.deleted&&e.highBorder)return-o/2;if(e.deleted)return l+o/2;if(e.added&&e.atBorder)return-o/2;if(e.added)return l+o/2}else{if(e.deleted&&e.highBorder)return l;if(e.deleted)return-o/2;if(e.added&&e.atBorder)return l+o/2;if(e.added)return-o/2}return 0},h||(h=this.selectAll(".wk-chart-layer")),f=g(t),h=h.data(f,function(e){return e.layerKey}),h.enter().append("g").attr("class","wk-chart-layer"),h.exit().remove(),s=h.selectAll(".wk-chart-rect"),s=s.data(function(e){return e.values},function(e){return e.key.toString()+"|"+e.layerKey.toString()}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).call(S.tooltip).call(x),s.each(d),(e?s.transition().duration(r.duration):s).attr("y",function(e){return n.scale()(e.y0+e.y)}).attr("height",function(e){return n.scale()(0)-n.scale()(e.y)}).attr("width",function(e){return e.added||e.deleted?0:l}).attr("x",function(e){return a.scale()(e.targetKey)+c(e)}).style("opacity",1),s.exit().remove()},c=function(e,t){var r;return r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("x",function(t){var r;return(r=e.scale()(t.key))>=0?r:-1e3}).attr("width",function(){return e.scale().rangeBand()}),v.brushRange(t)):void 0},f.lifeCycle().on("configure",function(){return b=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(u).scaleType("ordinal"),this.layerScale("color"),S=f.behavior().tooltip,x=f.behavior().selected,S.on("enter."+k,v.enter),v.keyScale(b.x).valueScale(b.y).colorScale(b.color).value(function(e){return e.value})}),f.lifeCycle().on("brushDraw."+k,c),f.lifeCycle().on("animationStartState."+k,p),f.lifeCycle().on("animationEndState."+k,y),f.lifeCycle().on("destroy."+k,function(){return f.lifeCycle().on("."+k,null),S.on("."+k,null)}),l.$observe("padding",function(e){var a;return"false"===e?(u.padding=0,u.outerPadding=0):"true"===e?u=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(u.padding=a[0]/100,u.outerPadding=a[0]/100),2===a.length&&(u.padding=a[0]/100,u.outerPadding=a[1]/100))),b.x.rangePadding(u),f.lifeCycle().update()}),l.$observe("columnStyle",function(t){return t?w=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("gauge",["$log","utils",function(e,t){return{restrict:"A",require:"^layout",controller:["$scope","$attrs",function(e,r){var a;return a={chartType:"GaugeChart",id:t.getId()},r.$set("chart-id",a.id),a}],link:function(t,r,a,n){var i,o,l;return l=n.me,o=!0,i=function(t,r,a,n,i){var l,s,c,u,d,f,h,y,p,g;for(e.info("drawing Gauge Chart"),u=[t],y=n.scale().domain(),c=angular.copy(i.scale().domain()),c.unshift(y[0]),c.push(y[1]),h=[],d=p=1,g=c.length-1;g>=1?g>=p:p>=g;d=g>=1?++p:--p)h.push({from:+c[d-1],to:+c[d]});return s=this.selectAll(".wk-chart-bar"),s=s.data(h,function(e,t){return t}),o?s.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50).style("opacity",0):s.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50),s.transition().duration(r.duration).attr("height",function(e){return n.scale()(0)-n.scale()(e.to-e.from)}).attr("y",function(e){return n.scale()(e.to)}).style("fill",function(e){return i.scale()(e.from)}).style("opacity",1),s.exit().remove(),l=function(e){return e.append("rect").attr("width",55).attr("height",4).style("fill","black"),e.append("circle").attr("r",10).attr("cx",65).attr("cy",2).style("stroke","black")},f=this.selectAll(".wk-chart-marker"),f=f.data(u,function(){return"wk-chart-marker"}),f.enter().append("g").attr("class","wk-chart-marker").call(l),o&&f.attr("transform",function(e){return"translate(0,"+n.scale()(e.value)+")"}).style("opacity",0),f.transition().duration(r.duration).attr("transform",function(e){return"translate(0,"+n.scale()(e.value)+")"}).style("fill",function(e){return i.scale()(e.value)}).style("opacity",1),o=!1},l.lifeCycle().on("configure",function(){return this.requiredScales(["y","color"]),this.getKind("color").resetOnNewData(!0)}),l.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("geoMap",["$log","utils",function(e){var t,r;return t=0,r=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),t=t.map(function(e){return isNaN(e)?e:+e}),1===t.length?t[0]:t):void 0},{restrict:"A",require:"layout",scope:{geojson:"=",projection:"="},link:function(r,a,n,i){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return l=i.me,b=void 0,k=void 0,w={},h="geoMap"+t++,u=d3.map(),m=1,v=[0,0],y="",c=function(e){var t,r;return r=u.get(e.properties[y[0]]),t=w.color.map(r),this.layers[r.RS]={value:r.DES,color:{fill:"string"==typeof t?t:t.color}}},s=[],g=d3.geo.orthographic(),x=0,f=0,p=void 0,S=d3.geo.zoom().projection(g).on("zoom.redraw",function(){return d3.event.sourceEvent.preventDefault(),s.attr("d",p)}),d=void 0,o=function(e,t,r,a,n){var i,o,l,c;if(o=function(e){var t,r,a,i;return r=d3.select(this),i=u.get(e.properties[y[0]]),a=n.map(i),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},x=t.width,f=t.height,e&&e[0].hasOwnProperty(y[1]))for(l=0,c=e.length;c>l;l++)i=e[l],u.set(i[y[1]],i);return d?(g.translate([x/2,f/2]),s=this.selectAll("path").data(d.features,function(e){return e.properties[y[0]]}),s.enter().append("svg:path").style("fill","lightgrey").style("stroke","darkgrey").call(b.tooltip).call(k).call(S),s.attr("d",p).each(o),s.exit().remove()):void 0},l.lifeCycle().on("configure",function(){return w=this.getScales(["color"]),w.color.resetOnNewData(!0)}),l.lifeCycle().on("drawChart",o),b=l.behavior().tooltip,k=l.behavior().selected,b.on("enter."+h,c),l.lifeCycle().on("destroy."+h,function(){return l.lifeCycle().on("."+h,null),b.on("."+h,null),r.$destroy()}),r.$watch("projection",function(t){return void 0!==t&&(e.log("setting Projection params",t),d3.geo.hasOwnProperty(t.projection))?(g=d3.geo[t.projection](),g.center(t.center).scale(t.scale).rotate(t.rotate).clipAngle(t.clipAngle),y=t.idMap,g.parallels&&g.parallels(t.parallels),m=g.scale(),v=g.rotate(),p=d3.geo.path().projection(g),S.projection(g),l.lifeCycle().update()):void 0},!0),r.$watch("geojson",function(e){return void 0!==e&&""!==e?(d=e,l.lifeCycle().update()):void 0})}}}]),angular.module("wk.chart").directive("columnHistogramOld",["$log","barConfig","utils","wkChartMargins",function(e,t,r,a){var n;return n=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k;return f=l.me,g="histogram"+n++,m={},c=void 0,y=void 0,u={},k=void 0,w=void 0,u=_.clone(t,!0),v=r.mergeData().key(function(e){return e.xVal}),h=!0,k=void 0,p=function(e){var t,r,a;return this.headerName=m.rangeX.axisLabel(),this.headerValue=m.y.axisLabel(),t=m.rangeX.formatValue(m.rangeX.lowerValue(e.data)),m.rangeX.upperProperty()?(a=m.rangeX.formatValue(m.rangeX.upperValue(e.data)),r=t+" - "+a):r=m.rangeX.formatValue(m.rangeX.lowerValue(e.data)),this.layers.push({name:r,value:m.y.formattedValue(e.data),color:{"background-color":m.color.map(e.data)}})},d=function(e,t,r,n,i,o,l,s){var u,d,y,p,g;return s.upperProperty()?d=e.map(function(e){return{x:s.scale()(s.lowerValue(e)),xVal:s.lowerValue(e),width:s.scale()(s.upperValue(e))-s.scale()(s.lowerValue(e)),y:n.map(e),height:t.height-n.map(e),color:i.map(e),data:e}}):e.length>0&&(y=s.lowerValue(e[0]),p=s.lowerValue(e[1])-y,g=t.width/e.length,d=e.map(function(e,r){return{x:s.scale()(y+p*r),xVal:s.lowerValue(e),width:g,y:n.map(e),height:t.height-n.map(e),color:i.map(e),data:e}})),v(d).first({x:0,width:0}).last({x:t.width,width:0}),c||(c=this.selectAll(".wk-chart-bucket")),c=c.data(d,function(e){return e.xVal}),u=c.enter().append("g").attr("class","wk-chart-bucket").attr("transform",function(e){return"translate("+(h?e.x:v.addedPred(e).x+v.addedPred(e).width)+","+e.y+") scale("+(h?1:0)+",1)"}),u.append("rect").attr("class","wk-chart-selectable").attr("height",function(e){return e.height}).attr("width",function(e){return e.width}).style("fill",function(e){return e.color}).style("opacity",h?0:1).call(k.tooltip).call(w),u.append("text").attr("class","wk-chart-data-label").attr("x",function(e){return e.width/2}).attr("y",-a.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),c.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+", "+e.y+") scale(1,1)"}),c.select("rect").transition().duration(t.duration).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}).style("fill",function(e){return e.color}).style("opacity",1),c.select("text").text(function(e){return n.formattedValue(e.data)}).transition().duration(t.duration).attr("x",function(e){return e.width/2}).style("opacity",f.showDataLabels()?1:0),c.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+v.deletedSucc(e).x+","+e.y+") scale(0,1)"}).remove(),h=!1},s=function(e,t,r){var a;return a=function(e,a){return e.upperProperty()?e.scale()(e.upperValue(a.data))-e.scale()(e.lowerValue(a.data)):r/Math.max(t[1]-t[0]+1,1)},c.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.xVal))>=0?r:-1e3)+", "+t.y+")"}),c.select("rect").attr("width",function(t){return a(e,t)}),c.selectAll("text").attr("x",function(t){return a(e,t)/2})},f.lifeCycle().on("configure",function(){return m=this.getScales(["rangeX","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("rangeX").resetOnNewData(!0).scaleType("linear").domainCalc("rangeExtent"),this.getKind("color").resetOnNewData(!0),k=f.behavior().tooltip,w=f.behavior().selected,k.on("enter."+g,p)}),f.lifeCycle().on("drawChart",d),f.lifeCycle().on("brushDraw",s),o.$observe("labels",function(e){return"false"===e?f.showDataLabels(!1):("true"===e||""===e)&&f.showDataLabels("y"),f.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("line",["$log","behavior","utils","dataManagerFactory","tooltipHelperFactory","markerFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"layout",link:function(t,r,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return d=s.me,A=void 0,S=!1,C=!1,b={"stroke-width":1},x={},p=0,k="line"+o++,h=void 0,y=void 0,f=void 0,w=a(),y=i(),m=n(),v=function(e,t,r,a,n){return w.keyScale(r).valueScale(a).data(e),w.isInitial()?void 0:(f=w.animationStartLayers(),u.apply(this,[!1,f,t,r,a,n]))},g=function(e,t,r,a,n){return y.active(S),f=w.animationEndLayers(),u.apply(this,[!0,f,t,r,a,n])},u=function(t,r,a,n,i,o){var l,s,c,u,d;return d=function(e){var t,r,a;return r=d3.select(this),r.style(b),a=o.scale()(e.layerKey),"string"==typeof a?r.style({stroke:a}):(t=a.color,a.stroke=t,r.style(a))},e.debug("data",r),p=n.isOrdinal()?n.scale().rangeBand()/2:0,A&&(A.data(r),m.layout(r)),c=a.width/r[0].values.length*2,h=d3.svg.line().y(function(e){return i.scale()(e.layerAdded||e.layerDeleted?0:e.value)}),C&&h.interpolate("cardinal"),h.x(n.isOrdinal()?function(e){return e.highBorder?a.width+c:e.lowBorder?-c:n.scale()(e.targetKey)}:function(e){return n.scale()(e.targetKey)}),s=this.selectAll(".wk-chart-layer").data(r,function(e){return e.layerKey}),l=s.enter().append("g").attr("class","wk-chart-layer"),l.append("path").attr("class","wk-chart-line").attr("d",function(e){return h(e.values)}).style("opacity",0).style("pointer-events","none"),u=s.select(".wk-chart-line"),u.each(d),(t?u.transition().duration(a.duration):u).attr("d",function(e){return h(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}).style("pointer-events","none"),s.exit().remove(),y.y(function(e){return i.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).color(function(e){var t;return t=o.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(n.scale()),y.x(n.isOrdinal()?function(e){return e.highBorder?a.width+c:e.lowBorder?-c:n.scale()(e.targetKey)+n.scale().rangeBand()/2}:function(e){return n.scale()(e.targetKey)}),s.call(y,t)},c=function(e,t){var r;return r=this.selectAll(".wk-chart-line"),e.isOrdinal()?(r.attr("d",function(e){return h(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),y.brush(this,t),m.brushRange(t)):(r.attr("d",function(e){return h(e.values)}),y.brush(this))},d.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),A=d.behavior().tooltip,m.keyScale(x.x).valueScale(x.y).colorScale(x.color).value(function(e){return e.value}),A.markerScale(x.x),A.on("enter."+k,m.enter),A.on("moveData."+k,m.moveData),A.on("moveMarker."+k,m.moveMarkers)}),d.lifeCycle().on("brushDraw."+k,c),d.lifeCycle().on("animationStartState."+k,v),d.lifeCycle().on("animationEndState."+k,g),d.lifeCycle().on("destroy."+k,function(){return d.lifeCycle().on("."+k,null),A.on("."+k,null)}),l.$observe("markers",function(e){return S=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),l.$observe("spline",function(e){return C=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),l.$observe("lineStyle",function(e){return e?b=t.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("lineVertical",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return d=l.me,c=0,A=void 0,S=!1,C=!1,x={},p=0,k="lineVertical"+i++,f=void 0,h=void 0,b={},w=a(),y=n(),m=r(),v=function(e,t,r,a,n){return w.keyScale(a).valueScale(r).data(e),w.isInitial()?void 0:(f=w.animationStartLayers(),u.apply(this,[!1,f,t,r,a,n]))},g=function(e,t,r,a,n){return y.active(S),f=w.animationEndLayers(),u.apply(this,[!0,f,t,r,a,n])},u=function(e,t,r,a,n,i){var o,l,s,c,u;return u=function(e){var t,r,a;return r=d3.select(this),r.style(b),a=i.scale()(e.layerKey),"string"==typeof a?r.style({stroke:a}):(t=a.color,a.stroke=t,r.style(a))},p=n.isOrdinal()?n.scale().rangeBand()/2:0,A&&(A.data(t),m.layout(t)),s=r.height/t[0].values.length*2,h=d3.svg.line().x(function(e){return a.scale()(e.layerAdded||e.layerDeleted?0:e.value)}),C&&h.interpolate("cardinal"),h.y(n.isOrdinal()?function(e){return e.lowBorder?r.height+s:e.highBorder?-s:n.scale()(e.targetKey)}:function(e){return n.scale()(e.targetKey)}),l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),o=l.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-line").attr("d",function(e){return h(e.values)}).style("opacity",0).style("pointer-events","none").style("stroke",function(e){return i.scale()(e.layerKey)}),c=l.select(".wk-chart-line").attr("transform","translate(0,"+p+")"),c.each(u),(e?c.transition().duration(r.duration):c).attr("d",function(e){return h(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}).style("pointer-events","none"),l.exit().remove(),y.isVertical(!0).x(function(e){return a.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(n.scale()),y.y(n.isOrdinal()?function(e){return e.lowBorder?r.height+s:e.highBorder?-s:n.scale()(e.targetKey)+n.scale().rangeBand()/2}:function(e){return n.scale()(e.targetKey)}),l.call(y,e)},s=function(e,t){var r;return r=this.selectAll(".wk-chart-line"),e.isOrdinal()?(r.attr("d",function(e){return h(e.values.slice(t[0],t[1]+1))}).attr("transform","translate(0,"+e.scale().rangeBand()/2+")"),y.brush(this,t),m.brushRange(t)):(r.attr("d",function(e){return h(e.value)}),y.brush(this))},d.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),A=d.behavior().tooltip,m.keyScale(x.y).valueScale(x.x).colorScale(x.color).value(function(e){return e.value}),A.markerScale(x.y),A.on("enter."+k,m.enter),A.on("moveData."+k,m.moveData),A.on("moveMarker."+k,m.moveMarkers)}),d.lifeCycle().on("brushDraw."+k,s),d.lifeCycle().on("animationStartState."+k,v),d.lifeCycle().on("animationEndState."+k,g),d.lifeCycle().on("destroy."+k,function(){return d.lifeCycle().on("."+k,null),A.on("."+k,null)}),o.$observe("markers",function(e){return S=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("spline",function(e){return C=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("lineStyle",function(t){return t?b=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("pie",["$log","utils",function(e,t){var r;return r=0,{restrict:"EA",require:"^layout",link:function(e,a,n,i){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$;return f=i.me,k="pie"+r++,u=void 0,h=void 0,d=void 0,b=void 0,S=void 0,y=void 0,p=void 0,C=[],A=void 0,$=void 0,D=!1,w=!1,v=0,o=0,x=t.mergeData(),m=function(e){var t,r;return this.headerName=C.y.axisLabel(),this.headerValue=C.size.axisLabel(),r={},r.value=C.size.formattedValue(e),t=C.color.map(e),r.color="string"==typeof t?{fill:t,stroke:t}:t,this.layers[r.value]=r},c=!0,l=function(e,t,r,a,n,i){var l,s,h,g,m,k,b,B,M,O,K;return K=function(e){var t,r,a;return r=d3.select(this),r.style(S),a=n.map(e.data),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},o=t.duration,M=Math.min(t.width,t.height)/2,v=.06*M,y||(y=this.append("g").attr("class","wk-chart-pieBox")),y.attr("transform","translate("+t.width/2+","+t.height/2+")"),b=M*(D?.8:.9),h=b*(w?.6:0),s=d3.svg.arc().outerRadius(b).innerRadius(h),k=d3.svg.arc().outerRadius(.9*M).innerRadius(.9*M),g=function(e){return C.y.value(e.data)},B=d3.layout.pie().sort(null).value(i.value),l=function(e){var t;return t=d3.interpolate(this._current,e),this._current=t(0),function(e){return s(t(e))}},O=B(e),x.key(g),x(O).first({startAngle:0,endAngle:0}).last({startAngle:2*Math.PI,endAngle:2*Math.PI}),u||(u=y.selectAll(".wk-chart-innerArc")),u=u.data(O,g),u.enter().append("path").each(function(e){return this._current=c?e:{startAngle:x.addedPred(e).endAngle,endAngle:x.addedPred(e).endAngle}}).attr("class","wk-chart-innerArc wk-chart-selectable").call($.tooltip).call(A),u.each(K).transition().duration(t.duration).attrTween("d",l),u.exit().datum(function(e){return{startAngle:x.deletedSucc(e).startAngle,endAngle:x.deletedSucc(e).startAngle}}).transition().duration(t.duration).attrTween("d",l).remove(),m=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},D?(d=y.selectAll(".wk-chart-data-label").data(O,g),d.enter().append("text").attr("class","wk-chart-data-label").each(function(e){return this._current=e}).attr("dy",".35em").style(f.dataLabelStyle()).style("opacity",0).text(function(e){return i.formattedValue(e.data)}),d.transition().duration(t.duration).style("opacity",1).text(function(e){return i.formattedValue(e.data)}).attrTween("transform",function(e){var t,r;return r=this,t=d3.interpolate(r._current,e),function(e){var a,n;return a=t(e),r._current=a,n=k.centroid(a),n[0]+=15*(m(a)<Math.PI?1:-1),"translate("+n+")"}}).styleTween("text-anchor",function(e){var t;return t=d3.interpolate(this._current,e),function(e){var r;return r=t(e),m(r)<Math.PI?"start":"end"}}),d.exit().transition().duration(t.duration).style("opacity",0).remove(),p=y.selectAll(".wk-chart-polyline").data(O,g),p.enter().append("polyline").attr("class","wk-chart-polyline").style("opacity",0).style("pointer-events","none").each(function(e){return this._current=e}),p.transition().duration(t.duration).style("opacity",function(e){return 0===e.data.value?0:.5}).attrTween("points",function(e){var t,r;return this._current=this._current,t=d3.interpolate(this._current,e),r=this,function(e){var a,n;return a=t(e),r._current=a,n=k.centroid(a),n[0]+=10*(m(a)<Math.PI?1:-1),[s.centroid(a),k.centroid(a),n]}}),p.exit().transition().duration(t.duration).style("opacity",0).remove()):(y.selectAll(".wk-chart-polyline").remove(),y.selectAll(".wk-chart-data-label").remove()),c=!1},s=function(e){var t,r,a,n;return r=d3.select(this),r.classed("wk-chart-selected")?(t=(e.startAngle+e.endAngle)/2,a=Math.sin(t)*v,n=-Math.cos(t)*v,r.transition().duration(o).attr("transform","translate("+a+","+n+")")):r.transition().duration(o).attr("transform","translate(0,0)")},g=function(){return y.selectAll(".wk-chart-innerArc").each(s)},f.lifeCycle().on("configure",function(){return C=this.getScales(["size","y","color"]),C.color.scaleType("category20"),C.y.scaleType("ordinal"),$=f.behavior().tooltip,A=f.behavior().selected,$.on("enter."+k,m)
}),f.lifeCycle().on("drawChart."+k,l),f.lifeCycle().on("objectsSelected."+k,g),f.lifeCycle().on("destroy."+k,function(){return f.lifeCycle().on("."+k,null),$.on("."+k,null)}),n.$observe("labels",function(e){return"false"===e?D=!1:("true"===e||""===e)&&(D=!0),f.lifeCycle().update()}),n.$observe("donat",function(e){return"false"===e?w=!1:("true"===e||""===e)&&(w=!0),f.lifeCycle().update()}),n.$observe("labelStyle",function(t){return t&&f.dataLabelStyle(e.$eval(t)),f.lifeCycle().update()}),n.$observe("pieStyle",function(t){return t?S=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeArea",["$log","utils","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return d=l.me,A=void 0,x={},S=!1,C=!1,y=0,k="rangearea"+i++,s=void 0,f=void 0,b=0,w={},m=r(),h=a(),v=n(),g=function(e,t,r,a,n,i,o,l,s){return m.keyScale(r).valueScale(a).data(e),m.isInitial()?void 0:(f=m.animationStartLayers(),u.apply(this,[!1,f,t,r,a,n,i,o,l,s]))},p=function(e,t,r,a,n,i,o,l,s){return h.active(S),f=m.animationEndLayers(),u.apply(this,[!0,f,t,r,a,n,i,o,l,s])},u=function(e,t,r,a,n,i){var o,l,c,u,d;for(d=function(e){var t,r,a;return r=d3.select(this),r.style(w),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},y=a.isOrdinal()?a.scale().rangeBand()/2:0,A&&(A.data(t),v.layout(t)),s=d3.svg.area().x(function(e){return a.scale()(e.targetKey)}).y(function(e){return n.scale()(e.value)}).y1(function(e){return n.scale()(e.value1)}),C&&s.interpolate("cardinal"),o=0,u=[{values:t[1].values,layerKey:t[1].layerKey}];o<u[0].values.length;)u[0].values[o].value1=t[0].values[o].value,o++;return l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),l.enter().append("g").attr("class","wk-chart-layer"),c=this.selectAll(".wk-chart-area-path").data(u,function(e){return e.layerKey}),c.enter().append("path").attr("class","wk-chart-area-path wk-chart-edit-selectable").attr("d",function(e){return s(e.values)}).style("opacity",b).style("pointer-events","none").attr("transform","translate("+y+")"),c.style("stroke",function(e){return i.scale()(e.layerKey)}).style("pointer-events","none").each(d),(e?c.transition().duration(r.duration):c).attr("d",function(e){return s(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}),c.exit().remove(),l.exit().remove(),h.x(function(e){return a.scale()(e.targetKey)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}).y(function(e){return n.scale()(e.value)}).color(function(e){return i.scale()(e.layerKey)}),l.call(h,e)},c=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return s(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),h.brush(this,t),v.brushRange(t)):(r.attr("d",function(e){return s(e.values)}),h.brush(this,t))},d.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),A=d.behavior().tooltip,v.keyScale(x.x).valueScale(x.y).colorScale(x.color).value(function(e){return e.value}),A.markerScale(x.x),A.on("enter."+k,v.moveData),A.on("moveData."+k,v.moveData),A.on("moveMarker."+k,v.moveMarkers)}),d.lifeCycle().on("brushDraw."+k,c),d.lifeCycle().on("animationStartState."+k,g),d.lifeCycle().on("animationEndState."+k,p),d.lifeCycle().on("destroy."+k,function(){return d.lifeCycle().on("."+k,null),A.on("."+k,null)}),o.$observe("markers",function(e){return S=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("spline",function(e){return C=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?w=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeAreaVertical",["$log","utils","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,a,n){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return d=l.me,A=void 0,x={},S=!1,C=!1,y=0,k="rangeareavertical"+i++,s=void 0,f=void 0,b=0,w={},m=r(),h=a(),v=n(),g=function(e,t,r,a,n){return m.keyScale(a).valueScale(r).data(e),m.isInitial()?void 0:(f=m.animationStartLayers(),u.apply(this,[!1,f,t,r,a,n]))},p=function(e,t,r,a,n){return h.active(S),f=m.animationEndLayers(),u.apply(this,[!0,f,t,r,a,n])},u=function(e,t,r,a,n,i){var o,l,c,u,d;for(d=function(e){var t,r,a;return r=d3.select(this),r.style(w),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},y=n.isOrdinal()?n.scale().rangeBand()/2:0,A&&(A.data(t),v.layout(t)),s=d3.svg.area().x(function(e){return-n.scale()(e.targetKey)}).y(function(e){return a.scale()(e.value)}).y1(function(e){return a.scale()(e.value1)}),C&&s.interpolate("cardinal"),o=0,u=[{values:t[1].values,layerKey:t[1].layerKey}];o<u[0].values.length;)u[0].values[o].value1=t[0].values[o].value,o++;return l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),l.enter().append("g").attr("class","wk-chart-layer"),c=this.selectAll(".wk-chart-area-path").data(u,function(e){return e.layerKey}),c.enter().append("path").attr("class","wk-chart-area-path").attr("d",function(e){return s(e.values)}).style("opacity",b).style("pointer-events","none").attr("transform","translate(0,"+y+")rotate(-90)"),c.style("stroke",function(e){return i.scale()(e.layerKey)}).style("pointer-events","none").each(d),(e?c.transition().duration(r.duration):c).attr("d",function(e){return s(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}),c.exit().remove(),l.exit().remove(),h.y(function(e){return n.scale()(e.targetKey)+(n.isOrdinal()?n.scale().rangeBand()/2:0)}).x(function(e){return a.scale()(e.value)}).color(function(e){return i.scale()(e.layerKey)}),l.call(h,e)},c=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return s(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),h.brush(this,t),v.brushRange(t)):(r.attr("d",function(e){return s(e.values)}),h.brush(this,t))},d.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("x").domainCalc("extent").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).domainCalc("extent"),A=d.behavior().tooltip,v.keyScale(x.y).valueScale(x.x).colorScale(x.color).value(function(e){return e.value}),A.markerScale(x.y),A.on("enter."+k,v.moveData),A.on("moveData."+k,v.moveData),A.on("moveMarker."+k,v.moveMarkers)}),d.lifeCycle().on("brushDraw."+k,c),d.lifeCycle().on("animationStartState."+k,g),d.lifeCycle().on("animationEndState."+k,p),d.lifeCycle().on("destroy."+k,function(){return d.lifeCycle().on("."+k,null),A.on("."+k,null)}),o.$observe("markers",function(e){return S=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("spline",function(e){return C=""===e||"true"===e?!0:!1,d.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?w=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeBars",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return h=c.me,x="rangebars"+o++,b={},D=void 0,C=void 0,S={},A=!1,g=0,y=void 0,d=_.clone(r,!0),k=a(),p=n(),w=i(),m=function(e,t,r,a,n){return k.keyScale(a).valueScale(r).data(e,!0),k.isInitial()?void 0:(y=k.animationStartLayers(),f.apply(this,[!1,y,t,r,a,n]))},v=function(e,t,r,a,n){return p.active(A),y=k.animationEndLayers(),f.apply(this,[!0,y,t,r,a,n])},f=function(e,t,r,a,n,i){var o,l,s,c,u,f,h;for(h=function(e){var t,r,a;return r=d3.select(this),r.style(b),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},o=n.scale().rangeBand(),l=o/(1-d.padding)*d.padding,g=n.isOrdinal()?o/2:0,D&&(D.data(t),w.layout(t)),g=function(e){return e.deleted&&e.atBorder?-l/2:e.deleted?o+l/2:e.added&&e.atBorder?-l/2:e.added?o+l/2:0},s=0,f=[{values:t[1].values,layerKey:t[1].layerKey}];s<f[0].values.length;)f[0].values[s].value1=t[0].values[s].targetValue,s++;return c=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),c.enter().append("g").attr("class","wk-chart-layer"),u=this.selectAll(".wk-chart-rect").data(f[0].values,function(e){return e.key}),u.enter().append("rect").attr("class","wk-chart-rect").style("opacity",0).call(D.tooltip).call(C).attr("transform",function(e){return"translate(0, "+n.scale()(e.targetKey)+")"}),u.each(h),(e?u.transition().duration(r.duration):u).attr("transform",function(e){return"translate(0, "+(n.scale()(e.targetKey)+g(e))+")"}).attr("height",function(e){return e.added||e.deleted?0:o}).attr("width",function(e){return Math.abs(a.scale()(e.targetValue)-a.scale()(e.value1))}).attr("x",function(e){return a.scale()(e.value1)}).style("stroke",function(e){return i.scale()(e.layerKey)}).style("opacity",1),u.exit().remove(),c.exit().remove()},u=function(e){return this.selectAll(".wk-chart-rect").attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.targetKey))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return S=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("extent").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(d).scaleType("ordinal"),D=h.behavior().tooltip,w.keyScale(S.y).valueScale(S.x).colorScale(S.color).value(function(e){return e.value}),C=h.behavior().selected,D.on("enter."+x,w.enter)}),h.lifeCycle().on("brushDraw."+x,u),h.lifeCycle().on("animationStartState."+x,m),h.lifeCycle().on("animationEndState."+x,v),h.lifeCycle().on("destroy."+x,function(){return h.lifeCycle().on("."+x,null),D.on("."+x,null)}),s.$observe("padding",function(e){var a;return"false"===e?(d.padding=0,d.outerPadding=0):"true"===e?d=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(d.padding=a[0]/100,d.outerPadding=a[0]/100),2===a.length&&(d.padding=a[0]/100,d.outerPadding=a[1]/100))),S.y.rangePadding(d),h.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?h.showDataLabels(!1):("true"===e||""===e)&&h.showDataLabels("x"),h.lifeCycle().update()}),s.$observe("barStyle",function(t){return t?b=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeColumn",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,a,n,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return h=c.me,x="rangeColumn"+o++,b={},D=void 0,C=void 0,S={},A=!1,g=0,y=void 0,d=_.clone(r,!0),k=a(),p=n(),w=i(),m=function(e,t,r,a,n){return k.keyScale(r).valueScale(a).data(e,!0),k.isInitial()?void 0:(y=k.animationStartLayers(),f.apply(this,[!1,y,t,r,a,n]))},v=function(e,t,r,a,n){return p.active(A),y=k.animationEndLayers(),f.apply(this,[!0,y,t,r,a,n])},f=function(e,t,r,a,n,i){var o,l,s,c,u,f,h;for(h=function(e){var t,r,a;return r=d3.select(this),r.style(b),a=i.scale()(e.layerKey),"string"==typeof a?r.style({fill:a,stroke:a}):(t=a.color,a.fill=t,r.style(a))},o=a.scale().rangeBand(),l=o/(1-d.padding)*d.padding,g=n.isOrdinal()?o/2:0,D&&(D.data(t),w.layout(t)),g=function(e){return e.deleted&&e.atBorder?o:e.deleted?-l/2:e.added&&e.atBorder?o+l/2:e.added?-l/2:0},s=0,f=[{values:t[1].values,layerKey:t[1].layerKey}];s<f[0].values.length;)f[0].values[s].value1=t[0].values[s].targetValue,s++;return c=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),c.enter().append("g").attr("class","wk-chart-layer"),u=this.selectAll(".wk-chart-rect").data(f[0].values,function(e){return e.key}),u.enter().append("rect").attr("class","wk-chart-rect").style("opacity",0).call(D.tooltip).call(C).attr("transform",function(e){return"translate("+a.scale()(e.targetKey)+")"}),u.each(h),(e?u.transition().duration(r.duration):u).attr("transform",function(e){return"translate("+(a.scale()(e.targetKey)+g(e))+")"}).attr("width",function(e){return e.added||e.deleted?0:o}).attr("height",function(e){return Math.abs(n.scale()(e.targetValue)-n.scale()(e.value1))}).attr("y",function(e){return n.scale()(e.targetValue)}).style("stroke",function(e){return i.scale()(e.layerKey)}).style("opacity",1),u.exit().remove(),c.exit().remove()},u=function(e){return this.selectAll(".wk-chart-rect").attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.targetKey))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return S=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(d).scaleType("ordinal"),D=h.behavior().tooltip,w.keyScale(S.x).valueScale(S.y).colorScale(S.color).value(function(e){return e.value}),C=h.behavior().selected,D.on("enter."+x,w.enter)}),h.lifeCycle().on("brushDraw."+x,u),h.lifeCycle().on("animationStartState."+x,m),h.lifeCycle().on("animationEndState."+x,v),h.lifeCycle().on("destroy."+x,function(){return h.lifeCycle().on("."+x,null),D.on("."+x,null)}),s.$observe("padding",function(e){var a;return"false"===e?(d.padding=0,d.outerPadding=0):"true"===e?d=_.clone(r,!0):(a=t.parseList(e),a&&(1===a.length&&(d.padding=a[0]/100,d.outerPadding=a[0]/100),2===a.length&&(d.padding=a[0]/100,d.outerPadding=a[1]/100))),S.x.rangePadding(d),h.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?h.showDataLabels(!1):("true"===e||""===e)&&h.showDataLabels("y"),h.lifeCycle().update()}),s.$observe("columnStyle",function(t){return t?b=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("scatter",["$log","utils",function(){var e;return e=0,{restrict:"A",require:"^layout",link:function(t,r,a,n){var i,o,l,s,c,u,d,f;return l=n.me,f=void 0,d=void 0,c="scatter"+e++,u=[],s=function(e){var t,r,a;a=[];for(t in u)r=u[t],a.push(this.layers[r.axisLabel()]={value:r.formattedValue(e),color:"color"===t?{fill:"string"==typeof r.map(e)?r.map(e):r.map(e).color}:{fill:"none"},path:"shape"===t?d3.svg.symbol().type(r.map(e)).size(80)():void 0,"class":"shape"===t?"wk-chart-tt-svg-shape":""});return a},o=0,i=function(e,t,r,a,n,i,l){var s;return s=this.selectAll(".wk-chart-shape").data(e,function(e,t){return t}),s.enter().append("path").attr("class","wk-chart-shape wk-chart-selectable").attr("transform",function(e){return"translate("+r.map(e)+","+a.map(e)+")"}).style("opacity",o).call(f.tooltip).call(d),s.style("fill",function(e){return n.map(e)}).attr("d",d3.svg.symbol().type(function(e){return l.map(e)}).size(function(e){return i.map(e)*i.map(e)})).transition().duration(t.duration).attr("transform",function(e){return"translate("+r.map(e)+","+a.map(e)+")"}).style("opacity",1),o=1,s.exit().remove()},l.lifeCycle().on("configure",function(){return u=this.getScales(["x","y","color","size","shape"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),f=l.behavior().tooltip,d=l.behavior().selected,f.on("enter."+c,s)}),l.lifeCycle().on("drawChart."+c,i),l.lifeCycle().on("destroy."+c,function(){return l.lifeCycle().on("."+c,null),f.on("."+c,null)})}}}]),angular.module("wk.chart").directive("spider",["$log","utils",function(e){var t;return t=0,{restrict:"A",require:"layout",link:function(r,a,n,i){var o,l,s,c,u,d,f,h;return s=i.me,h=void 0,f={},d="spider"+t++,o=d3.svg.axis(),u=void 0,c=function(e){var t,r,a,n,i;for(i=[],a=0,n=u.length;n>a;a++)t=u[a],r=f.color.scale()(e),i.push(this.layers[f.x.value(t)]={value:f.y.formatValue(t[e]),color:{fill:"string"==typeof r?r:r.color}});return i},l=function(t,r,a,n,i){var l,s,c,d,f,y,p,g,v,m,w,k,b,x,S,C;return k=function(e){var t,r,a;return r=d3.select(this),a=i.scale()(e),"string"==typeof a?r.style({fill:"none",stroke:a,"stroke-width":3}):(t=a.color,a.stroke=t,r.style(a))},u=t,e.log(t),d=r.width/2,f=r.height/2,w=.8*d3.min([d,f]),b=20,m=t.length,l=2*Math.PI/m,g=360/m,s=this.select(".wk-chart-axis"),s.empty()&&(s=this.append("g").attr("class","wk-chart-axis")),C=n.scale().ticks(n.ticks()),n.scale().range([w,0]),o.scale(n.scale()).orient("right").tickValues(C).tickFormat(n.tickFormat()),s.call(o).attr("transform","translate("+d+","+(f-w)+")"),n.scale().range([0,w]),v=this.selectAll(".wk-chart-axis-line").data(t,function(e){return a.value(e)}),v.enter().append("line").attr("class","wk-chart-axis-line").style("stroke","darkgrey"),v.attr({x1:0,y1:0,x2:0,y2:w}).attr("transform",function(e,t){return"translate("+d+", "+f+")rotate("+(g*t+180)+")"}),v.exit().remove(),x=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),S=this.selectAll(".wk-chart-tickPath").data(C),S.enter().append("path").attr("class","wk-chart-tickPath").style("fill","none").style("stroke","lightgrey"),S.attr("d",function(e){var r;return r=t.map(function(t,r){return{x:Math.sin(l*r+Math.PI)*n.scale()(e),y:Math.cos(l*r+Math.PI)*n.scale()(e)}}),x(r)+"Z"}).attr("transform","translate("+d+", "+f+")"),S.exit().remove(),c=this.selectAll(".wk-chart-axis-text").data(t,function(e){return a.value(e)}),c.enter().append("text").attr("class","wk-chart-axis-text").style("fill","black").attr("dy","0.8em").attr("text-anchor","middle"),c.attr({x:function(e,t){return d+Math.sin(l*t+Math.PI)*(w+b)},y:function(e,t){return f+Math.cos(l*t+Math.PI)*(w+b)}}).text(function(e){return a.value(e)}),c.exit().remove(),p=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),y=this.selectAll(".wk-chart-data-line").data(n.layerKeys(t)),y.enter().append("path").attr("class","wk-chart-data-line").call(h.tooltip),y.attr("d",function(e){var r;return r=t.map(function(t,r){return{x:Math.sin(l*r+Math.PI)*n.scale()(t[e]),y:Math.cos(l*r+Math.PI)*n.scale()(t[e])}}),p(r)+"Z"}).each(k).attr("transform","translate("+d+", "+f+")")},s.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),f.y.domainCalc("max"),f.x.resetOnNewData(!0).scaleType("ordinal"),h=s.behavior().tooltip,h.on("enter."+d,c)}),s.lifeCycle().on("drawChart."+d,l),s.lifeCycle().on("destroy."+d,function(){return s.lifeCycle().on("."+d,null),h.on("."+d,null)})}}}]),angular.module("wk.chart").factory("behaviorBrush",["$log","$window","selectionSharing","timing",function(e,t,r,a){var n;return n=function(){var e,n,i,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M,O,K,L,P,V,T,z,E,F,N,G,q,I,j,H,R,U,X,Y;return d=function(){},b=!1,j=void 0,F=void 0,R=void 0,E=void 0,S=void 0,P=void 0,z=void 0,V=void 0,x=void 0,C=void 0,T=void 0,H=void 0,M=void 0,X=void 0,Y=void 0,U=void 0,K=!1,O=!1,L=!1,D=void 0,$=void 0,A=[],G=q=N=I=void 0,B=d3.dispatch("brushStart","brush","brushEnd"),u=k=y=e=w=v=m=g=void 0,f=function(e,t,r,a){var n,i;return i=t-e,n=a-r,K&&(j.selectAll(".wk-chart-n").attr("transform","translate("+e+","+r+")").select("rect").attr("width",i),j.selectAll(".wk-chart-s").attr("transform","translate("+e+","+a+")").select("rect").attr("width",i),j.selectAll(".wk-chart-w").attr("transform","translate("+e+","+r+")").select("rect").attr("height",n),j.selectAll(".wk-chart-e").attr("transform","translate("+t+","+r+")").select("rect").attr("height",n),j.selectAll(".wk-chart-ne").attr("transform","translate("+t+","+r+")"),j.selectAll(".wk-chart-nw").attr("transform","translate("+e+","+r+")"),j.selectAll(".wk-chart-se").attr("transform","translate("+t+","+a+")"),j.selectAll(".wk-chart-sw").attr("transform","translate("+e+","+a+")"),F.attr("width",i).attr("height",n).attr("x",e).attr("y",r)),O&&(j.selectAll(".wk-chart-w").attr("transform","translate("+e+",0)").select("rect").attr("height",n),j.selectAll(".wk-chart-e").attr("transform","translate("+t+",0)").select("rect").attr("height",n),j.selectAll(".wk-chart-e").select("rect").attr("height",x.height),j.selectAll(".wk-chart-w").select("rect").attr("height",x.height),F.attr("width",i).attr("height",x.height).attr("x",e).attr("y",0)),L?(j.selectAll(".wk-chart-n").attr("transform","translate(0,"+r+")").select("rect").attr("width",i),j.selectAll(".wk-chart-s").attr("transform","translate(0,"+a+")").select("rect").attr("width",i),j.selectAll(".wk-chart-n").select("rect").attr("width",x.width),j.selectAll(".wk-chart-s").select("rect").attr("width",x.width),F.attr("width",x.width).attr("height",n).attr("x",0).attr("y",r)):void 0},c=function(){return d3.select(S).selectAll(".wk-chart-resize").style("display","none"),F.attr("width",0).attr("height",0).attr("x",0).attr("y",0).style("display","none")},s=function(){var e,t;return t=F.node().getBoundingClientRect(),H.each(function(){var e,r,a;return e=this.getBoundingClientRect(),r=t.left<e.right-e.width/3&&e.left+e.width/3<t.right,a=t.top<e.bottom-e.height/3&&e.top+e.height/3<t.bottom,d3.select(this).classed("wk-chart-selected",a&&r)}),e=V.selectAll(".wk-chart-selected").data(),V.classed("wk-chart-has-selected-items",e.length>0),e},p=function(e,t,a,n){var i,o,l,c,u,f,h,y,p,g;return O&&(d.x().reverse()&&(o=e,e=t,t=o),f=d.x().invert(e),y=d.x().invert(t),(G!==f||q!==y)&&(q=y,G=f,u=d.x().findIndex(f),h=d.x().findIndex(y),D=[u,h],$=d.x().isOrdinal()?z.map(function(e){return d.x().value(e)}).slice(u,h+1):[d.x().value(z[D[0]]),d.x().value(z[h])],A=z.slice(u,h+1),B.brush(D,$,A),r.setSelection($,D,M))),L&&(d.y().reverse()&&(o=a,a=n,n=o),c=d.y().invert(n),g=d.y().invert(a),(N!==c||I!==g)&&(N=c,I=g,l=d.y().findIndex(c),p=d.y().findIndex(g),D=[l,p],$=d.y().isOrdinal()?z.map(function(e){return d.y().value(e)}).slice(l,p+1):[d.y().value(z[l]),d.y().value(z[p])],A=z.slice(l,p+1),B.brush(D,$,A),r.setSelection($,D,M))),K&&(i=s(),_.xor(A,i).length>0)?(D=[],$=[],A=i,B.brush(D,$,A),r.setSelection($,D,M)):void 0},l=function(){return D=[],$=[],A=[],H.classed("wk-chart-selected",!1),V.classed("wk-chart-has-selected-items",!1),r.setSelection($,D,M),_.delay(function(){return B.brush(D,$,A),B.brushEnd(D,$,A)},20)},o=function(){var r;return d3.event.preventDefault(),r=d3.select(d3.event.target),E=r.datum(),r.classed("wk-chart-selectable")&&(E={name:"forwarded"}),x=S.getBBox(),R=d3.mouse(S),w=k,v=u,m=y,g=e,d3.select(S).selectAll(".wk-chart-resize").style("display",null),d3.select(S).select(".wk-chart-selectable").style("pointer-events","none"),F.style("display",null),d3.select("body").style("cursor",d3.select(d3.event.target).style("cursor")),d3.select(t).on("mousemove.brush",i).on("mouseup.brush",n),U.hide(!0),D=[void 0,void 0],A=[void 0],H=V.selectAll(".wk-chart-selectable"),B.brushStart(),a.clear(),a.init()},n=function(){return d3.select(t).on("mousemove.brush",null),d3.select(t).on("mouseup.brush",null),d3.select(S).style("pointer-events","all").selectAll(".wk-chart-resize").style("display",null),d3.select(S).select(".wk-chart-selectable").style("pointer-events",null),d3.select("body").style("cursor",null),U.hide(!1),B.brushEnd(D,$,A)},i=function(){var t,r,a,n,i,o,l,s,c;switch(o=d3.mouse(S),r=o[0]-R[0],a=o[1]-R[1],i=function(e){return o=v+e,u=o>=0?m>o?o:m:0,y=o<=x.width?m>o?m:o:x.width},l=function(e){return o=m+e,u=o>=0?v>o?o:v:0,y=o<=x.width?v>o?v:o:x.width},s=function(t){return o=w+t,k=o>=0?g>o?o:g:0,e=o<=x.height?o>g?o:g:x.height},t=function(t){return o=g+t,k=o>=0?w>o?o:w:0,e=o<=x.height?o>w?o:w:x.height},n=function(e){return v+e>=0?m+e<=x.width?(u=v+e,y=m+e):(y=x.width,u=x.width-(m-v)):(u=0,y=m-v)},c=function(t){return w+t>=0?g+t<=x.height?(k=w+t,e=g+t):(e=x.height,k=x.height-(g-w)):(k=0,e=g-w)},E.name){case"background":case"forwarded":r+R[0]>0?(u=0>r?R[0]+r:R[0],y=u+Math.abs(r)<x.width?u+Math.abs(r):x.width):u=0,a+R[1]>0?(k=0>a?R[1]+a:R[1],e=k+Math.abs(a)<x.height?k+Math.abs(a):x.height):k=0;break;case"extent":c(a),n(r);break;case"n":s(a);break;case"s":t(a);break;case"w":i(r);break;case"e":l(r);break;case"nw":s(a),i(r);break;case"ne":s(a),l(r);break;case"sw":t(a),i(r);break;case"se":t(a),l(r)}return f(u,y,k,e),p(u,y,k,e)},d.brush=function(e){if(0===arguments.length)return j;if(b)return j=e,K=d.x()&&d.y(),O=d.x()&&!d.y(),L=d.y()&&!d.x(),e.style({"pointer-events":"all",cursor:"crosshair"}),F=e.append("rect").attr({"class":"wk-chart-extent",x:0,y:0,width:0,height:0}).style({cursor:"move"}).datum({name:"extent"}),(L||K)&&(e.append("g").attr("class","wk-chart-resize wk-chart-n").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"n"}),e.append("g").attr("class","wk-chart-resize wk-chart-s").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"s"})),(O||K)&&(e.append("g").attr("class","wk-chart-resize wk-chart-w").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"w"}),e.append("g").attr("class","wk-chart-resize wk-chart-e").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"e"})),K&&(e.append("g").attr("class","wk-chart-resize wk-chart-nw").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"nw"}),e.append("g").attr("class","wk-chart-resize wk-chart-ne").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"ne"}),e.append("g").attr("class","wk-chart-resize wk-chart-sw").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"sw"}),e.append("g").attr("class","wk-chart-resize wk-chart-se").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"se"})),e.on("mousedown.brush",o),d},h=function(){var t,r,a;return x?(r=S.getBBox(),t=x.width/r.width,a=x.height/r.height,k/=a,w/=a,e/=a,g/=a,u/=t,v/=t,y/=t,m/=t,R[0]=R[0]/t,R[1]=R[1]/a,x=r,f(u,y,k,e)):void 0},d.chart=function(e){return 0===arguments.length?P:(P=e,P.lifeCycle().on("resize.brush",h),d)},d.active=function(e){return 0===arguments.length?b:(b=e,d)},d.x=function(e){return 0===arguments.length?X:(X=e,d)},d.y=function(e){return 0===arguments.length?Y:(Y=e,d)},d.area=function(e){return 0===arguments.length?V:(void 0===e?(S=void 0,V=void 0):V||(V=e,S=V.node(),d.brush(V),H=V.selectAll(".wk-chart-selectable")),d)},d.container=function(e){return 0===arguments.length?T:(T=e,d)},d.data=function(e){return 0===arguments.length?z:(z=e,d)},d.brushGroup=function(e){return 0===arguments.length?M:(M=e,r.createGroup(M),d)},d.tooltip=function(e){return 0===arguments.length?U:(U=e,d)},d.on=function(e,t){return B.on(e,t)},d.extent=function(){return D},d.events=function(){return B},d.empty=function(){return 0===A.length},d.clearBrush=function(){return console.log("Brush cleared"),c(),l()},d}}]),angular.module("wk.chart").factory("behavior",["$log","$window","behaviorTooltip","behaviorBrush","behaviorSelect",function(e,t,r,a,n){var i;return i=function(){var e,t,i,o,l,s;return s=r(),o=a(),l=n(),o.tooltip(s),t=function(e){return o.area(e),s.area(e),l.area(e)},i=function(e){return o.container(e),s.container(e)},e=function(e){return o.chart(e),s.chart(e)},{tooltip:s,brush:o,selected:l,chartArea:t,container:i,chart:e}}}]),angular.module("wk.chart").factory("behaviorSelect",["$log",function(e){var t,r;return r=0,t=function(){var t,a,n,i,o,l,s;return o="select"+r++,i=void 0,l=void 0,n=!1,s=d3.dispatch("selected"),t=function(){var e,t,r,a;if(n&&(t=d3.select(this),n))return t.classed("wk-chart-selectable")?(e=t.classed("wk-chart-selected"),t.classed("wk-chart-selected",!e),r=i.selectAll(".wk-chart-selected"),a=r.data().map(function(e){return e.data?e.data:e}),i.classed("wk-chart-has-selected-items",a.length>0),l.lifeCycle().objectsSelected(r),s.selected(a)):void 0},a=function(e){return 0===arguments.length?a:(e.on("click",t),a)},a.id=function(){return o},a.active=function(e){return 0===arguments.length?n:(n=e,a)},a.clearSelection=function(){return e.log("selection Cleared"),i?(i.selectAll(".wk-chart-selected").classed("wk-chart-selected",!1),i.classed("wk-chart-has-selected-items",!1),l.lifeCycle().objectsSelected(i.selectAll(".wk-chart-selected"))):void 0},a.area=function(e){return 0===arguments.length?i:(i=e,a)},a.layout=function(e){return 0===arguments.length?l:(l=e,a)},a.events=function(){return s},a.on=function(e,t){return s.on(e,t),a},a}}]),angular.module("wk.chart").factory("behaviorTooltip",["$log","$document","$rootScope","$compile","$templateCache","wkChartTemplates",function(e,t,r,a,n,i){var o;return o=function(){var r,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M,O,K,L,P,V;return v=!1,B="",C=!1,K=void 0,A=void 0,D=void 0,m=void 0,k=void 0,w=void 0,x=void 0,O=void 0,$=void 0,S=void 0,M=!1,V=d3.dispatch("enter","moveData","moveMarker","leave"),L=i.tooltipTemplate(),P=void 0,b=void 0,r=t.find("body"),o=r[0].getBoundingClientRect(),d=function(){},f=function(){var e,t,r;return r=b[0].getBoundingClientRect(),e=o.right-20>d3.event.clientX+r.width+10?d3.event.clientX+10:d3.event.clientX-r.width-10,t=o.bottom-20>d3.event.clientY+r.height+10?d3.event.clientY+10:d3.event.clientY-r.height-10,_.assign(P.tooltipStyle,{position:"absolute",left:e+"px",top:t+"px","z-index":1500,opacity:1}),P.$apply()},h=function(){return _.assign(P.tooltipStyle,{position:"absolute",left:"0px",top:"0px","z-index":1500,opacity:0}),P.$apply()},y=function(){var e,t,a,n,i,o;if(v&&!C)return P.layers={},K?(o=d3.mouse(this),t=$.invert($.isHorizontal()?o[0]:o[1]),e=$.find(t),P.ttData=e):(n=d3.select(this).datum(),e=P.ttData=n.data?n.data:n),V.enter.apply(P,[e,e]),a=d3.select(".wk-chart-tooltip"),a.empty()&&(r.append(b),P.tooltipStyle=d.chart().tooltipStyle(),h()),K?(A=x.select(".wk-chart-tooltip-marker"),A.empty()&&(i=m.select(".wk-chart-background").node().getBBox(),A=x.append("g").attr("class","wk-chart-tooltip-marker"),D=A.append("line"),D.attr($.isHorizontal()?{"class":"wk-chart-marker-line",x0:0,x1:0,y0:0,y1:i.height}:{"class":"wk-chart-marker-line",x0:0,x1:i.width,y0:0,y1:0}),D.style({stroke:"darkgrey","pointer-events":"none"})),V.moveMarker.apply(A,[t,e])):void 0},g=function(){var e,t,r;if(v&&!C){if(r=d3.mouse(w),K){if(!A)return void y.apply(this,arguments);t=$.invert($.isHorizontal()?r[0]:r[1]),e=$.find(t),V.moveMarker.apply(A,[t,e]),P.ttData=e,V.moveData.apply(P,[t,e])}return f()}},p=function(){return A&&A.remove(),A=void 0,b.remove()},c=function(){var e,t;return e=w,d3.event.target!==e?(t=new Event("mousedown"),t.pageX=d3.event.pageX,t.clientX=d3.event.clientX,t.pageY=d3.event.pageY,t.clientY=d3.event.clientY,e.dispatchEvent(t)):void 0},u=function(t){return e.debug(t,d3.event)},d.hide=function(e){return 0===arguments.length?C:(C=e,A&&A.style("visibility",C?"hidden":"visible"),P.ttHide=C,P.$apply(),d)},d.chart=function(t){return 0===arguments.length?k:(k=t,k.lifeCycle().on("destroy.tooltip",function(){return P&&(e.log("destroying tooltip scope",P.$id,k.id()),P.map=void 0,P.scale=void 0,P.properties=void 0,P.label=void 0,P.value=void 0,P.$destroy()),b=void 0,w=void 0}),d)},d.active=function(e){return 0===arguments.length?v:(v=e,d)},d.template=function(e){var t;return 0===arguments.length?B:(B=e,B.length>0&&(t=n.get(B),L='<div class="wk-chart-tooltip" ng-style="tooltipStyle" ng-hide="ttHide">'+t+"</div>"),d)},d.area=function(e){return 0===arguments.length?m:(void 0===e?(m=e,w=e):(m=e,w=m.node(),K&&d.tooltip(m)),d)},d.container=function(e){return 0===arguments.length?x:(x=e,d)},d.markerScale=function(e){return 0===arguments.length?$:(e?(K=!0,$=e):K=!1,d)},d.data=function(e){return 0===arguments.length?S:(S=e,d)},d.on=function(e,t){return V.on(e,t)},s=function(e){return function(){return P.ttData?e(P.ttData):void 0}},l=function(){var t,r,n;if(!P){P=k.scope().$new(!0),e.log("creating tooltip scope",P.$id,k.id()),P.properties={},P.map={},P.scale={},P.label={},P.value={},P.ttHide=!1,n=k.allScales().allKinds();for(t in n)r=n[t],P.map[t]=s(r.map),P.scale[t]=r.scale(),P.properties[t]=s(r.layerKeys),P.label[t]=r.axisLabel(),P.value[t]=s(r.value)
}return b?void 0:b=a(L)(P)},d.tooltip=function(e){return 0===arguments.length?d:(l(L),!K||e.classed("wk-chart-area")?e.on("mouseenter.tooltip",y).on("mousemove.tooltip",g).on("mouseleave.tooltip",p):void 0)},d}}]),angular.module("wk.chart").factory("chart",["$log","scaleList","container","behavior","d3Animation",function(e,t,r,a,n){var i,o;return o=0,i=function(){var i,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B;return v="chart"+o++,s=function(){},m=[],y=void 0,c=void 0,k=void 0,p=void 0,x=!1,b=void 0,$="",A=void 0,S=void 0,g=!1,f=a(),u=n.duration,w=d3.dispatch("configure","resize","prepareData","scaleDomains","rescaleDomains","sizeContainer","drawAxis","drawChart","newData","update","updateAttrs","scopeApply","destroy","animationStartState","animationEndState","editSelected"),h=d3.dispatch("draw","change"),s.id=function(){return v},s.scope=function(e){return 0===arguments.length?b:(b=e,s)},s.showTooltip=function(e){return 0===arguments.length?x:(x=e,f.tooltip.active(x),s)},s.toolTipTemplate=function(e){return 0===arguments.length?$:($=e,f.tooltip.template(e),s)},B={},s.tooltipStyle=function(e){return 0===arguments.length?B:(_.isObject(e)&&_.assign(B,e),s)},s.title=function(e){return 0===arguments.length?A:(A=e,s)},D={"font-size":"1.8em"},s.titleStyle=function(e){return 0===arguments.length?D:(_.isObject(e)&&_.assign(D,e),s)},s.subTitle=function(e){return 0===arguments.length?S:(S=e,s)},C={"font-size":"1.3em"},s.subTitleStyle=function(e){return 0===arguments.length?C:(_.isObject(e)&&_.assign(C,e),s)},d={position:"relative"},s.backgroundStyle=function(e){return 0===arguments.length?d:(_.isObject(e)&&(_.assign(d,e),d.position="relative"),s)},s.addLayout=function(e){return 0===arguments.length?m:(m.push(e),s)},s.addScale=function(e,t){return c.add(e),t?t.scales().add(e):k.add(e),s},s.prepareScaleHierarchy=function(){var e,t,r,a,n;a=c.getOwned(),n=[];for(e in a)r=a[e],!k.hasScale(r)&&(t=k.getKind(r.kind(),r.orientation()))?(r.parentScale(t),t.rangePadding(r.rangePadding()),n.push(r.reverse()?t.reverse(!0):t.reverse()?r.reverse(!0):void 0)):n.push(void 0);return n},s.animationDuration=function(e){return 0===arguments.length?u:(u=e,s)},s.editMode=function(e){return 0===arguments.length?g:(e!==g&&(g=e,g?s.container().registerEditHooks():s.container().deregisterEditHooks()),s)},s.lifeCycle=function(){return w},s.layouts=function(){return m},s.scales=function(){return k},s.allScales=function(){return c},s.hasScale=function(e){return!!c.has(e)},s.container=function(){return y},s.brush=function(){return h},s.getData=function(){return p},s.behavior=function(){return f},l=function(t,r){return t?(e.log("executing full life cycle"),p=t,b.filteredData=t,b.scales=c,s.prepareScaleHierarchy(),w.prepareData(t,r),w.animationStartState(t),w.scaleDomains(t,r),w.sizeContainer(t,r),w.drawAxis(r),w.animationEndState(t),w.drawChart(t,r),w.scopeApply(),y.registerEditHooks()):void 0},i=_.debounce(l,100),s.execLifeCycleFull=l,s.resizeLifeCycle=function(t){return p?(e.log("executing resize life cycle"),w.sizeContainer(p,t),w.drawAxis(t),w.drawChart(p,t),w.scopeApply()):void 0},s.newDataLifeCycle=function(t,r){return t?(e.log("executing new data life cycle"),p=t,b.filteredData=t,w.prepareData(t,r),w.scaleDomains(t,r),w.drawAxis(r),w.drawChart(t,r)):void 0},s.attributeChange=function(t){return p?(e.log("executing attribute change life cycle"),w.sizeContainer(p,t),w.drawAxis(t),w.drawChart(p,t)):void 0},s.brushExtentChanged=function(){return p?(w.drawAxis(!0),w.drawChart(p,!0)):void 0},s.lifeCycle().on("newData.chart",_.debounce(l,10)),s.lifeCycle().on("resize.chart",s.resizeLifeCycle),s.lifeCycle().on("update.chart",function(e){return s.execLifeCycleFull(p,e)}),s.lifeCycle().on("updateAttrs",s.attributeChange),s.lifeCycle().on("rescaleDomains",w.scaleDomains(p,!0)),f.chart(s),y=r().chart(s),c=t(),k=t(),s}}]),angular.module("wk.chart").factory("container",["$log","$window","wkChartMargins","wkChartTemplates","$templateCache",function(e,t,r,a){var n,i;return i=0,n=function(){var t,n,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M,O,K,L,P,V,T,z;return u=function(){},w="cntnr"+i++,p=void 0,x=void 0,S=void 0,v=void 0,B=[],M=[],T=void 0,m=void 0,V=void 0,g=void 0,A=void 0,O=angular.copy(r["default"]),$=0,D=0,z=0,k=void 0,K=void 0,y=void 0,b=0,l=0,u.id=function(){return w},u.chart=function(e){return 0===arguments.length?p:(p=e,p.lifeCycle().on("sizeContainer."+u.id(),u.drawChartFrame),u)},u.element=function(t){var r,a;return 0===arguments.length?x:(a=function(){return u.chart().lifeCycle().resize(!0)},x=t,x&&(S=d3.select(x),S.empty()?e.error("Error: Element "+x+" does not exist"):(C(),r=S.select(".wk-chart").node(),new ResizeSensor(r,a))),u)},u.addLayout=function(e){return B.push(e),u},u.height=function(){return D},u.width=function(){return $},u.margins=function(){return O},u.getChartArea=function(){return g},u.getOverlay=function(){return K},u.getContainer=function(){return V},u.registerEditHooks=function(){return p.editMode()?(u.chart().behavior().tooltip.active(!1),m.selectAll(".wk-chart-axis-select").each(function(){var e,t;return t=this.parentElement.getBBox(),e=d3.select(this).attr(t)}),S.selectAll(".wk-chart-axis-select, .wk-chart-line, .wk-chart-area-path, .wk-chart-marker, .wk-chart-legend").style("pointer-events","all"),S.selectAll(".wk-chart-axis-select, .wk-chart-label-text, .wk-chart-data-label, .wk-chart-layer, .wk-chart-innerArc, .wk-chart-legend, .wk-chart-overlay, .wk-chart-bubble, .wk-chart-shape").style("cursor","pointer").on("click",function(t){return e.log("clicked",d3.select(this).attr("class"),t),p.lifeCycle().editSelected(d3.select(this).attr("class"),t)})):m.selectAll(".wk-chart-axis-select, .wk-chart-line, .wk-chart-area-path, .wk-chart-legend").style("pointer-events","none").style("cursor","default")},t=function(e,t,r,a,n){var i;return i=e.select("."+r.replace(" ",".")),i.empty()&&(i=e.append("text").attr({"class":r,"text-anchor":"middle",y:n?n:0})),i.text(t).style(a),i.node().getBBox().height},s=function(e,r){var a,n;return n=0,a=m.select(".wk-chart-title-area"),a.empty()&&(a=m.insert("g",".wk-chart-area").attr("class","wk-chart-title-area wk-center-hor")),e&&(z=t(a,e,"wk-chart-title wk-chart-label-text",p.titleStyle())),r&&t(a,r,"wk-chart-subtitle wk-chart-label-text",p.subTitleStyle(),z),a.node().getBBox().height},d=function(e,t,r,a){var n,i,o,l,s;for(i=t.append("g"),l=0,s=e.length;s>l;l++)o=e[l],i.append("text").attr({"class":r}).text(o).style(a);return n=i.node().getBBox(),i.remove(),n},f=function(e){var t;switch(t=e.rotateTickLabels(),e.axisOrient()){case"bottom":return 0>t?"end":"start";case"top":return t>0?"end":"start";case"right":return Math.abs(t)>=90?"end":"start";case"left":return Math.abs(t)<=90?"end":"start"}},h=function(e){var t;switch(t=e.rotateTickLabels(),e.axisOrient()){case"bottom":return"rotate("+t+", 0, 10)";case"top":return"rotate("+t+", 0, -10)";case"right":return"rotate("+t+", 10, 0)";case"left":return"rotate("+t+", -10, 0)"}},c=function(e){var t,r;return t=m.append("g"),e.range([0,500]),t.call(e.axis()),e.rotateTickLabels()&&t.selectAll("text").attr({dy:"0.35em"}).attr("transform",h(e)).style("text-anchor",f(e)),t.selectAll("text").style(e.tickLabelStyle()),r=t.node().getBBox(),t.remove(),r},n=function(e){var t;return t=m.select(".wk-chart-axis.wk-chart-"+e.axisOrient()),t.empty()&&(t=m.insert("g",".wk-chart-area").attr("class","wk-chart-axis wk-chart-"+e.axisOrient()),t.append("rect").attr("class","wk-chart-axis-select wk-chart-"+e.axisOrient()).style({opacity:0,"pointer-events":"none"})),t.transition().duration(b).call(e.axis()),e.rotateTickLabels()?t.selectAll(".wk-chart-"+e.axisOrient()+".wk-chart-axis text").attr({dy:"0.35em"}).attr("transform",function(){return h(e)}).style("text-anchor",f(e)).style("pointer-events","none").style(e.tickLabelStyle()):t.selectAll(".wk-chart-"+e.axisOrient()+".wk-chart-axis text").attr("transform",null).style("pointer-events","none").style(e.tickLabelStyle())},L=function(e){return m.select(".wk-chart-axis.wk-chart-"+e+", .wk-chart-axis-select.wk-chart-"+e).remove()},P=function(e){return m.select(".wk-chart-label.wk-chart-"+e).remove()},o=function(e,t){var r,a,n,i,o,s;return r=t?0:b,n=e.kind(),o=e.axis().tickValues(),s=o?o:e.isOrdinal()?e.scale().range():e.scale().ticks(),i=e.isOrdinal()?e.scale().rangeBand()/2:0,a=A.selectAll(".wk-chart-grid.wk-chart-"+n).data(s,function(e){return e}),a.enter().append("line").attr("class","wk-chart-grid wk-chart-"+n).style("pointer-events","none").style("opacity",0),a.style(e.gridStyle()),"y"===n?a.transition().duration(r).attr({x1:l,x2:$-2*l,y1:function(t){return e.isOrdinal()?t+i:e.scale()(t)},y2:function(t){return e.isOrdinal()?t+i:e.scale()(t)}}).style("opacity",1):a.transition().duration(r).attr({y1:l,y2:D-2*l,x1:function(t){return e.isOrdinal()?t+i:e.scale()(t)},x2:function(t){return e.isOrdinal()?t+i:e.scale()(t)}}).style("opacity",1),a.exit().transition().duration(r).style("opacity",0).remove()},C=function(){var e;return v=S.append("div").attr("class","wk-chart"),T=v.append("svg").attr("class","wk-chart"),e=T.append("defs"),e.node().innerHTML=a.svgDefTemplate(),e.append("clipPath").attr("id","wk-chart-clip-"+w).append("rect"),m=T.append("g").attr("class","wk-chart-container"),A=m.append("g").attr("class","wk-chart-grid-lines"),g=m.append("g").attr("class","wk-chart-area"),g.append("rect").style("visibility","hidden").attr("class","wk-chart-background").datum({name:"background"}),m.append("g").attr("class","wk-chart-marker-area")},u.drawChartFrame=function(a,i){var f,h,y,k,C,M,K,L,P,E,_,F,N,G,q,I,j,H,R,U,X,Y,W,J,Z;for(y=S.node().getBoundingClientRect(),b=i?0:u.chart().animationDuration(),H=y.height,Z=y.width,G=s(p.title(),p.subTitle()),h={top:{height:0,width:0},bottom:{height:0,width:0},left:{height:0,width:0},right:{height:0,width:0}},_={top:0,bottom:0,left:0,right:0},C={width:0,height:0},K={},R=0,U=B.length;U>R;R++)P=B[R],P.showDataLabels()&&(K[P.showDataLabels()]=!0);Y=p.allScales().getOwned();for(L in Y)N=Y[L],N.parentScale()||(N.showAxis()&&(N.axis().scale(N.scale()).orient(N.axisOrient()),f=m.select(".wk-chart-axis.wk-chart-"+N.axisOrient()),h[N.axisOrient()]=c(N),E=m.select(".wk-chart-label.wk-chart-"+N.axisOrient()),N.showLabel()?(E.empty()&&(E=m.insert("g",".wk-chart-area").attr("class","wk-chart-label wk-chart-"+N.axisOrient())),_[N.axisOrient()]=t(E,N.axisLabel(),"wk-chart-label-text wk-chart-"+N.axisOrient(),N.axisLabelStyle())):E.remove()),K[N.kind()]&&(N.isHorizontal()?M=r.dataLabelPadding.hor+d(N.formattedValue(a),m,"wk-chart-data-label",P.dataLabelStyle()).width:k=r.dataLabelPadding.vert+d(N.formattedValue(a),m,"wk-chart-data-label",P.dataLabelStyle()).height));I=G+h.top.height+_.top+h.bottom.height+_.bottom+O.top+O.bottom,j=h.right.width+_.right+h.left.width+_.left+O.left+O.right,D=H>I?H-I:0,$=Z>j?Z-j:0,W=p.allScales().getOwned();for(L in W)N=W[L],N.parentScale()||("x"===N.kind()?N.range(K.x?N.reverse()?[$-l-M,l]:[l,$-l-M]:N.reverse()?[$-l,l]:[l,$-l]):"y"===N.kind()&&N.range(K.y?N.reverse()?[k+l,D-l]:[D-l,k+l]:N.reverse()?[l,D-l]:[D-l,l]),N.showAxis()&&n(N));F=h.left.width+_.left+O.left,q=G+h.top.height+_.top+O.top,V=m.attr("transform","translate("+F+", "+q+")"),T.select("#wk-chart-clip-"+w+" rect").attr("width",$).attr("height",D),X=Math.max($,D),T.selectAll("defs>mask>rect").attr({x:-X,y:-X,height:2*X,width:2*X}),V.select(".wk-chart-area>.wk-chart-background").attr("width",$).attr("height",D),V.select(".wk-chart-area").style("clip-path","url(#wk-chart-clip-"+w+")"),m.selectAll(".wk-chart-axis.wk-chart-right").attr("transform","translate("+$+", 0)"),m.selectAll(".wk-chart-axis.wk-chart-bottom").attr("transform","translate(0, "+D+")"),m.select(".wk-chart-label.wk-chart-left").attr("transform","translate("+(-h.left.width-_.left/2)+", "+D/2+") rotate(-90)"),m.select(".wk-chart-label.wk-chart-right").attr("transform","translate("+($+h.right.width+_.right/2)+", "+D/2+") rotate(90)"),m.select(".wk-chart-label.wk-chart-top").attr("transform","translate("+$/2+", "+(-h.top.height-_.top/2)+")"),m.select(".wk-chart-label.wk-chart-bottom").attr("transform","translate("+$/2+", "+(D+h.bottom.height+_.bottom)+")"),m.selectAll(".wk-chart-title-area").attr("transform","translate("+$/2+", "+(-q+z)+")"),J=p.allScales().getOwned();for(L in J)N=J[L],N.parentScale()||N.showAxis()&&N.showGrid()&&o(N);return v.style(p.backgroundStyle()),p.behavior().chartArea(g),p.behavior().container(m),angular.element(g.node()).on("$destroy",function(){return e.log("removing event listeners from",g.attr("class")),g.on(".tooltip",null),g.on(".brush",null),p.behavior().chartArea(void 0),A=void 0,x=void 0,v=void 0})},u.drawSingleAxis=function(e){var t;return e.showAxis()&&(t=V.select(".wk-chart-axis.wk-chart-"+e.axis().orient()),t.call(e.axis()),e.showGrid()&&o(e,!0)),u},u}}]),angular.module("wk.chart").factory("layout",["$log","scale","scaleList","timing",function(e,t,r){var a,n;return n=0,a=function(){var e,a,i,o,l,s,c,u,d,f,h;return u="layout"+n++,l=void 0,s=void 0,o=void 0,f=r(),h=!1,d=d3.dispatch("configure","drawChart","prepareData","brush","redraw","drawAxis","update","updateAttrs","brushDraw","destroy","objectsSelected","animationStartState","animationEndState"),i=function(){},i.id=function(){return u},i.chart=function(e){return 0===arguments.length?o:(o=e,f.parentScales(e.scales()),o.lifeCycle().on("configure."+i.id(),function(){return d.configure.apply(i.scales())}),o.lifeCycle().on("drawChart."+i.id(),i.draw),o.lifeCycle().on("prepareData."+i.id(),i.prepareData),o.lifeCycle().on("animationStartState.."+i.id(),i.animationStartState),o.lifeCycle().on("animationEndState.."+i.id(),i.animationEndState),o.lifeCycle().on("destroy."+i.id(),function(){return d.destroy(),o.lifeCycle().on("."+i.id(),null)}),i)},i.scales=function(){return f},i.scaleProperties=function(){return i.scales().getScaleProperties()},i.container=function(e){return 0===arguments.length?l:(l=e,i)},i.showDataLabels=function(e){return 0===arguments.length?h:(h=e,i)},c={"font-size":"1.3em"},i.dataLabelStyle=function(e){return 0===arguments.length?c:(_.isObject(e)&&_.assign(c,e),i)},i.behavior=function(){return i.chart().behavior()},i.prepareData=function(e){var t,r,a,n,i;for(t=[],i=["x","y","color","size","shape","rangeX","rangeY"],a=0,n=i.length;n>a;a++)r=i[a],t.push(f.getKind(r));return d.prepareData.apply(e,t)},i.lifeCycle=function(){return d},a=function(){var e,t;return e=l.getChartArea(),t=e.select("."+i.id()),t.empty()&&(t=e.append("g").attr("class",function(){return i.id()})),t},e=function(e,r){var a,n,o,s,c,u;for(o={height:l.height(),width:l.width(),margins:l.margins(),duration:r?0:i.chart().animationDuration()},a=[e,o],u=["x","y","color","size","shape"],s=0,c=u.length;c>s;s++)n=u[s],t=f.getKind(n),a.push(t);return a},i.draw=function(t,r){return s=t,d.drawChart.apply(a(),e(t,r)),d.on("redraw."+u,i.redraw),d.on("update."+u,i.chart().lifeCycle().update),d.on("drawAxis."+u,i.chart().lifeCycle().drawAxis),d.on("updateAttrs."+u,i.chart().lifeCycle().updateAttrs),d.on("brush."+u,function(e,t,r){return l.drawSingleAxis(e),d.brushDraw.apply(a(),[e,r,l.width(),l.height()])}),d.on("destroy."+u,function(){return d.on("."+u,null)})},i.animationStartState=function(t){return d.animationStartState.apply(a(),e(t,!0))},i.animationEndState=function(t){return d.animationEndState.apply(a(),e(t,!1))},i}}]),angular.module("wk.chart").factory("legend",["$log","$compile","$rootScope","$templateCache","wkChartTemplates",function(e,t,r,a,n){var i,o,l;return o=0,l=function(e){var t,r,a,n;for(r={},a=0,n=e.length;n>a;a++)t=e[a],r[t]=0;return Object.keys(r)},i=function(){var i,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return u="legend-"+o++,v="top-right",m=void 0,x=void 0,h=void 0,b=n.legendTemplate(),g=void 0,s=void 0,f=void 0,S=void 0,d=void 0,c=void 0,p=void 0,w=!1,k=!1,i={},i.position=function(e){return 0===arguments.length?v:(v=e,i)},i.show=function(a){return 0===arguments.length?w:a===w?i:(w=a,w?(h=r.$new(!0),e.log("creating legend scope",h.$id),g=t(b)(h)):e.log("destroying legend scope",h.$id),i)},i.showValues=function(e){return 0===arguments.length?k:(k=e,i)},i.div=function(e){return 0===arguments.length?f:(f=e,i)},i.layout=function(e){return 0===arguments.length?d:(d=e,i)},i.scale=function(e){return 0===arguments.length?m:(m=e,i)},i.title=function(e){return 0===arguments.length?S:(S=e,i)},i.template=function(e){return 0===arguments.length?x:(x=e,b=a.get(x),i)},y={},i.legendStyle=function(e){return 0===arguments.length?y:(_.isObject(e)&&_.assign(y,e),i)},i.draw=function(e,t){var r,a,n,o,u,d,y,w,k,b;if(c=e,p=t,s=f||d3.select(i.scale().parent().container().element()).select(".wk-chart"),i.show()){if(s.select(".wk-chart-legend").empty()&&angular.element(s.node()).append(g),o=i.showValues()?l(m.value(e)):m.layerKeys(e),d=m.scale(),(null!=(k=i.layout())?k.scales().layerScale():void 0)&&(d=i.layout().scales().layerScale().scale()),a=m.parent().scales().getKind("color").scale(),h.legendRows=o.map("shape"!==m.kind()?function(e){var t,r;return t=a(e),"string"==typeof t?r={fill:t,stroke:t}:(r=t,r.fill=t.color),{value:e,color:r}}:function(e){return{value:e,path:d3.svg.symbol().type(d(e)).size(80)()}}),h.showLegend=!0,h.legendStyle=i.legendStyle(),h.legendStyle.position=f?"relative":"absolute",!f)for(n=s.node().getBoundingClientRect(),r=s.select(".wk-chart-area .wk-chart-background").node().getBoundingClientRect(),b=v.split("-"),y=0,w=b.length;w>y;y++)u=b[y],h.legendStyle[u]=""+Math.abs(n[u]-r[u])+"px";h.title=S}else g.remove();return i},i.register=function(e){return e.lifeCycle().on("drawChart."+u,i.draw),e.lifeCycle().on("destroy."+u,function(){return h.$destroy(),g.remove(),g=void 0,s=void 0,f=void 0,e.lifeCycle().on("."+u,null)}),i},i.redraw=function(){return c&&p&&i.draw(c,p),i},i}}]);var __indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").factory("scale",["$log","legend","formatDefaults","wkChartScales","wkChartLocale","maxTicks",function(e,t,r,a,n,i){var o;return o=function(){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M,O,K,L,P,V,T,z,E,F,N,G,q,I,j,H,R,U,X,Y,W,J,Z,Q,et,tt,rt,at,nt,it,ot,lt,st,ct,ut,dt;return B="",q=void 0,et=d3.scale.linear(),tt="linear",D=1,L=!1,x=void 0,S=void 0,k=void 0,J=!1,U=d3.set(),E="",z=[],G="",dt="",X=void 0,W=.3,Y=.3,O=void 0,M=function(e){return isNaN(+e)||_.isDate(e)?e:+e},rt=!1,m=void 0,w=void 0,p=void 0,ct=void 0,it=void 0,ot=void 0,st=void 0,Q=void 0,nt=!1,g=void 0,at=!1,Z=!1,K=!1,V=!1,T=void 0,H=void 0,R=void 0,b=void 0,F=void 0,N=t(),j=void 0,I=void 0,ut=n.timeFormat.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!==e.getDate()}],["%b %d",function(e){return 1!==e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",function(){return!0}]]),f=function(){},s=function(e){return _.isArray(e)?_.reject(_.keys(e[0]),function(e){return"$$hashKey"===e}):_.reject(_.keys(e),function(e){return"$$hashKey"===e})},d=function(e,t){return t.reduce(function(t,r){return+t+ +f.layerValue(e,r)},0)},c=function(e,t){return d3.max(e,function(e){return d3.max(t,function(t){return f.layerValue(e,t)})})},u=function(e,t){return d3.min(e,function(e){return d3.min(t,function(t){return f.layerValue(e,t)})})},h=function(e){return M.parse?M.parse(e):M(e)},o={extent:function(e){var t;return t=f.layerKeys(e),[u(e,t),c(e,t)]},max:function(e){var t;return t=f.layerKeys(e),[0,c(e,t)]},min:function(e){var t;return t=f.layerKeys(e),[0,u(e,t)]},totalExtent:function(e){var t;return e[0].hasOwnProperty("total")?d3.extent(e.map(function(e){return e.total})):(t=f.layerKeys(e),d3.extent(e.map(function(e){return d(e,t)})))},total:function(e){var t;return e[0].hasOwnProperty("total")?[0,d3.max(e.map(function(e){return e.total}))]:(t=f.layerKeys(e),[0,d3.max(e.map(function(e){return d(e,t)}))])},rangeExtent:function(e){var t,r;return f.upperProperty()?[d3.min(f.lowerValue(e)),d3.max(f.upperValue(e))]:e.length>1?(t=f.lowerValue(e[0]),r=f.lowerValue(e[1])-t,[f.lowerValue(e[0]),t+r*e.length]):void 0},rangeMin:function(e){return[0,d3.min(f.lowerValue(e))]},rangeMax:function(e){var t,r;return f.upperProperty()?[0,d3.max(f.upperValue(e))]:(t=f.lowerValue(e[0]),r=f.lowerValue(e[1])-t,[0,t+r*e.length])}},y=function(e,t){var r,a,n,o,l,s;for(s=[1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],o=["seconds","minutes","hours","days","weeks","months","years"],n=o.indexOf(e),-1===n&&(n=3),r=+f.domainMax()-f.domainMin();;){if(a=r/s[n],l=a/t,n>=o.length||i>=l)break;n++}return o[n]!==e?d3.time[o[n]](f.domainMin(),f.domainMax()):d3.time[o[n]](f.domainMin(),f.domainMax(),t)},l=function(){var e,t,r,a,n;if(!L&&f.tickInterval()&&void 0!==f.domainMax()&&void 0!==f.domainMin()){if("time"===tt)t=f.tickInterval().split(":"),a=2===t.length&&d3.time.hasOwnProperty(t[0])?y(t[0],t[1]):void 0;else for(n=Math.abs(Math.floor((f.domainMax()-f.domainMin())/f.tickInterval())),n>i&&f.tickInterval(Math.floor(f.domainMax()-f.domainMin())/i),r=Math.ceil(1+f.domainMin()/f.tickInterval())*f.tickInterval(),a=[],e=0;r<f.domainMax();)a[e]=r,e++,r+=f.tickInterval();return f.tickValues(a)}},f.id=function(){return T+"."+q+"."+H.id()},f.orientation=function(e){return 0===arguments.length?q:(q=e,f)},f.kind=function(e){return 0===arguments.length?T:(T=e,f)},f.parent=function(e){return 0===arguments.length?H:(H=e,f)},f.chart=function(e){return 0===arguments.length?b:(b=e,f)},f.layout=function(e){return 0===arguments.length?F:(F=e,f)},P=!1,f.isParentScale=function(e){return 0===arguments.length?P:(P=e,f)},f.parentScale=function(e){return 0===arguments.length?R:(R=e,R.isParentScale(!0),f)},f.scale=function(){return et},f.legend=function(){return N},f.isOrdinal=function(){return L},f.isHorizontal=function(e){return 0===arguments.length?K:(K=e,e&&(f.axisOrient()||f.axisOrient("bottom"),V=!1),f)},f.isVertical=function(e){return 0===arguments.length?V:(V=e,e&&(f.axisOrient()||f.axisOrient("left"),K=!1),f)},f.scaleType=function(t){return 0===arguments.length?tt:(d3.scale.hasOwnProperty(t)?(et=d3.scale[t](),tt=t,f.format(r.number)):"time"===t?(et=d3.time.scale(),tt="time",O&&f.dataFormat(O),f.format(r.date)):a.hasOwnProperty(t)?(tt=t,et=a[t]()):e.error("Error: illegal scale type:",t),L=_.has(et,"rangeBand"),X&&f.range(X),rt&&p.scale(et),D&&"pow"===tt&&et.exponent(D),f)},f.exponent=function(e){return 0===arguments.length?D:(D=e,"pow"===tt&&et.exponent(D),f)},f.scaleMapFn=function(e){return 0===arguments.length?et.mapFn?et.mapFn():void 0:(_.isFunction(e)&&et.mapFn&&et.mapFn(e),f)},f.domain=function(e){return 0===arguments.length?x:(x=e,_.isArray(x)&&et.domain(x),f)},f.domainCalc=function(t){return 0===arguments.length?L?void 0:S:(o.hasOwnProperty(t)?S=t:e.error("illegal domain calculation rule:",t," expected",_.keys(o)),f)},A=void 0,f.domainMin=function(e){return 0===arguments.length?A||k[0]:(A=h(e),f)},C=void 0,C=void 0,f.domainMax=function(e){return 0===arguments.length?C||k[1]:(C=h(e),f)},f.getDomain=function(e){return 0===arguments.length?et.domain():!x&&f.domainCalc()?(A&&(k[0]=A),C&&(k[1]=C),l(),k):x?x:f.value(e)},f.resetOnNewData=function(e){return 0===arguments.length?J:(J=e,f)},f.range=function(e){var t;return 0===arguments.length?et.range():(X=e,!L||"x"!==(t=f.kind())&&"y"!==t?"category10"!==tt&&"category20"!==tt&&"category20b"!==tt&&"category20c"!==tt&&et.range(e):et.rangeBands(e,W,Y),f)},f.rangePadding=function(e){return 0===arguments.length?{padding:W,outerPadding:Y}:(W=e.padding,Y=e.outerPadding,f)},f.property=function(e){return 0===arguments.length?U.values():(e&&f.addProperty(e),f)},f.addProperty=function(e){var t,r,a,n;if(_.isArray(e)){for(n=[],r=0,a=e.length;a>r;r++)t=e[r],n.push(U.add(t));return n}return U.add(e)},f.layerProperty=function(e){return 0===arguments.length?E:(E=e,f)},f.layerExclude=function(e){return 0===arguments.length?z:(z=e,f)},f.layerKeys=function(e){return U.size()>0?_.intersection(U.values(),s(e)):_.reject(s(e),function(e){return __indexOf.call(z,e)>=0})},f.lowerProperty=function(e){return 0===arguments.length?G:(G=e,f)},f.upperProperty=function(e){return 0===arguments.length?dt:(dt=e,f)},f.dataFormat=function(e){return 0===arguments.length?O:(O=e,M="time"===tt?n.timeFormat(e):function(e){return e},f)},f.value=function(e){var t;return t=U.values()[0],e?E?_.isArray(e)?e.map(function(e){return h(e[t][E])}):h(e[t][E]):_.isArray(e)?e.map(function(e){return h(e[t])}):h(e[t]):void 0},f.layerValue=function(e,t){return e?h(E?e[t][E]:e[t]):void 0},f.formattedValue=function(e){return _.isArray(e)?e.map(function(e){return f.formatValue(f.value(e))}):f.formatValue(f.value(e))},f.formattedLayerValue=function(e,t){return _.isArray(e)?e.map(function(e){return f.formatValue(f.layerValue(e,t))}):f.formatValue(f.layerValue(e,t))},f.formatValue=function(e){return j&&e&&(e.getUTCDate||!isNaN(e))?I(e):e},f.map=function(e,t){return t?Array.isArray(e)?e.map(function(){return et(f.layerValue(e,t))}):et(f.layerValue(e,t)):Array.isArray(e)?e.map(function(){return et(f.value(e))}):et(f.value(e))},f.invert=function(e){var t,r,a,n,i;return _.has(f.scale(),"invert")?(a=(et.range()[1]-et.range()[0])/b.getData().length,et.invert(e-a/2)):_.has(f.scale(),"invertExtent")?f.scale().invertExtent(e):f.isOrdinal()&&f.resetOnNewData()?(t=et.domain(),i=et.range(),i[0]>i[1]?(n=i[0]-i[1],r=i.length-Math.floor(e/n)-1,0>r&&(r=0)):(n=i[1]-i[0],r=Math.floor(e/n),r>=i.length&&(r=i.length-1)),t[r]):void 0},f.findIndex=function(e){var t,r,a;return a=f.chart().getData(),L?_.findIndex(a,function(t){return e===f.value(t)}):_.isArray(e)&&2===e.length?void 0:(t=d3.bisector(f.value).left,r=t(a,e),r=0>r?0:r>=a.length?a.length-1:r)},f.find=function(e){return f.chart().getData()[f.findIndex(e)]},f.showAxis=function(e){return 0===arguments.length?rt:(rt=e,e?(p=d3.svg.axis(),"time"===f.scaleType()&&p.tickFormat(ut)):p=void 0,f)},f.axisOrient=function(e){return 0===arguments.length?m:(w=m,m=e,f)},f.axisOrientOld=function(e){return 0===arguments.length?w:(w=e,f)},f.axis=function(){return p},f.ticks=function(e){return 0===arguments.length?ct:(ct=e,f.axis()&&f.axis().ticks(ct),f)},f.tickInterval=function(e){return 0===arguments.length?ot:(L||("time"!==tt?ot=h(e):/\w+:\d+/.test(e)&&(ot=e)),f)},f.tickFormat=function(e){return 0===arguments.length?it:(it=e,f.axis()&&f.axis().tickFormat(e),f)},f.tickValues=function(e){return 0===arguments.length?st:(st=e,f.axis()&&f.axis().tickValues(e),f)},lt={"font-size":"1em"},f.tickLabelStyle=function(e){return 0===arguments.length?lt:(_.isObject(e)&&_.assign(lt,e),f)},f.showLabel=function(e){return 0===arguments.length?nt:(nt=e,f)},f.axisLabel=function(e){return 0===arguments.length?g?g:f.property()[0]:(g=e,f)},v={"font-size":"1.5em"},f.axisLabelStyle=function(e){return 0===arguments.length?v:(_.isObject(e)&&_.assign(v,e),f)},f.rotateTickLabels=function(e){return 0===arguments.length?Q:(Q=e,f)},f.format=function(e){return 0===arguments.length?j:(j=e.length>0?e:"time"===f.scaleType()?r.date:r.number,I="time"===f.scaleType()?n.timeFormat(j):n.numberFormat(j),f)},f.showGrid=function(e){return 0===arguments.length?at:(at=e,f)},$={stroke:"lightgrey","stroke-width":1},f.gridStyle=function(e){return 0===arguments.length?$:(_.isObject(e)&&_.assign($,e),f)},f.reverse=function(e){return 0===arguments.length?Z:(Z=e,f)},f.register=function(){return f.chart().lifeCycle().on("scaleDomains."+f.id(),function(t){var r;return f.parentScale()?et=f.parentScale().scale():f.resetOnNewData()?(r=f.getDomain(t),"linear"===tt&&_.some(r,isNaN)?e.error("Scale "+f.kind()+", Type '"+tt+"': cannot compute domain for property '"+U+"' . Possible reasons: property not set, data not compatible with defined type. Domain:"+r):et.domain(r)):void 0}),f.chart().lifeCycle().on("prepareData."+f.id(),function(e){var t,r,a,n,i,l,s,c,u,d;c=f.chart().allScales().getOwned();for(a in c)i=c[a],i.parentScale()&&i.parentScale().addProperty(i.property());r=d3.set(),u=f.chart().allScales().getOwned();for(a in u)if(i=u[a],i!==f&&i.parentScale()!==f)for(d=i.property(),l=0,s=d.length;s>l;l++)n=d[l],r.add(n);return f.layerExclude(r.values()),t=f.domainCalc(),t&&o[t]?k=o[t](e):void 0}),f.chart().lifeCycle().on("destroy."+f.id(),function(){return f.chart().lifeCycle().on("."+f.id(),null)})},f.update=function(e){return f.parent().lifeCycle().update(e),f},f.updateAttrs=function(){return f.parent().lifeCycle().updateAttrs()},f.drawAxis=function(){return f.parent().lifeCycle().drawAxis(),f},f}}]),angular.module("wk.chart").factory("scaleList",["$log",function(e){var t;return t=function(){var t,r,a,n,i,o,l;return n={},r={},o={},i=void 0,l=[],a=void 0,t=function(){},t.owner=function(e){return 0===arguments.length?i:(i=e,t)},t.add=function(a){return n[a.id()]&&e.error("scaleList.add: scale "+a.id()+" already defined in scaleList of "+i.id()+". Duplicate scales are not allowed"),n[a.id()]=a,r[a.kind()]=a,t},t.hasScale=function(e){return n.hasOwnProperty(e.id())},t.getKind=function(e,t){var a,i;if(t){for(a in n)if(i=n[a],i.kind()===e&&i.orientation()===t)return i;return void 0}return r[e]?r[e]:o.getKind?o.getKind(e):void 0},t.hasKind=function(e,r){var a,i;if(r){for(a in n)if(i=n[a],i.kind()===e&&i.orientation()===r)return!0;return!1}return!!t.getKind(e)},t.remove=function(r){return n[r.id()]?(delete n[r.id()],delete t[r.id],t):(e.warn("scaleList.delete: scale "+r.id()+" not defined in scaleList of "+i.id()+". Ignoring"),t)},t.parentScales=function(e){return 0===arguments.length?o:(o=e,t)},t.getOwned=function(){return n},t.allKinds=function(){var e,t,a,n;if(t={},o.allKinds){n=o.allKinds();for(e in n)a=n[e],t[e]=a}for(e in r)a=r[e],t[e]=a;return t},t.requiredScales=function(e){var r,a,n;if(0===arguments.length)return l;for(l=e,a=0,n=e.length;n>a;a++)if(r=e[a],!t.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";return t},t.getScales=function(e){var r,a,n,i;for(a={},n=0,i=e.length;i>n;n++){if(r=e[n],!t.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";a[r]=t.getKind(r)}return a},t.getScaleProperties=function(){var e,r,a,n,i;r=[],i=t.allKinds();for(e in i)n=i[e],a=n.property(),a.length>0&&r.concat(a);return r},t.layerScale=function(e){return 0===arguments.length?a?t.getKind(a):void 0:(a=e,t)},t}}]),angular.module("wk.chart").directive("color",["$log","scale","legend","scaleUtils",function(e,t,r,a){var n;return n=0,{restrict:"E",require:["color","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],scope:{mapFunction:"="},link:function(t,r,n,i){var o,l,s,c,u,d;return c=i[0].me,o=i[1].me,s=null!=(d=i[2])?d.me:void 0,l=void 0,o||s?(u="color",c.kind(u),c.parent(s||o),c.chart(o),c.scaleType("category20"),r.addClass(c.id()),o.addScale(c,s),c.register(),a.observeSharedAttributes(n,c),a.observeLegendAttributes(n,c,s,t),t.$watch("mapFunction",function(e){return e&&_.isFunction(e)?c.scaleMapFn(e):void 0}),o.lifeCycle().on("destroy.color",function(){return t.$destroy()})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").service("scaleUtils",["$log","wkChartScales","utils",function(e,t,r){var a;return a=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),t=t.map(function(e){return isNaN(e)?e:+e}),1===t.length?t[0]:t):void 0},{observeSharedAttributes:function(n,i){return n.$observe("type",function(r){return void 0!==r?(d3.scale.hasOwnProperty(r)||"time"===r||t.hasOwnProperty(r)?i.scaleType(r):""!==r&&e.error("Error: illegal scale value: "+r+". Using 'linear' scale instead"),i.update()):void 0}),n.$observe("exponent",function(e){return"pow"===i.scaleType()&&_.isNumber(+e)?i.exponent(+e).update():void 0}),n.$observe("property",function(e){return i.property(a(e)).update()}),n.$observe("layerProperty",function(e){return e&&e.length>0?i.layerProperty(e).update():void 0}),n.$observe("range",function(e){var t;return t=a(e),Array.isArray(t)?i.range(t).update():void 0
}),n.$observe("dateFormat",function(e){return e&&"time"===i.scaleType()?i.dataFormat(e).update():void 0}),n.$observe("domain",function(t){var r;return t?(e.info("domain",t),r=a(t),Array.isArray(r)?i.domain(r).update():e.error("domain: must be array, or comma-separated list, got",t)):i.domain(void 0).update()}),n.$observe("domainRange",function(e){return e?i.domainCalc(e).update():void 0}),n.$observe("domainMin",function(e){return e?i.domainMin(e):void 0}),n.$observe("domainMax",function(e){return e?i.domainMax(e):void 0}),n.$observe("label",function(e){return void 0!==e?i.axisLabel(e).updateAttrs():void 0}),n.$observe("format",function(e){return void 0!==e?i.format(e):void 0}),n.$observe("reset",function(e){return i.resetOnNewData(r.parseTrueFalse(e))})},observeAxisAttributes:function(e,t,a){return e.$observe("axis",function(e){return t.axisOrient(t.orientation()).showAxis(r.parseTrueFalse(e)).update()}),e.$observe("labelStyle",function(e){return e?t.axisLabelStyle(a.$eval(e)):void 0}),e.$observe("tickFormat",function(e){return void 0!==e?t.tickFormat(d3.format(e)).update():void 0}),e.$observe("ticks",function(e){return void 0!==e&&(t.ticks(+e),t.axis())?t.updateAttrs():void 0}),e.$observe("tickInterval",function(e){return void 0!==e&&(t.tickInterval(e),t.axis())?t.updateAttrs():void 0}),e.$observe("tickLabelStyle",function(e){return e?t.tickLabelStyle(a.$eval(e)):void 0}),e.$observe("grid",function(e){return void 0!==e?t.showGrid(""===e||"true"===e).updateAttrs():void 0}),e.$observe("gridStyle",function(e){return e?t.gridStyle(a.$eval(e)):void 0}),e.$observe("showLabel",function(e){return void 0!==e?t.showLabel(""===e||"true"===e).update(!0):void 0}),e.$observe("reverse",function(e){return void 0!==e?t.reverse(""===e||"true"===e).update():void 0}),e.$observe("rotateTickLabels",function(e){return t.rotateTickLabels(e&&_.isNumber(+e)?+e:void 0),t.update(!0)})},observeLegendAttributes:function(t,r,a,n){return t.$observe("legend",function(t){var n,i;if(void 0!==t){switch(n=r.legend(),n.showValues(!1),t){case"false":n.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":n.position(t).div(void 0).show(!0);break;case"true":case"":n.position("top-right").show(!0).div(void 0);break;default:i=d3.select(t),i.empty()?(e.warn("legend reference does not exist:",t),n.div(void 0).show(!1)):n.div(i).position("top-left").show(!0)}return n.scale(r).layout(a),r.parent()&&n.register(r.parent()),n.redraw()}}),t.$observe("valuesLegend",function(t){var n,i;if(void 0!==t){switch(n=r.legend(),n.showValues(!0),t){case"false":n.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":n.position(t).div(void 0).show(!0);break;case"true":case"":n.position("top-right").show(!0).div(void 0);break;default:i=d3.select(t),i.empty()?(e.warn("legend reference does not exist:",t),n.div(void 0).show(!1)):n.div(i).position("top-left").show(!0)}return n.scale(r).layout(a),r.parent()&&n.register(r.parent()),n.redraw()}}),t.$observe("legendTitle",function(e){return void 0!==e?r.legend().title(e).redraw():void 0}),t.$observe("legendStyle",function(e){return void 0!==e?r.legend().legendStyle(n.$eval(e)).redraw():void 0})}}}]),angular.module("wk.chart").directive("shape",["$log","scale","d3Shapes","scaleUtils",function(e,t,r,a){var n;return n=0,{restrict:"E",require:["shape","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,i,o){var l,s,c,u,d;return e.log("shape-scope",t.$id),c=o[0].me,l=o[1].me,s=null!=(d=o[2])?d.me:void 0,l||s?(u="shape",c.kind(u),c.parent(s||l),c.chart(l),c.scaleType("ordinal"),c.scale().range(r),n.addClass(c.id()),l.addScale(c,s),c.register(),a.observeSharedAttributes(i,c),a.observeLegendAttributes(i,c,s,t)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("size",["$log","scale","scaleUtils",function(e,t,r){var a;return a=0,{restrict:"E",require:["size","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,a,n,i){var o,l,s,c,u;return e.log("size-scope",t.$id),s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(c="size",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.resetOnNewData(!0),a.addClass(s.id()),o.addScale(s,l),s.register(),r.observeSharedAttributes(n,s),r.observeLegendAttributes(n,s,l,t)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("x",["$log","scale","scaleUtils",function(e,t,r){var a;return a=0,{restrict:"E",require:["x","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,a,n,i){var o,l,s,c,u;return e.log("x-scope",t.$id),s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(s.orientation(n.hasOwnProperty("top")?"top":"bottom"),c="x",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.resetOnNewData(!0),s.isHorizontal(!0),s.register(),a.addClass(s.id()),o.addScale(s,l),r.observeSharedAttributes(n,s),r.observeAxisAttributes(n,s,t),r.observeLegendAttributes(n,s,l)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeX",["$log","scale","scaleUtils",function(e,t,r){var a;return a=0,{restrict:"E",require:["rangeX","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,a,n,i){var o,l,s,c,u;return s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(c="rangeX",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.resetOnNewData(!0),s.isHorizontal(!0),s.register(),a.addClass(s.id()),o.addScale(s,l),r.observeSharedAttributes(n,s),n.$observe("axis",function(e){return void 0!==e?("false"!==e?"top"===e||"bottom"===e?s.axisOrient(e).showAxis(!0):s.axisOrient("bottom").showAxis(!0):s.showAxis(!1).axisOrient(void 0),s.update(!0)):void 0}),r.observeAxisAttributes(n,s,t),r.observeLegendAttributes(n,s,l),r.observerRangeAttributes(n,s),n.$observe("rotateTickLabels",function(e){return s.rotateTickLabels(e&&_.isNumber(+e)?+e:void 0),s.update(!0)})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("y",["$log","scale","legend","scaleUtils",function(e,t,r,a){var n;return n=0,{restrict:"E",require:["y","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,r,n,i){var o,l,s,c,u;return e.log("color-scope",t.$id),s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(s.orientation(n.hasOwnProperty("right")?"right":"left"),c="y",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.isVertical(!0),s.resetOnNewData(!0),r.addClass(s.id()),o.addScale(s,l),s.register(),a.observeSharedAttributes(n,s),a.observeAxisAttributes(n,s,t),a.observeLegendAttributes(n,s,l)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeY",["$log","scale","legend","scaleUtils",function(e,t,r,a){var n;return n=0,{restrict:"E",require:["rangeY","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,r,n,i){var o,l,s,c,u;return s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(c="rangeY",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.isVertical(!0),s.resetOnNewData(!0),r.addClass(s.id()),o.addScale(s,l),s.register(),a.observeSharedAttributes(n,s),n.$observe("axis",function(e){return void 0!==e?("false"!==e?"left"===e||"right"===e?s.axisOrient(e).showAxis(!0):s.axisOrient("left").showAxis(!0):s.showAxis(!1).axisOrient(void 0),s.update(!0)):void 0}),a.observeAxisAttributes(n,s,t),a.observeLegendAttributes(n,s,l),a.observerRangeAttributes(n,s)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").provider("wkChartLocale",function(){var e,t;return e="en_US",t={de_DE:d3.locale({decimal:",",thousands:".",grouping:[3],currency:[""," "],dateTime:"%A, der %e. %B %Y, %X",date:"%e.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),en_US:d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},this.setLocale=function(r){if(_.has(t,r))return e=r;throw"unknowm locale '"+r+"' using 'en-US' instead"},this.addLocaleDefinition=function(e,r){return t[e]=d3.locale(r)},this.$get=["$log",function(){return t[e]}],this}),angular.module("wk.chart").provider("wkChartScales",function(){var e,t,r,a,n,i,o,l,s;return l=["red","orange","yellow","green","blue"],s=void 0,o=function(){var e,t;return e=d3.scale.ordinal(),t=function(e){return 0===arguments.length?t:e},t.invert=function(e){return e},t.domain=d3.scale.domain,t.range=d3.scale.domain,t},i=function(){var e,t,r;return e=d3.scale.ordinal(),r=function(t){var r,a,n,i,o,l;for(r=0,n=e.range().length-1,l=[],a=i=0,o=t.length;o>=0?o>=i:i>=o;a=o>=0?++i:--i)l.push(r=(31*r+t.charAt(a))%n);return l},t=function(a){return arguments?e(r(a)):t},t.range=function(t){return arguments?(e.domain(d3.range(t.length)),e.range(t)):e.range()},t.domain=e.domain,t.rangePoint=e.rangePoints,t.rangeBands=e.rangeBands,t.rangeRoundBands=e.rangeRoundBands,t.rangeBand=e.rangeBand,t.rangeExtent=e.rangeExtent,t.hash=function(e){return arguments?(r=e,t):r},t},n=function(){var e,t,r;return e=d3.scale.ordinal(),t=s||e,r=function(e){return arguments?t.apply(r,[e,r.domain()]):r},r.mapFn=function(e){return arguments?(_.isFunction(e)&&(t=e),r):t},r.domain=e.domain,r.range=e.range,r.rangePoint=e.rangePoints,r.rangeBands=e.rangeBands,r.rangeRoundBands=e.rangeRoundBands,r.rangeBand=e.rangeBand,r.rangeExtent=e.rangeExtent,r},r=function(){return d3.scale.ordinal().range(l)},e=function(){return d3.scale.ordinal().range(d3.scale.category20().range().map(function(e){return"url(#lgrad-"+e.replace("#","")+")"}))},t=function(){return d3.scale.ordinal().range(d3.scale.category20().range().map(function(e){return"url(#rgrad-"+e.replace("#","")+")"}))},a=function(){return i().range(l)},this.colors=function(e){return l=e},this.customMapFn=function(e){var t;return _.isFunction(e)?t=e:void 0},this.$get=["$log",function(){return{hashed:i,customCategory:r,customCategoryHashed:a,customScale:n,category20Linear:e,category20Radial:t,ordinalIdentity:o}}],this}),angular.module("wk.chart").provider("wkChartTemplates",function(){var e,t,r;return r="templates/toolTip.html",e="templates/legend.html",t="templates/patterns.html",this.setTooltipTemplate=function(e){return r=e},this.setLegendTemplate=function(t){return e=t},this.setSVGDefsUrl=function(e){return t=e},this.$get=["$log","$templateCache",function(a,n){return{tooltipTemplate:function(){return n.get(r)},legendTemplate:function(){return n.get(e)},svgDefTemplate:function(){return n.get(t)}}}],this}),angular.module("wk.chart").service("selectionSharing",["$log",function(){var e,t,r;return t={},r={},e={},this.createGroup=function(){},this.setSelection=function(a,n,i){var o,l,s,c,u;if(i&&(t[i]=a,r[i]=n,e[i])){for(c=e[i],u=[],l=0,s=c.length;s>l;l++)o=c[l],u.push(o(a,n));return u}},this.getSelection=function(e){var t;return t=e||"default",selection[t]},this.register=function(t,r){return t&&(e[t]||(e[t]=[]),!_.contains(e[t],r))?e[t].push(r):void 0},this.unregister=function(t,r){var a;return e[t]&&(a=e[t].indexOf(r),a>=0)?e[t].splice(a,1):void 0},this}]),angular.module("wk.chart").service("timing",["$log",function(e){var t,r,a;return a={},r=0,t=0,this.init=function(){return r=Date.now()},this.start=function(e){var t;return t=a[e],t||(t=a[e]={name:e,start:0,total:0,callCnt:0,active:!1}),t.start=Date.now(),t.active=!0},this.stop=function(e){var n;return(n=a[e])&&(n.active=!1,n.total+=Date.now()-n.start,n.callCnt+=1),t=Date.now()-r},this.report=function(){var r,n;for(r in a)n=a[r],n.avg=n.total/n.callCnt;return e.info(a),e.info("Elapsed Time (ms)",t),a},this.clear=function(){return a={}},this}]),angular.module("wk.chart").factory("dataLabelFactory",["$log","wkChartMargins",function(e,t){var r,a;return a=0,r=function(){var e,r,a,n,i,o,l,s,c,u,d;return l=void 0,r=!1,o=void 0,d=void 0,i=void 0,u=void 0,a=void 0,s=void 0,n=void 0,c={"font-size":"1.3em"},e=function(e,t,c){var f,h;return l=e,f=o.scale().rangeBand(),h=e.select("text"),h.empty()&&(h=e.append("text").attr("class","wk-chart-data-label").attr(a).style("opacity",0).attr(i,function(e){return e.added||e.deleted?0:f/2}).attr(u,function(e){return s+("x"===u?Math.abs(d.scale()(0)-d.scale()(e.targetValue)):Math.min(d.scale()(0),d.scale()(e.targetValue)))})),h.text(function(e){return d.formatValue(e.targetValue)}).style(c),(t?h.transition().duration(n):h).attr(i,function(e){return e.added||e.deleted?0:f/2}).attr(u,function(e){return s+("x"===u?Math.abs(d.scale()(0)-d.scale()(e.targetValue)):Math.min(d.scale()(0),d.scale()(e.targetValue)))}).style("opacity",function(e){return e.added||e.deleted||!r?0:1})},e.brush=function(e){return e.select("text").attr(i,o.scale().rangeBand()/2)},e.active=function(t){return 0===arguments.length?r:(r=t,e)},e.keyScale=function(r){return 0===arguments.length?o:(o=r,o.isHorizontal()?(i="x",u="y",a={"text-anchor":"middle"},s=-t.dataLabelPadding.vert):(i="y",u="x",a={"text-anchor":"start",dy:"0.35em"},s=t.dataLabelPadding.hor),e)},e.valueScale=function(t){return 0===arguments.length?d:(d=t,e)},e.duration=function(t){return 0===arguments.length?n:(n=t,e)},e.style=function(t){return 0===arguments.length?c:(c=t,e)},e}}]),angular.module("wk.chart").factory("layeredData",["$log",function(){var e;return e=function(){var e,t,r,a,n,i,o,l,s;return r=[],a=[],s=void 0,t=!1,i=1/0,n=-1/0,l=1/0,o=-1/0,e=function(){},e.data=function(t){return arguments.length(Is(0))?r:(r=t,e)},e.layerKeys=function(t){return 0===arguments.length?a:(a=t,e)},e.x=function(t){return 0===arguments.length?s:(s=t,e)},e.calcTotal=function(r){return 0===arguments.length?t:(t=r,e)},e.min=function(){return i},e.max=function(){return n},e.minTotal=function(){return l},e.maxTotal=function(){return o},e.extent=function(){return[e.min(),e.max()]},e.totalExtent=function(){return[e.minTotal(),e.maxTotal()]},e.columns=function(r){var c,u,d,f,h,y,p,g,v,m,w,k,b,x;if(1===arguments.length){for(h=[],i=1/0,n=-1/0,l=1/0,o=-1/0,u=v=0,k=a.length;k>v;u=++v)d=a[u],h[u]={key:d,value:[],min:1/0,max:-1/0};for(u=m=0,b=r.length;b>m;u=++m){for(c=r[u],y=0,g="string"==typeof s?c[s]:s(c),w=0,x=h.length;x>w;w++)f=h[w],p=+c[f.key],f.value.push({x:g,value:p,key:f.key}),f.max<p&&(f.max=p),f.min>p&&(f.min=p),p>n&&(n=p),i>p&&(i=p),t&&(y+=+p);t&&(y>o&&(o=y),l>y&&(l=y))}return{min:i,max:n,totalMin:l,totalMax:o,data:h}}return e},e.rows=function(t){return 1===arguments.length?t.map(function(e){return{x:e[s],layers:layerKeys.map(function(t){return{key:t,value:e[t],x:e[s]}})}}):e},e}}]),angular.module("wk.chart").factory("markerFactory",["$log","d3Animation",function(e,t){var r,a;return a=0,r=function(){var e,r,n,i,o,l,s,c,u,d,f,h;return f=void 0,h=void 0,n=void 0,r=!1,d=0,l=0,i=t.duration,s=!1,c=void 0,u=void 0,o=a++,e=function(e,t){var a,s,c;return u=e,r?(a=e.selectAll(".wk-chart-marker-"+o).data(function(e){return e.values},function(e,t){return t}),a.enter().append("circle").attr("class","wk-chart-marker-"+o).style("fill",n).attr("r",5).style("pointer-events","none").style("opacity",l),c=t?a.transition().duration(i):a,c.attr("cx",f).attr("cy",h).style("opacity",function(e){return(e.added||e.deleted||e.layerAdded||e.layerDeleted?0:1)*d}),s=t?a.exit().transition().duration(i):a.exit(),s.remove()):e.selectAll(".wk-chart-marker-"+o).transition().duration(i).style("opacity",0).remove()},e.brush=function(e,t){var a,n,i;return r?(s?(a="cy",i=h):(a="cx",i=f),t?u.selectAll(".wk-chart-marker-"+o).attr(a,i).style("opacity",function(e,r){return t[0]<=r&&r<=t[1]?1:0}):(n=c.domain(),u.selectAll(".wk-chart-marker-"+o).attr(a,i).style("opacity",function(e){return n[0]<=e.key&&e.key<=n[1]?1:0}))):void 0},e.active=function(t){return 0===arguments.length?r:(l=!r&&t?0:1,r=t,d=r?1:0,e)},e.x=function(t){return 0===arguments.length?f:(f=t,e)},e.y=function(t){return 0===arguments.length?h:(h=t,e)},e.color=function(t){return 0===arguments.length?n:(n=t,e)},e.opacity=function(t){return 0===arguments.length?d:(d=t,e)},e.duration=function(t){return 0===arguments.length?i:(i=t,e)},e.isVertical=function(t){return 0===arguments.length?s:(s=t,e)},e.keyScale=function(t){return 0===arguments.length?c:(c=t,e)},e}}]),angular.module("wk.chart").directive("svgIcon",["$log",function(e){return{restrict:"E",template:'<svg ng-style="style"><path></path></svg>',scope:{path:"@",width:"@"},link:function(t,r,a){return t.style={height:"20px",width:t.width+"px","vertical-align":"middle"},a.$observe("path",function(e){return e?d3.select(r[0]).select("path").attr("d",e).attr("transform","translate(8,8)"):void 0}),t.$on("$destroy",function(){return e.log("svgIcon scope destroyed")})}}}]),angular.module("wk.chart").factory("tooltipHelperFactory",["$log",function(){var e,t;return e=0,t=function(){var t,r,a,n,i,o,l,s,c,u,d,f;return c=void 0,f=void 0,s=!1,i=void 0,n=!1,u=void 0,d=void 0,l=void 0,r=[],a=void 0,o=e++,t={},t.keyScale=function(e){return 0===arguments.length?c:(c=e,t)},t.valueScale=function(e){var r;return 0===arguments.length?f:(f=e,r="rangeX"===f.kind()||"rangeY"===f.kind(),t)},t.isStacked=function(e){return 0===arguments.length?s:(s=e,t)},t.colorScale=function(e){return 0===arguments.length?i:(i=e,t)},t.colorByKey=function(e){return 0===arguments.length?n:(n=e,t)},t.layout=function(e){var a,n,i,o,s;if(0===arguments.length)return u;for(u=e,l=[],r=[0,u[0].values.length-1],s=u[0].values,n=i=0,o=s.length;o>i;n=++i)a=s[n],a.deleted||l.push(n);return t},t.brushRange=function(e){return 0===arguments.length?r:r=e},t.value=function(e){return 0===arguments.length?d:(d=e,t)},t.enter=function(e){var t,r,a,o,l,s,u;for(this.headerName=c.axisLabel(),this.headerValue=c.formattedValue(e),a=f.parentScale()?f.parentScale().layerKeys(e):f.layerKeys(e),u=[],l=0,s=a.length;s>l;l++)r=a[l],this.layers[r]={},this.layers[r].value=f.formattedLayerValue(e,r),t="",t=i.property().length>0?i.map(e):i.scale()(n?c.value(e):r),"string"==typeof t?o={fill:t,stroke:t}:(o=t,o.fill=t.color),u.push(this.layers[r].color=o);return u},t.moveData=function(e,r){return t.enter.apply(this,[r])},t.moveMarkers=function(e,t){var r,n,l,u,d,h,y,p,g,v;if(e&&t){if(h=c.value(t),d=f.layerKeys(t),n=d.map(function(e){return{key:e,value:f.layerValue(t,e)}}),s)for(p=0,g=0,v=n.length;v>g;g++)u=n[g],p+=u.value,u.value=p;return a=this.selectAll(".wk-chart-tt-marker-"+o).data(n,function(e){return e.key}),l=a.enter().append("g").attr("class","wk-chart-tt-marker-"+o),l.append("circle").attr("class","wk-chart-tt-marker").attr("r",9).style("fill",function(e){var t;return t=i.scale()(e.key),"string"==typeof t?t:t.color}).style("fill-opacity",.3).style("stroke",function(e){return i.scale()(e.key)}).style("pointer-events","none"),l.append("circle").attr("class","wk-chart-tt-inner-marker").attr("r",4).style("fill",function(e){var t;return t=i.scale()(e.key),"string"==typeof t?t:t.color}).style("fill-opacity",.6).style("stroke","white").style("pointer-events","none"),r=c.isHorizontal()?"cy":"cx",a.select(".wk-chart-tt-marker").attr(r,function(e){return f.scale()(e.value)}),a.select(".wk-chart-tt-inner-marker").attr(r,function(e){return f.scale()(e.value)}),a.exit().remove(),y=c.isOrdinal()?c.scale().rangeBand()/2:0,c.isHorizontal()?(isNaN(c.scale()(h)+y),this.attr("transform","translate("+(c.scale()(h)+y)+")")):this.attr("transform","translate(0,"+(c.scale()(h)+y)+")")}},t}}]),angular.module("wk.chart").service("utils",["$log",function(){var e;return this.diff=function(e,t,r){var a,n,i,o;for(i=function(e){return t.indexOf(e)<0},o={},a=0;a<e.length;){if(i(e[a]))for(o[e[a]]=void 0,n=a+r;n>=0&&n<e.length;){if(!i(e[n])){o[e[a]]=e[n];break}n+=r}a++}return o},e=0,this.getId=function(){return"Chart"+e++},this.parseList=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),1===t.length?t[0]:t):void 0},this.parseTrueFalse=function(e){return""===e||"true"===e?!0:"false"===e?!1:void 0},this.mergeData=function(){var e,t,r,a,n,i,o,l,s,c,u;return c=[],r=[],u={},n={},s=[],t=[],a=void 0,o=void 0,i=function(e){return e},l=function(e){return e},e=function(a){var o,l,d,f,h,y,p,g;for(c=[],u={},l=h=0,p=r.length;p>h;l=++h)o=r[l],c[l]=o,u[i(o)]=l;for(s=[],t=[],n={},r=a,d=y=0,g=r.length;g>y;d=++y)o=r[d],f=i(o),n[f]=d,u.hasOwnProperty(f)&&(s[u[f]]=!0,t[d]=!0);return e},e.key=function(t){return arguments?(i=t,e):i},e.first=function(t){return arguments?(a=t,e):a},e.last=function(t){return arguments?(o=t,e):o},e.added=function(){var e,a,n,i,o;for(n=[],a=i=0,o=r.length;o>i;a=++i)e=r[a],t[a]||n.push(_d);return n},e.deleted=function(){var e,t,r,a,n;for(r=[],e=a=0,n=c.length;n>a;e=++a)t=c[e],s[e]||r.push(c[e]);return r},e.current=function(e){return r[n[e]]},e.prev=function(e){return c[u[e]]},e.addedPred=function(e){var o;for(o=n[i(e)];!t[o];)if(o--<0)return a;return c[u[i(r[o])]]},e.addedPred.left=function(t){return e.addedPred(t).x},e.addedPred.right=function(t){var r;return r=e.addedPred(t),_.has(r,"width")?r.x+r.width:r.x},e.deletedSucc=function(e){var t;for(t=u[i(e)];!s[t];)if(t++>=c.length)return o;return r[n[i(c[t])]]},e},this.mergeSeriesSorted=function(e,t){var r,a,n,i,o,l;for(a=0,r=0,o=e.length-1,i=t.length-1,n=Math.max(o,i),l=[];o>=a&&i>=r;)+e[a]===+t[r]?(l.push([a,Math.min(r,i),e[a]]),a++,r++):+e[a]<+t[r]?(l.push([a,void 0,e[a]]),a++):(l.push([void 0,Math.min(r,i),t[r]]),r++);for(;o>=a;)l.push([a,void 0,e[a]]),a++;for(;i>=r;)l.push([void 0,Math.min(r,i),t[r]]),r++;return l},this.mergeSeriesUnsorted=function(e,t){var r,a,n,i,o,l;for(a=0,r=0,o=e.length-1,i=t.length-1,n=Math.max(o,i),l=[];o>=a&&i>=r;)e[a]===t[r]?(l.push([a,Math.min(r,i),e[a]]),a++,r++):t.indexOf(e[a])<0?(l.push([a,void 0,e[a]]),a++):(l.push([void 0,Math.min(r,i),t[r]]),r++);for(;o>=a;)l.push([a,void 0,e[a]]),a++;for(;i>=r;)l.push([void 0,Math.min(r,i),t[r]]),r++;return l},this}]),angular.module("wk.chart").directive("chartGenerator",["$log","chartFactory","modelTypes",function(e,t){return{restrict:"E",scope:{markup:"=",properties:"=",error:"&",warning:"&"},link:function(e,r,a){return a.properties&&(e.properties=t.create()),e.$watch("properties",function(){if(t.verify()){if(a.markup&&(e.markup=t.generateMarkup(e.properties)),a.warning&&t.hasWarnings)return e.warning({warnings:t.warnings})}else if(a.error)return e.error({errors:t.errors})},!0)}}}]),angular.module("wk.chart").service("modelUtils",["$log","$templateCache","modelTypes",function(e,t,r){var a;return this.camelToDash=a=function(e){return e.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(e){return e.replace(/\W+(.)/g,function(e,t){return t.toUpperCase()})},this.addProperty=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r].value},set:function(e){return t[r].value=e},enumerable:!0})},this.addGetter=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r]},enumerable:!0})},this.addProperties=function(e,t,a){var n,i;for(i in e)n=e[i],_.has(a,i)||(t[i]={},this.addProperty(a,t,i),_.isString(n)?t[i].validator=r.getValidator(n):"enum"===n.type&&(t[i]["enum"]=n.values,t[i].validator=r.getValidator(n)));return a.validate=function(e,r){return t[e].validator.apply(t[e],[r])},a.acceptedValues=function(e){return t[e]["enum"]}},this.addDecorator=function(e,t,a){return t[e.name]={},t[e.key]={},this.addProperty(a,t,e.key),_.has(e,"value")&&(this.addProperty(a,t,e.name),_.isString(e.value)&&(t[e.name].validator=r.getValidator(e.value)),"enum"===e.value.type&&(t[e.name]["enum"]=e.value.values,t[e.name].validator=r.getValidator(e.value))),this.addProperties(e.properties,t,a)},this.addDecorators=function(e,t,r){var a,n,i,o;if(e){for(o=[],n=0,i=e.length;i>n;n++)a=e[n],o.push(this.addDecorator(a,t,r));return o}},this.generateProperties=function(e,t){var r,n,i;r="";for(n in e)i=e[n],void 0!==t[n]&&null!==t[n]&&""!==t[n]&&(r+=_.has(e[n],"generator")?e[n].generator(t[n]):_.isObject(t[n])?" "+a(n)+'="'+t[n].toString()+'"':" "+a(n)+'="'+t[n]+'"');return r},this.generateDecorators=function(e,t){var r,n,i,o;if(n="",e){for(i=0,o=e.length;o>i;i++)r=e[i],t[r.key]&&(n+=_.has(r,"generator")?r.generator(t[r.name]):t[r.name]?" "+a(r.name)+'="'+t[r.name]+'"':" "+a(r.name),n+=this.generateProperties(r.properties,t));return n}return""},this}]),angular.module("wk.chart").service("chartFactory",["$log","modelTypes","dimensionFactory","layoutFactory","modelUtils",function(e,t,r,a,n){var i;return i=function(e){return function(e){var i,o;return o={},o.dimensions={},o.layouts={},o.properties=[],i={},n.addProperties(e.properties,o,i),n.addDecorators(e.decorators,o,i),n.addGetter(i,o,"dimensions"),n.addGetter(i,o,"layouts"),n.addGetter(i,o,"properties"),i.availableDimensions=function(){return _.keys(t.dimension)},i.addDimension=function(e){return o.dimensions[e]=r.create(e),o.dimensions[e]},i.removeDimension=function(e){return void delete o.dimensions[e]},i.availableLayouts=function(){return _.keys(t.layouts)},i.addLayout=function(e,t){var r;return r=a.create(t),o.layouts[e]=r,o.layouts[e].layoutName=e,r},i.removeLayout=function(e){return void delete o.layouts[e]},i.addProperty=function(e,t,r){var a,n,l,s,c;return l=o.dimensions[t]?r+"."+t:r,a=o.layouts[l],a||(a=i.addLayout(l,r)),n=a.dimensions[t],n||(n=a.addDimension(t)),s=n.property,s?(c=s.split(","),c.indexOf(e.trim())<0?(c.push(e.trim()),n.property=c.join(","),o.properties.push({property:e,dimName:t,dimension:n,layoutName:r,layout:a})):void 0):(n.property=e.trim(),o.properties.push({property:e,dimName:t,dimension:n,layoutName:r,layout:a}))},i.removeProperty=function(e,t,r){var a,n,l,s,c,u,d,f;for(n=o.layouts[r],l=n.dimensions[t],s=l.property,c=s.split(","),c.splice(c.indexOf(e),1),c.length>0?l.property=c.join(","):(l.property="",n.removeDimension(t),0===_.keys(n.dimensions).length&&i.removeLayout(r)),u=o.properties.filter(function(a){return a.property===e&&a.dimName===t&&(a.layoutName=r)}),d=0,f=u.length;f>d;d++)a=u[d],o.properties.splice(o.properties.indexOf(a),1)},i.getDescriptor=function(){return e},i}(e)},this.create=function(){return i(t.chart)},this.verify=function(){return!0},this.generateMarkup=function(e){var t,i;return t=e.getDescriptor(),i="<"+t.name,i+=n.generateProperties(t.properties,e),i+=n.generateDecorators(t.decorators,e),i+=">",i+=r.generateMarkup(e.dimensions),i+=a.generateMarkup(e.layouts),i+="\n</"+t.name+">"},this.hasErrors=!1,this.errors=[],this.hasWarnings=!1,this.warnings=[],this}]),angular.module("wk.chart").service("dimensionFactory",["$log","modelUtils","modelTypes",function(e,t,r){var a;return a=function(e){return function(e){var r,a;return a={},r={},t.addProperties(e.properties,a,r),t.addDecorators(e.decorators,a,r),r.getDescriptor=function(){return e},r}(e)},this.create=function(e){return _.has(r.dimension,e)?a(r.dimension[e]):void 0},this.generateMarkup=function(e){var r,a,n,i;n="";for(i in e)a=e[i],r=a.getDescriptor(),n+="\n		<"+r.name,n+=t.generateProperties(r.properties,a),n+=t.generateDecorators(r.decorators,a),n+=" />";return n},this}]),angular.module("wk.chart").service("layoutFactory",["$log","dimensionFactory","modelTypes","modelUtils",function(e,t,r,a){var n;return n=function(e){return function(e){var r,n,i,o,l;o={},o.dimensions={},o.layout=e.name,n={},a.addProperties(e.properties,o,n),a.addDecorators(e.decorators,o,n),l=e.dimensions;for(i in l)r=l[i],o.dimensions[i]=t.create(i);return a.addGetter(n,o,"dimensions"),a.addGetter(n,o,"layout"),n.addDimension=function(e){return o.dimensions[e]=t.create(e),o.dimensions[e]},n.removeDimension=function(e){return void delete o.dimensions[e]},n.getDescriptor=function(){return e},n}(e)},this.create=function(e){return _.has(r.layouts,e)?n(r.layouts[e]):void 0},this.generateMarkup=function(e){var r,n,i,o;i="";for(o in e)n=e[o],r=n.getDescriptor(),i+="\n	<layout",n[a.dashToCamel(r.name)]||(i+=" "+a.camelToDash(r.name)),i+=a.generateProperties(r.properties,n),i+=a.generateDecorators(r.decorators,n),i+=">",i+=t.generateMarkup(n.dimensions),i+="\n	</layout>";return i},this}]);var __indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").service("modelTypes",["$log","wkChartScales",function(e,t){var r,a,n,i,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,M,O;return y=function(e,t,r,a){var i;return i={name:e,clazz:"layout",layerDimension:t,properties:n(r),decorators:a}},c=function(e,t,r){return{clazz:"dimension",name:e,properties:n(t),decorators:r}},f=function(){return _.keys(d3.scale).concat("time").concat(_.keys(t))},n=function(e){return _.assign.apply(this,[{}].concat(e))},x={string:"string",number:"number",bool:"boolean",list:"list","enum":function(e){return{type:"enum",values:e}},object:"scope variable",event:"scope event",callback:"callback",objArray:"scope variable"},this.getValidator=function(e){switch(e){case x.string:return _.isString;case x.number:return _.isNumber;case x.bool:return _.isBoolean;case x.list:return function(e){return/^\[(.*)\]$|^[^\[](?=[^\]\[]*$)/.test(e)};default:return _.isObject(e)&&"enum"===e.type?function(e){return __indexOf.call(this["enum"],e)>=0}:function(){return!0}}},v={markers:x.bool},u={donat:x.bool},w={padding:x.number},m={outerPadding:x.number},r={areaStacked:x["enum"](["zero","silhouette","expand","wiggle"])},a={areaStackedVertical:x["enum"](["zero","silhouette","expand","wiggle"])},d={geojson:x.object},k={projection:x.object},D={spline:x.bool},g={mapFunction:x.string},b={property:x.list},$={rotateTickLabels:x.number},S={lowerProperty:x.string,upperProperty:x.string},o={type:x["enum"](f()),dateFormat:x.string,domain:x.list,domainMin:x.string,domainMax:x.string,reset:x.bool,range:x.list,domainRange:x["enum"](["min","max","extent","total"]),label:x.string,labelStyle:x.object,exponent:x.number,reverse:x.bool},C={name:"right",clazz:"decorator",key:"right"},M={name:"top",clazz:"decorator",key:"top"},B={name:"tooltips",clazz:"decorator",key:"tooltips",properties:{tooltipsTemplate:x.string}},i={name:"axis",clazz:"decorator",key:"axis",properties:{grid:x.bool,gridStyle:x.object,format:x.string,showLabel:x.bool,ticks:x.number,tickInterval:x.number,tickFormat:x.string,tickLabelStyle:x.object,axisFormatter:x.object}},p={name:"legend",clazz:"decorator",key:"legend$set",value:x["enum"](["top-left","top-right","bottom-left","bottom-right"]),properties:{templateUrl:x.string,legendStyle:x.object}},O={name:"valuesLegend",clazz:"decorator",key:"valuesLegend$set",value:x["enum"](["top-left","top-right","bottom-left","bottom-right"]),properties:{templateUrl:x.string,legendStyle:x.object}},A={name:"selection",clazz:"decorator",key:"selection",properties:{selectedDomain:x.object,clearSelection:x.callback,selectedDomainChange:x.event}},l={name:"brush",key:"brush$set",clazz:"decorator",value:x.string,properties:{selectedDomain:x.object,selectedValues:x.object,brushExtent:x.object,selectedDomainChange:x.event,brushStart:x.event,brushEnd:x.event,clearBrush:x.callback}},s={name:"brushed",clazz:"decorator",key:"brushed$set",value:x.string},h={name:"labels",clazz:"decorator",key:"labels$set",properties:{labelStyle:x.object}},this.chart={name:"chart",clazz:"chart",properties:{data:x.objArray,header:x.string,headerStyle:x.object,subHeader:x.string,subHeaderStyle:x.object,deepWatch:x.bool,filter:x.string,edit:x.bool,editSelected:x.event,animationDuration:x.number,backgroundStyle:x.object},decorators:[B],dimensions:{},layouts:[]},this.layouts={line:y("line","y",[v,D]),lineVertical:y("lineVertical","x",[v,D]),area:y("area","x",[v,D]),areaVertical:y("areaVertical","y",[v,D]),areaStacked:y("areaStacked",!1,"y",[r,v,D]),areaStackedVertical:y("areaStackedVertical",!1,"x",[a,v,D]),bars:y("bars",!1,[w,m],[h,A]),barStacked:y("barStacked","x",[w,m],[A]),barClustered:y("barClustered","x",[w,m],[A]),column:y("column",!1,[w,m],[h,A]),columnStacked:y("columnStacked","y",[w,m],[A]),columnClustered:y("columnClustered","y",[w,m],[A]),rangeArea:y("rangeArea",!1,[],[A]),rangeAreaVertical:y("rangeAreaVertical",!1,[],[A]),rangeBars:y("rangeBars",!1,[],[h,A]),rangeColumn:y("rangeColumn",!1,[],[h,A]),histogram:y("histogram",!1,[],[h,A]),pie:y("pie",!1,[u],[h,A]),spider:y("spider",!1,[],[A]),bubble:y("bubble",!1,[],[A,l]),scatter:y("scatter",!1,[],[A,l]),geoMap:y("geo-map",!1,[d,k],[A])},this.dimension={x:c("x",[b,o,$],[i,l,s]),"x top":c("x top",[b,o,$],[i,l,s]),y:c("y",[b,o,$],[i,l,s]),"y right":c("y right",[b,o,$],[i,l,s]),color:c("color",[b,o,g],[p,O]),size:c("size",[b,o],[p,O]),shape:c("shape",[b,o],[p,O])},this
}]);