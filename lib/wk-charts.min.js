angular.module("wk.chart",[]),angular.module("wk.chart").constant("d3OrdinalScales",["ordinal","category10","category20","category20b","category20c"]),angular.module("wk.chart").constant("wkChartMargins",{top:10,left:50,bottom:40,right:20,topBottomMargin:{axis:25,label:18},leftRightMargin:{axis:40,label:20},minMargin:8,"default":{top:8,left:8,bottom:8,right:10},axis:{top:25,bottom:25,left:40,right:40},label:{top:18,bottom:18,left:20,right:20},dataLabelPadding:{hor:5,vert:5}}),angular.module("wk.chart").constant("d3Shapes",["circle","cross","triangle-down","triangle-up","square","diamond"]),angular.module("wk.chart").constant("axisConfig",{labelFontSize:"1.6em",x:{axisPositions:["top","bottom"],axisOffset:{bottom:"height"},axisPositionDefault:"bottom",direction:"horizontal",measure:"width",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{top:"1em",bottom:"-0.8em"}},y:{axisPositions:["left","right"],axisOffset:{right:"width"},axisPositionDefault:"left",direction:"vertical",measure:"height",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{left:"1.2em",right:"1.2em"}}}),angular.module("wk.chart").constant("d3Animation",{duration:500}),angular.module("wk.chart").constant("templateDir","templates/"),angular.module("wk.chart").constant("formatDefaults",{date:"%x",number:",.2f"}),angular.module("wk.chart").constant("barConfig",{padding:.1,outerPadding:0}),function(){function e(e,t,r){var n=e.translate(),a=Math.atan2(t[1]-n[1],t[0]-n[0])-Math.atan2(r[1]-n[1],r[0]-n[0]);return[Math.cos(a/2),0,0,Math.sin(a/2)]}function t(e,t){var r=(e.translate(),e.invert(t));return r&&isFinite(r[0])&&isFinite(r[1])&&o(r)}function r(e){var t=.5*e[0]*u,r=.5*e[1]*u,n=.5*e[2]*u,a=Math.sin(t),i=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(n),s=Math.cos(n);return[i*l*s+a*o*c,a*l*s-i*o*c,i*o*s+a*l*c,i*l*c-a*o*s]}function n(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=t[0],l=t[1],c=t[2],u=t[3];return[r*o-n*l-a*c-i*u,r*l+n*o+a*u-i*c,r*c-n*u+a*o+i*l,r*u+n*c-a*l+i*o]}function a(e,t){if(e&&t){var r=c(e,t),n=Math.sqrt(l(r,r)),a=.5*Math.acos(Math.max(-1,Math.min(1,l(e,t)))),i=Math.sin(a)/n;return n&&[Math.cos(a),r[2]*i,-r[1]*i,r[0]*i]}}function i(e){return[Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),1-2*(e[1]*e[1]+e[2]*e[2]))*s,Math.asin(Math.max(-1,Math.min(1,2*(e[0]*e[2]-e[3]*e[1]))))*s,Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),1-2*(e[2]*e[2]+e[3]*e[3]))*s]}function o(e){var t=e[0]*u,r=e[1]*u,n=Math.cos(r);return[n*Math.cos(t),n*Math.sin(t),Math.sin(r)]}function l(e,t){for(var r=0,n=e.length,a=0;n>r;++r)a+=e[r]*t[r];return a}function c(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}var u=Math.PI/180,s=180/Math.PI;d3.geo.zoom=function(){var o,l,c=d3.dispatch("zoomstart","zoom","zoomend"),u=d3.behavior.zoom().on("zoomstart",function(){var d=d3.mouse(this),h=r(o.rotate()),f=t(o,d);f&&(l=f),s.call(u,"zoom",function(){o.scale(d3.event.scale);var r=d3.mouse(this),u=a(l,t(o,r));o.rotate(i(h=u?n(h,u):n(e(o,d,r),h))),d=r,c.zoom.apply(this,arguments)}),c.zoomstart.apply(this,arguments)}).on("zoomend",function(){s.call(u,"zoom",null),c.zoomend.apply(this,arguments)}),s=u.on;return u.projection=function(e){return arguments.length?u.scale((o=e).scale()):o},d3.rebind(u,c,"on")}}(),angular.module("wk.chart").directive("brush",["$log","selectionSharing","behavior",function(){return{restrict:"A",require:["^chart","^layout","?x","?y","?rangeX","?rangeY"],scope:{brushExtent:"=",selectedValues:"=",selectedDomain:"=",selectedDomainChange:"&",brushStart:"&",brushEnd:"&",clearBrush:"="},link:function(e,t,r,n){var a,i,o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b;return i=n[0].me,o=null!=(v=n[1])?v.me:void 0,s=null!=(m=n[2])?m.me:void 0,h=null!=(w=n[3])?w.me:void 0,l=null!=(x=n[4])?x.me:void 0,c=null!=(k=n[5])?k.me:void 0,d=void 0,f=void 0,b=void 0,g=void 0,p=!s&&!h,y=void 0,a=i.behavior().brush,s||h||l||c?(a.x(s||l),a.y(h||c)):(u=o.scales().getScales(["x","y"]),a.x(u.x),a.y(u.y)),a.active(!0),e.$watch("clearBrush",function(){return r.clearBrush?e.clearBrush=a.clearBrush:void 0}),r.$observe("brush",function(e){return a.brushGroup(_.isString(e)&&e.length>0?e:void 0)}),a.events().on("brushStart",function(){return e.brushStart(),e.$apply()}),a.events().on("brush",function(t,n,a){return r.brushExtent&&(e.brushExtent=t),r.selectedValues&&(e.selectedValues=n),r.selectedDomain&&(e.selectedDomain=a),e.selectedDomainChange({domain:a}),e.$apply()}),a.events().on("brushEnd",function(t,r,n){return e.brushEnd({domain:n}),e.$apply()}),o.lifeCycle().on("drawChart.brush",function(e){return a.data(e)})}}}]),angular.module("wk.chart").run(["$templateCache",function(e){e.put("templates/legend.html",'\n<div ng-style="position" ng-show="showLegend" class="wk-chart-legend">\n  <div ng-show="title" class="legend-title">{{title}}</div>\n  <ul class="list-unstyled">\n    <li ng-repeat="legendRow in legendRows track by legendRow.value" class="wk-chart-legend-item"><span ng-if="legendRow.color" ng-style="legendRow.color">&nbsp;&nbsp;&nbsp;</span>\n      <svg-icon ng-if="legendRow.path" path="legendRow.path" width="20"></svg-icon><span> &nbsp;{{legendRow.value}}</span>\n    </li>\n  </ul>\n</div>'),e.put("templates/toolTip.html",'\n<div ng-style="position" class="wk-chart-tooltip">\n  <table class="table table-condensed table-bordered">\n    <thead ng-show="headerValue">\n      <tr>\n        <th colspan="2">{{headerName}}</th>\n        <th>{{headerValue}}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="ttRow in layers track by ttRow.name">\n        <td ng-style="ttRow.color" ng-class="ttRow.class">\n          <svg-icon ng-if="ttRow.path" path="ttRow.path" width="15"></svg-icon>\n        </td>\n        <td>{{ttRow.name}}</td>\n        <td>{{ttRow.value}}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>')}]),function(){this.ResizeSensor=function(e,t){function r(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;t>e;e++)this.q[e].call()}}function n(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function a(e,t){if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new r,e.resizedAttached.add(t);e.resizeSensor=document.createElement("div"),e.resizeSensor.className="wk-chart-resize-sensor";var a="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;",i="position: absolute; left: 0; top: 0;";e.resizeSensor.style.cssText=a,e.resizeSensor.innerHTML='<div class="wk-chart-resize-sensor-expand" style="'+a+'"><div style="'+i+'"></div></div><div class="wk-chart-resize-sensor-shrink" style="'+a+'"><div style="'+i+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),{fixed:1,absolute:1}[n(e,"position")]||(e.style.position="relative");var o,l,c=e.resizeSensor.childNodes[0],u=c.childNodes[0],s=e.resizeSensor.childNodes[1],d=(s.childNodes[0],function(){u.style.width=c.offsetWidth+10+"px",u.style.height=c.offsetHeight+10+"px",c.scrollLeft=c.scrollWidth,c.scrollTop=c.scrollHeight,s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,o=e.offsetWidth,l=e.offsetHeight});d();var h=function(){e.resizedAttached.call()},f=function(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener(t,r)};f(c,"scroll",function(){(e.offsetWidth>o||e.offsetHeight>l)&&h(),d()}),f(s,"scroll",function(){(e.offsetWidth<o||e.offsetHeight<l)&&h(),d()})}if("[object Array]"===Object.prototype.toString.call(e)||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements)for(var i=0,o=e.length;o>i;i++)a(e[i],t);else a(e,t)}}(),angular.module("wk.chart").directive("brushed",["$log","selectionSharing","timing",function(e,t){var r;return r=0,{restrict:"A",require:["^chart","?^layout","?x","?y","?rangeX","?rangeY"],link:function(e,r,n,a){var i,o,l,c,u,s,d,h,f,g,y,p,v,m;return l=a[0].me,c=null!=(g=a[1])?g.me:void 0,d=null!=(y=a[2])?y.me:void 0,h=null!=(p=a[3])?p.me:void 0,u=null!=(v=a[4])?v.me:void 0,s=null!=(m=a[5])?m.me:void 0,i=d||h||u||s,f=void 0,o=function(e,t){var r,n,a,o,c;if(i){for(e.length>0?i.domain(e).scale().domain(e):(i.domain(void 0),i.scale().domain(i.getDomain(l.getData())),i.isOrdinal()&&(t=[0,i.scale().domain().length-1])),o=l.layouts(),c=[],n=0,a=o.length;a>n;n++)r=o[n],r.scales().hasScale(i)&&c.push(r.lifeCycle().brush(i,!0,t));return c}},n.$observe("brushed",function(e){return _.isString(e)&&e.length>0?(f=e,t.register(f,o)):f=void 0}),e.$on("$destroy",function(){return t.unregister(f,o)})}}}]),function(){function e(e){var t=document.querySelectorAll("svg image"),r=t.length;0==r&&e();for(var n=0;n<t.length;n++)!function(t){if(t.getAttribute("xlink:href")){var n=t.getAttribute("xlink:href").value;if(/^http/.test(n)&&!new RegExp("^"+window.location.host).test(n))throw new Error("Cannot render embedded images linking to external hosts.")}var a=document.createElement("canvas"),i=a.getContext("2d"),o=new Image;o.src=t.getAttribute("xlink:href"),o.onload=function(){a.width=o.width,a.height=o.height,i.drawImage(o,0,0),t.setAttribute("xlink:href",a.toDataURL("image/png")),r--,0==r&&e()}}(t[n])}function t(){for(var e="",t=document.styleSheets,r=0;r<t.length;r++){var n=t[r].cssRules;if(null!=n)for(var a=0;a<n.length;a++){var i=n[a];"undefined"!=typeof i.style&&(e+=i.selectorText+" { "+i.style.cssText+" }\n")}}var o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML="<![CDATA[\n"+e+"\n]]>";var l=document.createElement("defs");return l.appendChild(o),l}var r="undefined"!=typeof exports&&exports||this,n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';r.svgAsDataUri=function(a,i,o){i=i||1,e(function(){var e=document.createElement("div"),l=a.cloneNode(!0),c=parseInt(l.getAttribute("width")||l.style.width||r.getComputedStyle(a).getPropertyValue("width")),u=parseInt(l.getAttribute("height")||l.style.height||r.getComputedStyle(a).getPropertyValue("height")),s="http://www.w3.org/2000/xmlns/";l.setAttribute("version","1.1"),l.setAttributeNS(s,"xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(s,"xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("width",c*i),l.setAttribute("height",u*i),l.setAttribute("viewBox","0 0 "+c+" "+u),e.appendChild(l),l.insertBefore(t(l),l.firstChild);var d=n+e.innerHTML,h="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(d)));o&&o(h)})},r.saveSvgAsPng=function(e,t,n){r.svgAsDataUri(e,n,function(e){var r=new Image;r.src=e,r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height;var n=e.getContext("2d");n.drawImage(r,0,0);var a=document.createElement("a");a.download=t,a.href=e.toDataURL("image/png"),document.body.appendChild(a),a.click()}})}}(),angular.module("wk.chart").directive("chart",["$log","chart","$filter",function(e,t,r){var n;return n=0,{restrict:"E",require:"chart",scope:{data:"=",filter:"="},controller:["$scope",function(e){return this.me=t(),this.me.scope(e)}],link:function(t,n,a,i){var o,l,c,u,s,d;return c=i.me,l=!1,u=void 0,n.addClass(c.id()),s=void 0,d=void 0,c.container().element(n[0]),c.lifeCycle().configure(),c.lifeCycle().on("scopeApply",function(){return t.$apply()}),a.$observe("animationDuration",function(e){return e&&_.isNumber(+e)&&+e>=0?c.animationDuration(e):void 0}),a.$observe("title",function(e){return c.title(e?e:void 0)}),a.$observe("subtitle",function(e){return c.subTitle(e?e:void 0)}),t.$watch("filter",function(e){if(e){if(d=e,s)return c.lifeCycle().newData(r("filter")(s,d))}else if(d=void 0,s)return c.lifeCycle().newData(s)}),a.$observe("deepWatch",function(e){return l=void 0!==e&&"false"!==e?!0:!1,u&&u(),u=t.$watch("data",o,l)}),o=function(e){if(e){if(s=e,_.isArray(s)&&0===s.length)return;return c.lifeCycle().newData(d?r("filter")(e,d):e)}},u=t.$watch("data",o,l),n.on("$destroy",function(){return u&&u(),e.log("Destroying chart"),c.lifeCycle().destroy()})}}}]),describe("chartGen Test Suite",function(){beforeEach(module("wk.chart"));var e,t;beforeEach(inject(function(r,n){e=r,t=n})),it("creates the element",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined()}),it("adds a layout and chart type",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;r.addLayout("line"),expect(r.layouts[0]).toBeDefined()}),it("adds a property to the layout x axis",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;r.addLayout("line"),expect(r.layouts[0]).toBeDefined();var n=r.layouts[0];n.dimensions.x.property="abcde",expect(n.dimensions.x.property).toEqual("abcde"),expect(n.dimensions.x.acceptedValues("domainRange")).toEqual(["min","max","extent","total"]),expect(n.dimensions.x.validate("domainRange","min")).toBeTruthy(),expect(n.dimensions.x.validate("domainRange","aaa")).toBeFalsy()}),it("generates Markup",function(){t('<chart-generator properties="chartDescription", markup="markup"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;console.log("setting data"),r.data="chartData",r.tooltips$set=!0,r.tooltipsTemplate="url",e.$digest(),r.filter="filterString",r.addDimension("color"),r.dimensions.color.property="farbe",r.dimensions.color.legend$set=!0,r.dimensions.color.legend="top-left",r.dimensions.color.valuesLegend$set=!1,r.addLayout("barStacked"),r.addLayout("line"),expect(r.layouts[0]).toBeDefined(),expect(r.layouts.length).toBe(2);var n=r.layouts[0];n.dimensions.y.property="abcde",n.padding=10,e.$apply(r),console.log(e.markup),expect(e.markup).toBeTruthy()})}),angular.module("wk.chart").directive("layout",["$log","layout","container",function(e,t){var r;return r=0,{restrict:"AE",require:["layout","^chart"],controller:["$element",function(){return this.me=t()}],link:function(e,t,r,n){var a,i;return i=n[0].me,a=n[1].me,i.chart(a),t.addClass(i.id()),a.addLayout(i),a.container().addLayout(i),i.container(a.container())}}}]),describe("chartGen Test Suite",function(){beforeEach(module("wk.chart"));var e,t,r,n;beforeEach(inject(function(a,i,o,l){e=a,t=i,r=o,n=l})),it("should inject modelTypes",function(){expect(r).not.toBeUndefined(),expect(r.chart.properties.title).toEqual("string"),expect(r.dimension.x.properties.property).toEqual("list")}),it("creates a model instance",function(){var e=n.create();e.data="abcde",e.title="efg",expect(e.data).toEqual("abcde"),expect(e.title).toEqual("efg")}),it("adds and removes a dimension",function(){var e=n.create();expect(e.dimensions).toEqual({}),e.addDimension("x"),expect(e.dimensions.x).toBeDefined(),e.removeDimension("x"),expect(e.dimensions).toEqual({})}),it("can access properties and functions in dimensions",function(){var e=n.create();e.addDimension("x"),expect(e.dimensions).toBeDefined(),e.dimensions.x.showLabel=!0,expect(e.dimensions.x.showLabel).toBeTruthy(),expect(e.dimensions.x.validate("type","linear")).toBeTruthy(),expect(e.dimensions.x.validate("type","nonsense")).toBeFalsy(),expect(e.dimensions.x.acceptedValues("domainRange")).toEqual(["min","max","extent","total"])}),it("adds and removes a layout",function(){var e=n.create();expect(e.layouts).toEqual([]);var t=e.addLayout("line");expect(e.layouts.length).toBe(1),e.removeLayout(t),expect(e.layouts.length).toBe(0)}),it("can access properties and functions in layouts",function(){var e=n.create();e.addLayout("line");var t=e.layouts[0];expect(t).toBeDefined(),expect(t.dimensions.x).toBeDefined();var r=t.dimensions.x;r.reset=!0,expect(r.reset).toBeTruthy(),expect(r.validate("type","linear")).toBeTruthy(),expect(r.validate("type","nonsense")).toBeFalsy(),expect(r.acceptedValues("domainRange")).toEqual(["min","max","extent","total"])}),it("can access decorator attributes",function(){var e=n.create();e.tooltips$set=!0,expect(e.tooltips$set).toBeTruthy(),expect(e.validate("tooltips",!0)).toBeTruthy(),e.tooltipsTemplate="url",expect(e.tooltipsTemplate).toEqual("url")})}),angular.module("wk.chart").directive("printButton",["$log",function(e){return{require:"chart",restrict:"A",link:function(t,r,n,a){var i,o;return i=a.me,o=function(){var t;return t=d3.select(i.container().element()).select("div.wk-chart"),t.append("button").attr("class","wk-chart-print-button").style({position:"absolute",top:0,right:0}).text("Print").on("click",function(){var r;return e.log("Clicked Print Button"),r=t.select("svg.wk-chart").node(),saveSvgAsPng(r,"print.png",5)})},i.lifeCycle().on("drawChart.print",o)}}}]),angular.module("wk.chart").directive("selection",["$log",function(){var e;return e=0,{restrict:"A",scope:{selectedDomain:"=",selectedDomainChange:"&",clearSelection:"="},require:"layout",link:function(e,t,r,n){var a;return a=n.me,a.lifeCycle().on("configure.selection",function(){var t;return t=a.behavior().selected,t.layout(a),e.$watch("clearSelection",function(){return r.clearSelection?e.clearSelection=t.clearSelection:void 0}),t.active(!0),t.on("selected",function(t){return e.selectedDomain&&(e.selectedDomain=t),e.selectedDomainChange({domain:t}),e.$apply()})})}}}]),angular.module("wk.chart").directive("tooltips",["$log","behavior",function(){return{restrict:"A",require:"chart",link:function(e,t,r,n){var a;return a=n.me,r.$observe("tooltips",function(e){return a.toolTipTemplate(""),void 0===e||""!==e&&"true"!==e?e.length>0&&"false"!==e?(a.toolTipTemplate(e),a.showTooltip(!0)):a.showTooltip(!1):a.showTooltip(!0)})}}}]),angular.module("wk.chart").directive("color",["$log","scale","legend","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["color","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],scope:{mapFunction:"="},link:function(t,r,a,i){var o,l,c,u,s,d;return u=i[0].me,o=i[1].me,c=null!=(d=i[2])?d.me:void 0,l=void 0,o||c?(s="color",u.kind(s),u.parent(c||o),u.chart(o),u.scaleType("category20"),r.addClass(u.id()),o.addScale(u,c),u.register(),n.observeSharedAttributes(a,u),n.observeLegendAttributes(a,u,c),t.$watch("mapFunction",function(e){return e&&_.isFunction(e)?u.scaleMapFn(e):void 0})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").service("scaleUtils",["$log","wkChartScales","utils",function(e,t,r){var n;return n=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),t=t.map(function(e){return isNaN(e)?e:+e}),1===t.length?t[0]:t):void 0},{observeSharedAttributes:function(a,i){return a.$observe("type",function(r){return void 0!==r?(d3.scale.hasOwnProperty(r)||"time"===r||t.hasOwnProperty(r)?i.scaleType(r):""!==r&&e.error("Error: illegal scale value: "+r+". Using 'linear' scale instead"),i.update()):void 0}),a.$observe("exponent",function(e){return"pow"===i.scaleType()&&_.isNumber(+e)?i.exponent(+e).update():void 0}),a.$observe("property",function(e){return i.property(n(e)).update()}),a.$observe("layerProperty",function(e){return e&&e.length>0?i.layerProperty(e).update():void 0}),a.$observe("range",function(e){var t;return t=n(e),Array.isArray(t)?i.range(t).update():void 0}),a.$observe("dateFormat",function(e){return e&&"time"===i.scaleType()?i.dataFormat(e).update():void 0}),a.$observe("domain",function(t){var r;return t?(e.info("domain",t),r=n(t),Array.isArray(r)?i.domain(r).update():e.error("domain: must be array, or comma-separated list, got",t)):i.domain(void 0).update()}),a.$observe("domainRange",function(e){return e?i.domainCalc(e).update():void 0}),a.$observe("label",function(e){return void 0!==e?i.axisLabel(e).updateAttrs():void 0}),a.$observe("format",function(e){return void 0!==e?i.format(e):void 0}),a.$observe("reset",function(e){return i.resetOnNewData(r.parseTrueFalse(e))})},observeAxisAttributes:function(e,t,r){return e.$observe("tickFormat",function(e){return void 0!==e?t.tickFormat(d3.format(e)).update():void 0}),e.$observe("ticks",function(e){return void 0!==e&&(t.ticks(+e),t.axis())?t.updateAttrs():void 0}),e.$observe("grid",function(e){return void 0!==e?t.showGrid(""===e||"true"===e).updateAttrs():void 0}),e.$observe("showLabel",function(e){return void 0!==e?t.showLabel(""===e||"true"===e).update(!0):void 0}),r.$watch(e.axisFormatters,function(e){return _.isObject(e)?(_.has(e,"tickFormat")&&_.isFunction(e.tickFormat)?t.tickFormat(e.tickFormat):_.isString(e.tickFormat)&&t.tickFormat(d3.format(e)),_.has(e,"tickValues")&&_.isArray(e.tickValues)&&t.tickValues(e.tickValues),t.update()):void 0}),e.$observe("reverse",function(e){return void 0!==e?t.reverse(""===e||"true"===e).update():void 0})},observeLegendAttributes:function(t,r,n){return t.$observe("legend",function(t){var a,i;if(void 0!==t){switch(a=r.legend(),a.showValues(!1),t){case"false":a.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":a.position(t).div(void 0).show(!0);break;case"true":case"":a.position("top-right").show(!0).div(void 0);break;default:i=d3.select(t),i.empty()?(e.warn("legend reference does not exist:",t),a.div(void 0).show(!1)):a.div(i).position("top-left").show(!0)}return a.scale(r).layout(n),r.parent()&&a.register(r.parent()),a.redraw()}}),t.$observe("valuesLegend",function(t){var a,i;if(void 0!==t){switch(a=r.legend(),a.showValues(!0),t){case"false":a.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":a.position(t).div(void 0).show(!0);break;case"true":case"":a.position("top-right").show(!0).div(void 0);break;default:i=d3.select(t),i.empty()?(e.warn("legend reference does not exist:",t),a.div(void 0).show(!1)):a.div(i).position("top-left").show(!0)}return a.scale(r).layout(n),r.parent()&&a.register(r.parent()),a.redraw()}}),t.$observe("legendTitle",function(e){return void 0!==e?r.legend().title(e).redraw():void 0})},observerRangeAttributes:function(e,t){return e.$observe("lowerProperty",function(e){return t.lowerProperty(n(e)).update()}),e.$observe("upperProperty",function(e){return t.upperProperty(n(e)).update()})}}}]),angular.module("wk.chart").directive("shape",["$log","scale","d3Shapes","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["shape","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,a,i,o){var l,c,u,s,d;return u=o[0].me,l=o[1].me,c=null!=(d=o[2])?d.me:void 0,l||c?(s="shape",u.kind(s),u.parent(c||l),u.chart(l),u.scaleType("ordinal"),u.scale().range(r),a.addClass(u.id()),l.addScale(u,c),u.register(),n.observeSharedAttributes(i,u),n.observeLegendAttributes(i,u,c)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("size",["$log","scale","scaleUtils",function(e,t,r){var n;return n=0,{restrict:"E",require:["size","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,a,i){var o,l,c,u,s;return c=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(u="size",c.kind(u),c.parent(l||o),c.chart(o),c.scaleType("linear"),c.resetOnNewData(!0),n.addClass(c.id()),o.addScale(c,l),c.register(),r.observeSharedAttributes(a,c),r.observeLegendAttributes(a,c,l)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("x",["$log","scale","scaleUtils",function(e,t,r){var n;return n=0,{restrict:"E",require:["x","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,a,i){var o,l,c,u,s;return c=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(u="x",c.kind(u),c.parent(l||o),c.chart(o),c.scaleType("linear"),c.resetOnNewData(!0),c.isHorizontal(!0),c.register(),n.addClass(c.id()),o.addScale(c,l),r.observeSharedAttributes(a,c),a.$observe("axis",function(e){return void 0!==e?("false"!==e?"top"===e||"bottom"===e?c.axisOrient(e).showAxis(!0):c.axisOrient("bottom").showAxis(!0):c.showAxis(!1).axisOrient(void 0),c.update(!0)):void 0}),r.observeAxisAttributes(a,c,t),r.observeLegendAttributes(a,c,l),a.$observe("rotateTickLabels",function(e){return c.rotateTickLabels(e&&_.isNumber(+e)?+e:void 0),c.update(!0)})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeX",["$log","scale","scaleUtils",function(e,t,r){var n;return n=0,{restrict:"E",require:["rangeX","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,a,i){var o,l,c,u,s;return c=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(u="rangeX",c.kind(u),c.parent(l||o),c.chart(o),c.scaleType("linear"),c.resetOnNewData(!0),c.isHorizontal(!0),c.register(),n.addClass(c.id()),o.addScale(c,l),r.observeSharedAttributes(a,c),a.$observe("axis",function(e){return void 0!==e?("false"!==e?"top"===e||"bottom"===e?c.axisOrient(e).showAxis(!0):c.axisOrient("bottom").showAxis(!0):c.showAxis(!1).axisOrient(void 0),c.update(!0)):void 0}),r.observeAxisAttributes(a,c,t),r.observeLegendAttributes(a,c,l),r.observerRangeAttributes(a,c),a.$observe("rotateTickLabels",function(e){return c.rotateTickLabels(e&&_.isNumber(+e)?+e:void 0),c.update(!0)})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("y",["$log","scale","legend","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["y","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,r,a,i){var o,l,c,u,s;return c=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(u="y",c.kind(u),c.parent(l||o),c.chart(o),c.scaleType("linear"),c.isVertical(!0),c.resetOnNewData(!0),r.addClass(c.id()),o.addScale(c,l),c.register(),n.observeSharedAttributes(a,c),a.$observe("axis",function(e){return void 0!==e?("false"!==e?"left"===e||"right"===e?c.axisOrient(e).showAxis(!0):c.axisOrient("left").showAxis(!0):c.showAxis(!1).axisOrient(void 0),c.update(!0)):void 0}),n.observeAxisAttributes(a,c,t),n.observeLegendAttributes(a,c,l)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeY",["$log","scale","legend","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["rangeY","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,r,a,i){var o,l,c,u,s;return c=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(u="rangeY",c.kind(u),c.parent(l||o),c.chart(o),c.scaleType("linear"),c.isVertical(!0),c.resetOnNewData(!0),r.addClass(c.id()),o.addScale(c,l),c.register(),n.observeSharedAttributes(a,c),a.$observe("axis",function(e){return void 0!==e?("false"!==e?"left"===e||"right"===e?c.axisOrient(e).showAxis(!0):c.axisOrient("left").showAxis(!0):c.showAxis(!1).axisOrient(void 0),c.update(!0)):void 0}),n.observeAxisAttributes(a,c,t),n.observeLegendAttributes(a,c,l),n.observerRangeAttributes(a,c)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("area",["$log","utils","tooltipUtils",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O;return d=o.me,h=[],x=[],m=[],A=[],b=[],k=[],S=void 0,O=void 0,v=void 0,C={},D=!1,f=0,w="area"+n++,l=void 0,c=void 0,g=function(e){return k=_.toArray(b),y.apply(this,[e])},y=function(e){var t;return t=k.map(function(t){return{name:t[e].key,value:C.y.formatValue(t[e].yv),color:{"background-color":t[e].color},xv:t[e].xv}}),this.headerName=C.x.axisLabel(),this.headerValue=C.x.formatValue(t[0].xv),this.layers=this.layers.concat(t)},p=function(e){return v=this.selectAll(".wk-chart-marker-"+w).data(k,function(t){return t[e].key}),v.enter().append("g").attr("class","wk-chart-marker-"+w).call(r.createTooltipMarkers,e),v.selectAll("circle").attr("cy",function(t){return t[e].y}),v.exit().remove(),this.attr("transform","translate("+(C.x.scale()(k[0][e].xv)+f)+")")},s=function(e,r,n,a,i){var o,l,u,s,d,h,g,y,p,v,w,k,C,D,O,$,P;for(y=t.mergeSeriesSorted(n.value(m),n.value(e)),O=a.layerKeys(e),x=[],b={},C=0,$=O.length;$>C;C++){for(d=O[C],b[d]=e.map(function(e){return{x:n.map(e),y:a.scale()(a.layerValue(e,d)),xv:n.value(e),yv:a.layerValue(e,d),key:d,color:i.scale()(d),data:e}}),v=p=void 0,h={key:d,color:i.scale()(d),value:[]},s=0;s<y.length;){if(void 0!==y[s][0]){v=A[d][y[s][0]];break}s++}for(;s<y.length;){if(void 0!==y[s][1]){p=b[d][y[s][1]];break}s++}for(s=D=0,P=y.length;P>D;s=++D)k=y[s],w={color:h.color,x:k[2]},void 0===k[1]?(w.yNew=p.y,w.xNew=p.x,w.deleted=!0):(w.yNew=b[d][k[1]].y,w.xNew=b[d][k[1]].x,p=b[d][k[1]],w.deleted=!1),m.length>0?void 0===k[0]?(w.yOld=v.y,w.xOld=v.x):(w.yOld=A[d][k[0]].y,w.xOld=A[d][k[0]].x,v=A[d][k[0]]):(w.xOld=w.xNew,w.yOld=w.yNew),h.value.push(w);x.push(h)}return f=n.isOrdinal()?n.scale().rangeBand()/2:0,S&&S.data(e),l=d3.svg.area().x(function(e){return e.xOld}).y0(function(e){return e.yOld}).y1(function(){return a.scale()(0)}),o=d3.svg.area().x(function(e){return e.xNew}).y0(function(e){return e.yNew}).y1(function(){return a.scale()(0)}),c=d3.svg.area().x(function(e){return n.scale()(e.x)}).y0(function(e){return e.yNew}).y1(function(){return a.scale()(0)}),g=this.selectAll(".wk-chart-layer").data(x,function(e){return e.key}),u=g.enter().append("g").attr("class","wk-chart-layer"),u.append("path").attr("class","wk-chart-area-path").style("stroke",function(e){return e.color}).style("fill",function(e){return e.color}).style("opacity",0).style("pointer-events","none"),g.select(".wk-chart-area-path").attr("transform","translate("+f+")").attr("d",function(e){return l(e.value)}).transition().duration(r.duration).attr("d",function(e){return o(e.value)}).style("opacity",.7).style("pointer-events","none"),g.exit().transition().duration(r.duration).style("opacity",0).remove(),m=e,A=b},u=function(e,t){var r;return r=this.select(".wk-chart-area-path"),e.isOrdinal()?r.attr("d",function(e){return c(e.value.slice(t[0],t[1]+1))}):r.attr("d",function(e){return c(e.value)})},d.lifeCycle().on("configure",function(){return C=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),S=d.behavior().tooltip,S.markerScale(C.x),S.on("enter."+w,g),S.on("moveData."+w,y),S.on("moveMarker."+w,p)}),d.lifeCycle().on("drawChart",s),d.lifeCycle().on("brushDraw",u),i.$observe("markers",function(e){return D=""===e||"true"===e?!0:!1})}}}]),angular.module("wk.chart").directive("areaStacked",["$log","utils","tooltipUtils",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V,B,N;return f=o.me,A=d3.layout.stack(),k="zero",v=null,V=!1,y=[],g=[],m=[],w=[],p=[],c=void 0,s={},l={},B=void 0,N=void 0,O=void 0,P={},b=void 0,x=0,$="areaStacked"+n++,D=function(e){var t;return t=g.map(function(t){return{name:t.key,value:P.y.formatValue(t.layer[e].yy),color:{"background-color":t.color}}}),this.headerName=P.x.axisLabel(),this.headerValue=P.x.formatValue(g[0].layer[e].x),this.layers=this.layers.concat(t)},S=function(e){return O=this.selectAll(".wk-chart-marker-"+$).data(g,function(e){return e.key}),O.enter().append("g").attr("class","wk-chart-marker-"+$).call(r.createTooltipMarkers),O.selectAll("circle").attr("cy",function(t){return b(t.layer[e].y+t.layer[e].y0)}),O.exit().remove(),this.attr("transform","translate("+(P.x.scale()(g[0].layer[e].x)+x)+")")},h=function(e,t){var r,n,a;for(n=0,a=t.length;a>n;n++)if(r=t[n],r.key===e)return r},C=A.values(function(e){return e.layer}).y(function(e){return e.yy}),d=function(e,r,n,a,i){var o;return y=a.layerKeys(e),s=t.diff(p,y,1),l=t.diff(y,p,-1),g=y.map(function(){return function(t){return{key:t,color:i.scale()(t),layer:e.map(function(e){return{x:n.value(e),yy:+a.layerValue(e,t),y0:0,data:e}
})}}}(this)),m=C(g),x=n.isOrdinal()?n.scale().rangeBand()/2:0,B&&B.data(e),v||(v=this.selectAll(".wk-chart-layer")),"expand"===k?(b=a.scale().copy(),b.domain([0,1])):b=a.scale(),c=d3.svg.area().x(function(e){return n.scale()(e.x)}).y0(function(e){return b(e.y0+e.y)}).y1(function(e){return b(e.y0)}),v=v.data(m,function(e){return e.key}),o=v.enter().append("path").attr("class","wk-chart-area-path").style("pointer-events","none").style("opacity",0),w.length>0&&o.attr("d",function(e){return l[e.key]?h(l[e.key],w).path:c(e.layer.map(function(e){return{x:e.x,y:0,y0:0}}))}),v.style("fill",function(e){return i.scale()(e.key)}).style("stroke",function(e){return i.scale()(e.key)}).attr("transform","translate("+x+")").transition().duration(r.duration).attr("d",function(e){return c(e.layer)}).style("opacity",1),v.exit().transition().duration(r.duration).attr("d",function(e){var t;return t=s[e.key],c(t?h(t,m).layer.map(function(e){return{x:e.x,y:0,y0:e.y0}}):m[m.length-1].layer.map(function(e){return{x:e.x,y:0,y0:e.y0+e.y}}))}).remove(),w=m.map(function(e){return{key:e.key,path:c(e.layer.map(function(e){return{x:e.x,y:0,y0:e.y+e.y0}}))}}),p=y},u=function(){return v=this.selectAll(".wk-chart-area-path"),v.attr("d",function(e){return c(e.layer)})},f.lifeCycle().on("configure",function(){return P=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),B=f.behavior().tooltip,B.markerScale(P.x),B.on("enter."+$,D),B.on("moveData."+$,D),B.on("moveMarker."+$,S)}),f.lifeCycle().on("drawChart",d),i.$observe("areaStacked",function(e){return k="zero"===e||"silhouette"===e||"expand"===e||"wiggle"===e?e:"zero",A.offset(k),f.lifeCycle().update()}),i.$observe("markers",function(e){return V=""===e||"true"===e?!0:!1})}}}]),angular.module("wk.chart").directive("areaStackedVertical",["$log","utils","tooltipUtils",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V,B;return h=o.me,A=d3.layout.stack(),k="zero",p=null,P=!1,g=[],f=[],m=[],w=[],y=[],c=void 0,u={},l={},V=void 0,B=void 0,S=void 0,$={},b=void 0,x=0,O="area-stacked-vert"+n++,C=function(e){var t;return t=f.map(function(t){return{name:t.key,value:$.x.formatValue(t.layer[e].xx),color:{"background-color":t.color}}}),this.headerName=$.y.axisLabel(),this.headerValue=$.y.formatValue(f[0].layer[e].yy),this.layers=this.layers.concat(t)},D=function(e){return S=this.selectAll(".wk-chart-marker-"+O).data(f,function(e){return e.key}),S.enter().append("g").attr("class","wk-chart-marker-"+O).call(r.createTooltipMarkers),S.selectAll("circle").attr("cx",function(t){return b(t.layer[e].y+t.layer[e].y0)}),S.exit().remove(),this.attr("transform","translate(0,"+($.y.scale()(f[0].layer[e].yy)+x)+")")},d=function(e,t){var r,n,a;for(n=0,a=t.length;a>n;n++)if(r=t[n],r.key===e)return r},v=A.values(function(e){return e.layer}).y(function(e){return e.xx}),s=function(e,r,n,a,i){var o;return g=n.layerKeys(e),u=t.diff(y,g,1),l=t.diff(g,y,-1),f=g.map(function(){return function(t){return{key:t,color:i.scale()(t),layer:e.map(function(e){return{yy:a.value(e),xx:+n.layerValue(e,t),y0:0,data:e}})}}}(this)),m=v(f),x=a.isOrdinal()?a.scale().rangeBand()/2:0,V&&V.data(e),p||(p=this.selectAll(".wk-chart-layer")),"expand"===k?(b=n.scale().copy(),b.domain([0,1])):b=n.scale(),c=d3.svg.area().x(function(e){return a.scale()(e.yy)}).y0(function(e){return b(e.y0+e.y)}).y1(function(e){return b(e.y0)}),p=p.data(m,function(e){return e.key}),o=p.enter().append("path").attr("class","wk-chart-area-path").style("pointer-events","none").style("opacity",0),w.length>0&&o.attr("d",function(e){return l[e.key]?d(l[e.key],w).path:c(e.layer.map(function(e){return{yy:e.yy,y:0,y0:0}}))}),p.style("fill",function(e){return i.scale()(e.key)}).style("stroke",function(e){return i.scale()(e.key)}).attr("transform","rotate(90) scale(1,-1)").transition().duration(r.duration).attr("d",function(e){return c(e.layer)}).style("opacity",1),p.exit().transition().duration(r.duration).attr("d",function(e){var t;return t=u[e.key],c(t?d(t,m).layer.map(function(e){return{yy:e.yy,y:0,y0:e.y0}}):m[m.length-1].layer.map(function(e){return{yy:e.yy,y:0,y0:e.y0+e.y}}))}).remove(),w=m.map(function(e){return{key:e.key,path:c(e.layer.map(function(e){return{yy:e.yy,y:0,y0:e.y+e.y0}}))}}),y=g},h.lifeCycle().on("configure",function(){return $=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).domainCalc("extent"),V=h.behavior().tooltip,V.markerScale($.y),V.on("enter."+O,C),V.on("moveData."+O,C),V.on("moveMarker."+O,D)}),h.lifeCycle().on("drawChart",s),i.$observe("areaStackedVertical",function(e){return k="zero"===e||"silhouette"===e||"expand"===e||"wiggle"===e?e:"zero",A.offset(k),h.lifeCycle().update()}),i.$observe("markers",function(e){return P=""===e||"true"===e?!0:!1})}}}]),angular.module("wk.chart").directive("areaVertical",["$log","utils","tooltipUtils",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O;return d=o.me,h=[],x=[],m=[],A=[],b=[],k=[],S=void 0,O=void 0,v=void 0,C={},D=!1,f=0,l=void 0,u=0,w="areaVertical"+n++,g=function(e){return k=_.toArray(b),y.apply(this,[e])},y=function(e){var t,r;return t=e+u,r=k.map(function(e){return{name:e[t].key,value:C.x.formatValue(e[t].xv),color:{"background-color":e[t].color},yv:e[t].yv}}),this.headerName=C.y.axisLabel(),this.headerValue=C.y.formatValue(r[0].yv),this.layers=this.layers.concat(r)},p=function(e){var t,n,a;return n=e+u,v=this.selectAll(".wk-chart-marker-"+w).data(k,function(e){return e[n].key}),a=v.enter().append("g").attr("class","wk-chart-marker-"+w).call(r.createTooltipMarkers,n),v.selectAll("circle").attr("cx",function(e){return e[n].x}),v.exit().remove(),t=C.y.isOrdinal?C.y.scale().rangeBand()/2:0,this.attr("transform","translate(0,"+(C.y.scale()(k[0][n].yv)+t)+")")},s=function(e,r,n,a,i){var o,c,u,s,d,h,g,y,p,v,w,k,C,D,O,$;for(g=a.isOrdinal()?t.mergeSeriesUnsorted(a.value(m),a.value(e)):t.mergeSeriesSorted(a.value(m),a.value(e)),D=n.layerKeys(e),x=[],b={},k=0,O=D.length;O>k;k++){for(s=D[k],b[s]=e.map(function(e){return{y:a.map(e),x:n.scale()(n.layerValue(e,s)),yv:a.value(e),xv:n.layerValue(e,s),key:s,color:i.scale()(s),data:e}}),d={key:s,color:i.scale()(s),value:[]},u=0;u<g.length;){if(void 0!==g[u][0]){p=A[s][g[u][0]];break}u++}for(;u<g.length;){if(void 0!==g[u][1]){y=b[s][g[u][1]];break}u++}for(u=C=0,$=g.length;$>C;u=++C)w=g[u],v={color:d.color,y:w[2]},void 0===w[1]?(v.yNew=y.y,v.xNew=y.x,v.deleted=!0):(v.yNew=b[s][w[1]].y,v.xNew=b[s][w[1]].x,y=b[s][w[1]],v.deleted=!1),m.length>0?void 0===w[0]?(v.yOld=p.y,v.xOld=p.x):(v.yOld=A[s][w[0]].y,v.xOld=A[s][w[0]].x,p=A[s][w[0]]):(v.xOld=v.xNew,v.yOld=v.yNew),d.value.push(v);x.push(d)}return f=a.isOrdinal()?a.scale().rangeBand()/2:0,S&&S.data(e),c=d3.svg.area().x(function(e){return r.width-e.yOld}).y0(function(e){return e.xOld}).y1(function(){return n.scale()(0)}),o=d3.svg.area().x(function(e){return r.width-e.yNew}).y0(function(e){return e.xNew}).y1(function(){return n.scale()(0)}),l=d3.svg.area().x(function(e){return r.width-a.scale()(e.y)}).y0(function(e){return e.xNew}).y1(function(){return n.scale()(0)}),h=this.selectAll(".wk-chart-layer").data(x,function(e){return e.key}),h.enter().append("g").attr("class","wk-chart-layer").append("path").attr("class","wk-chart-area-path").style("stroke",function(e){return e.color}).style("fill",function(e){return e.color}).style("opacity",0).style("pointer-events","none"),h.select(".wk-chart-area-path").attr("transform","translate(0,"+(r.width+f)+")rotate(-90)").attr("d",function(e){return c(e.value)}).transition().duration(r.duration).attr("d",function(e){return o(e.value)}).style("opacity",.7).style("pointer-events","none"),h.exit().transition().duration(r.duration).style("opacity",0).remove(),m=e,A=b},c=function(e,t,r){var n;return n=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(n.attr("transform","translate(0,"+(r+e.scale().rangeBand()/2)+")rotate(-90)"),n.attr("d",function(e){return l(e.value.slice(t[0],t[1]+1))}),u=t[0]):n.attr("d",function(e){return l(e.value)})},d.lifeCycle().on("configure",function(){return C=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),S=d.behavior().tooltip,S.markerScale(C.y),S.on("enter."+w,g),S.on("moveData."+w,y),S.on("moveMarker."+w,p)}),d.lifeCycle().on("drawChart",s),d.lifeCycle().on("brushDraw",c),i.$observe("markers",function(e){return D=""===e||"true"===e?!0:!1})}}}]),angular.module("wk.chart").directive("bars",["$log","utils","barConfig","wkChartMargins",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var c,u,s,d,h,f,g,y,p,v,m,w,x,k;return g=l.me,v="bars"+a++,s=null,u=0,c=0,w={},x=void 0,m=t.mergeData(),m([]).key(function(e){return e.key}),y=!0,h=_.clone(r,!0),k=void 0,p=function(e){return this.headerName=w.y.axisLabel(),this.headerValue=w.x.axisLabel(),this.layers.push({name:w.color.formattedValue(e.data),value:w.x.formattedValue(e.data),color:{"background-color":w.color.map(e.data)}})},f=function(e,t,r,a,i){var o,l,d,f;return s||(s=this.selectAll(".wk-chart-bars")),l=a.scale().rangeBand()/(1-h.padding)*h.padding,o=a.scale().rangeBand()/(1-h.outerPadding)*h.outerPadding,f=e.map(function(e){return{key:a.value(e),x:r.map(e),y:a.map(e),color:i.map(e),height:a.scale().rangeBand(a.value(e)),data:e}}),m(f).first({y:t.height+u/2-o}).last({y:0,height:c-u/2}),s=s.data(f,function(e){return e.key}),d=s.enter().append("g").attr("class","wk-chart-bar").attr("transform",function(e){return"translate(0, "+(y?e.y:m.addedPred(e).y-u/2)+") scale(1, "+(y?1:0)+")"}),d.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(e){return e.height}).style("opacity",y?0:1).call(k.tooltip).call(x),d.append("text").attr({"class":"wk-chart-data-label"}).attr("y",function(e){return e.height/2}).attr("x",function(e){return e.x+n.dataLabelPadding.hor}).attr({dy:"0.35em","text-anchor":"start"}).style({opacity:0}),s.transition().duration(t.duration).attr("transform",function(e){return"translate(0, "+e.y+") scale(1,1)"}),s.select("rect").style("fill",function(e){return e.color}).transition().duration(t.duration).attr("height",function(e){return e.height}).attr("width",function(e){return Math.abs(r.scale()(0)-e.x)}).style("opacity",1),s.select("text").text(function(e){return r.formattedValue(e.data)}).transition().duration(t.duration).attr("y",function(e){return e.height/2}).attr("x",function(e){return e.x+n.dataLabelPadding.hor}).style("opacity",g.showDataLabels()?1:0),s.exit().transition().duration(t.duration).attr("transform",function(e){return"translate(0,"+(m.deletedSucc(e).y+m.deletedSucc(e).height+l/2)+") scale(1,0)"}).attr("height",0).remove(),y=!1,u=l,c=o},d=function(e){return s.attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()}),s.selectAll("text").attr("y",e.scale().rangeBand()/2)},g.lifeCycle().on("configure",function(){return w=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(h).scaleType("ordinal"),k=g.behavior().tooltip,x=g.behavior().selected,k.on("enter."+v,p)}),g.lifeCycle().on("drawChart",f),g.lifeCycle().on("brushDraw",d),o.$observe("padding",function(e){var n;return"false"===e?(h.padding=0,h.outerPadding=0):"true"===e?h=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(h.padding=n[0]/100,h.outerPadding=n[0]/100),2===n.length&&(h.padding=n[0]/100,h.outerPadding=n[1]/100))),w.y.rangePadding(h),g.lifeCycle().update()}),o.$observe("labels",function(e){return"false"===e?g.showDataLabels(!1):("true"===e||""===e)&&g.showDataLabels("x"),g.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("barClustered",["$log","utils","barConfig",function(e,t,r){var n;return n=0,{restrict:"A",require:"^layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k;return f=o.me,v="clusteredBar"+n++,y=null,u=void 0,m=t.mergeData().key(function(e){return e.key}),w=t.mergeData().key(function(e){return e.layerKey}),c=0,l=0,s=_.clone(r,!0),g=!0,k=void 0,x={},p=function(e){var t;return t=e.layers.map(function(e){return{name:e.layerKey,value:x.x.formatValue(e.value),color:{"background-color":e.color}}}),this.headerName=x.y.axisLabel(),this.headerValue=x.y.formatValue(e.key),this.layers=this.layers.concat(t)},d=function(e,t,r,n,a){var i,o,d,h,f;return o=n.scale().rangeBand()/(1-s.padding)*s.padding,i=n.scale().rangeBand()/(1-s.outerPadding)*s.outerPadding,f=r.layerKeys(e),u=d3.scale.ordinal().domain(r.layerKeys(e)).rangeBands([0,n.scale().rangeBand()],0,0),h=e.map(function(e){var t;return t={key:n.value(e),data:e,y:n.map(e),height:n.scale().rangeBand(n.value(e)),layers:f.map(function(t){return{layerKey:t,color:a.scale()(t),key:n.value(e),value:e[t],y:u(t),x:r.scale()(e[t]),width:r.scale()(e[t]),height:u.rangeBand(t)}})}}),m(h).first({y:t.height+c/2-i,height:n.scale().rangeBand()}).last({y:0,height:l-c/2}),w(h[0].layers).first({y:0,height:0}).last({y:h[0].height,height:0}),y||(y=this.selectAll(".wk-chart-layer")),y=y.data(h,function(e){return e.key}),y.enter().append("g").attr("class","wk-chart-layer").call(k.tooltip).attr("transform",function(e){return"translate(0, "+(g?e.y:m.addedPred(e).y-c/2)+") scale(1,"+(g?1:0)+")"}).style("opacity",g?0:1),y.transition().duration(t.duration).attr("transform",function(e){return"translate(0,"+e.y+") scale(1,1)"}).style("opacity",1),y.exit().transition().duration(t.duration).attr("transform",function(e){return"translate(0, "+(m.deletedSucc(e).y+m.deletedSucc(e).height+o/2)+") scale(1,0)"}).remove(),d=y.selectAll(".wk-chart-bar").data(function(e){return e.layers},function(e){return e.layerKey+"|"+e.key}),d.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("y",function(e){return g?e.y:w.addedPred(e).y+w.addedPred(e).height}).attr("height",function(e){return g?e.height:0}).attr("x",r.scale()(0)),d.style("fill",function(e){return a.scale()(e.layerKey)}).transition().duration(t.duration).attr("width",function(e){return e.width}).attr("y",function(e){return e.y}).attr("x",function(e){return Math.min(r.scale()(0),e.x)}).attr("height",function(e){return Math.abs(e.height)}),d.exit().transition().duration(t.duration).attr("height",0).attr("y",function(e){return w.deletedSucc(e).y}).remove(),g=!1,c=o,l=i},h=function(e){var t;return u.rangeBands([0,e.scale().rangeBand()],0,0),t=u.rangeBand(),y.attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-bar").attr("height",t).attr("y",function(e){return u(e.layerKey)})},f.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(s).scaleType("ordinal"),this.layerScale("color"),k=f.behavior().tooltip,k.on("enter."+v,p)}),f.lifeCycle().on("drawChart",d),f.lifeCycle().on("brushDraw",h),i.$observe("padding",function(e){var n;return"false"===e?(s.padding=0,s.outerPadding=0):"true"===e?s=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(s.padding=n[0]/100,s.outerPadding=n[0]/100),2===n.length&&(s.padding=n[0]/100,s.outerPadding=n[1]/100))),x.y.rangePadding(s),f.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("barStacked",["$log","utils","barConfig",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b;return h=o.me,v="stackedBar"+n++,g=null,y=[],b=function(){},x={},k=void 0,c=0,l=0,m=t.mergeData().key(function(e){return e.key}),w=t.mergeData(),f=!0,u=_.clone(r,!0),p=function(e){var t;return t=e.layers.map(function(e){return{name:e.layerKey,value:x.y.formatValue(e.value),color:{"background-color":e.color}}}),this.headerName=x.x.axisLabel(),this.headerValue=x.x.formatValue(e.key),this.layers=this.layers.concat(t)},s=function(e,t,r,n,a){var i,o,s,d,h,p,v,x,A;for(g||(g=this.selectAll(".wk-chart-layer")),o=n.scale().rangeBand()/(1-u.padding)*u.padding,i=n.scale().rangeBand()/(1-u.outerPadding)*u.outerPadding,p=r.layerKeys(e),y=[],x=0,A=e.length;A>x;x++)d=e[x],v=0,h={key:n.value(d),layers:[],data:d,y:n.map(d),height:n.scale().rangeBand?n.scale().rangeBand():1},void 0!==h.y&&(h.layers=p.map(function(e){var t;return t={layerKey:e,key:h.key,value:d[e],width:r.scale()(+d[e]),height:n.scale().rangeBand?n.scale().rangeBand():1,x:r.scale()(+v),color:a.scale()(e)},v+=+d[e],t}),y.push(h));return m(y).first({y:t.height+c/2-i,height:0}).last({y:0,height:l-c/2}),w(p),g=g.data(y,function(e){return e.key}),g.enter().append("g").attr("class","wk-chart-layer").attr("transform",function(e){return"translate(0,"+(f?e.y:m.addedPred(e).y-c/2)+") scale(1,"+(f?1:0)+")"}).style("opacity",f?0:1).call(b.tooltip),g.transition().duration(t.duration).attr("transform",function(e){return"translate(0, "+e.y+") scale(1,1)"}).style("opacity",1),g.exit().transition().duration(t.duration).attr("transform",function(e){return"translate(0,"+(m.deletedSucc(e).y+m.deletedSucc(e).height+o/2)+") scale(1,0)"}).remove(),s=g.selectAll(".wk-chart-bar").data(function(e){return e.layers},function(e){return e.layerKey+"|"+e.key}),s.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("x",function(e){var t;return m.prev(e.key)?(t=p.indexOf(w.addedPred(e.layerKey)),t>=0?m.prev(e.key).layers[t].x+m.prev(e.key).layers[t].width:r.scale()(0)):e.x}).attr("width",function(e){return m.prev(e.key)?0:e.width}).attr("height",function(e){return e.height}).call(k),s.style("fill",function(e){return e.color}).transition().duration(t.duration).attr("x",function(e){return e.x}).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}),s.exit().transition().duration(t.duration).attr("x",function(e){var t;return t=p.indexOf(w.deletedSucc(e.layerKey)),t>=0?m.current(e.key).layers[t].x:m.current(e.key).layers[p.length-1].x+m.current(e.key).layers[p.length-1].width}).attr("width",0).remove(),f=!1,c=o,l=i},d=function(e){return g.attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-bar").attr("height",function(){return e.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(u).scaleType("ordinal"),this.layerScale("color"),b=h.behavior().tooltip,k=h.behavior().selected,b.on("enter."+v,p)}),h.lifeCycle().on("drawChart",s),h.lifeCycle().on("brushDraw",d),i.$observe("padding",function(e){var n;return"false"===e?(u.padding=0,u.outerPadding=0):"true"===e?u=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(u.padding=n[0]/100,u.outerPadding=n[0]/100),2===n.length&&(u.padding=n[0]/100,u.outerPadding=n[1]/100))),x.y.rangePadding(u),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("bubble",["$log","utils",function(){var e;return e=0,{restrict:"A",require:"layout",link:function(t,r,n,a){var i,o,l,c,u,s,d;return o=a.me,d=void 0,u={},c="bubble"+e++,s=void 0,l=function(e){var t,r,n;n=[];for(t in u)r=u[t],n.push(this.layers.push({name:r.axisLabel(),value:r.formattedValue(e),color:"color"===t?{"background-color":r.map(e)}:void 0}));return n},i=function(e,t,r,n,a,i){var o;return o=this.selectAll(".wk-chart-bubble").data(e,function(e){return a.value(e)}),o.enter().append("circle").attr("class","wk-chart-bubble wk-chart-selectable").style("opacity",0).call(d.tooltip).call(s),o.style("fill",function(e){return a.map(e)}).transition().duration(t.duration).attr({r:function(e){return i.map(e)},cx:function(e){return r.map(e)},cy:function(e){return n.map(e)}}).style("opacity",1),o.exit().transition().duration(t.duration).style("opacity",0).remove()},o.lifeCycle().on("configure",function(){return u=this.getScales(["x","y","color","size"]),this.getKind("y").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0),d=o.behavior().tooltip,s=o.behavior().selected,d.on("enter."+c,l)}),o.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("column",["$log","utils","barConfig","wkChartMargins",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var c,u,s,d,h,f,g,y,p,v,m,w,x,k;return g=l.me,v="column"+a++,d=null,w={},x=void 0,m=t.mergeData(),m([]).key(function(e){return e.key}),y=!0,u=0,c=0,h=_.clone(r,!0),k=void 0,p=function(e){return this.headerName=w.x.axisLabel(),this.headerValue=w.y.axisLabel(),this.layers.push({name:w.color.formattedValue(e.data),value:w.y.formattedValue(e.data),color:{"background-color":w.color.map(e.data)}})},f=function(e,t,r,a,i){var o,l,s,f;return d||(d=this.selectAll(".wk-chart-column")),l=r.scale().rangeBand()/(1-h.padding)*h.padding,o=r.scale().rangeBand()/(1-h.outerPadding)*h.outerPadding,f=e.map(function(e){return{data:e,key:r.value(e),x:r.map(e),y:Math.min(a.scale()(0),a.map(e)),color:i.map(e),width:r.scale().rangeBand(r.value(e)),height:Math.abs(a.scale()(0)-a.map(e))}}),m(f).first({x:0,width:0}).last({x:t.width+l/2-c,width:o}),d=d.data(f,function(e){return e.key}),s=d.enter().append("g").attr("class","wk-chart-column").attr("transform",function(e,t){return"translate("+(y?e.x:m.addedPred(e).x+m.addedPred(e).width+(t?u/2:c))+","+e.y+") scale("+(y?1:0)+",1)"}),s.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(e){return e.height}).attr("width",function(e){return e.width}).style("fill",function(e){return e.color}).style("opacity",y?0:1).call(k.tooltip).call(x),s.append("text").attr("class","wk-chart-data-label").attr("x",function(e){return e.width/2}).attr("y",-n.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),d.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+", "+e.y+") scale(1,1)"}),d.select("rect").transition().duration(t.duration).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}).style("opacity",1),d.select("text").text(function(e){return a.formattedValue(e.data)}).transition().duration(t.duration).attr("x",function(e){return e.width/2}).style("opacity",g.showDataLabels()?1:0),d.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+(m.deletedSucc(e).x-l/2)+","+e.y+") scale(0,1)"}).remove(),y=!1,u=l,c=o},s=function(e){return d.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.key))>=0?r:-1e3)+", "+t.y+")"}).selectAll(".wk-chart-rect").attr("width",function(){return e.scale().rangeBand()}),d.selectAll("text").attr("x",e.scale().rangeBand()/2)},g.lifeCycle().on("configure",function(){return w=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(h).scaleType("ordinal"),k=g.behavior().tooltip,x=g.behavior().selected,k.on("enter."+v,p)}),g.lifeCycle().on("drawChart",f),g.lifeCycle().on("brushDraw",s),o.$observe("padding",function(e){var n;return"false"===e?(h.padding=0,h.outerPadding=0):"true"===e?h=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(h.padding=n[0]/100,h.outerPadding=n[0]/100),2===n.length&&(h.padding=n[0]/100,h.outerPadding=n[1]/100))),w.x.rangePadding(h),g.lifeCycle().update()}),o.$observe("labels",function(e){return"false"===e?g.showDataLabels(!1):("true"===e||""===e)&&g.showDataLabels("y"),g.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("columnClustered",["$log","utils","barConfig",function(e,t,r){var n;return n=0,{restrict:"A",require:"^layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k;return f=o.me,v="clusteredColumn"+n++,y=null,m=t.mergeData().key(function(e){return e.key}),w=t.mergeData().key(function(e){return e.layerKey}),c=0,l=0,s=_.clone(r,!0),h=void 0,u=void 0,g=!0,k=void 0,x={},p=function(e){var t;return t=e.layers.map(function(e){return{name:e.layerKey,value:x.y.formatValue(e.value),color:{"background-color":e.color}}}),this.headerName=x.x.axisLabel(),this.headerValue=x.x.formatValue(e.key),this.layers=this.layers.concat(t)},d=function(e,t,r,n,a){var i,o,d,h,f;return o=r.scale().rangeBand()/(1-s.padding)*s.padding,i=r.scale().rangeBand()/(1-s.outerPadding)*s.outerPadding,f=n.layerKeys(e),u=d3.scale.ordinal().domain(n.layerKeys(e)).rangeBands([0,r.scale().rangeBand()],0,0),h=e.map(function(e){var t;return t={key:r.value(e),data:e,x:r.map(e),width:r.scale().rangeBand(r.value(e)),layers:f.map(function(t){return{layerKey:t,color:a.scale()(t),key:r.value(e),value:e[t],x:u(t),y:n.scale()(e[t]),height:n.scale()(0)-n.scale()(e[t]),width:u.rangeBand(t)}})}}),m(h).first({x:c/2-i,width:0}).last({x:t.width+o/2-l,width:0}),w(h[0].layers).first({x:0,width:0}).last({x:h[0].width,width:0}),y||(y=this.selectAll(".wk-chart-layer")),y=y.data(h,function(e){return e.key}),y.enter().append("g").attr("class","wk-chart-layer").call(k.tooltip).attr("transform",function(e){return"translate("+(g?e.x:m.addedPred(e).x+m.addedPred(e).width+c/2)+",0) scale("+(g?1:0)+", 1)"}).style("opacity",g?0:1),y.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+",0) scale(1,1)"}).style("opacity",1),y.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+(m.deletedSucc(e).x-o/2)+", 0) scale(0,1)"}).remove(),d=y.selectAll(".wk-chart-bar").data(function(e){return e.layers},function(e){return e.layerKey+"|"+e.key}),d.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("x",function(e){return g?e.x:w.addedPred(e).x+w.addedPred(e).width}).attr("width",function(e){return g?e.width:0}),d.style("fill",function(e){return a.scale()(e.layerKey)}).transition().duration(t.duration).attr("width",function(e){return e.width}).attr("x",function(e){return e.x}).attr("y",function(e){return Math.min(n.scale()(0),e.y)}).attr("height",function(e){return Math.abs(e.height)}),d.exit().transition().duration(t.duration).attr("width",0).attr("x",function(e){return w.deletedSucc(e).x}).remove(),g=!1,c=o,l=i},h=function(e){var t;return u.rangeBands([0,e.scale().rangeBand()],0,0),t=u.rangeBand(),y.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.key))>=0?r:-1e3)+",0)"}).selectAll(".wk-chart-bar").attr("width",t).attr("x",function(e){return u(e.layerKey)})},f.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(s).scaleType("ordinal"),this.layerScale("color"),k=f.behavior().tooltip,k.on("enter."+v,p)}),f.lifeCycle().on("drawChart",d),f.lifeCycle().on("brushDraw",h),i.$observe("padding",function(e){var n;return"false"===e?(s.padding=0,s.outerPadding=0):"true"===e?s=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(s.padding=n[0]/100,s.outerPadding=n[0]/100),2===n.length&&(s.padding=n[0]/100,s.outerPadding=n[1]/100))),x.x.rangePadding(s),f.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("columnStacked",["$log","utils","barConfig",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b;return h=o.me,v="stackedColumn"+n++,g=null,y=[],b=function(){},x={},k=void 0,c=0,l=0,m=t.mergeData().key(function(e){return e.key}),w=t.mergeData(),f=!0,u=_.clone(r,!0),p=function(e){var t;return t=e.layers.map(function(e){return{name:e.layerKey,value:x.y.formatValue(e.value),color:{"background-color":e.color}}}),this.headerName=x.x.axisLabel(),this.headerValue=x.x.formatValue(e.key),this.layers=this.layers.concat(t)},s=function(e,t,r,n,a){var i,o,s,d,h,p,v,x,A;for(g||(g=this.selectAll(".layer")),o=r.scale().rangeBand()/(1-u.padding)*u.padding,i=r.scale().rangeBand()/(1-u.outerPadding)*u.outerPadding,p=n.layerKeys(e),y=[],x=0,A=e.length;A>x;x++)d=e[x],v=0,h={key:r.value(d),layers:[],data:d,x:r.map(d),width:r.scale().rangeBand?r.scale().rangeBand():1},void 0!==h.x&&(h.layers=p.map(function(e){var t;return t={layerKey:e,key:h.key,value:d[e],height:n.scale()(0)-n.scale()(+d[e]),width:r.scale().rangeBand?r.scale().rangeBand():1,y:n.scale()(+v+ +d[e]),color:a.scale()(e)},v+=+d[e],t}),y.push(h));return m(y).first({x:c/2-i,width:0}).last({x:t.width+o/2-l,width:0}),w(p),g=g.data(y,function(e){return e.key}),g.enter().append("g").attr("transform",function(e){return"translate("+(f?e.x:m.addedPred(e).x+m.addedPred(e).width+c/2)+",0) scale("+(f?1:0)+", 1)"}).style("opacity",f?0:1).call(b.tooltip),g.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+",0) scale(1,1)"}).style("opacity",1),g.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+(m.deletedSucc(e).x-o/2)+", 0) scale(0,1)"}).remove(),s=g.selectAll(".wk-chart-bar").data(function(e){return e.layers},function(e){return e.layerKey+"|"+e.key}),s.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("y",function(e){var t;return m.prev(e.key)?(t=p.indexOf(w.addedPred(e.layerKey)),t>=0?m.prev(e.key).layers[t].y:n.scale()(0)):e.y}).attr("height",function(e){return e.height}).call(k),s.style("fill",function(e){return e.color}).transition().duration(t.duration).attr("y",function(e){return e.y}).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}),s.exit().transition().duration(t.duration).attr("height",0).attr("y",function(e){var t;return t=p.indexOf(w.deletedSucc(e.layerKey)),t>=0?m.current(e.key).layers[t].y+m.current(e.key).layers[t].height:m.current(e.key).layers[p.length-1].y}).remove(),f=!1,c=o,l=i},d=function(e){return g.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.key))>=0?r:-1e3)+",0)"}).selectAll(".wk-chart-bar").attr("width",function(){return e.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return x=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(u).scaleType("ordinal"),this.layerScale("color"),b=h.behavior().tooltip,k=h.behavior().selected,b.on("enter."+v,p)}),h.lifeCycle().on("drawChart",s),h.lifeCycle().on("brushDraw",d),i.$observe("padding",function(e){var n;return"false"===e?(u.padding=0,u.outerPadding=0):"true"===e?u=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(u.padding=n[0]/100,u.outerPadding=n[0]/100),2===n.length&&(u.padding=n[0]/100,u.outerPadding=n[1]/100))),x.x.rangePadding(u),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("gauge",["$log","utils",function(e,t){return{restrict:"A",require:"^layout",controller:["$scope","$attrs",function(e,r){var n;return n={chartType:"GaugeChart",id:t.getId()},r.$set("chart-id",n.id),n}],link:function(t,r,n,a){var i,o,l;return l=a.me,o=!0,i=function(t,r,n,a,i){var l,c,u,s,d,h,f,g,y,p;for(e.info("drawing Gauge Chart"),s=[t],g=a.scale().domain(),u=angular.copy(i.scale().domain()),u.unshift(g[0]),u.push(g[1]),f=[],d=y=1,p=u.length-1;p>=1?p>=y:y>=p;d=p>=1?++y:--y)f.push({from:+u[d-1],to:+u[d]});return c=this.selectAll(".wk-chart-bar"),c=c.data(f,function(e,t){return t}),o?c.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50).style("opacity",0):c.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50),c.transition().duration(r.duration).attr("height",function(e){return a.scale()(0)-a.scale()(e.to-e.from)}).attr("y",function(e){return a.scale()(e.to)}).style("fill",function(e){return i.scale()(e.from)}).style("opacity",1),c.exit().remove(),l=function(e){return e.append("rect").attr("width",55).attr("height",4).style("fill","black"),e.append("circle").attr("r",10).attr("cx",65).attr("cy",2).style("stroke","black")
},h=this.selectAll(".wk-chart-marker"),h=h.data(s,function(){return"wk-chart-marker"}),h.enter().append("g").attr("class","wk-chart-marker").call(l),o&&h.attr("transform",function(e){return"translate(0,"+a.scale()(e.value)+")"}).style("opacity",0),h.transition().duration(r.duration).attr("transform",function(e){return"translate(0,"+a.scale()(e.value)+")"}).style("fill",function(e){return i.scale()(e.value)}).style("opacity",1),o=!1},l.lifeCycle().on("configure",function(){return this.requiredScales(["y","color"]),this.getKind("color").resetOnNewData(!0)}),l.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("geoMap",["$log","utils",function(e){var t,r;return t=0,r=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),t=t.map(function(e){return isNaN(e)?e:+e}),1===t.length?t[0]:t):void 0},{restrict:"A",require:"layout",scope:{geojson:"=",projection:"="},link:function(r,n,a,i){var o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A;return l=i.me,k=void 0,x=void 0,w={},f="geoMap"+t++,s=d3.map(),m=1,v=[0,0],g="",u=function(e){var t;return t=s.get(e.properties[g[0]]),this.layers.push({name:t.RS,value:t.DES})},c=[],p=d3.geo.orthographic(),b=0,h=0,y=void 0,A=d3.geo.zoom().projection(p).on("zoom.redraw",function(){return d3.event.sourceEvent.preventDefault(),c.attr("d",y)}),d=void 0,o=function(e,t,r,n,a){var i,o,l;if(b=t.width,h=t.height,e&&e[0].hasOwnProperty(g[1]))for(o=0,l=e.length;l>o;o++)i=e[o],s.set(i[g[1]],i);return d?(p.translate([b/2,h/2]),c=this.selectAll("path").data(d.features,function(e){return e.properties[g[0]]}),c.enter().append("svg:path").style("fill","lightgrey").style("stroke","darkgrey").call(k.tooltip).call(x).call(A),c.attr("d",y).style("fill",function(e){var t;return t=s.get(e.properties[g[0]]),a.map(t)}),c.exit().remove()):void 0},l.lifeCycle().on("configure",function(){return w=this.getScales(["color"]),w.color.resetOnNewData(!0)}),l.lifeCycle().on("drawChart",o),k=l.behavior().tooltip,x=l.behavior().selected,k.on("enter."+f,u),r.$watch("projection",function(t){return void 0!==t&&(e.log("setting Projection params",t),d3.geo.hasOwnProperty(t.projection))?(p=d3.geo[t.projection](),p.center(t.center).scale(t.scale).rotate(t.rotate).clipAngle(t.clipAngle),g=t.idMap,p.parallels&&p.parallels(t.parallels),m=p.scale(),v=p.rotate(),y=d3.geo.path().projection(p),A.projection(p),l.lifeCycle().update()):void 0},!0),r.$watch("geojson",function(e){return void 0!==e&&""!==e?(d=e,l.lifeCycle().update()):void 0})}}}]),angular.module("wk.chart").directive("columnHistogram",["$log","barConfig","utils","wkChartMargins",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var c,u,s,d,h,f,g,y,p,v,m,w,x;return h=l.me,p="histogram"+a++,m={},u=void 0,g=void 0,s={},x=void 0,w=void 0,s=_.clone(t,!0),v=r.mergeData().key(function(e){return e.xVal}),f=!0,x=void 0,y=function(e){var t,r,n;return this.headerName=m.rangeX.axisLabel(),this.headerValue=m.y.axisLabel(),t=m.rangeX.formatValue(m.rangeX.lowerValue(e.data)),m.rangeX.upperProperty()?(n=m.rangeX.formatValue(m.rangeX.upperValue(e.data)),r=t+" - "+n):r=m.rangeX.formatValue(m.rangeX.lowerValue(e.data)),this.layers.push({name:r,value:m.y.formattedValue(e.data),color:{"background-color":m.color.map(e.data)}})},d=function(e,t,r,a,i,o,l,c){var s,d,g,y,p;return c.upperProperty()?d=e.map(function(e){return{x:c.scale()(c.lowerValue(e)),xVal:c.lowerValue(e),width:c.scale()(c.upperValue(e))-c.scale()(c.lowerValue(e)),y:a.map(e),height:t.height-a.map(e),color:i.map(e),data:e}}):e.length>0&&(g=c.lowerValue(e[0]),y=c.lowerValue(e[1])-g,p=t.width/e.length,d=e.map(function(e,r){return{x:c.scale()(g+y*r),xVal:c.lowerValue(e),width:p,y:a.map(e),height:t.height-a.map(e),color:i.map(e),data:e}})),v(d).first({x:0,width:0}).last({x:t.width,width:0}),u||(u=this.selectAll(".wk-chart-bucket")),u=u.data(d,function(e){return e.xVal}),s=u.enter().append("g").attr("class","wk-chart-bucket").attr("transform",function(e){return"translate("+(f?e.x:v.addedPred(e).x+v.addedPred(e).width)+","+e.y+") scale("+(f?1:0)+",1)"}),s.append("rect").attr("class","wk-chart-selectable").attr("height",function(e){return e.height}).attr("width",function(e){return e.width}).style("fill",function(e){return e.color}).style("opacity",f?0:1).call(x.tooltip).call(w),s.append("text").attr("class","wk-chart-data-label").attr("x",function(e){return e.width/2}).attr("y",-n.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),u.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+", "+e.y+") scale(1,1)"}),u.select("rect").transition().duration(t.duration).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}).style("fill",function(e){return e.color}).style("opacity",1),u.select("text").text(function(e){return a.formattedValue(e.data)}).transition().duration(t.duration).attr("x",function(e){return e.width/2}).style("opacity",h.showDataLabels()?1:0),u.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+v.deletedSucc(e).x+","+e.y+") scale(0,1)"}).remove(),f=!1},c=function(e,t,r){var n;return n=function(e,n){return e.upperProperty()?e.scale()(e.upperValue(n.data))-e.scale()(e.lowerValue(n.data)):r/Math.max(t[1]-t[0]+1,1)},u.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.xVal))>=0?r:-1e3)+", "+t.y+")"}),u.select("rect").attr("width",function(t){return n(e,t)}),u.selectAll("text").attr("x",function(t){return n(e,t)/2})},h.lifeCycle().on("configure",function(){return m=this.getScales(["rangeX","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("rangeX").resetOnNewData(!0).scaleType("linear").domainCalc("rangeExtent"),this.getKind("color").resetOnNewData(!0),x=h.behavior().tooltip,w=h.behavior().selected,x.on("enter."+p,y)}),h.lifeCycle().on("drawChart",d),h.lifeCycle().on("brushDraw",c),o.$observe("labels",function(e){return"false"===e?h.showDataLabels(!1):("true"===e||""===e)&&h.showDataLabels("y"),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("line",["$log","behavior","utils","tooltipUtils","timing",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"layout",link:function(e,t,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V;return u=o.me,b=[],A=[],w=[],S=[],D=[],C=[],k=0,P=void 0,V=void 0,m=void 0,$=!1,O={},g=0,x="line"+a++,s=void 0,h=void 0,f=void 0,d=void 0,y=function(e){return C=_.toArray(D),p.apply(this,[e])},p=function(e){var t;return t=C.map(function(t){return{name:t[e].key,value:O.y.formatValue(t[e].yv),color:{"background-color":t[e].color},xv:t[e].xv}}),this.headerName=O.x.axisLabel(),this.headerValue=O.x.formatValue(t[0].xv),this.layers=this.layers.concat(t)},v=function(e){return m=this.selectAll(".wk-chart-marker-"+x).data(C,function(t){return t[e].key}),m.enter().append("g").attr("class","wk-chart-marker-"+x).call(n.createTooltipMarkers,e),m.selectAll("circle").attr("cy",function(t){return t[e].y}),m.exit().remove(),this.attr("transform","translate("+(O.x.scale()(C[0][e].xv)+g)+")")},c=function(e,t,n,a,i){var o,l,c,u,s,y,p,v,m,x,C,O,V,B,N,M;for(v=r.mergeSeriesSorted(n.value(w),n.value(e)),b=a.layerKeys(e),A=[],D={},V=0,N=b.length;N>V;V++){for(c=b[V],D[c]=e.map(function(e){return{x:n.map(e),y:a.scale()(a.layerValue(e,c)),xv:n.value(e),yv:a.layerValue(e,c),key:c,color:i.scale()(c),data:e}}),u={key:c,color:i.scale()(c),value:[]},l=0;l<v.length;){if(void 0!==v[l][0]){x=S[c][v[l][0]];break}l++}for(;l<v.length;){if(void 0!==v[l][1]){m=D[c][v[l][1]];break}l++}for(l=B=0,M=v.length;M>B;l=++B)O=v[l],C={color:u.color,x:O[2]},void 0===O[1]?(C.yNew=m.y,C.xNew=m.x,C.deleted=!0):(C.yNew=D[c][O[1]].y,C.xNew=D[c][O[1]].x,m=D[c][O[1]],C.deleted=!1),w.length>0?void 0===O[0]?(C.yOld=x.y,C.xOld=x.x):(C.yOld=S[c][O[0]].y,C.xOld=S[c][O[0]].x,x=S[c][O[0]]):(C.xOld=C.xNew,C.yOld=C.yNew),u.value.push(C);A.push(u)}return g=n.isOrdinal()?n.scale().rangeBand()/2:0,P&&P.data(e),h=function(e,t){var r;return $?(r=e.selectAll(".wk-chart-marker").data(function(e){return e.value},function(e){return e.x}),r.enter().append("circle").attr("class","wk-chart-marker wk-chart-selectable").attr("r",5).style("pointer-events","none").style("opacity",0).style("fill",function(e){return e.color}),r.attr("cy",function(e){return e.yOld}).attr("cx",function(e){return e.xOld+g}).classed("wk-chart-deleted",function(e){return e.deleted}).transition().duration(t).attr("cy",function(e){return e.yNew}).attr("cx",function(e){return e.xNew+g}).style("opacity",function(e){return e.deleted?0:1}),r.exit().remove()):e.selectAll(".wk-chart-marker").transition().duration(t).style("opacity",0).remove()},f=function(e){return $?e.attr("cx",function(e){return n.scale()(e.x)}):void 0},p=d3.svg.line().x(function(e){return e.xOld}).y(function(e){return e.yOld}),y=d3.svg.line().x(function(e){return e.xNew}).y(function(e){return e.yNew}),d=d3.svg.line().x(function(e){return n.scale()(e.x)}).y(function(e){return e.yNew}),s=this.selectAll(".wk-chart-layer").data(A,function(e){return e.key}),o=s.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-line").attr("d",function(e){return y(e.value)}).style("opacity",k).style("pointer-events","none"),s.select(".wk-chart-line").attr("transform","translate("+g+")").attr("d",function(e){return p(e.value)}).transition().duration(t.duration).attr("d",function(e){return y(e.value)}).style("stroke",function(e){return e.color}).style("opacity",1).style("pointer-events","none"),s.exit().transition().duration(t.duration).style("opacity",0).remove(),s.call(h,t.duration),k=0,w=e,S=D},l=function(e,t){var r;return r=this.selectAll(".wk-chart-line"),e.isOrdinal()?r.attr("d",function(e){return d(e.value.slice(t[0],t[1]+1))}):r.attr("d",function(e){return d(e.value)}),h=this.selectAll(".wk-chart-marker").call(f)},u.lifeCycle().on("configure",function(){return O=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),P=u.behavior().tooltip,P.markerScale(O.x),P.on("enter."+x,y),P.on("moveData."+x,p),P.on("moveMarker."+x,v)}),u.lifeCycle().on("drawChart",c),u.lifeCycle().on("brushDraw",l),i.$observe("markers",function(e){return $=""===e||"true"===e?!0:!1,u.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("lineVertical",["$log","utils","tooltipUtils",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V;return s=o.me,d=[],A=[],k=[],S=[],D=[],C=[],h=void 0,g=void 0,c=0,P=void 0,V=void 0,x=void 0,$=!1,O={},y=0,b="lineVertical"+n++,p=function(){},v=function(e){return C=_.toArray(D),m.apply(this,[e])},m=function(e){var t,r;return t=e+c,r=C.map(function(e){return{name:e[t].key,value:O.x.formatValue(e[t].xv),color:{"background-color":e[t].color},yv:e[t].yv}}),this.headerName=O.y.axisLabel(),this.headerValue=O.y.formatValue(r[0].yv),this.layers=this.layers.concat(r)},w=function(e){var t,n;return n=e+c,x=this.selectAll(".wk-chart-marker-"+b).data(C,function(e){return e[n].key}),x.enter().append("g").attr("class","wk-chart-marker-"+b).call(r.createTooltipMarkers,n),x.selectAll("circle").attr("cx",function(e){return e[n].x}),x.exit().remove(),t=O.y.isOrdinal?O.y.scale().rangeBand()/2:0,this.attr("transform","translate(0,"+(O.y.scale()(C[0][n].yv)+t)+")")},f=function(e,t){var r;return $?(r=e.selectAll(".wk-chart-marker").data(function(e){return e.value},function(e){return e.y}),r.enter().append("circle").attr("class","wk-chart-marker wk-chart-selectable").attr("r",5).style("pointer-events","none").style("opacity",0).style("fill",function(e){return e.color}),r.attr("cy",function(e){return e.yOld+y}).attr("cx",function(e){return e.xOld}).classed("wk-chart-deleted",function(e){return e.deleted}).transition().duration(t).attr("cy",function(e){return e.yNew+y}).attr("cx",function(e){return e.xNew}).style("opacity",function(e){return e.deleted?0:1}),r.exit().remove()):e.selectAll(".wk-chart-marker").transition().duration(t).style("opacity",0).remove()},u=function(e,r,n,a,i){var o,l,c,u,s,d,p,v,m,w,x,b,C,O,V,B,N;for(v=a.isOrdinal()?t.mergeSeriesUnsorted(a.value(k),a.value(e)):t.mergeSeriesSorted(a.value(k),a.value(e)),V=n.layerKeys(e),A=[],D={},C=0,B=V.length;B>C;C++){for(c=V[C],D[c]=e.map(function(e){return{y:a.map(e),x:n.scale()(n.layerValue(e,c)),yv:a.value(e),xv:n.layerValue(e,c),key:c,color:i.scale()(c),data:e}}),u={key:c,color:i.scale()(c),value:[]},l=0;l<v.length;){if(void 0!==v[l][0]){w=S[c][v[l][0]];break}l++}for(;l<v.length;){if(void 0!==v[l][1]){m=D[c][v[l][1]];break}l++}for(l=O=0,N=v.length;N>O;l=++O)b=v[l],x={color:u.color,y:b[2]},void 0===b[1]?(x.yNew=m.y,x.xNew=m.x,x.deleted=!0):(x.yNew=D[c][b[1]].y,x.xNew=D[c][b[1]].x,m=D[c][b[1]],x.deleted=!1),k.length>0?void 0===b[0]?(x.yOld=w.y,x.xOld=w.x):(x.yOld=S[c][b[0]].y,x.xOld=S[c][b[0]].x,w=S[c][b[0]]):(x.xOld=x.xNew,x.yOld=x.yNew),u.value.push(x);A.push(u)}return y=a.isOrdinal()?a.scale().rangeBand()/2:0,g=function(e){return $?e.attr("cy",function(e){return a.scale()(e.y)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}):void 0},P&&P.data(e),p=d3.svg.line().x(function(e){return e.xOld}).y(function(e){return e.yOld}),d=d3.svg.line().x(function(e){return e.xNew}).y(function(e){return e.yNew}),h=d3.svg.line().x(function(e){return e.xNew}).y(function(e){return a.scale()(e.y)}),s=this.selectAll(".wk-chart-layer").data(A,function(e){return e.key}),o=s.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-line").style("stroke",function(e){return e.color}).style("opacity",0).style("pointer-events","none"),s.select(".wk-chart-line").attr("transform","translate(0,"+y+")").attr("d",function(e){return p(e.value)}).transition().duration(r.duration).attr("d",function(e){return d(e.value)}).style("opacity",1).style("pointer-events","none"),s.exit().transition().duration(r.duration).style("opacity",0).remove(),s.call(f,r.duration),k=e,S=D},l=function(e,t){var r;return r=this.selectAll(".wk-chart-line"),e.isOrdinal()?(c=t[0],r.attr("d",function(e){return h(e.value.slice(t[0],t[1]+1))}).attr("transform","translate(0,"+e.scale().rangeBand()/2+")")):r.attr("d",function(e){return h(e.value)}),f=this.selectAll(".wk-chart-marker").call(g)},s.lifeCycle().on("configure",function(){return O=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),P=s.behavior().tooltip,P.markerScale(O.y),P.on("enter."+b,v),P.on("moveData."+b,m),P.on("moveMarker."+b,w)}),s.lifeCycle().on("drawChart",u),s.lifeCycle().on("brushDraw",l),i.$observe("markers",function(e){return $=""===e||"true"===e?!0:!1,s.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("pie",["$log","utils",function(e,t){var r;return r=0,{restrict:"EA",require:"^layout",link:function(e,n,a,i){var o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C;return h=i.me,w="pie"+r++,s=void 0,f=void 0,d=void 0,g=void 0,y=void 0,k=[],b=void 0,C=void 0,A=!1,v=0,o=0,x=t.mergeData(),m=function(e){return this.headerName=k.color.axisLabel(),this.headerValue=k.size.axisLabel(),this.layers.push({name:k.color.formattedValue(e.data),value:k.size.formattedValue(e.data),color:{"background-color":k.color.map(e.data)}})},u=!0,l=function(e,t,r,n,a,i){var l,c,h,f,p,m,w,D,S;return o=t.duration,D=Math.min(t.width,t.height)/2,v=.06*D,g||(g=this.append("g").attr("class","wk-chart-pieBox")),g.attr("transform","translate("+t.width/2+","+t.height/2+")"),h=d3.svg.arc().outerRadius(D*(A?.8:.9)).innerRadius(0),c=d3.svg.arc().outerRadius(D*(A?.85:1)).innerRadius(D*(A?.8:.95)),m=d3.svg.arc().outerRadius(.9*D).innerRadius(.9*D),f=function(e){return k.color.value(e.data)},w=d3.layout.pie().sort(null).value(i.value),l=function(e){var t;return t=d3.interpolate(this._current,e),this._current=t(0),function(e){return h(t(e))}},S=w(e),x.key(f),x(S).first({startAngle:0,endAngle:0}).last({startAngle:2*Math.PI,endAngle:2*Math.PI}),s||(s=g.selectAll(".wk-chart-innerArc")),s=s.data(S,f),s.enter().append("path").each(function(e){return this._current=u?e:{startAngle:x.addedPred(e).endAngle,endAngle:x.addedPred(e).endAngle}}).attr("class","wk-chart-innerArc wk-chart-selectable").style("fill",function(e){return a.map(e.data)}).style("stroke",function(e){return a.map(e.data)}).style("opacity",u?0:1).call(C.tooltip).call(b),s.transition().duration(t.duration).style("opacity",1).attrTween("d",l),s.exit().datum(function(e){return{startAngle:x.deletedSucc(e).startAngle,endAngle:x.deletedSucc(e).startAngle}}).transition().duration(t.duration).attrTween("d",l).remove(),p=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},A?(d=g.selectAll(".wk-chart-data-label").data(S,f),d.enter().append("text").attr("class","wk-chart-data-label").each(function(e){return this._current=e}).attr("dy",".35em").style("font-size","1.3em").style("opacity",0).text(function(e){return i.formattedValue(e.data)}),d.transition().duration(t.duration).style("opacity",1).text(function(e){return i.formattedValue(e.data)}).attrTween("transform",function(e){var t,r;return r=this,t=d3.interpolate(r._current,e),function(e){var n,a;return n=t(e),r._current=n,a=m.centroid(n),a[0]+=15*(p(n)<Math.PI?1:-1),"translate("+a+")"}}).styleTween("text-anchor",function(e){var t;return t=d3.interpolate(this._current,e),function(e){var r;return r=t(e),p(r)<Math.PI?"start":"end"}}),d.exit().transition().duration(t.duration).style("opacity",0).remove(),y=g.selectAll(".wk-chart-polyline").data(S,f),y.enter().append("polyline").attr("class","wk-chart-polyline").style("opacity",0).style("pointer-events","none").each(function(e){return this._current=e}),y.transition().duration(t.duration).style("opacity",function(e){return 0===e.data.value?0:.5}).attrTween("points",function(e){var t,r;return this._current=this._current,t=d3.interpolate(this._current,e),r=this,function(e){var n,a;return n=t(e),r._current=n,a=m.centroid(n),a[0]+=10*(p(n)<Math.PI?1:-1),[h.centroid(n),m.centroid(n),a]}}),y.exit().transition().duration(t.duration).style("opacity",0).remove()):(g.selectAll(".wk-chart-polyline").remove(),g.selectAll(".wk-chart-data-label").remove()),u=!1},c=function(e){var t,r,n,a;return r=d3.select(this),r.classed("wk-chart-selected")?(t=(e.startAngle+e.endAngle)/2,n=Math.sin(t)*v,a=-Math.cos(t)*v,r.transition().duration(o).attr("transform","translate("+n+","+a+")")):r.transition().duration(o).attr("transform","translate(0,0)")},p=function(){return g.selectAll(".wk-chart-innerArc").each(c)},h.lifeCycle().on("configure",function(){return k=this.getScales(["size","color"]),k.color.scaleType("category20"),C=h.behavior().tooltip,b=h.behavior().selected,C.on("enter."+w,m)}),h.lifeCycle().on("drawChart",l),h.lifeCycle().on("objectsSelected",p),a.$observe("labels",function(e){return"false"===e?A=!1:("true"===e||""===e)&&(A=!0),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("rangeArea",["$log","utils","tooltipUtils",function(e,t,r){var n;return n=0,{restrict:"A",require:"layout",link:function(e,a,i,o){var l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$;return d=o.me,h=[],k=[],w=[],C=[],A=[],b=[],O=void 0,$=void 0,m=void 0,D={},S=!1,g=0,x="rangeArea"+n++,l=void 0,c=void 0,f=[],y=function(e){return b=A,p.apply(this,[e]),m=void 0,f=[{i:1,y:b[e].y0,color:b[e].color},{i:2,y:b[e].y1,color:b[e].color}]},p=function(e){var t,r;return t=b[e].data,r=[],r.push({name:D.rangeY.lowerProperty(),value:D.rangeY.formatValue(D.rangeY.lowerValue(t)),color:{"background-color":b[e].color}}),r.push({name:D.rangeY.upperProperty(),value:D.rangeY.formatValue(D.rangeY.upperValue(t)),color:{"background-color":b[e].color}}),this.headerName=D.x.axisLabel(),this.headerValue=D.x.formattedValue(t),this.layers=this.layers.concat(r)},v=function(e){return f[0].y=b[e].y0,f[1].y=b[e].y1,m||(m=this.selectAll(".wk-chart-marker-"+x)),m=m.data(f,function(e){return e.i}),m.enter().append("g").attr("class","wk-chart-marker-"+x).call(r.createTooltipMarkers),m.selectAll("circle").attr("cy",function(e){return e.y}),m.exit().remove(),this.attr("transform","translate("+(D.x.scale()(b[e].xv)+g)+")")},s=function(e,r,n,a,i,o,l,u,s){var d,h,f,y,p,v,m,x,b,D,S,$,P;for(v=t.mergeSeriesUnsorted(n.value(w),n.value(e)),k=[],A=[],A=e.map(function(e){return{x:n.map(e),y1:s.scale()(s.upperValue(e)),y0:s.scale()(s.lowerValue(e)),xv:n.value(e),yv1:s.upperValue(e),yv0:s.lowerValue(e),color:i.scale()(0),data:e}}),x=m=void 0,p={value:[],color:i.scale()(0)},y=0;y<v.length;){if(void 0!==v[y][0]){x=C[v[y][0]];break}y++}for(;y<v.length;){if(void 0!==v[y][1]){m=A[v[y][1]];break}y++}for(y=$=0,P=v.length;P>$;y=++$)S=v[y],D={x:S[2]},void 0===S[1]?(D.y0New=m.y0,D.y1New=m.y1,D.xNew=m.x,D.deleted=!0):(D.y0New=A[S[1]].y0,D.y1New=A[S[1]].y1,D.xNew=A[S[1]].x,m=A[S[1]],D.deleted=!1),w.length>0?void 0===S[0]?(D.y0Old=x.y0,D.y1Old=x.y1,D.xOld=x.x):(D.y0Old=C[S[0]].y0,D.y1Old=C[S[0]].y1,D.xOld=C[S[0]].x,x=C[S[0]]):(D.xOld=D.xNew,D.y0Old=D.y0New,D.y1Old=D.y1New),p.value.push(D);return g=n.isOrdinal()?n.scale().rangeBand()/2:0,O&&O.data(e),h=d3.svg.area().x(function(e){return e.xOld}).y0(function(e){return e.y0Old}).y1(function(e){return e.y1Old}),d=d3.svg.area().x(function(e){return e.xNew}).y0(function(e){return e.y0New}).y1(function(e){return e.y1New}),c=d3.svg.area().x(function(e){return n.scale()(e.x)}).y0(function(e){return e.y0New}).y1(function(e){return e.y1New}),b=this.selectAll(".wk-chart-area-path").data([p]),f=b.enter().append("path").attr("class","wk-chart-area-path").style("stroke",function(e){return e.color}).style("fill",function(e){return e.color}).style("opacity",0).style("pointer-events","none"),b.attr("transform","translate("+g+")").attr("d",function(e){return h(e.value)}).transition().duration(r.duration).attr("d",function(e){return d(e.value)}).style("opacity",.7).style("pointer-events","none"),b.exit().transition().duration(r.duration).style("opacity",0).remove(),w=e,C=A},u=function(e,t){var r;return r=this.select(".wk-chart-area-path"),e.isOrdinal()?r.attr("d",function(e){return c(e.value.slice(t[0],t[1]+1))}):r.attr("d",function(e){return c(e.value)})},d.lifeCycle().on("configure",function(){return D=this.getScales(["x","rangeY","color"]),this.layerScale("color"),this.getKind("rangeY").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),O=d.behavior().tooltip,O.markerScale(D.x),O.on("enter."+x,y),O.on("moveData."+x,p),O.on("moveMarker."+x,v)}),d.lifeCycle().on("drawChart",s),d.lifeCycle().on("brushDraw",u),i.$observe("markers",function(e){return S=""===e||"true"===e?!0:!1})}}}]),angular.module("wk.chart").directive("rangeBars",["$log","utils","barConfig","wkChartMargins",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var c,u,s,d,h,f,g,y,p,v,m,w,x,k;return g=l.me,v="rangebars"+a++,s=null,u=0,c=0,w={},x=void 0,m=t.mergeData(),m([]).key(function(e){return e.key}),y=!0,h=_.clone(r,!0),k=void 0,p=function(e){return this.headerName=w.y.axisLabel(),this.headerValue=w.y.formattedValue(e.data),this.layers.push({name:w.rangeX.lowerProperty(),value:w.rangeX.formatValue(w.rangeX.lowerValue(e.data)),color:{"background-color":w.color.map(e.data)}}),this.layers.push({name:w.rangeX.upperProperty(),value:w.rangeX.formatValue(w.rangeX.upperValue(e.data)),color:{"background-color":w.color.map(e.data)}})},f=function(e,t,r,a,i,o,l,d){var f,p,v,w;return s||(s=this.selectAll(".wk-chart-bars")),p=a.scale().rangeBand()/(1-h.padding)*h.padding,f=a.scale().rangeBand()/(1-h.outerPadding)*h.outerPadding,w=e.map(function(e){return{key:a.value(e),x:d.scale()(d.lowerValue(e)),width:Math.abs(d.scale()(d.upperValue(e))-d.scale()(d.lowerValue(e))),y:a.map(e),color:i.map(e),height:a.scale().rangeBand(a.value(e)),data:e}}),m(w).first({y:t.height+u/2-f}).last({y:0,height:c-u/2}),s=s.data(w,function(e){return e.key}),v=s.enter().append("g").attr("class","wk-chart-bar").attr("transform",function(e){return"translate(0, "+(y?e.y:m.addedPred(e).y-u/2)+") scale(1, "+(y?1:0)+")"}),v.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(e){return e.height}).style("opacity",y?0:1).call(k.tooltip).call(x),v.append("text").attr({"class":"wk-chart-data-label"}).attr("y",function(e){return e.height/2}).attr("x",function(e){return e.x+n.dataLabelPadding.hor}).attr({dy:"0.35em","text-anchor":"start"}).style({opacity:0}),s.transition().duration(t.duration).attr("transform",function(e){return"translate(0, "+e.y+") scale(1,1)"}),s.select("rect").style("fill",function(e){return e.color}).transition().duration(t.duration).attr("x",function(e){return e.x}).attr("height",function(e){return e.height}).attr("width",function(e){return e.width}).style("opacity",1),s.select("text").text(function(e){return d.formatValue(d.lowerValue(e.data))}).transition().duration(t.duration).attr("y",function(e){return e.height/2}).attr("x",function(e){return e.x+n.dataLabelPadding.hor}).style("opacity",g.showDataLabels()?1:0),s.exit().transition().duration(t.duration).attr("transform",function(e){return"translate(0,"+(m.deletedSucc(e).y+m.deletedSucc(e).height+p/2)+") scale(1,0)"}).attr("height",0).remove(),y=!1,u=p,c=f},d=function(e){return s.attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()}),s.selectAll("text").attr("y",e.scale().rangeBand()/2)},g.lifeCycle().on("configure",function(){return w=this.getScales(["rangeX","y","color"]),this.getKind("rangeX").domainCalc("extent").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(h).scaleType("ordinal"),k=g.behavior().tooltip,x=g.behavior().selected,k.on("enter."+v,p)}),g.lifeCycle().on("drawChart",f),g.lifeCycle().on("brushDraw",d),o.$observe("padding",function(e){var n;return"false"===e?(h.padding=0,h.outerPadding=0):"true"===e?h=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(h.padding=n[0]/100,h.outerPadding=n[0]/100),2===n.length&&(h.padding=n[0]/100,h.outerPadding=n[1]/100))),w.y.rangePadding(h),g.lifeCycle().update()}),o.$observe("labels",function(e){return"false"===e?g.showDataLabels(!1):("true"===e||""===e)&&g.showDataLabels("x"),g.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("rangeColumn",["$log","utils","barConfig","wkChartMargins",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var c,u,s,d,h,f,g,y,p,v,m,w,x,k;return g=l.me,v="rangeColumn"+a++,d=null,w={},x=void 0,m=t.mergeData(),m([]).key(function(e){return e.key}),y=!0,u=0,c=0,h=_.clone(r,!0),k=void 0,p=function(e){return this.headerName=w.x.axisLabel(),this.headerValue=w.x.formattedValue(e.data),this.layers.push({name:w.rangeY.upperProperty(),value:w.rangeY.formatValue(w.rangeY.upperValue(e.data)),color:{"background-color":w.color.map(e.data)}}),this.layers.push({name:w.rangeY.lowerProperty(),value:w.rangeY.formatValue(w.rangeY.lowerValue(e.data)),color:{"background-color":w.color.map(e.data)}})},f=function(e,t,r,a,i,o,l,s,f){var p,v,w,b;return d||(d=this.selectAll(".wk-chart-column")),v=r.scale().rangeBand()/(1-h.padding)*h.padding,p=r.scale().rangeBand()/(1-h.outerPadding)*h.outerPadding,b=e.map(function(e){return{data:e,key:r.value(e),x:r.map(e),y:f.scale()(f.lowerValue(e)),color:i.map(e),width:r.scale().rangeBand(r.value(e)),height:Math.abs(f.scale()(f.lowerValue(e))-f.scale()(f.upperValue(e)))}}),m(b).first({x:0,width:0}).last({x:t.width+v/2-c,width:p}),d=d.data(b,function(e){return e.key}),w=d.enter().append("g").attr("class","wk-chart-column").attr("transform",function(e,t){return"translate("+(y?e.x:m.addedPred(e).x+m.addedPred(e).width+(t?u/2:c))+","+(e.y-e.height)+") scale("+(y?1:0)+",1)"}),w.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(e){return e.height}).attr("width",function(e){return e.width}).style("fill",function(e){return e.color}).style("opacity",y?0:1).call(k.tooltip).call(x),w.append("text").attr("class","wk-chart-data-label").attr("x",function(e){return e.width/2}).attr("y",-n.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),d.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+", "+(e.y-e.height)+") scale(1,1)"}),d.select("rect").transition().duration(t.duration).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}).style("opacity",1),d.select("text").text(function(e){return f.formatValue(f.upperValue(e))}).transition().duration(t.duration).attr("x",function(e){return e.width/2}).style("opacity",g.showDataLabels()?1:0),d.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+(m.deletedSucc(e).x-v/2)+","+e.y+") scale(0,1)"}).remove(),y=!1,u=v,c=p},s=function(e){return d.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.key))>=0?r:-1e3)+", "+t.y+")"}).selectAll(".wk-chart-rect").attr("width",function(){return e.scale().rangeBand()}),d.selectAll("text").attr("x",e.scale().rangeBand()/2)},g.lifeCycle().on("configure",function(){return w=this.getScales(["x","rangeY","color"]),this.getKind("rangeY").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(h).scaleType("ordinal"),k=g.behavior().tooltip,x=g.behavior().selected,k.on("enter."+v,p)}),g.lifeCycle().on("drawChart",f),g.lifeCycle().on("brushDraw",s),o.$observe("padding",function(e){var n;return"false"===e?(h.padding=0,h.outerPadding=0):"true"===e?h=_.clone(r,!0):(n=t.parseList(e),n&&(1===n.length&&(h.padding=n[0]/100,h.outerPadding=n[0]/100),2===n.length&&(h.padding=n[0]/100,h.outerPadding=n[1]/100))),w.x.rangePadding(h),g.lifeCycle().update()}),o.$observe("labels",function(e){return"false"===e?g.showDataLabels(!1):("true"===e||""===e)&&g.showDataLabels("y"),g.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("scatter",["$log","utils",function(){var e;return e=0,{restrict:"A",require:"^layout",link:function(t,r,n,a){var i,o,l,c,u,s,d,h;return l=a.me,h=void 0,d=void 0,u="scatter"+e++,s=[],c=function(e){var t,r,n;n=[];for(t in s)r=s[t],n.push(this.layers.push({name:r.axisLabel(),value:r.formattedValue(e),color:"color"===t?{"background-color":r.map(e)}:void 0,path:"shape"===t?d3.svg.symbol().type(r.map(e)).size(80)():void 0,"class":"shape"===t?"wk-chart-tt-svg-shape":""}));return n},o=!0,i=function(e,t,r,n,a,i,l){var c,u;return c=function(e){return o&&e.style("fill",a.map).attr("transform",function(e){return"translate("+r.map(e)+","+n.map(e)+")"}).style("opacity",1),o=!1},u=this.selectAll(".wk-chart-points").data(e),u.enter().append("path").attr("class","wk-chart-points wk-chart-selectable").attr("transform",function(e){return"translate("+r.map(e)+","+n.map(e)+")"}).call(c).call(h.tooltip).call(d),u.transition().duration(t.duration).attr("d",d3.svg.symbol().type(function(e){return l.map(e)}).size(function(e){return i.map(e)*i.map(e)})).style("fill",a.map).attr("transform",function(e){return"translate("+r.map(e)+","+n.map(e)+")"}).style("opacity",1),u.exit().remove()},l.lifeCycle().on("configure",function(){return s=this.getScales(["x","y","color","size","shape"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),h=l.behavior().tooltip,d=l.behavior().selected,h.on("enter."+u,c)}),l.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("spider",["$log","utils",function(e){var t;return t=0,{restrict:"A",require:"layout",link:function(r,n,a,i){var o,l,c,u,s,d,h,f;return c=i.me,f=void 0,h={},d="spider"+t++,o=d3.svg.axis(),s=void 0,u=function(e){return this.layers=s.map(function(t){return{name:h.x.value(t),value:h.y.formatValue(t[e]),color:{"background-color":h.color.scale()(e)}}})},l=function(t,r,n,a,i){var l,c,u,d,h,g,y,p,v,m,w,x,k,b,A;return s=t,e.log(t),d=r.width/2,h=r.height/2,w=.8*d3.min([d,h]),x=20,m=t.length,l=2*Math.PI/m,p=360/m,c=this.select(".wk-chart-axis"),c.empty()&&(c=this.append("g").attr("class","wk-chart-axis")),A=a.scale().ticks(a.ticks()),a.scale().range([w,0]),o.scale(a.scale()).orient("right").tickValues(A).tickFormat(a.tickFormat()),c.call(o).attr("transform","translate("+d+","+(h-w)+")"),a.scale().range([0,w]),v=this.selectAll(".wk-chart-axis-line").data(t,function(e){return e.axis
}),v.enter().append("line").attr("class","wk-chart-axis-line").style("stroke","darkgrey"),v.attr({x1:0,y1:0,x2:0,y2:w}).attr("transform",function(e,t){return"translate("+d+", "+h+")rotate("+p*t+")"}),v.exit().remove(),k=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),b=this.selectAll(".wk-chart-tickPath").data(A),b.enter().append("path").attr("class","wk-chart-tickPath").style("fill","none").style("stroke","lightgrey"),b.attr("d",function(e){var r;return r=t.map(function(t,r){return{x:Math.sin(l*r)*a.scale()(e),y:Math.cos(l*r)*a.scale()(e)}}),k(r)+"Z"}).attr("transform","translate("+d+", "+h+")"),b.exit().remove(),u=this.selectAll(".wk-chart-axis-text").data(t,function(e){return n.value(e)}),u.enter().append("text").attr("class","wk-chart-axis-text").style("fill","black").attr("dy","0.8em").attr("text-anchor","middle"),u.attr({x:function(e,t){return d+Math.sin(l*t)*(w+x)},y:function(e,t){return h+Math.cos(l*t)*(w+x)}}).text(function(e){return n.value(e)}),y=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),g=this.selectAll(".wk-chart-data-line").data(a.layerKeys(t)),g.enter().append("path").attr("class","wk-chart-data-line").style({stroke:function(e){return i.scale()(e)},fill:function(e){return i.scale()(e)},"fill-opacity":.2,"stroke-width":2}).call(f.tooltip),g.attr("d",function(e){var r;return r=t.map(function(t,r){return{x:Math.sin(l*r)*a.scale()(t[e]),y:Math.cos(l*r)*a.scale()(t[e])}}),y(r)+"Z"}).attr("transform","translate("+d+", "+h+")")},c.lifeCycle().on("configure",function(){return h=this.getScales(["x","y","color"]),h.y.domainCalc("max"),h.x.resetOnNewData(!0).scaleType("ordinal"),f=c.behavior().tooltip,f.on("enter."+d,u)}),c.lifeCycle().on("drawChart",l)}}}]),angular.module("wk.chart").factory("behaviorBrush",["$log","$window","selectionSharing","timing",function(e,t,r,n){var a;return a=function(){var e,a,i,o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V,B,N,M,L,T,z,K,E,F,q,R,j,Y,X;return d=function(){},k=!1,F=void 0,E=void 0,R=void 0,K=void 0,b=void 0,L=void 0,z=void 0,C=void 0,A=void 0,D=void 0,T=void 0,q=void 0,V=void 0,Y=void 0,X=void 0,j=void 0,N=!1,B=!1,M=!1,O=void 0,$=void 0,S=[],P=d3.dispatch("brushStart","brush","brushEnd"),s=x=g=e=w=v=m=p=void 0,h=function(e,t,r,n){var a,i;return i=t-e,a=n-r,N&&(F.selectAll(".wk-chart-n").attr("transform","translate("+e+","+r+")").select("rect").attr("width",i),F.selectAll(".wk-chart-s").attr("transform","translate("+e+","+n+")").select("rect").attr("width",i),F.selectAll(".wk-chart-w").attr("transform","translate("+e+","+r+")").select("rect").attr("height",a),F.selectAll(".wk-chart-e").attr("transform","translate("+t+","+r+")").select("rect").attr("height",a),F.selectAll(".wk-chart-ne").attr("transform","translate("+t+","+r+")"),F.selectAll(".wk-chart-nw").attr("transform","translate("+e+","+r+")"),F.selectAll(".wk-chart-se").attr("transform","translate("+t+","+n+")"),F.selectAll(".wk-chart-sw").attr("transform","translate("+e+","+n+")"),E.attr("width",i).attr("height",a).attr("x",e).attr("y",r)),B&&(F.selectAll(".wk-chart-w").attr("transform","translate("+e+",0)").select("rect").attr("height",a),F.selectAll(".wk-chart-e").attr("transform","translate("+t+",0)").select("rect").attr("height",a),F.selectAll(".wk-chart-e").select("rect").attr("height",A.height),F.selectAll(".wk-chart-w").select("rect").attr("height",A.height),E.attr("width",i).attr("height",A.height).attr("x",e).attr("y",0)),M?(F.selectAll(".wk-chart-n").attr("transform","translate(0,"+r+")").select("rect").attr("width",i),F.selectAll(".wk-chart-s").attr("transform","translate(0,"+n+")").select("rect").attr("width",i),F.selectAll(".wk-chart-n").select("rect").attr("width",A.width),F.selectAll(".wk-chart-s").select("rect").attr("width",A.width),E.attr("width",A.width).attr("height",a).attr("x",0).attr("y",r)):void 0},u=function(){return d3.select(b).selectAll(".wk-chart-resize").style("display","none"),E.attr("width",0).attr("height",0).attr("x",0).attr("y",0).style("display","none")},c=function(){var e,t;return t=E.node().getBoundingClientRect(),q.each(function(){var e,r,n;return e=this.getBoundingClientRect(),r=t.left<e.right-e.width/3&&e.left+e.width/3<t.right,n=t.top<e.bottom-e.height/3&&e.top+e.height/3<t.bottom,d3.select(this).classed("wk-chart-selected",n&&r)}),e=T.selectAll(".wk-chart-selected").data(),T.classed("wk-chart-has-selected-items",e.length>0),e},y=function(e,t,n,a){var i,o,l,u,s,h;return B&&(u=d.x().invert(e),s=d.x().invert(t),(O[0]!==u||O[1]!==s)&&(O=[u,s],d.x().isOrdinal()?$=z.map(function(e){return d.x().value(e)}).slice(u,s+1):"rangeX"===d.x().kind()?d.x().upperProperty()?$=[d.x().lowerValue(z[u]),d.x().upperValue(z[s])]:(o=d.x().lowerValue(z[1])-d.x().lowerValue(z[0]),$=[d.x().lowerValue(z[u]),d.x().lowerValue(z[s])+o]):$=[d.x().value(z[O[0]]),d.x().value(z[s])],S=z.slice(u,s+1),P.brush(O,$,S),r.setSelection($,O,V))),M&&(l=d.y().invert(a),h=d.y().invert(n),(O[0]!==l||O[1]!==h)&&(O=[l,h],d.y().isOrdinal()?$=z.map(function(e){return d.y().value(e)}).slice(l,h+1):"rangeY"===d.y().kind()?(o=d.y().lowerValue(z[1])-d.y().lowerValue(z[0]),$=[d.y().lowerValue(z[l]),d.y().lowerValue(z[h])+o]):$=[d.y().value(z[l]),d.y().value(z[h])],S=z.slice(l,h+1),P.brush(O,$,S),r.setSelection($,O,V))),N&&(i=c(),_.xor(S,i).length>0)?(O=[],$=[],S=i,P.brush(O,$,S),r.setSelection($,O,V)):void 0},l=function(){return O=[],$=[],S=[],q.classed("wk-chart-selected",!1),T.classed("wk-chart-has-selected-items",!1),r.setSelection($,O,V),_.delay(function(){return P.brush(O,$,S),P.brushEnd(O,$,S)},20)},o=function(){return d3.event.preventDefault(),K=d3.select(d3.event.target).datum(),_(K?void 0:K={name:"forwarded"}),A=b.getBBox(),R=d3.mouse(b),w=x,v=s,m=g,p=e,d3.select(b).style("pointer-events","none").selectAll(".wk-chart-resize").style("display",null),E.style("display",null),d3.select("body").style("cursor",d3.select(d3.event.target).style("cursor")),d3.select(t).on("mousemove.brush",i).on("mouseup.brush",a),j.hide(!0),O=[void 0,void 0],S=[void 0],q=T.selectAll(".wk-chart-selectable"),P.brushStart(),n.clear(),n.init()},a=function(){return d3.select(t).on("mousemove.brush",null),d3.select(t).on("mouseup.brush",null),d3.select(b).style("pointer-events","all").selectAll(".wk-chart-resize").style("display",null),d3.select("body").style("cursor",null),j.hide(!1),P.brushEnd(O,$,S)},i=function(){var t,r,n,a,i,o,l,c,u;switch(o=d3.mouse(b),r=o[0]-R[0],n=o[1]-R[1],i=function(e){return o=v+e,s=o>=0?m>o?o:m:0,g=o<=A.width?m>o?m:o:A.width},l=function(e){return o=m+e,s=o>=0?v>o?o:v:0,g=o<=A.width?v>o?v:o:A.width},c=function(t){return o=w+t,x=o>=0?p>o?o:p:0,e=o<=A.height?o>p?o:p:A.height},t=function(t){return o=p+t,x=o>=0?w>o?o:w:0,e=o<=A.height?o>w?o:w:A.height},a=function(e){return v+e>=0?m+e<=A.width?(s=v+e,g=m+e):(g=A.width,s=A.width-(m-v)):(s=0,g=m-v)},u=function(t){return w+t>=0?p+t<=A.height?(x=w+t,e=p+t):(e=A.height,x=A.height-(p-w)):(x=0,e=p-w)},K.name){case"background":case"forwarded":r+R[0]>0?(s=0>r?R[0]+r:R[0],g=s+Math.abs(r)<A.width?s+Math.abs(r):A.width):s=0,n+R[1]>0?(x=0>n?R[1]+n:R[1],e=x+Math.abs(n)<A.height?x+Math.abs(n):A.height):x=0;break;case"extent":u(n),a(r);break;case"n":c(n);break;case"s":t(n);break;case"w":i(r);break;case"e":l(r);break;case"nw":c(n),i(r);break;case"ne":c(n),l(r);break;case"sw":t(n),i(r);break;case"se":t(n),l(r)}return h(s,g,x,e),y(s,g,x,e)},d.brush=function(e){if(0===arguments.length)return F;if(k)return F=e,N=d.x()&&d.y(),B=d.x()&&!d.y(),M=d.y()&&!d.x(),e.style({"pointer-events":"all",cursor:"crosshair"}),E=e.append("rect").attr({"class":"wk-chart-extent",x:0,y:0,width:0,height:0}).style("cursor","move").datum({name:"extent"}),(M||N)&&(e.append("g").attr("class","wk-chart-resize wk-chart-n").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"n"}),e.append("g").attr("class","wk-chart-resize wk-chart-s").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"s"})),(B||N)&&(e.append("g").attr("class","wk-chart-resize wk-chart-w").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"w"}),e.append("g").attr("class","wk-chart-resize wk-chart-e").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"e"})),N&&(e.append("g").attr("class","wk-chart-resize wk-chart-nw").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"nw"}),e.append("g").attr("class","wk-chart-resize wk-chart-ne").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"ne"}),e.append("g").attr("class","wk-chart-resize wk-chart-sw").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"sw"}),e.append("g").attr("class","wk-chart-resize wk-chart-se").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"se"})),e.on("mousedown.brush",o),d},f=function(){var t,r,n;return A?(r=b.getBBox(),t=A.width/r.width,n=A.height/r.height,x/=n,w/=n,e/=n,p/=n,s/=t,v/=t,g/=t,m/=t,R[0]=R[0]/t,R[1]=R[1]/n,A=r,h(s,g,x,e)):void 0},d.chart=function(e){return 0===arguments.length?L:(L=e,L.lifeCycle().on("resize.brush",f),d)},d.active=function(e){return 0===arguments.length?k:(k=e,d)},d.x=function(e){return 0===arguments.length?Y:(Y=e,d)},d.y=function(e){return 0===arguments.length?X:(X=e,d)},d.area=function(e){return 0===arguments.length?C:(C||(C=e,b=C.node(),d.brush(C)),d)},d.container=function(e){return 0===arguments.length?T:(T=e,q=T.selectAll(".wk-chart-selectable"),d)},d.data=function(e){return 0===arguments.length?z:(z=e,d)},d.brushGroup=function(e){return 0===arguments.length?V:(V=e,r.createGroup(V),d)},d.tooltip=function(e){return 0===arguments.length?j:(j=e,d)},d.on=function(e,t){return P.on(e,t)},d.extent=function(){return O},d.events=function(){return P},d.empty=function(){return 0===S.length},d.clearBrush=function(){return console.log("Brush cleared"),u(),l()},d}}]),angular.module("wk.chart").factory("behavior",["$log","$window","behaviorTooltip","behaviorBrush","behaviorSelect",function(e,t,r,n,a){var i;return i=function(){var e,t,i,o,l,c;return c=r(),o=n(),l=a(),o.tooltip(c),e=function(e){return o.area(e),c.area(e)},i=function(e){return o.container(e),l.container(e),c.container(e)},t=function(e){return o.chart(e),c.chart(e)},{tooltip:c,brush:o,selected:l,overlay:e,container:i,chart:t}}}]),angular.module("wk.chart").factory("behaviorSelect",["$log",function(e){var t,r;return r=0,t=function(){var t,n,a,i,o,l,c;return o="select"+r++,i=void 0,l=void 0,a=!1,c=d3.dispatch("selected"),t=function(){var e,t,r,n;if(a&&(t=d3.select(this),a))return t.classed("wk-chart-selectable")?(e=t.classed("wk-chart-selected"),t.classed("wk-chart-selected",!e),r=i.selectAll(".wk-chart-selected"),n=r.data().map(function(e){return e.data?e.data:e}),i.classed("wk-chart-has-selected-items",n.length>0),l.lifeCycle().objectsSelected(r),c.selected(n)):void 0},n=function(e){return 0===arguments.length?n:(e.on("click",t),n)},n.id=function(){return o},n.active=function(e){return 0===arguments.length?a:(a=e,n)},n.clearSelection=function(){return e.log("selection Cleared"),i.selectAll(".wk-chart-selected").classed("wk-chart-selected",!1),i.classed("wk-chart-has-selected-items",!1),_.delay(function(){return c.selected([]),l.lifeCycle().objectsSelected(i.selectAll(".wk-chart-selected"))},20)},n.container=function(e){return 0===arguments.length?i:(i=e,n)},n.layout=function(e){return 0===arguments.length?l:(l=e,n)},n.events=function(){return c},n.on=function(e,t){return c.on(e,t),n},n}}]),angular.module("wk.chart").factory("behaviorTooltip",["$log","$document","$rootScope","$compile","$templateCache","wkChartTemplates",function(e,t,r,n,a,i){var o;return o=function(){var e,r,o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V,B;return y=!1,S="",b=!1,$=void 0,A=void 0,C=void 0,v=void 0,m=void 0,p=void 0,x=void 0,O=void 0,D=void 0,k=void 0,B=d3.dispatch("enter","moveData","moveMarker","leave"),P=i.tooltipTemplate(),V=void 0,w=void 0,e=t.find("body"),r=e[0].getBoundingClientRect(),u=function(){},s=function(){var e,t,n;return n=w[0].getBoundingClientRect(),e=r.right-20>d3.event.clientX+n.width+10?d3.event.clientX+10:d3.event.clientX-n.width-10,t=r.bottom-20>d3.event.clientY+n.height+10?d3.event.clientY+10:d3.event.clientY-n.height-10,V.position={position:"absolute",left:e+"px",top:t+"px","z-index":1500,opacity:1},V.$apply()},d=function(){return V.position={position:"absolute",left:"0px",top:"0px","z-index":1500,opacity:0},V.$apply(),_.throttle(s,200)},h=function(){var t,r,n;if(y&&!b)return e.append(w),V.layers=[],$?(n=d3.mouse(this),t=D.invert(D.isHorizontal()?n[0]:n[1]),V.ttData=u.data()[t]):(t=d3.select(this).datum(),V.ttData=t.data?t.data:t),B.enter.apply(V,[t]),d(),$?(r=v.select(".wk-chart-background").node().getBBox(),n=d3.mouse(p),A=v.append("g").attr("class","wk-chart-tooltip-marker"),C=A.append("line"),C.attr(D.isHorizontal()?{"class":"wk-chart-marker-line",x0:0,x1:0,y0:0,y1:r.height}:{"class":"wk-chart-marker-line",x0:0,x1:r.width,y0:0,y1:0}),C.style({stroke:"darkgrey","pointer-events":"none"}),B.moveMarker.apply(A,[t])):void 0},g=function(){var e,t;if(y&&!b)return t=d3.mouse(p),s(),$&&(e=D.invert(D.isHorizontal()?t[0]:t[1]),B.moveMarker.apply(A,[e]),V.layers=[],V.ttData=u.data()[e],B.moveData.apply(V,[e])),V.$apply()},f=function(){return A&&A.remove(),A=void 0,w.remove()},c=function(){var e,t;return e=d3.select(x.node().parentElement).select(".wk-chart-overlay").node(),d3.event.target!==e?(t=new Event("mousedown"),t.pageX=d3.event.pageX,t.clientX=d3.event.clientX,t.pageY=d3.event.pageY,t.clientY=d3.event.clientY,e.dispatchEvent(t)):void 0},u.hide=function(e){return 0===arguments.length?b:(b=e,A&&A.style("visibility",b?"hidden":"visible"),V.ttShow=!b,V.$apply(),u)},u.chart=function(e){return 0===arguments.length?m:(m=e,u)},u.active=function(e){return 0===arguments.length?y:(y=e,u)},u.template=function(e){var t;return 0===arguments.length?S:(S=e,S.length>0&&(t=a.get(S),P='<div class="wk-chart-tooltip" ng-style="position">'+t+"</div>"),u)},u.area=function(e){return 0===arguments.length?v:(v=e,p=v.node(),$&&u.tooltip(v),u)},u.container=function(e){return 0===arguments.length?x:(x=e,u)},u.markerScale=function(e){return 0===arguments.length?D:(e?($=!0,D=e):$=!1,u)},u.data=function(e){return 0===arguments.length?k:(k=e,u)},u.on=function(e,t){return B.on(e,t)},l=function(e){return function(){return V.ttData?e(V.ttData):void 0}},o=function(){var e,t,r;if(!V){V=m.scope().$parent.$new(!0),V.properties={},V.map={},V.scale={},V.label={},V.value={},r=m.allScales().allKinds();for(e in r)t=r[e],V.map[e]=l(t.map),V.scale[e]=t.scale(),V.properties[e]=l(t.layerKeys),V.label[e]=t.axisLabel(),V.value[e]=l(t.value)}return w?void 0:w=n(P)(V)},u.tooltip=function(e){return 0===arguments.length?u:(o(P),u.chart().lifeCycle().on("destroy.tooltip",f),e.on("mouseenter.tooltip",h).on("mousemove.tooltip",g).on("mouseleave.tooltip",f),e.empty()||e.classed("wk-chart-overlay")?void 0:e.on("mousedown.tooltip",c))},u}}]),angular.module("wk.chart").factory("chart",["$log","scaleList","container","behavior","d3Animation",function(e,t,r,n,a){var i,o;return o=0,i=function(){var i,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A;return y="chart"+o++,c=function(){},p=[],f=void 0,u=void 0,m=void 0,g=void 0,x=!1,w=void 0,A="",b=void 0,k=void 0,d=n(),s=a.duration,v=d3.dispatch("configure","resize","prepareData","scaleDomains","rescaleDomains","sizeContainer","drawAxis","drawChart","newData","update","updateAttrs","scopeApply","destroy"),h=d3.dispatch("draw","change"),c.id=function(){return y},c.scope=function(e){return 0===arguments.length?w:(w=e,c)},c.showTooltip=function(e){return 0===arguments.length?x:(x=e,d.tooltip.active(x),c)},c.toolTipTemplate=function(e){return 0===arguments.length?A:(A=e,d.tooltip.template(e),c)},c.title=function(e){return 0===arguments.length?b:(b=e,c)},c.subTitle=function(e){return 0===arguments.length?k:(k=e,c)},c.addLayout=function(e){return 0===arguments.length?p:(p.push(e),c)},c.addScale=function(e,t){return u.add(e),t?t.scales().add(e):m.add(e),c},c.animationDuration=function(e){return 0===arguments.length?s:(s=e,c)},c.lifeCycle=function(){return v},c.layouts=function(){return p},c.scales=function(){return m},c.allScales=function(){return u},c.hasScale=function(e){return!!u.has(e)},c.container=function(){return f},c.brush=function(){return h},c.getData=function(){return g},c.behavior=function(){return d},l=function(t,r){return t?(e.log("executing full life cycle"),g=t,w.filteredData=t,w.scales=u,v.prepareData(t,r),v.scaleDomains(t,r),v.sizeContainer(t,r),v.drawAxis(r),v.drawChart(t,r),v.scopeApply()):void 0},i=_.debounce(l,100),c.execLifeCycleFull=i,c.resizeLifeCycle=function(t){return g?(e.log("executing resize life cycle"),v.sizeContainer(g,t),v.drawAxis(t),v.drawChart(g,t),v.scopeApply()):void 0},c.newDataLifeCycle=function(t,r){return t?(e.log("executing new data life cycle"),g=t,w.filteredData=t,v.prepareData(t,r),v.scaleDomains(t,r),v.drawAxis(r),v.drawChart(t,r)):void 0},c.attributeChange=function(t){return g?(e.log("executing attribute change life cycle"),v.sizeContainer(g,t),v.drawAxis(t),v.drawChart(g,t)):void 0},c.brushExtentChanged=function(){return g?(v.drawAxis(!0),v.drawChart(g,!0)):void 0},c.lifeCycle().on("newData.chart",c.execLifeCycleFull),c.lifeCycle().on("resize.chart",c.resizeLifeCycle),c.lifeCycle().on("update.chart",function(e){return c.execLifeCycleFull(g,e)}),c.lifeCycle().on("updateAttrs",c.attributeChange),c.lifeCycle().on("rescaleDomains",v.scaleDomains(g,!0)),d.chart(c),f=r().chart(c),u=t(),m=t(),c}}]),angular.module("wk.chart").factory("container",["$log","$window","wkChartMargins","scaleList","axisConfig","d3Animation","behavior",function(e,t,r){var n,a;return a=0,n=function(){var t,n,i,o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V,B;return c=function(){},g="cntnr"+a++,d=void 0,v=void 0,m=void 0,A=[],C=[],V=void 0,f=void 0,P=void 0,h=void 0,x=void 0,D=angular.copy(r["default"]),b=0,k=0,B=0,y=void 0,S=void 0,s=void 0,p=0,c.id=function(){return g},c.chart=function(e){return 0===arguments.length?d:(d=e,d.lifeCycle().on("sizeContainer."+c.id(),c.drawChartFrame),c)},c.element=function(t){var r,n;return 0===arguments.length?v:(n=function(){return c.chart().lifeCycle().resize(!0)},v=t,m=d3.select(v),m.empty()?e.error("Error: Element "+v+" does not exist"):(w(),r=m.select(".wk-chart").node(),new ResizeSensor(r,n)),c)},c.addLayout=function(e){return A.push(e),c},c.height=function(){return k},c.width=function(){return b},c.margins=function(){return D},c.getChartArea=function(){return h},c.getOverlay=function(){return S},c.getContainer=function(){return P},t=function(e,t,r,n,a){var i;return i=e.select("."+r),i.empty()&&(i=e.append("text").attr({"class":r,"text-anchor":"middle",y:a?a:0}).style("font-size",n)),i.text(t),i.node().getBBox().height},o=function(e,r){var n,a;return a=0,n=f.select(".wk-chart-title-area"),n.empty()&&(n=f.append("g").attr("class","wk-chart-title-area wk-center-hor")),e&&(B=t(n,e,"wk-chart-title","2em")),r&&t(n,r,"wk-chart-subtitle","1.8em",B),n.node().getBBox().height},u=function(e,t,r){var n,a,i,o,l;for(a=t.append("g"),o=0,l=e.length;l>o;o++)i=e[o],a.append("text").attr({"class":r}).text(i);return n=a.node().getBBox(),a.remove(),n},l=function(e){var t,r;return t=f.append("g"),e.range([0,500]),t.call(e.axis()),e.rotateTickLabels()&&t.selectAll("text").attr({dy:"0.35em"}).attr("transform","rotate("+e.rotateTickLabels()+", 0, "+("bottom"===e.axisOrient()?10:-10)+")").style("text-anchor","bottom"===e.axisOrient()?"end":"start"),r=t.node().getBBox(),t.remove(),r},n=function(e){var t;return t=f.select(".wk-chart-axis.wk-chart-"+e.axisOrient()),t.empty()&&(t=f.append("g").attr("class","wk-chart-axis wk-chart-"+e.axisOrient())),t.transition().duration(p).call(e.axis()),e.rotateTickLabels()?t.selectAll(".wk-chart-"+e.axisOrient()+".wk-chart-axis text").attr({dy:"0.35em"}).attr("transform","rotate("+e.rotateTickLabels()+", 0, "+("bottom"===e.axisOrient()?10:-10)+")").style("text-anchor","bottom"===e.axisOrient()?"end":"start"):t.selectAll(".wk-chart-"+e.axisOrient()+".wk-chart-axis text").attr("transform",null)},O=function(e){return f.select(".wk-chart-axis.wk-chart-"+e).remove()},$=function(e){return f.select(".wk-chart-label.wk-chart-"+e).remove()},i=function(e,t){var r,n,a,i,o;return r=t?0:p,a=e.kind(),o=e.isOrdinal()?e.scale().range():e.scale().ticks(),i=e.isOrdinal()?e.scale().rangeBand()/2:0,n=x.selectAll(".wk-chart-grid.wk-chart-"+a).data(o,function(e){return e}),n.enter().append("line").attr("class","wk-chart-grid wk-chart-"+a).style("pointer-events","none").style("opacity",0),"y"===a?n.transition().duration(r).attr({x1:0,x2:b,y1:function(t){return e.isOrdinal()?t+i:e.scale()(t)},y2:function(t){return e.isOrdinal()?t+i:e.scale()(t)}}).style("opacity",1):n.transition().duration(r).attr({y1:0,y2:k,x1:function(t){return e.isOrdinal()?t+i:e.scale()(t)},x2:function(t){return e.isOrdinal()?t+i:e.scale()(t)}}).style("opacity",1),n.exit().transition().duration(r).style("opacity",0).remove()},w=function(){return V=m.append("div").attr("class","wk-chart").append("svg").attr("class","wk-chart"),V.append("defs").append("clipPath").attr("id","wk-chart-clip-"+g).append("rect"),f=V.append("g").attr("class","wk-chart-container"),S=f.append("g").attr("class","wk-chart-overlay").style("pointer-events","all"),S.append("rect").style("visibility","hidden").attr("class","wk-chart-background").datum({name:"background"}),x=f.append("g").attr("class","wk-chart-grid-lines"),h=f.append("g").attr("class","wk-chart-area")},c.drawChartFrame=function(e,a){var s,y,v,w,x,C,N,M,L,T,z,_,K,E,F,q,R,j,Y,X,U,G,I,H,W,J,Q;for(v=m.node().getBoundingClientRect(),p=a?0:c.chart().animationDuration(),R=v.height,Q=v.width,K=o(d.title(),d.subTitle()),y={top:{height:0,width:0},bottom:{height:0,width:0},left:{height:0,width:0},right:{height:0,width:0}},T={top:0,bottom:0,left:0,right:0},x={width:0,height:0},j=0,U=A.length;U>j;j++){M=A[j],w=C=0,H=M.scales().allKinds();for(N in H)_=H[N],_.showAxis()&&(_.axis().scale(_.scale()).orient(_.axisOrient()),s=f.select(".wk-chart-axis.wk-chart-"+_.axisOrient()),y[_.axisOrient()]=l(_),L=f.select(".wk-chart-label.wk-chart-"+_.axisOrient()),_.showLabel()?(L.empty()&&(L=f.append("g").attr("class","wk-chart-label wk-chart-"+_.axisOrient())),T[_.axisOrient()]=t(L,_.axisLabel(),"wk-chart-label-text","1.5em")):L.remove()),_.axisOrientOld()&&_.axisOrientOld()!==_.axisOrient()&&(O(_.axisOrientOld()),$(_.axisOrientOld())),M.showDataLabels()===N&&(_.isHorizontal()?C=r.dataLabelPadding.hor+u(_.formattedValue(e),f,"wk-chart-data-label").width:w=r.dataLabelPadding.vert+u(_.formattedValue(e),f,"wk-chart-data-label").height)}for(F=K+y.top.height+T.top+y.bottom.height+T.bottom+D.top+D.bottom,q=y.right.width+T.right+y.left.width+T.left+D.left+D.right,k=R>F?R-F:0,b=Q>q?Q-q:0,Y=0,G=A.length;G>Y;Y++){M=A[Y],W=M.scales().allKinds();for(N in W)_=W[N],"x"===N||"rangeX"===N?_.range("x"===M.showDataLabels()?_.reverse()?[b-C,0]:[0,b-C]:_.reverse()?[b,0]:[0,b]):("y"===N||"rangeY"===N)&&_.range("y"===M.showDataLabels()?_.reverse()?[w,k]:[k,w]:_.reverse()?[0,k]:[k,0]),_.showAxis()&&n(_)}for(z=y.left.width+T.left+D.left,E=K+y.top.height+T.top+D.top,P=f.attr("transform","translate("+z+", "+E+")"),V.select("#wk-chart-clip-"+g+" rect").attr("width",b).attr("height",k),P.select(".wk-chart-overlay>.wk-chart-background").attr("width",b).attr("height",k),P.select(".wk-chart-area").style("clip-path","url(#wk-chart-clip-"+g+")"),f.selectAll(".wk-chart-axis.wk-chart-right").attr("transform","translate("+b+", 0)"),f.selectAll(".wk-chart-axis.wk-chart-bottom").attr("transform","translate(0, "+k+")"),f.select(".wk-chart-label.wk-chart-left").attr("transform","translate("+(-y.left.width-T.left/2)+", "+k/2+") rotate(-90)"),f.select(".wk-chart-label.wk-chart-right").attr("transform","translate("+(b+y.right.width+T.right/2)+", "+k/2+") rotate(90)"),f.select(".wk-chart-label.wk-chart-top").attr("transform","translate("+b/2+", "+(-y.top.height-T.top/2)+")"),f.select(".wk-chart-label.wk-chart-bottom").attr("transform","translate("+b/2+", "+(k+y.bottom.height+T.bottom)+")"),f.selectAll(".wk-chart-title-area").attr("transform","translate("+b/2+", "+(-E+B)+")"),X=0,I=A.length;I>X;X++){M=A[X],J=M.scales().allKinds();for(N in J)_=J[N],_.showAxis()&&_.showGrid()&&i(_)}return d.behavior().overlay(S),d.behavior().container(h)},c.drawSingleAxis=function(e){var t;return e.showAxis()&&(t=P.select(".wk-chart-axis.wk-chart-"+e.axis().orient()),t.call(e.axis()),e.showGrid()&&i(e,!0)),c},c}}]),angular.module("wk.chart").factory("layout",["$log","scale","scaleList","timing",function(e,t,r){var n,a;return a=0,n=function(){var e,t,n,i,o,l,c,u,s,d;return c="layout"+a++,o=void 0,l=void 0,i=void 0,s=r(),d=!1,u=d3.dispatch("configure","drawChart","prepareData","brush","redraw","drawAxis","update","updateAttrs","brushDraw","destroy","objectsSelected"),n=function(){},n.id=function(){return c},n.chart=function(e){return 0===arguments.length?i:(i=e,s.parentScales(e.scales()),i.lifeCycle().on("configure."+n.id(),function(){return u.configure.apply(n.scales())}),i.lifeCycle().on("drawChart."+n.id(),n.draw),i.lifeCycle().on("prepareData."+n.id(),n.prepareData),i.lifeCycle().on("destroy."+n.id(),function(){return u.destroy()}),n)},n.scales=function(){return s},n.scaleProperties=function(){return n.scales().getScaleProperties()},n.container=function(e){return 0===arguments.length?o:(o=e,n)},n.showDataLabels=function(e){return 0===arguments.length?d:(d=e,n)},n.behavior=function(){return n.chart().behavior()},n.prepareData=function(e){var t,r,n,a,i;for(t=[],i=["x","y","color","size","shape","rangeX","rangeY"],n=0,a=i.length;a>n;n++)r=i[n],t.push(s.getKind(r));return u.prepareData.apply(e,t)},n.lifeCycle=function(){return u},t=function(){var e,t;return e=o.getChartArea(),t=e.select("."+n.id()),t.empty()&&(t=e.append("g").attr("class",function(){return n.id()})),t},e=function(e,t){var r,a,i,l,c,u;for(i={height:o.height(),width:o.width(),margins:o.margins(),duration:t?0:n.chart().animationDuration()},r=[e,i],u=["x","y","color","size","shape","rangeX","rangeY"],l=0,c=u.length;c>l;l++)a=u[l],r.push(s.getKind(a));return r},n.draw=function(r,a){return l=r,u.drawChart.apply(t(),e(r,a)),u.on("redraw",n.redraw),u.on("update",n.chart().lifeCycle().update),u.on("drawAxis",n.chart().lifeCycle().drawAxis),u.on("updateAttrs",n.chart().lifeCycle().updateAttrs),u.on("brush",function(e,r,n){return o.drawSingleAxis(e),u.brushDraw.apply(t(),[e,n,o.width(),o.height()])})},n}}]),angular.module("wk.chart").factory("legend",["$log","$compile","$rootScope","$templateCache","wkChartTemplates",function(e,t,r,n,a){var i,o,l;return o=0,l=function(e){var t,r,n,a;for(r={},n=0,a=e.length;a>n;n++)t=e[n],r[t]=0;return Object.keys(r)},i=function(){var e,i,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b;return s="legend-"+o++,p="top-right",v=void 0,k=void 0,f=r.$new(!0),x=void 0,y=void 0,c=void 0,h=void 0,b=void 0,d=void 0,u=void 0,g=void 0,m=!1,w=!1,i={},i.position=function(e){return 0===arguments.length?p:(p=e,i)},i.show=function(e){return 0===arguments.length?m:(m=e,i)},i.showValues=function(e){return 0===arguments.length?w:(w=e,i)},i.div=function(e){return 0===arguments.length?h:(h=e,i)},i.layout=function(e){return 0===arguments.length?d:(d=e,i)},i.scale=function(e){return 0===arguments.length?v:(v=e,i)},i.title=function(e){return 0===arguments.length?b:(b=e,i)},i.template=function(e){return 0===arguments.length?k:(k=e,x=n.get(k),y=t(x)(f),i)},i.draw=function(e,t){var r,n,a,o,s,d,m,w,x;if(u=e,g=t,c=h||d3.select(i.scale().parent().container().element()).select(".wk-chart"),i.show()){if(c.select(".wk-chart-legend").empty()&&angular.element(c.node()).append(y),a=i.showValues()?l(v.value(e)):v.layerKeys(e),s=v.scale(),(null!=(w=i.layout())?w.scales().layerScale():void 0)&&(s=i.layout().scales().layerScale().scale()),f.legendRows=a.map("shape"!==v.kind()?function(e){return{value:e,color:{"background-color":s(e)}}}:function(e){return{value:e,path:d3.svg.symbol().type(s(e)).size(80)()}}),f.showLegend=!0,f.position={position:h?"relative":"absolute"},!h)for(n=c.node().getBoundingClientRect(),r=c.select(".wk-chart-overlay rect").node().getBoundingClientRect(),x=p.split("-"),d=0,m=x.length;m>d;d++)o=x[d],f.position[o]=""+Math.abs(n[o]-r[o])+"px";f.title=b}else y.remove();return i},y=t(a.legendTemplate())(f),e=function(){return f.$destroy()},i.register=function(t){return t.lifeCycle().on("drawChart."+s,i.draw),t.lifeCycle().on("destroy."+s,e),i},i.redraw=function(){return u&&g&&i.draw(u,g),i},i}}]);var __indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").factory("scale",["$log","legend","formatDefaults","wkChartScales","wkChartLocale",function(e,t,r,n,a){var i;return i=function(){var i,o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A,C,D,S,O,$,P,V,B,N,M,L,T,z,K,E,F,q,R,j,Y,X,U,G,I,H,W,J,Q;return k="",Y=d3.scale.linear(),X="linear",x=1,D=!1,m=void 0,w=void 0,p=void 0,q=!1,z="",P="",$=[],N="",Q="",K=void 0,F=.3,E=.3,A=void 0,b=function(e){return isNaN(+e)||_.isDate(e)?e:+e},U=!1,g=void 0,y=void 0,h=void 0,J=void 0,H=void 0,W=void 0,j=void 0,I=!1,f=void 0,G=!1,R=!1,C=!1,S=!1,O=void 0,T=void 0,v=void 0,V=void 0,B=t(),L=void 0,M=void 0,H=a.timeFormat.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!==e.getDate()}],["%b %d",function(e){return 1!==e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",function(){return!0}]]),s=function(){},o=function(e){return _.isArray(e)?_.reject(_.keys(e[0]),function(e){return"$$hashKey"===e}):_.reject(_.keys(e),function(e){return"$$hashKey"===e})},u=function(e,t){return t.reduce(function(t,r){return+t+ +s.layerValue(e,r)},0)},l=function(e,t){return d3.max(e,function(e){return d3.max(t,function(t){return s.layerValue(e,t)})})},c=function(e,t){return d3.min(e,function(e){return d3.min(t,function(t){return s.layerValue(e,t)})})},d=function(e){return b.parse?b.parse(e):b(e)},i={extent:function(e){var t;return t=s.layerKeys(e),[c(e,t),l(e,t)]},max:function(e){var t;return t=s.layerKeys(e),[0,l(e,t)]},min:function(e){var t;return t=s.layerKeys(e),[0,c(e,t)]},totalExtent:function(e){var t;return e[0].hasOwnProperty("total")?d3.extent(e.map(function(e){return e.total})):(t=s.layerKeys(e),d3.extent(e.map(function(e){return u(e,t)})))},total:function(e){var t;return e[0].hasOwnProperty("total")?[0,d3.max(e.map(function(e){return e.total}))]:(t=s.layerKeys(e),[0,d3.max(e.map(function(e){return u(e,t)}))])},rangeExtent:function(e){var t,r;return s.upperProperty()?[d3.min(s.lowerValue(e)),d3.max(s.upperValue(e))]:e.length>1?(t=s.lowerValue(e[0]),r=s.lowerValue(e[1])-t,[s.lowerValue(e[0]),t+r*e.length]):void 0},rangeMin:function(e){return[0,d3.min(s.lowerValue(e))]},rangeMax:function(e){var t,r;return s.upperProperty()?[0,d3.max(s.upperValue(e))]:(t=s.lowerValue(e[0]),r=s.lowerValue(e[1])-t,[0,t+r*e.length])}},s.id=function(){return O+"."+T.id()},s.kind=function(e){return 0===arguments.length?O:(O=e,s)},s.parent=function(e){return 0===arguments.length?T:(T=e,s)},s.chart=function(e){return 0===arguments.length?v:(v=e,s)},s.layout=function(e){return 0===arguments.length?V:(V=e,s)},s.scale=function(){return Y},s.legend=function(){return B},s.isOrdinal=function(){return D},s.isHorizontal=function(e){return 0===arguments.length?C:(C=e,e&&(S=!1),s)},s.isVertical=function(e){return 0===arguments.length?S:(S=e,e&&(C=!1),s)},s.scaleType=function(t){return 0===arguments.length?X:(d3.scale.hasOwnProperty(t)?(Y=d3.scale[t](),X=t,s.format(r.number)):"time"===t?(Y=d3.time.scale(),X="time",A&&s.dataFormat(A),s.format(r.date)):n.hasOwnProperty(t)?(X=t,Y=n[t]()):e.error("Error: illegal scale type:",t),D=_.has(Y,"rangeBand"),K&&s.range(K),U&&h.scale(Y),x&&"pow"===X&&Y.exponent(x),s)
},s.exponent=function(e){return 0===arguments.length?x:(x=e,"pow"===X&&Y.exponent(x),s)},s.scaleMapFn=function(e){return 0===arguments.length?Y.mapFn?Y.mapFn():void 0:(_.isFunction(e)&&Y.mapFn&&Y.mapFn(e),s)},s.domain=function(e){return 0===arguments.length?m:(m=e,_.isArray(m)&&Y.domain(m),s)},s.domainCalc=function(t){return 0===arguments.length?D?void 0:w:(i.hasOwnProperty(t)?w=t:e.error("illegal domain calculation rule:",t," expected",_.keys(i)),s)},s.getDomain=function(e){return 0===arguments.length?Y.domain():!m&&s.domainCalc()?p:m?m:s.value(e)},s.resetOnNewData=function(e){return 0===arguments.length?q:(q=e,s)},s.range=function(e){var t;return 0===arguments.length?Y.range():(K=e,!D||"x"!==(t=s.kind())&&"y"!==t&&"rangeX"!==t&&"rangeY"!==t?"category10"!==X&&"category20"!==X&&"category20b"!==X&&"category20c"!==X&&Y.range(e):Y.rangeBands(e,F,E),s)},s.rangePadding=function(e){return 0===arguments.length?{padding:F,outerPadding:E}:(F=e.padding,E=e.outerPadding,s)},s.property=function(e){return 0===arguments.length?z:(z=e,s)},s.layerProperty=function(e){return 0===arguments.length?P:(P=e,s)},s.layerExclude=function(e){return 0===arguments.length?$:($=e,s)},s.layerKeys=function(e){return z?_.isArray(z)?_.intersection(z,o(e)):[z]:_.reject(o(e),function(e){return __indexOf.call($,e)>=0})},s.lowerProperty=function(e){return 0===arguments.length?N:(N=e,s)},s.upperProperty=function(e){return 0===arguments.length?Q:(Q=e,s)},s.dataFormat=function(e){return 0===arguments.length?A:(A=e,b="time"===X?a.timeFormat(e):function(e){return e},s)},s.value=function(e){return P?_.isArray(e)?e.map(function(e){return d(e[z][P])}):d(e[z][P]):_.isArray(e)?e.map(function(e){return d(e[z])}):d(e[z])},s.layerValue=function(e,t){return d(P?e[t][P]:e[t])},s.lowerValue=function(e){return _.isArray(e)?e.map(function(e){return d(e[N])}):d(e[N])},s.upperValue=function(e){return _.isArray(e)?e.map(function(e){return d(e[Q])}):d(e[Q])},s.formattedValue=function(e){return _.isArray(e)?e.map(function(e){return s.formatValue(s.value(e))}):s.formatValue(s.value(e))},s.formatValue=function(e){return L&&e&&(e.getUTCDate||!isNaN(e))?M(e):e},s.map=function(e){return Array.isArray(e)?e.map(function(){return Y(s.value(e))}):Y(s.value(e))},s.invert=function(e){var t,r,n,a,i,o,l,c;return _.has(s.scale(),"invert")?(c=s.chart().getData(),"rangeX"===s.kind()||"rangeY"===s.kind()?(l=s.scale().invert(e),s.upperProperty()?t=d3.bisector(s.upperValue).left:(o=s.lowerValue(c[1])-s.lowerValue(c[0]),t=d3.bisector(function(e){return s.lowerValue(e)+o}).left)):(i=Y.range(),a=(i[1]-i[0])/c.length,l=s.scale().invert(e-a/2),t=d3.bisector(s.value).left),n=t(c,l),n=0>n?0:n>=c.length?c.length-1:n):_.has(s.scale(),"invertExtent")?s.scale().invertExtent(e):s.resetOnNewData()?(r=Y.domain(),i=Y.range(),S?(a=i[0]-i[1],n=i.length-Math.floor(e/a)-1,0>n&&(n=0)):(a=i[1]-i[0],n=Math.floor(e/a),n>=i.length&&(n=i.length-1)),n):void 0},s.invertOrdinal=function(e){var t;return s.isOrdinal()&&s.resetOnNewData()?(t=s.invert(e),Y.domain()[t]):void 0},s.showAxis=function(e){return 0===arguments.length?U:(U=e,e?(h=d3.svg.axis(),"time"===s.scaleType()&&h.tickFormat(H)):h=void 0,s)},s.axisOrient=function(e){return 0===arguments.length?g:(y=g,g=e,s)},s.axisOrientOld=function(e){return 0===arguments.length?y:(y=e,s)},s.axis=function(){return h},s.ticks=function(e){return 0===arguments.length?J:(J=e,s.axis()&&s.axis().ticks(J),s)},s.tickFormat=function(e){return 0===arguments.length?H:(H=e,s.axis()&&s.axis().tickFormat(e),s)},s.tickValues=function(e){return 0===arguments.length?W:(W=e,s.axis()&&s.axis().tickValues(e),s)},s.showLabel=function(e){return 0===arguments.length?I:(I=e,s)},s.axisLabel=function(e){return 0===arguments.length?f?f:s.property():(f=e,s)},s.rotateTickLabels=function(e){return 0===arguments.length?j:(j=e,s)},s.format=function(e){return 0===arguments.length?L:(L=e.length>0?e:"time"===s.scaleType()?r.date:r.number,M="time"===s.scaleType()?a.timeFormat(L):a.numberFormat(L),s)},s.showGrid=function(e){return 0===arguments.length?G:(G=e,s)},s.reverse=function(e){return 0===arguments.length?R:(R=e,s)},s.register=function(){return s.chart().lifeCycle().on("scaleDomains."+s.id(),function(e){var t;if(s.resetOnNewData()){if(t=s.getDomain(e),"linear"===X&&_.some(t,isNaN))throw"Scale "+s.kind()+", Type '"+X+"': cannot compute domain for property '"+z+"' . Possible reasons: property not set, data not compatible with defined type. Domain:"+t;return Y.domain(t)}}),s.chart().lifeCycle().on("prepareData."+s.id(),function(e){var t;return t=s.domainCalc(),s.parent().scaleProperties&&s.layerExclude(s.parent().scaleProperties()),t&&i[t]?p=i[t](e):void 0})},s.update=function(e){return s.parent().lifeCycle().update(e),s},s.updateAttrs=function(){return s.parent().lifeCycle().updateAttrs()},s.drawAxis=function(){return s.parent().lifeCycle().drawAxis(),s},s}}]),angular.module("wk.chart").factory("scaleList",["$log",function(e){var t;return t=function(){var t,r,n,a,i,o,l;return a={},r={},o={},i=void 0,l=[],n=void 0,t=function(){},t.owner=function(e){return 0===arguments.length?i:(i=e,t)},t.add=function(n){return a[n.id()]&&e.error("scaleList.add: scale "+n.id()+" already defined in scaleList of "+i.id()+". Duplicate scales are not allowed"),a[n.id()]=n,r[n.kind()]=n,t},t.hasScale=function(e){var r;return r=t.getKind(e.kind()),r.id()===e.id()},t.getKind=function(e){return r[e]?r[e]:o.getKind?o.getKind(e):void 0},t.hasKind=function(e){return!!t.getKind(e)},t.remove=function(r){return a[r.id()]?(delete a[r.id()],delete t[r.id],t):(e.warn("scaleList.delete: scale "+r.id()+" not defined in scaleList of "+i.id()+". Ignoring"),t)},t.parentScales=function(e){return 0===arguments.length?o:(o=e,t)},t.getOwned=function(){return a},t.allKinds=function(){var e,t,n,a;if(t={},o.allKinds){a=o.allKinds();for(e in a)n=a[e],t[e]=n}for(e in r)n=r[e],t[e]=n;return t},t.requiredScales=function(e){var r,n,a;if(0===arguments.length)return l;for(l=e,n=0,a=e.length;a>n;n++)if(r=e[n],!t.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";return t},t.getScales=function(e){var r,n,a,i;for(n={},a=0,i=e.length;i>a;a++){if(r=e[a],!t.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";n[r]=t.getKind(r)}return n},t.getScaleProperties=function(){var e,r,n,a,i;r=[],i=t.allKinds();for(e in i)a=i[e],n=a.property(),n&&(Array.isArray(n)?r.concat(n):r.push(n));return r},t.layerScale=function(e){return 0===arguments.length?n?t.getKind(n):void 0:(n=e,t)},t}}]),angular.module("wk.chart").provider("wkChartLocale",function(){var e,t;return e="en_US",t={de_DE:d3.locale({decimal:",",thousands:".",grouping:[3],currency:[""," "],dateTime:"%A, der %e. %B %Y, %X",date:"%e.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),en_US:d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},this.setLocale=function(r){if(_.has(t,r))return e=r;throw"unknowm locale '"+r+"' using 'en-US' instead"},this.addLocaleDefinition=function(e,r){return t[e]=d3.locale(r)},this.$get=["$log",function(){return t[e]}],this}),angular.module("wk.chart").provider("wkChartScales",function(){var e,t,r,n,a,i;return a=["red","orange","yellow","green","blue"],i=void 0,n=function(){var e,t,r;return e=d3.scale.ordinal(),r=function(t){var r,n,a,i,o,l;for(r=0,a=e.range().length-1,l=[],n=i=0,o=t.length;o>=0?o>=i:i>=o;n=o>=0?++i:--i)l.push(r=(31*r+t.charAt(n))%a);return l},t=function(n){return arguments?e(r(n)):t},t.range=function(t){return arguments?(e.domain(d3.range(t.length)),e.range(t)):e.range()},t.domain=e.domain,t.rangePoint=e.rangePoints,t.rangeBands=e.rangeBands,t.rangeRoundBands=e.rangeRoundBands,t.rangeBand=e.rangeBand,t.rangeExtent=e.rangeExtent,t.hash=function(e){return arguments?(r=e,t):r},t},r=function(){var e,t,r;return e=d3.scale.ordinal(),t=i||e,r=function(e){return arguments?t.apply(r,[e]):r},r.mapFn=function(e){return arguments?(_.isFunction(e)&&(t=e),r):t},r.domain=e.domain,r.range=e.range,r.rangePoint=e.rangePoints,r.rangeBands=e.rangeBands,r.rangeRoundBands=e.rangeRoundBands,r.rangeBand=e.rangeBand,r.rangeExtent=e.rangeExtent,r},e=function(){return d3.scale.ordinal().range(a)},t=function(){return n().range(a)},this.colors=function(e){return a=e},this.customMapFn=function(e){var t;return _.isFunction(e)?t=e:void 0},this.$get=["$log",function(){return{hashed:n,customCategory:e,customCategoryHashed:t,customScale:r}}],this}),angular.module("wk.chart").provider("wkChartTemplates",function(){var e,t;return t="templates/toolTip.html",e="templates/legend.html",this.setTooltipTemplate=function(e){return t=e},this.setLegendTemplate=function(t){return e=t},this.$get=["$log","$templateCache",function(r,n){return{tooltipTemplate:function(){return n.get(t)},legendTemplate:function(){return n.get(e)}}}],this}),angular.module("wk.chart").service("selectionSharing",["$log",function(){var e,t,r;return t={},r={},e={},this.createGroup=function(){},this.setSelection=function(n,a,i){var o,l,c,u,s;if(i&&(t[i]=n,r[i]=a,e[i])){for(u=e[i],s=[],l=0,c=u.length;c>l;l++)o=u[l],s.push(o(n,a));return s}},this.getSelection=function(e){var t;return t=e||"default",selection[t]},this.register=function(t,r){return t&&(e[t]||(e[t]=[]),!_.contains(e[t],r))?e[t].push(r):void 0},this.unregister=function(t,r){var n;return e[t]&&(n=e[t].indexOf(r),n>=0)?e[t].splice(n,1):void 0},this}]),angular.module("wk.chart").service("timing",["$log",function(e){var t,r,n;return n={},r=0,t=0,this.init=function(){return r=Date.now()},this.start=function(e){var t;return t=n[e],t||(t=n[e]={name:e,start:0,total:0,callCnt:0,active:!1}),t.start=Date.now(),t.active=!0},this.stop=function(e){var a;return(a=n[e])&&(a.active=!1,a.total+=Date.now()-a.start,a.callCnt+=1),t=Date.now()-r},this.report=function(){var r,a;for(r in n)a=n[r],a.avg=a.total/a.callCnt;return e.info(n),e.info("Elapsed Time (ms)",t),n},this.clear=function(){return n={}},this}]),angular.module("wk.chart").factory("layeredData",["$log",function(){var e;return e=function(){var e,t,r,n,a,i,o,l,c;return r=[],n=[],c=void 0,t=!1,i=1/0,a=-1/0,l=1/0,o=-1/0,e=function(){},e.data=function(t){return arguments.length(Is(0))?r:(r=t,e)},e.layerKeys=function(t){return 0===arguments.length?n:(n=t,e)},e.x=function(t){return 0===arguments.length?c:(c=t,e)},e.calcTotal=function(r){return 0===arguments.length?t:(t=r,e)},e.min=function(){return i},e.max=function(){return a},e.minTotal=function(){return l},e.maxTotal=function(){return o},e.extent=function(){return[e.min(),e.max()]},e.totalExtent=function(){return[e.minTotal(),e.maxTotal()]},e.columns=function(r){var u,s,d,h,f,g,y,p,v,m,w,x,k,b;if(1===arguments.length){for(f=[],i=1/0,a=-1/0,l=1/0,o=-1/0,s=v=0,x=n.length;x>v;s=++v)d=n[s],f[s]={key:d,value:[],min:1/0,max:-1/0};for(s=m=0,k=r.length;k>m;s=++m){for(u=r[s],g=0,p="string"==typeof c?u[c]:c(u),w=0,b=f.length;b>w;w++)h=f[w],y=+u[h.key],h.value.push({x:p,value:y,key:h.key}),h.max<y&&(h.max=y),h.min>y&&(h.min=y),y>a&&(a=y),i>y&&(i=y),t&&(g+=+y);t&&(g>o&&(o=g),l>g&&(l=g))}return{min:i,max:a,totalMin:l,totalMax:o,data:f}}return e},e.rows=function(t){return 1===arguments.length?t.map(function(e){return{x:e[c],layers:layerKeys.map(function(t){return{key:t,value:e[t],x:e[c]}})}}):e},e}}]),angular.module("wk.chart").directive("svgIcon",["$log",function(){return{restrict:"E",template:'<svg ng-style="style"><path></path></svg>',scope:{path:"=",width:"@"},link:function(e,t){return e.style={height:"20px",width:e.width+"px","vertical-align":"middle"},e.$watch("path",function(e){return e?d3.select(t[0]).select("path").attr("d",e).attr("transform","translate(8,8)"):void 0})}}}]),angular.module("wk.chart").service("tooltipUtils",["$log",function(){return this.createTooltipMarkers=function(e,t){var r;return r=2===arguments.length,e.append("circle").attr("class","wk-chart-tt-marker").attr("r",9).style("fill",function(e){return r?e[t].color:e.color}).style("fill-opacity",.3).style("stroke",function(e){return r?e[t].color:e.color}).style("pointer-events","none"),e.append("circle").attr("class","wk-chart-tt-marker").attr("r",4).style("fill",function(e){return r?e[t].color:e.color}).style("fill-opacity",.6).style("stroke","white").style("pointer-events","none")},this}]),angular.module("wk.chart").service("utils",["$log",function(){var e;return this.diff=function(e,t,r){var n,a,i,o;for(i=function(e){return t.indexOf(e)<0},o={},n=0;n<e.length;){if(i(e[n]))for(o[e[n]]=void 0,a=n+r;a>=0&&a<e.length;){if(!i(e[a])){o[e[n]]=e[a];break}a+=r}n++}return o},e=0,this.getId=function(){return"Chart"+e++},this.parseList=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),1===t.length?t[0]:t):void 0},this.parseTrueFalse=function(e){return""===e||"true"===e?!0:"false"===e?!1:void 0},this.mergeData=function(){var e,t,r,n,a,i,o,l,c,u,s;return u=[],r=[],s={},a={},c=[],t=[],n=void 0,o=void 0,i=function(e){return e},l=function(e){return e},e=function(n){var o,l,d,h,f,g,y,p;for(u=[],s={},l=f=0,y=r.length;y>f;l=++f)o=r[l],u[l]=o,s[i(o)]=l;for(c=[],t=[],a={},r=n,d=g=0,p=r.length;p>g;d=++g)o=r[d],h=i(o),a[h]=d,s.hasOwnProperty(h)&&(c[s[h]]=!0,t[d]=!0);return e},e.key=function(t){return arguments?(i=t,e):i},e.first=function(t){return arguments?(n=t,e):n},e.last=function(t){return arguments?(o=t,e):o},e.added=function(){var e,n,a,i,o;for(a=[],n=i=0,o=r.length;o>i;n=++i)e=r[n],t[n]||a.push(_d);return a},e.deleted=function(){var e,t,r,n,a;for(r=[],e=n=0,a=u.length;a>n;e=++n)t=u[e],c[e]||r.push(u[e]);return r},e.current=function(e){return r[a[e]]},e.prev=function(e){return u[s[e]]},e.addedPred=function(e){var o;for(o=a[i(e)];!t[o];)if(o--<0)return n;return u[s[i(r[o])]]},e.addedPred.left=function(t){return e.addedPred(t).x},e.addedPred.right=function(t){var r;return r=e.addedPred(t),_.has(r,"width")?r.x+r.width:r.x},e.deletedSucc=function(e){var t;for(t=s[i(e)];!c[t];)if(t++>=u.length)return o;return r[a[i(u[t])]]},e},this.mergeSeriesSorted=function(e,t){var r,n,a,i,o,l;for(n=0,r=0,o=e.length-1,i=t.length-1,a=Math.max(o,i),l=[];o>=n&&i>=r;)+e[n]===+t[r]?(l.push([n,Math.min(r,i),e[n]]),n++,r++):+e[n]<+t[r]?(l.push([n,void 0,e[n]]),n++):(l.push([void 0,Math.min(r,i),t[r]]),r++);for(;o>=n;)l.push([n,void 0,e[n]]),n++;for(;i>=r;)l.push([void 0,Math.min(r,i),t[r]]),r++;return l},this.mergeSeriesUnsorted=function(e,t){var r,n,a,i,o,l;for(n=0,r=0,o=e.length-1,i=t.length-1,a=Math.max(o,i),l=[];o>=n&&i>=r;)e[n]===t[r]?(l.push([n,Math.min(r,i),e[n]]),n++,r++):t.indexOf(e[n])<0?(l.push([n,void 0,e[n]]),n++):(l.push([void 0,Math.min(r,i),t[r]]),r++);for(;o>=n;)l.push([n,void 0,e[n]]),n++;for(;i>=r;)l.push([void 0,Math.min(r,i),t[r]]),r++;return l},this}]),angular.module("wk.chart").directive("chartGenerator",["$log","chartFactory","modelTypes",function(e,t){return{restrict:"E",scope:{markup:"=",properties:"=",error:"&",warning:"&"},link:function(e,r,n){return n.properties&&(e.properties=t.create()),e.$watch("properties",function(){if(t.verify()){if(n.markup&&(e.markup=t.generateMarkup(e.properties)),n.warning&&t.hasWarnings)return e.warning({warnings:t.warnings})}else if(n.error)return e.error({errors:t.errors})},!0)}}}]),angular.module("wk.chart").service("chartFactory",["$log","modelTypes","dimensionFactory","layoutFactory","modelUtils",function(e,t,r,n,a){var i;return i=function(e){return function(e){var i,o;return o={},o.dimensions={},o.layouts=[],i={},a.addProperties(e.properties,o,i),a.addDecorators(e.decorators,o,i),a.addGetter(i,o,"dimensions"),a.addGetter(i,o,"layouts"),i.availableDimensions=function(){return _.keys(t.dimension)},i.addDimension=function(e){return o.dimensions[e]=r.create(e),o.dimensions[e]},i.removeDimension=function(e){return void delete o.dimensions[e]},i.availableLayouts=function(){return _.keys(t.layouts)},i.addLayout=function(e){var t;return t=n.create(e),o.layouts.push(t),t},i.removeLayout=function(e){var t;return t=o.layouts.indexOf(e),void(t>=0&&o.layouts.splice(t,1))},i.getDescriptor=function(){return e},i}(e)},this.create=function(){return i(t.chart)},this.verify=function(){return!0},this.generateMarkup=function(e){var t,i;return t=e.getDescriptor(),i="<"+t.name,i+=a.generateProperties(t.properties,e),i+=a.generateDecorators(t.decorators,e),i+=">",i+=r.generateMarkup(e.dimensions),i+=n.generateMarkup(e.layouts),i+="\n</"+t.name+">"},this.hasErrors=!1,this.errors=[],this.hasWarnings=!1,this.warnings=[],this}]),angular.module("wk.chart").service("dimensionFactory",["$log","modelUtils","modelTypes",function(e,t,r){var n,a;return a=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r].value},set:function(e){return t[r].value=e}})},n=function(e){return function(e){var r,n;return n={},r={},t.addProperties(e.properties,n,r),t.addDecorators(e.decorators,n,r),r.getDescriptor=function(){return e},r}(e)},this.create=function(e){return _.has(r.dimension,e)?n(r.dimension[e]):void 0},this.getTypes=function(){return _.keys(dimension)},this.verifyType=function(e){return _.has(dimension,e)},this.generateMarkup=function(e){var r,n,a,i;a="";for(i in e)n=e[i],r=n.getDescriptor(),a+="\n		<"+r.name,a+=t.generateProperties(r.properties,n),a+=t.generateDecorators(r.decorators,n),a+=" />";return a},this}]),angular.module("wk.chart").service("layoutFactory",["$log","dimensionFactory","modelTypes","modelUtils",function(e,t,r,n){var a,i,o;return o=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r].value},set:function(e){return t[r].value=e}})},i=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r]}})},a=function(e){return function(e){var r,a,i,o,l;o={},o.dimensions={},o.layout=e.name,a={},n.addProperties(e.properties,o,a),n.addDecorators(e.decorators,o,a),l=e.dimensions;for(i in l)r=l[i],o.dimensions[i]=t.create(i);return n.addGetter(a,o,"dimensions"),n.addGetter(a,o,"layout"),a.addDimension=function(e){return o.dimensions[e]=t.create(e),o.dimensions[e]},a.removeDimension=function(e){return void delete o.dimensions[e]},a.getDescriptor=function(){return e},a}(e)},this.create=function(e){return _.has(r.layouts,e)?a(r.layouts[e]):void 0},this.getTypes=function(){return _.keys(layouts)},this.verifyType=function(e){return _.has(layouts,e)},this.generateMarkup=function(e){var r,a,i,o,l;for(i="",o=0,l=e.length;l>o;o++)a=e[o],r=a.getDescriptor(),i+="\n	<layout "+r.name,r.value&&a[r.name]&&(i+='="'+r.value+'"'),i+=n.generateProperties(r.properties,a),i+=n.generateDecorators(r.decorators,a),i+=">",i+=t.generateMarkup(a.dimensions),i+="\n	</layout>";return i},this}]);var __indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").service("modelUtils",["$log","$templateCache","modelTypes",function(e,t,r){return this.stringList=function(e){return/(\[(.*)\])|(.*)/g.test(e)},this.string=function(e){return _.isString(e)},this.number=function(e){return _.isNumber(e)},this.trueFalse=function(e){return _.isBoolean(e)},this.templateUrl=function(e){return!_.isEmpty(t.get(e))},this.listVerifier=function(){return function(e){return __indexOf.call(this.values,e)>=0}},this.attributeGenerator=function(e,t){return t?""+e+'="'+t+'"':e},this.attributeListGenerator=function(e){var t,r,n;r="";for(t in e)n=e[t],"object"!==n.type&&(_.has(n,"generator")?r+=" "+n.generator(n):n.value&&(r+=" "+this.attributeGenerator(t,n.value)));return r},this.addProperty=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r].value},set:function(e){return t[r].value=e},enumerable:!0})},this.addGetter=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r]},enumerable:!0})},this.addProperties=function(e,t,n){var a,i;for(i in e)a=e[i],_.has(n,i)||(t[i]={},this.addProperty(n,t,i),_.isString(a)?t[i].validator=r.getValidator(a):(_.has(a,"validator")&&(t[i].validator=a.validator),"enum"===a.type&&(t[i]["enum"]=a.values,t[i].validator=r.getValidator(a))));return n.validate=function(e,r){return t[e].validator.apply(t[e],[r])},n.acceptedValues=function(e){return t[e]["enum"]}},this.addDecorator=function(e,t,n){return t[e.name]={},t[e.name+"$set"]={},this.addProperty(n,t,e.name+"$set"),_.has(e,"value")&&(this.addProperty(n,t,e.name),_.isString(e.value)&&(t[e.name].validator=r.getValidator(e.value)),_.has(e,"validator")&&(t[e.name].validator=e.value.validator),"enum"===e.value.type&&(t[e.name]["enum"]=e.value.values,t[e.name].validator=r.getValidator(e.value))),this.addProperties(e.properties,t,n)},this.addDecorators=function(e,t,r){var n,a,i,o;if(e){for(o=[],a=0,i=e.length;i>a;a++)n=e[a],o.push(this.addDecorator(n,t,r));return o}},this.generateProperties=function(e,t){var r,n,a;r="";for(n in e)a=e[n],t[n]&&(r+=_.has(e[n],"generator")?e[n].generator(t[n]):" "+n+'="'+t[n]+'"');return r},this.generateDecorators=function(e,t){var r,n,a,i;if(n="",e){for(a=0,i=e.length;i>a;a++)r=e[a],t[r.name+"$set"]&&(n+=_.has(r,"generator")?r.generator(t[r.name]):t[r.name]?" "+r.name+'="'+t[r.name]+'"':" "+r.name,n+=this.generateProperties(r.properties,t));return n}return""},this}]);var __indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").service("modelTypes",["$log","wkChartScales",function(e,t){var r,n,a,i,o,l,c,u,s,d,h,f,g,y,p,v,m,w,x,k,b,A;return h=function(e,t,r,a,i,o){var l,c,u,s,d;for(u={name:e,clazz:"layout",value:r,layerDimension:a,properties:n(i),decorators:o,dimensions:{}},c=t.trim().split(","),s=0,d=c.length;d>s;s++)l=c[s],u.dimensions[l.trim()]={};return u},c=function(e,t,r){return{clazz:"dimension",name:e,properties:n(t),decorators:r}},s=function(){return _.keys(d3.scale).concat("time").concat(_.keys(t))},n=function(e){var t;return t={},_.assign.apply(this,[].concat(e))},w={string:"string",number:"number",bool:"boolean",list:"list","enum":function(e){return{type:"enum",values:e}},object:"scope variable",event:"scope event",callback:"callback",objArray:"scope variable"},this.getValidator=function(e){switch(e){case w.string:return _.isString;case w.number:return _.isNumber;case w.bool:return _.isBoolean;case w.list:return function(e){return/^\[(.*)\]$|^[^\[](?=[^\]\[]*$)/.test(e)};default:return _.isObject(e)&&"enum"===e.type?function(e){return __indexOf.call(this["enum"],e)>=0}:function(){return!0}}},g={markers:w.bool},d={labels:w.bool},p={padding:w.number},y={outerPadding:w.number},r=w["enum"](["zero","silhouette","expand","wiggle"]),u={geojson:w.object},v={projection:w.object},m={property:w.list},x={lowerProperty:w.string,upperProperty:w.string},i={type:w["enum"](s()),domain:w.list,reset:w.bool,range:w.list,domainRange:w["enum"](["min","max","extent","total"]),label:w.string,exponent:w.number,reverse:w.bool},b={name:"tooltips",clazz:"decorator",key:"tooltips$set",show:w.bool,value:w.bool,properties:{tooltipsTemplate:w.string}},a={name:"axis",clazz:"decorator",key:"axis$set",show:w.bool,value:w["enum"](["top","bottom","left","right"]),properties:{grid:w.bool,format:w.string,showLabel:w.bool,ticks:w.number,tickFormat:w.string,axisFormatter:w.object}},f={name:"legend",clazz:"decorator",key:"legend$set",show:w.bool,value:w["enum"](["top-left","top-right","bottom-left","bottom-right"]),properties:{templateUrl:w.string}},A={name:"valuesLegend",clazz:"decorator",key:"valuesLegend$set",show:w.bool,value:w["enum"](["top-left","top-right","bottom-left","bottom-right"]),properties:{templateUrl:w.string}},k={name:"selection",clazz:"decorator",key:"selection$set",show:w.bool,properties:{selectedDomain:w.object,clearSelection:w.callback,selectedDomainChange:w.event}},o={name:"brush",key:"brush$set",clazz:"decorator",show:w.bool,value:w.string,properties:{selectedDomain:w.object,selectedValues:w.object,brushExtent:w.object,selectedDomainChange:w.event,brushStart:w.event,brushEnd:w.event,clearBrush:w.callback}},l={name:"brushed",clazz:"decorator",key:"brushed$set",show:w.bool,value:w.string},this.chart={name:"chart",clazz:"chart",properties:{data:w.objArray,title:w.string,subtitle:w.string,deepWatch:w.bool,filter:w.string},decorators:[b],dimensions:{},layouts:[]},this.layouts={line:h("line","x,y,color",!1,"y",[g]),lineVertical:h("line-vertical","x,y,color",!1,"x",[g]),area:h("area","x,y,color",!1,"x"),areaVertical:h("area-vertical","x,y,color",!1,"y"),areaStacked:h("area-stacked","x,y,color",r,"y"),areaStackedVertical:h("area-stacked-vertical","x,y,color",r,"x"),bars:h("bars","x,y,color",!1,!1,[d,p,y],[k]),barStacked:h("barStacked","x,y,color",!1,"x",[p,y],[k]),barClustered:h("barClustered","x,y,color",!1,"x",[p,y],[k]),column:h("column","x,y,color",!1,!1,[d,p,y],[k]),columnStacked:h("columnStacked","x,y,color",!1,"y",[p,y],[k]),columnClustered:h("columnClustered","x,y,color",!1,"y",[p,y],[k]),rangeArea:h("range-area","x,rangeY,color",!1,!1,[],[k]),rangeAreaVertical:h("range-area-vertical","x,rangeX,color",!1,!1,[],[k]),rangeBars:h("range-bars","x,rangeX,color",!1,!1,[d],[k]),rangeColumn:h("range-column","x,rangeY,color",!1,!1,[d],[k]),histogram:h("histogram","x,rangeX,color",!1,!1,[d],[k]),pie:h("pie","size,color",!1,!1,[d],[k]),spider:h("spider","x,y,color",!1,!1,[],[k]),bubble:h("bubble","x,y,color,size",!1,!1,[],[k,o]),scatter:h("scatter","x,y,color,size,shape",!1,!1,[],[k,o]),geoMap:h("geo-map","color",!1,!1,[u,v],[k])},this.dimension={x:c("x",[m,i],[a,o,l]),y:c("y",[m,i],[a,o,l]),rangeX:c("rangeX",[x,i],[a,o,l]),rangeY:c("rangeY",[x,i],[a,o,l]),color:c("color",[m,i],[f,A]),size:c("size",[m,i],[f,A]),shape:c("shape",[m,i],[f,A])},this}]);