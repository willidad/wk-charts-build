angular.module("wk.chart",[]),angular.module("wk.chart").constant("d3OrdinalScales",["ordinal","category10","category20","category20b","category20c"]),angular.module("wk.chart").constant("wkChartMargins",{top:10,left:50,bottom:40,right:20,topBottomMargin:{axis:25,label:18},leftRightMargin:{axis:40,label:20},minMargin:8,"default":{top:8,left:8,bottom:8,right:10},axis:{top:25,bottom:25,left:40,right:40},label:{top:18,bottom:18,left:20,right:20},dataLabelPadding:{hor:5,vert:5}}),angular.module("wk.chart").constant("d3Shapes",["circle","cross","triangle-down","triangle-up","square","diamond"]),angular.module("wk.chart").constant("axisConfig",{labelFontSize:"1.6em",x:{axisPositions:["top","bottom"],axisOffset:{bottom:"height"},axisPositionDefault:"bottom",direction:"horizontal",measure:"width",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{top:"1em",bottom:"-0.8em"}},y:{axisPositions:["left","right"],axisOffset:{right:"width"},axisPositionDefault:"left",direction:"vertical",measure:"height",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{left:"1.2em",right:"1.2em"}}}),angular.module("wk.chart").constant("d3Animation",{duration:300}),angular.module("wk.chart").constant("maxTicks",200),angular.module("wk.chart").constant("templateDir","templates/"),angular.module("wk.chart").constant("formatDefaults",{date:"%x",number:",.2f"}),angular.module("wk.chart").constant("barConfig",{paddingLeft:.1,paddingRight:.1,outerPaddingLeft:0,outerPaddingRight:0}),function(){function e(e,t,r){var n=e.translate(),a=Math.atan2(t[1]-n[1],t[0]-n[0])-Math.atan2(r[1]-n[1],r[0]-n[0]);return[Math.cos(a/2),0,0,Math.sin(a/2)]}function t(e,t){var r=(e.translate(),e.invert(t));return r&&isFinite(r[0])&&isFinite(r[1])&&o(r)}function r(e){var t=.5*e[0]*c,r=.5*e[1]*c,n=.5*e[2]*c,a=Math.sin(t),i=Math.cos(t),o=Math.sin(r),l=Math.cos(r),s=Math.sin(n),u=Math.cos(n);return[i*l*u+a*o*s,a*l*u-i*o*s,i*o*u+a*l*s,i*l*s-a*o*u]}function n(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],o=t[0],l=t[1],s=t[2],c=t[3];return[r*o-n*l-a*s-i*c,r*l+n*o+a*c-i*s,r*s-n*c+a*o+i*l,r*c+n*s-a*l+i*o]}function a(e,t){if(e&&t){var r=s(e,t),n=Math.sqrt(l(r,r)),a=.5*Math.acos(Math.max(-1,Math.min(1,l(e,t)))),i=Math.sin(a)/n;return n&&[Math.cos(a),r[2]*i,-r[1]*i,r[0]*i]}}function i(e){return[Math.atan2(2*(e[0]*e[1]+e[2]*e[3]),1-2*(e[1]*e[1]+e[2]*e[2]))*u,Math.asin(Math.max(-1,Math.min(1,2*(e[0]*e[2]-e[3]*e[1]))))*u,Math.atan2(2*(e[0]*e[3]+e[1]*e[2]),1-2*(e[2]*e[2]+e[3]*e[3]))*u]}function o(e){var t=e[0]*c,r=e[1]*c,n=Math.cos(r);return[n*Math.cos(t),n*Math.sin(t),Math.sin(r)]}function l(e,t){for(var r=0,n=e.length,a=0;n>r;++r)a+=e[r]*t[r];return a}function s(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}var c=Math.PI/180,u=180/Math.PI;d3.geo.zoom=function(){var o,l,s=d3.dispatch("zoomstart","zoom","zoomend"),c=d3.behavior.zoom().on("zoomstart",function(){var d=d3.mouse(this),f=r(o.rotate()),h=t(o,d);h&&(l=h),u.call(c,"zoom",function(){o.scale(d3.event.scale);var r=d3.mouse(this),c=a(l,t(o,r));o.rotate(i(f=c?n(f,c):n(e(o,d,r),f))),d=r,s.zoom.apply(this,arguments)}),s.zoomstart.apply(this,arguments)}).on("zoomend",function(){u.call(c,"zoom",null),s.zoomend.apply(this,arguments)}),u=c.on;return c.projection=function(e){return arguments.length?c.scale((o=e).scale()):o},d3.rebind(c,s,"on")}}(),angular.module("wk.chart").directive("brush",["$log","selectionSharing","behavior",function(e){var t;return t=0,{restrict:"A",require:["^chart","^?layout","?x","?y"],scope:{brushExtent:"=",selectedValues:"=",selectedDomain:"=",selectedDomainChange:"&",brushStart:"&",brushEnd:"&"},link:function(r,n,a,i){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x;return e.log("brush-scope",r.$id),s=t++,f=i[0].me,y=null!=(p=i[1])?p.me:void 0,w=null!=(g=i[2])?g.me:void 0,b=null!=(v=i[3])?v.me:void 0,k=void 0,x=void 0,u=void 0,o=void 0,c=!w&&!b,l=void 0,e.log("creating brush scope",r.$id),d=f.behavior().brush,h=f||y,w||b?(d.x(w),d.y(b)):(m=h.scales().getScales(["x","y"]),d.x(m.x),d.y(m.y)),d.active(!0),a.$observe("brush",function(e){return d.brushGroup(_.isString(e)&&e.length>0?e:void 0)}),r.$watch("brushExtent",function(e,t){return _.isArray(e)&&0===e.length&&_.isArray(t)&&0!==t.length?d.clearBrush():void 0}),d.events().on("brushStart."+s,function(){return a.brushStart?(r.brushStart(),r.$apply()):void 0}),d.events().on("brush."+s,function(e,t,n){return a.brushExtent&&(r.brushExtent=e),a.selectedValues&&(r.selectedValues=t),a.selectedDomain&&(r.selectedDomain=n),r.selectedDomainChange({domain:n}),r.$apply()}),d.events().on("brushEnd."+s,function(e,t,n){return a.brushEnd?(r.brushEnd({domain:n}),r.$apply()):void 0}),f.lifeCycle().on("drawChart.brush",function(e){return d.data(e)}),h.lifeCycle().on("destroy.brush",function(){return d.events().on("."+s,null),f.lifeCycle().on("."+s,null),r.$destroy(),e.log("destroying brush scope",r.$id)})}}}]),function(){var e=function(t,r){var n=t.nodeType;if(3==n)r.push(t.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"));else if(1==n){if(r.push("<",t.tagName),t.hasAttributes())for(var a=t.attributes,i=0,o=a.length;o>i;++i){var l=a.item(i);r.push(" ",l.name,"='",l.value,"'")}if(t.hasChildNodes()){r.push(">");for(var s=t.childNodes,i=0,o=s.length;o>i;++i)e(s.item(i),r);r.push("</",t.tagName,">")}else r.push("/>")}else{if(8!=n)throw"Error serializing XML. Unhandled node of type: "+n;r.push("<!--",t.nodeValue,"-->")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){for(var t=[],r=this.firstChild;r;)e(r,t),r=r.nextSibling;return t.join("")},set:function(e){for(;this.firstChild;)this.removeChild(this.firstChild);try{var t=new DOMParser;t.async=!1,sXML="<svg xmlns='http://www.w3.org/2000/svg'>"+e+"</svg>";for(var r=t.parseFromString(sXML,"text/xml").documentElement,n=r.firstChild;n;)this.appendChild(this.ownerDocument.importNode(n,!0)),n=n.nextSibling}catch(a){throw new Error("Error parsing XML string")}}}),Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}})}(),angular.module("wk.chart").directive("brushed",["$log","selectionSharing","timing",function(e,t){var r;return r=0,{restrict:"A",require:["^chart","?^layout","?x","?y","?rangeX","?rangeY"],link:function(n,a,i,o){var l,s,c,u,d,f,h,y,p,g,v,m,w,k,b;return e.log("brushed-scope",n.$id),s=r++,d=o[0].me,f=null!=(p=o[1])?p.me:void 0,k=null!=(g=o[2])?g.me:void 0,b=null!=(v=o[3])?v.me:void 0,h=null!=(m=o[4])?m.me:void 0,y=null!=(w=o[5])?w.me:void 0,c=k||b||h||y,l=void 0,u=function(e,t){var r,n,a,i,o;if(c){for(e.length>0?c.domain(e).scale().domain(e):(c.domain(void 0),c.scale().domain(c.getDomain(d.getData())),c.isOrdinal()&&(t=[0,c.scale().domain().length-1])),i=d.layouts(),o=[],r=0,a=i.length;a>r;r++)n=i[r],n.scales().getKind(c.kind()).id()===c.id()&&o.push(n.lifeCycle().brush(c,!0,t));return o}},i.$observe("brushed",function(e){return _.isString(e)&&e.length>0?(l=e,t.register(l,u)):l=void 0}),d.lifeCycle().on("destroy."+s,function(){return t.unregister(l,u),d.lifeCycle().on("."+s,null)})}}}]),function(){this.ResizeSensor=function(e,t){function r(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;t>e;e++)this.q[e].call()}}function n(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function a(e,t){if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new r,e.resizedAttached.add(t);e.resizeSensor=document.createElement("div"),e.resizeSensor.className="wk-chart-resize-sensor";var a="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;",i="position: absolute; left: 0; top: 0;";e.resizeSensor.style.cssText=a,e.resizeSensor.innerHTML='<div class="wk-chart-resize-sensor-expand" style="'+a+'"><div style="'+i+'"></div></div><div class="wk-chart-resize-sensor-shrink" style="'+a+'"><div style="'+i+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),{fixed:1,absolute:1}[n(e,"position")]||(e.style.position="relative");var o,l,s=e.resizeSensor.childNodes[0],c=s.childNodes[0],u=e.resizeSensor.childNodes[1],d=(u.childNodes[0],function(){c.style.width=s.offsetWidth+10+"px",c.style.height=s.offsetHeight+10+"px",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,o=e.offsetWidth,l=e.offsetHeight});d();var f=function(){e.resizedAttached.call()},h=function(e,t,r){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener(t,r)};h(s,"scroll",function(){(e.offsetWidth>o||e.offsetHeight>l)&&f(),d()}),h(u,"scroll",function(){(e.offsetWidth<o||e.offsetHeight<l)&&f(),d()})}if("[object Array]"===Object.prototype.toString.call(e)||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements)for(var i=0,o=e.length;o>i;i++)a(e[i],t);else a(e,t)}}(),angular.module("wk.chart").run(["$templateCache",function(e){e.put("templates/legend.html",'\n<div ng-style="legendStyle" ng-show="showLegend" class="wk-chart-legend">\n  <div ng-show="title" class="legend-title">{{title}}</div>\n  <ul class="list-unstyled">\n    <li ng-repeat="legendRow in legendRows track by legendRow.value" class="wk-chart-legend-item">\n      <svg ng-if="!legendRow.path" class="wk-chart-legend-svg-box">\n        <rect ng-style="legendRow.color" x="0" y="0" width="50" height="50"></rect>\n      </svg>\n      <svg ng-if="legendRow.path" style="width:15px;height:17px;">\n        <path ng-attr-d="{{legendRow.path}}" transform="translate(8,9)"></path>\n      </svg><span> &nbsp;{{legendRow.value}}</span>\n    </li>\n  </ul>\n</div>'),e.put("templates/patterns.html",'\n<pattern id="largeDotsPattern" x="0" y="0" width="12" height="12" patternUnits="userSpaceOnUse">\n  <circle cx="5" cy="5" r="5" fill="#ffffff"></circle>\n</pattern>\n<mask id="largeDots">\n  <rect x="0" y="0" width="100%" height="100%" fill="url(#largeDotsPattern)"></rect>\n</mask>\n<pattern id="smallDotsPattern" x="0" y="0" width="5" height="5" patternUnits="userSpaceOnUse">\n  <circle cx="2" cy="2" r="2" fill="#ffffff"></circle>\n</pattern>\n<mask id="smallDots">\n  <rect x="0" y="0" width="100%" height="100%" fill="url(#smallDotsPattern)"></rect>\n</mask>\n<pattern id="stripesPattern" x="0" y="0" width="4" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">\n  <rect width="2" height="100%" fill="#ffffff"></rect>\n</pattern>\n<mask id="stripes">\n  <rect x="0" y="0" width="100%" height="100%" fill="url(#stripesPattern)"></rect>\n</mask>\n<linearGradient id="lgrad-1f77b4" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#1f77b4;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#15537d;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-1f77b4" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#1f77b4;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#15537d;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-aec7e8" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#aec7e8;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#798ba2;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-aec7e8" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#aec7e8;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#798ba2;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-ff7f0e" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#ff7f0e;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b25809;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-ff7f0e" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#ff7f0e;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b25809;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-ffbb78" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#ffbb78;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b28254;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-ffbb78" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#ffbb78;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b28254;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-2ca02c" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#2ca02c;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#1e701e;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-2ca02c" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#2ca02c;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#1e701e;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-98df8a" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#98df8a;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6a9c60;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-98df8a" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#98df8a;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6a9c60;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-d62728" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#d62728;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#951b1c;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-d62728" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#d62728;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#951b1c;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-ff9896" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#ff9896;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b26a69;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-ff9896" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#ff9896;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#b26a69;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-9467bd" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#9467bd;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#674884;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-9467bd" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#9467bd;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#674884;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-c5b0d5" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#c5b0d5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#897b95;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-c5b0d5" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#c5b0d5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#897b95;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-8c564b" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#8c564b;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#623c34;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-8c564b" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#8c564b;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#623c34;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-c49c94" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#c49c94;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#896d67;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-c49c94" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#c49c94;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#896d67;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-e377c2" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#e377c2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#9e5387;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-e377c2" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#e377c2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#9e5387;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-f7b6d2" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#f7b6d2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#ac7f93;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-f7b6d2" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#f7b6d2;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#ac7f93;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-7f7f7f" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#7f7f7f;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#585858;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-7f7f7f" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#7f7f7f;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#585858;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-c7c7c7" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#c7c7c7;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#8b8b8b;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-c7c7c7" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#c7c7c7;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#8b8b8b;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-bcbd22" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#bcbd22;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#838417;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-bcbd22" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#bcbd22;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#838417;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-dbdb8d" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#dbdb8d;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#999962;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-dbdb8d" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#dbdb8d;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#999962;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-17becf" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#17becf;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#108590;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-17becf" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#17becf;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#108590;stop-opacity:1"></stop>\n</radialGradient>\n<linearGradient id="lgrad-9edae5" x1="0%" y1="100%" x2="100%" y2="0%">\n  <stop offset="0%" style="stop-color:#9edae5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6e98a0;stop-opacity:1"></stop>\n</linearGradient>\n<radialGradient id="rgrad-9edae5" cx="50%" cy="50%" r="75%">\n  <stop offset="0%" style="stop-color:#9edae5;stop-opacity:1"></stop>\n  <stop offset="100%" style="stop-color:#6e98a0;stop-opacity:1"></stop>\n</radialGradient>'),e.put("templates/toolTip.html",'\n<div ng-style="tooltipStyle" ng-hide="ttHide" class="wk-chart-tooltip">\n  <table class="table table-condensed table-bordered">\n    <thead ng-show="headerValue">\n      <tr>\n        <th colspan="2">{{headerName}}</th>\n        <th>{{headerValue}}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="(name,value) in layers track by name">\n        <!--td(ng-style="value.color", ng-class="value.class")\n        svg(ng-if="value.path", style="width:15px;height:17px;")\n            path(ng-attr-d="{{value.path}}",transform="translate(8,9)")\n        -->\n        <td class="wk-chart-tt-svg-box">\n          <svg ng-if="!value.path" class="wk-chart-svg-box">\n            <rect ng-style="value.color" x="0" y="0" width="50" height="50"></rect>\n          </svg>\n          <svg ng-if="value.path" style="width:15px;height:17px;">\n            <path ng-attr-d="{{value.path}}" transform="translate(8,9)"></path>\n          </svg>\n        </td>\n        <td>{{name}}</td>\n        <td>{{value.value}}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>')}]),function(){function e(e){var t=document.querySelectorAll("svg image"),r=t.length;0==r&&e();for(var n=0;n<t.length;n++)!function(t){if(t.getAttribute("xlink:href")){var n=t.getAttribute("xlink:href").value;if(/^http/.test(n)&&!new RegExp("^"+window.location.host).test(n))throw new Error("Cannot render embedded images linking to external hosts.")}var a=document.createElement("canvas"),i=a.getContext("2d"),o=new Image;o.src=t.getAttribute("xlink:href"),o.onload=function(){a.width=o.width,a.height=o.height,i.drawImage(o,0,0),t.setAttribute("xlink:href",a.toDataURL("image/png")),r--,0==r&&e()}}(t[n])}function t(){for(var e="",t=document.styleSheets,r=0;r<t.length;r++){var n=t[r].cssRules;if(null!=n)for(var a=0;a<n.length;a++){var i=n[a];"undefined"!=typeof i.style&&(e+=i.selectorText+" { "+i.style.cssText+" }\n")}}var o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML="<![CDATA[\n"+e+"\n]]>";var l=document.createElement("defs");return l.appendChild(o),l}var r="undefined"!=typeof exports&&exports||this,n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';r.svgAsDataUri=function(a,i,o){i=i||1,e(function(){var e=document.createElement("div"),l=a.cloneNode(!0),s=parseInt(l.getAttribute("width")||l.style.width||r.getComputedStyle(a).getPropertyValue("width")),c=parseInt(l.getAttribute("height")||l.style.height||r.getComputedStyle(a).getPropertyValue("height")),u="http://www.w3.org/2000/xmlns/";l.setAttribute("version","1.1"),l.setAttributeNS(u,"xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(u,"xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("width",s*i),l.setAttribute("height",c*i),l.setAttribute("viewBox","0 0 "+s+" "+c),e.appendChild(l),l.insertBefore(t(l),l.firstChild);var d=n+e.innerHTML,f="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(d)));o&&o(f)})},r.saveSvgAsPng=function(e,t,n){r.svgAsDataUri(e,n,function(e){var r=new Image;r.src=e,r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height;var n=e.getContext("2d");n.drawImage(r,0,0);var a=document.createElement("a");a.download=t,a.href=e.toDataURL("image/png"),document.body.appendChild(a),a.click()}})}}(),angular.module("wk.chart").directive("chart",["$log","chart","$filter",function(e,t,r){var n;return n=0,{restrict:"E",require:"chart",scope:{data:"=",filter:"="},controller:["$scope",function(e){return this.me=t(),this.me.scope(e)}],link:function(t,n,a,i){var o,l,s,c,u,d;return e.log("chart-scope",t.$id),u=i.me,c=!1,d=void 0,n.addClass(u.id()),o=void 0,l=void 0,u.container().element(n[0]),u.lifeCycle().configure(),u.lifeCycle().on("scopeApply.chart",function(){return t.$apply()}),u.lifeCycle().on("editSelected.chart",function(){return attr.editSelected?t.$apply():void 0}),a.$observe("animationDuration",function(e){return e&&_.isNumber(+e)&&+e>=0?u.animationDuration(e):void 0}),a.$observe("header",function(e){return u.title(e?e:void 0)}),a.$observe("headerStyle",function(e){return e?u.titleStyle(t.$eval(e)):void 0}),a.$observe("subHeader",function(e){return u.subTitle(e?e:void 0)}),a.$observe("subHeaderStyle",function(e){return e?u.subTitleStyle(t.$eval(e)):void 0}),a.$observe("backgroundStyle",function(e){return e?u.backgroundStyle(t.$eval(e)):void 0}),t.$watch("filter",function(e){if(e){if(l=e,o)return u.lifeCycle().newData(r("filter")(o,l))}else if(l=void 0,o)return u.lifeCycle().newData(o)}),a.$observe("deepWatch",function(e){return c=void 0!==e&&"false"!==e?!0:!1,d&&d(),d=t.$watch("data",s,c)}),a.$observe("edit",function(e){return u.editMode(""===e||"true"===e?!0:!1)}),s=function(e){if(e){if(o=e,_.isArray(o)&&0===o.length)return;return u.lifeCycle().newData(l?r("filter")(e,l):e)}},d=t.$watch("data",s,c),n.on("$destroy",function(){return d&&d(),u.lifeCycle().on(".chart",null),u.container().element(void 0),e.log("Destroying chart"),u.lifeCycle().destroy(),t.$destroy()})}}}]),angular.module("wk.chart").directive("layout",["$log","layout","container",function(e,t){var r;return r=0,{restrict:"AE",require:["layout","^chart"],controller:["$element",function(){return this.me=t()}],link:function(e,t,r,n){var a,i;return i=n[0].me,a=n[1].me,i.chart(a),t.addClass(i.id()),a.addLayout(i),a.container().addLayout(i),i.container(a.container())}}}]),describe("chartGen Test Suite",function(){beforeEach(module("wk.chart"));var e,t;beforeEach(inject(function(r,n){e=r,t=n})),it("creates the element",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined()}),it("adds a layout and chart type",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;r.addLayout("line"),expect(r.layouts[0]).toBeDefined()}),it("adds a property to the layout x axis",function(){t('<chart-generator properties="chartDescription"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;r.addLayout("line"),expect(r.layouts[0]).toBeDefined();var n=r.layouts[0];n.dimensions.x.property="abcde",expect(n.dimensions.x.property).toEqual("abcde"),expect(n.dimensions.x.acceptedValues("domainRange")).toEqual(["min","max","extent","total"]),expect(n.dimensions.x.validate("domainRange","min")).toBeTruthy(),expect(n.dimensions.x.validate("domainRange","aaa")).toBeFalsy()}),it("generates Markup",function(){t('<chart-generator properties="chartDescription", markup="markup"></chart-generator>')(e);e.$digest(),expect(e.chartDescription).toBeDefined();var r=e.chartDescription;console.log("setting data"),r.data="chartData",r.tooltips$set=!0,r.tooltipsTemplate="url",e.$digest(),r.filter="filterString",r.addDimension("color"),r.dimensions.color.property="farbe",r.dimensions.color.legend$set=!0,r.dimensions.color.legend="top-left",r.dimensions.color.valuesLegend$set=!1,r.addLayout("barStacked"),r.addLayout("areaStacked"),expect(r.layouts[0]).toBeDefined(),expect(r.layouts.length).toBe(2);var n=r.layouts[0];n.dimensions.y.property="abcde",n.padding=10;var a=r.layouts[1];a.areaStacked="zero",e.$apply(r),console.log(e.markup),expect(e.markup).toBeTruthy()})}),angular.module("wk.chart").directive("printButton",["$log",function(e){return{require:"chart",restrict:"A",link:function(t,r,n,a){var i,o;return i=a.me,o=function(){var t;return t=d3.select(i.container().element()).select("div.wk-chart"),t.append("button").attr("class","wk-chart-print-button").style({position:"absolute",top:0,right:0}).text("Print").on("click",function(){var r;return e.log("Clicked Print Button"),r=t.select("svg.wk-chart").node(),saveSvgAsPng(r,"print.png",5)})},i.lifeCycle().on("drawChart.print",o)}}}]),describe("chartGen Test Suite",function(){beforeEach(module("wk.chart"));var e,t,r,n;beforeEach(inject(function(a,i,o,l){e=a,t=i,r=o,n=l})),it("should inject modelTypes",function(){expect(r).not.toBeUndefined(),expect(r.chart.properties.title).toEqual("string"),expect(r.dimension.x.properties.property).toEqual("list")}),it("creates a model instance",function(){var e=n.create();e.data="abcde",e.title="efg",expect(e.data).toEqual("abcde"),expect(e.validate("data","anything")).toBeTruthy(),expect(e.title).toEqual("efg")}),it("adds and removes a dimension",function(){var e=n.create();expect(e.dimensions).toEqual({}),e.addDimension("x"),expect(e.dimensions.x).toBeDefined(),e.removeDimension("x"),expect(e.dimensions).toEqual({})}),it("can access properties and functions in dimensions",function(){var e=n.create();e.addDimension("x"),expect(e.dimensions).toBeDefined(),e.dimensions.x.showLabel=!0,expect(e.dimensions.x.showLabel).toBeTruthy(),expect(e.dimensions.x.validate("type","linear")).toBeTruthy(),expect(e.dimensions.x.validate("type","nonsense")).toBeFalsy(),expect(e.dimensions.x.acceptedValues("domainRange")).toEqual(["min","max","extent","total"])}),it("adds and removes a layout",function(){var e=n.create();expect(e.layouts).toEqual([]);var t=e.addLayout("line");expect(e.layouts.length).toBe(1),e.removeLayout(t),expect(e.layouts.length).toBe(0)}),it("can access properties and functions in layouts",function(){var e=n.create();e.addLayout("line");var t=e.layouts[0];expect(t).toBeDefined(),expect(t.dimensions.x).toBeDefined();var r=t.dimensions.x;r.reset=!0,expect(r.reset).toBeTruthy(),expect(r.validate("type","linear")).toBeTruthy(),expect(r.validate("type","nonsense")).toBeFalsy(),expect(r.acceptedValues("domainRange")).toEqual(["min","max","extent","total"]),expect(r.validate("domainRange","min")).toBeTruthy(),expect(r.validate("domainRange","nono")).toBeFalsy(),expect(r.validate("domain","[sbx]")).toBeTruthy(),expect(r.validate("domain","sbx]")).toBeFalsy()}),it("can add and remove a dimension for a layout",function(){var e=n.create();e.addLayout("line");var t=e.layouts[0];expect(t).toBeDefined(),expect(t.dimensions.x).toBeDefined(),t.addDimension("size"),expect(t.dimensions.size).toBeDefined(),t.removeDimension("size"),expect(t.dimensions.size).toBeUndefined()}),it("can access layout properties",function(){var e=n.create();e.addLayout("bars");var t=e.layouts[0];expect(_.has(t,"padding")).toBeTruthy(),expect(t.validate("padding",10)).toBeTruthy(),expect(t.validate("padding","abc")).toBeFalsy()}),it('handles layout values (e.g. areaStacked="wiggle" correctly',function(){var e=n.create();e.addLayout("areaStacked");var t=e.layouts[0];expect(t).toBeDefined(),expect(_.has(t,"areaStacked")).toBeTruthy(),expect(t.validate("areaStacked","wiggle")).toBeTruthy(),expect(t.validate("areaStacked","totalKrumm")).toBeFalsy()}),it("can access decorator attributes",function(){var e=n.create();e.tooltips$set=!0,expect(e.tooltips$set).toBeTruthy(),expect(e.validate("tooltips",!0)).toBeTruthy(),e.tooltipsTemplate="url",expect(e.tooltipsTemplate).toEqual("url")})}),angular.module("wk.chart").directive("selection",["$log",function(e){var t;return t=0,{restrict:"A",scope:{selectedDomain:"=",selectedDomainChange:"&"},require:"layout",link:function(r,n,a,i){var o,l,s;return e.log("selection-scope",r.$id),s=i.me,l=void 0,o=t++,r.$watch("selectedDomain",function(e){return _.isArray(e)&&0===e.length?(l.clearSelection(),r.selectedDomainChange({domain:[]})):void 0}),s.lifeCycle().on("configure.selection"+o,function(){return l=s.behavior().selected,l.layout(s),l.active(!0),l.on("selected.selection"+o,function(e){return r.selectedDomain&&(r.selectedDomain=e),r.selectedDomainChange({domain:e}),r.$apply()}),s.lifeCycle().on("destroy.selection"+o,function(){return l.on(".selection"+o,null),s.lifeCycle().on(".selection"+o,null),r.$destroy()})})}}}]),angular.module("wk.chart").directive("tooltips",["$log","behavior",function(e){return{restrict:"A",require:"chart",link:function(t,r,n,a){var i;return i=a.me,e.log("tooltips-scope",t.$id),n.$observe("tooltips",function(e){return i.toolTipTemplate(""),void 0===e||""!==e&&"true"!==e?e.length>0&&"false"!==e?(i.toolTipTemplate(e),i.showTooltip(!0)):i.showTooltip(!1):i.showTooltip(!0)
}),n.$observe("tooltipStyle",function(e){return e?i.tooltipStyle(t.$eval(e)):void 0})}}}]),angular.module("wk.chart").factory("dataManagerFactory",["$log",function(){var e,t;return t=function(e,t,r){var n,a,i,o,l,s,c,u,d,f,h,y;if(l=0,o=0,h=e.length-1,f=t.length-1,d=Math.max(h,f),y=[],s=0,r){for(;h>=l&&f>=o;){for((u=t.indexOf(e[l]))>=0?(y.push({iOld:l,iNew:u,key:e[l]}),s=l,l++):(y.push({deleted:!0,iOld:l,key:e[l],atBorder:0===o,lowBorder:0===o}),l++);e.indexOf(t[o])<0&&f>=o;)y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:0===l,lowBorder:0===l}),o++;o++}for(;h>=l;)(u=t.indexOf(e[l]))>=0?(y.push({iOld:l,iNew:u,key:e[l]}),s=l,l++):(y.push({deleted:!0,iOld:l,key:e[l],atBorder:!0,highBorder:!0}),l++);for(;f>=o;)e.indexOf(t[o])<0?(y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:!0,highBorder:!0}),o++):o++}else{for(;h>=l&&f>=o;)e[l]===t[o]?(y.push({iOld:l,iNew:Math.min(o,f),key:e[l]}),s=l,l++,o++):e.indexOf(t[o],l)>=0?(y.push({deleted:!0,iOld:l,key:e[l],atBorder:0===o,lowBorder:0===o}),l++):(y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:0===l,lowBorder:0===l}),o++);for(;h>=l;)y.push({deleted:!0,iOld:l,key:e[l],atBorder:!0,highBorder:!0}),l++;for(;f>=o;)y.push({added:!0,iPred:s,predKey:e[s],iNew:Math.min(o,f),key:t[o],atBorder:!0,highBorder:!0}),o++}for(i=y.length-1,n=!0,c=t.length-1;i>=0;)a=y[i],a.deleted?(a.iSucc=c,a.succKey=t[c]):(c=a.iNew,n=!1),i--;return y},e=function(){var e,r,n,a,i,o,l,s,c,u,d,f,h,y,p;return r=[],e=[],o=[],i=[],l=void 0,f=void 0,u=[],s=[],c=[],d=void 0,n=!0,a=!1,p={},p.data=function(n,a){return r=e,o=i,c=s,s=f.layerKeys(n),e=_.clone(n),i=l.value(n),"time"===l.scaleType()&&(i=i.map(function(e){return+e})),u=t(o,i,a),d=t(c,s),p},p.isInitial=function(){return 0===r.length},y=function(){return function(){var t,a,i,l,s,c,d;for(d=[],s=o[0],t=!0,c=void 0,i=void 0,l=0,a=function(e){return n?s:e.key};l<u.length;)i=u[l],void 0!==i.iOld?(d.push({added:!1,key:i.key,targetKey:i.key,data:r[i.iOld],targetData:r[i.iOld],newData:e[i.iNew]}),s=i.key,c=i.iOld,t=!1):d.push({added:!0,atBorder:i.atBorder,lowBorder:i.lowBorder,highBorder:i.highBorder,targetKey:i.atBorder&&!n?i.key:s,key:i.key,data:i.atBorder?e[i.iNew]:r[c],targetData:e[i.iNew],newData:e[i.iNew]}),l++;return d}}(this),p.animationStartLayers=function(){var e;return e=y(),d.map(function(t){return{layerKey:void 0===t.iOld?s[t.iNew]:t.key,added:t.added,values:e.map(function(e){return{key:e.key,targetKey:e.targetKey,layerKey:t.key,layerAdded:t.added,added:e.added,atBorder:e.atBorder,lowBorder:e.lowBorder,highBorder:e.highBorder,value:f.layerValue(e.data,t.key),targetValue:t.added?f.layerValue(e.newData,t.key)||0:f.layerValue(e.targetData,t.key)||0,data:e.data}})}})},h=function(){return function(){var t,a,o,l,s,c,d;for(d=[],s=i[i.length-1],c=void 0,t=!0,l=u.length-1,a=function(e){return n?s:e.key};l>=0;)o=u[l],void 0!==o.iNew?(d.unshift({deleted:!1,key:o.key,targetKey:o.key,data:e[o.iNew],targetData:e[o.iNew],oldData:r[o.iOld]}),s=o.key,c=o.iNew,t=!1):d.unshift({deleted:!0,atBorder:o.atBorder,lowBorder:o.lowBorder,highBorder:o.highBorder,targetKey:o.atBorder&&!n?o.key:s,key:o.key,data:e[c],targetData:r[o.iOld],oldData:r[o.iOld]}),l--;return d}}(this),p.animationEndLayers=function(){var e;return e=h(),d.map(function(t){return{layerKey:t.key,deleted:t.deleted,values:e.map(function(e){return{key:e.key,targetKey:e.targetKey,layerKey:t.key,layerDeleted:t.deleted,deleted:e.deleted,atBorder:e.atBorder,lowBorder:e.lowBorder,highBorder:e.highBorder,value:e.deleted&&e.atBorder?f.layerValue(e.targetData,t.key):f.layerValue(e.data,t.key),targetValue:t.deleted?f.layerValue(e.oldData,t.key)||0:f.layerValue(e.targetData,t.key)||0,data:e.targetData}})}})},p.keyScale=function(e){return 0===arguments.length?l:(l=e,n=e.isOrdinal(),p)},p.valueScale=function(e){return 0===arguments.length?f:(f=e,a="rangeX"===e.kind()||"rangeY"===e.kind(),p)},p}}]),angular.module("wk.chart").directive("color",["$log","scale","legend","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["color","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],scope:{mapFunction:"="},link:function(t,r,a,i){var o,l,s,c,u,d;return c=i[0].me,o=i[1].me,s=null!=(d=i[2])?d.me:void 0,l=void 0,o||s?(u="color",c.kind(u),c.parent(s||o),c.chart(o),c.scaleType("category20"),r.addClass(c.id()),o.addScale(c,s),c.register(),n.observeSharedAttributes(a,c),n.observeLegendAttributes(a,c,s,t),t.$watch("mapFunction",function(e){return e&&_.isFunction(e)?c.scaleMapFn(e):void 0}),o.lifeCycle().on("destroy.color",function(){return t.$destroy()})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").service("scaleUtils",["$log","wkChartScales","utils",function(e,t,r){var n;return n=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),t=t.map(function(e){return isNaN(e)?e:+e}),1===t.length?t[0]:t):void 0},{observeSharedAttributes:function(a,i){return a.$observe("type",function(r){return void 0!==r?(d3.scale.hasOwnProperty(r)||"time"===r||t.hasOwnProperty(r)?i.scaleType(r):""!==r&&e.error("Error: illegal scale value: "+r+". Using 'linear' scale instead"),i.update()):void 0}),a.$observe("exponent",function(e){return"pow"===i.scaleType()&&_.isNumber(+e)?i.exponent(+e).update():void 0}),a.$observe("property",function(e){return i.property(n(e)).update()}),a.$observe("layerProperty",function(e){return e&&e.length>0?i.layerProperty(e).update():void 0}),a.$observe("range",function(e){var t;return t=n(e),Array.isArray(t)?i.range(t).update():void 0}),a.$observe("dateFormat",function(e){return e&&"time"===i.scaleType()?i.dataFormat(e).update():void 0}),a.$observe("domain",function(t){var r;return t?(e.info("domain",t),r=n(t),Array.isArray(r)?i.domain(r).update():e.error("domain: must be array, or comma-separated list, got",t)):i.domain(void 0).update()}),a.$observe("domainRange",function(e){return e?i.domainCalc(e).update():void 0}),a.$observe("domainMin",function(e){return e?i.domainMin(e):void 0}),a.$observe("domainMax",function(e){return e?i.domainMax(e):void 0}),a.$observe("label",function(e){return void 0!==e?i.axisLabel(e).updateAttrs():void 0}),a.$observe("format",function(e){return void 0!==e?i.format(e):void 0}),a.$observe("reset",function(e){return i.resetOnNewData(r.parseTrueFalse(e))})},observeAxisAttributes:function(e,t,n){return e.$observe("axis",function(e){return t.axisOrient(t.orientation()).showAxis(r.parseTrueFalse(e)).update()}),e.$observe("labelStyle",function(e){return e?t.axisLabelStyle(n.$eval(e)):void 0}),e.$observe("tickFormat",function(e){return void 0!==e?t.tickFormat(d3.format(e)).update():void 0}),e.$observe("ticks",function(e){return void 0!==e&&(t.ticks(+e),t.axis())?t.updateAttrs():void 0}),e.$observe("tickInterval",function(e){return void 0!==e&&(t.tickInterval(e),t.axis())?t.updateAttrs():void 0}),e.$observe("tickLabelStyle",function(e){return e?t.tickLabelStyle(n.$eval(e)):void 0}),e.$observe("grid",function(e){return void 0!==e?t.showGrid(""===e||"true"===e).updateAttrs():void 0}),e.$observe("gridStyle",function(e){return e?t.gridStyle(n.$eval(e)):void 0}),e.$observe("showLabel",function(e){return void 0!==e?t.showLabel(""===e||"true"===e).update(!0):void 0}),e.$observe("reverse",function(e){return void 0!==e?t.reverse(""===e||"true"===e).update():void 0}),e.$observe("rotateTickLabels",function(e){return t.rotateTickLabels(e&&_.isNumber(+e)?+e:void 0),t.update(!0)})},observeLegendAttributes:function(t,r,n,a){return t.$observe("legend",function(t){var a,i;if(void 0!==t){switch(a=r.legend(),a.showValues(!1),t){case"false":a.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":a.position(t).div(void 0).show(!0);break;case"true":case"":a.position("top-right").show(!0).div(void 0);break;default:i=d3.select(t),i.empty()?(e.warn("legend reference does not exist:",t),a.div(void 0).show(!1)):a.div(i).position("top-left").show(!0)}return a.scale(r).layout(n),r.parent()&&a.register(r.parent()),a.redraw()}}),t.$observe("valuesLegend",function(t){var a,i;if(void 0!==t){switch(a=r.legend(),a.showValues(!0),t){case"false":a.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":a.position(t).div(void 0).show(!0);break;case"true":case"":a.position("top-right").show(!0).div(void 0);break;default:i=d3.select(t),i.empty()?(e.warn("legend reference does not exist:",t),a.div(void 0).show(!1)):a.div(i).position("top-left").show(!0)}return a.scale(r).layout(n),r.parent()&&a.register(r.parent()),a.redraw()}}),t.$observe("legendTitle",function(e){return void 0!==e?r.legend().title(e).redraw():void 0}),t.$observe("legendStyle",function(e){return void 0!==e?r.legend().legendStyle(a.$eval(e)).redraw():void 0})}}}]),angular.module("wk.chart").directive("shape",["$log","scale","d3Shapes","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["shape","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,a,i,o){var l,s,c,u,d;return e.log("shape-scope",t.$id),c=o[0].me,l=o[1].me,s=null!=(d=o[2])?d.me:void 0,l||s?(u="shape",c.kind(u),c.parent(s||l),c.chart(l),c.scaleType("ordinal"),c.scale().range(r),a.addClass(c.id()),l.addScale(c,s),c.register(),n.observeSharedAttributes(i,c),n.observeLegendAttributes(i,c,s,t)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("size",["$log","scale","scaleUtils",function(e,t,r){var n;return n=0,{restrict:"E",require:["size","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,a,i){var o,l,s,c,u;return e.log("size-scope",t.$id),s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(c="size",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.resetOnNewData(!0),n.addClass(s.id()),o.addScale(s,l),s.register(),r.observeSharedAttributes(a,s),r.observeLegendAttributes(a,s,l,t)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("x",["$log","scale","scaleUtils",function(e,t,r){var n;return n=0,{restrict:"E",require:["x","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,a,i){var o,l,s,c,u;return e.log("x-scope",t.$id),s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(s.orientation(a.hasOwnProperty("top")?"top":"bottom"),c="x",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.resetOnNewData(!0),s.isHorizontal(!0),s.register(),n.addClass(s.id()),o.addScale(s,l),r.observeSharedAttributes(a,s),r.observeAxisAttributes(a,s,t),r.observeLegendAttributes(a,s,l)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeX",["$log","scale","scaleUtils",function(e,t,r){var n;return n=0,{restrict:"E",require:["rangeX","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,n,a,i){var o,l,s,c,u;return s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(c="rangeX",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.resetOnNewData(!0),s.isHorizontal(!0),s.register(),n.addClass(s.id()),o.addScale(s,l),r.observeSharedAttributes(a,s),a.$observe("axis",function(e){return void 0!==e?("false"!==e?"top"===e||"bottom"===e?s.axisOrient(e).showAxis(!0):s.axisOrient("bottom").showAxis(!0):s.showAxis(!1).axisOrient(void 0),s.update(!0)):void 0}),r.observeAxisAttributes(a,s,t),r.observeLegendAttributes(a,s,l),r.observerRangeAttributes(a,s),a.$observe("rotateTickLabels",function(e){return s.rotateTickLabels(e&&_.isNumber(+e)?+e:void 0),s.update(!0)})):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("y",["$log","scale","legend","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["y","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,r,a,i){var o,l,s,c,u;return e.log("color-scope",t.$id),s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(s.orientation(a.hasOwnProperty("right")?"right":"left"),c="y",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.isVertical(!0),s.resetOnNewData(!0),r.addClass(s.id()),o.addScale(s,l),s.register(),n.observeSharedAttributes(a,s),n.observeAxisAttributes(a,s,t),n.observeLegendAttributes(a,s,l)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeY",["$log","scale","legend","scaleUtils",function(e,t,r,n){var a;return a=0,{restrict:"E",require:["rangeY","^chart","?^layout"],controller:["$element",function(){return this.me=t()}],link:function(t,r,a,i){var o,l,s,c,u;return s=i[0].me,o=i[1].me,l=null!=(u=i[2])?u.me:void 0,o||l?(c="rangeY",s.kind(c),s.parent(l||o),s.chart(o),s.scaleType("linear"),s.isVertical(!0),s.resetOnNewData(!0),r.addClass(s.id()),o.addScale(s,l),s.register(),n.observeSharedAttributes(a,s),a.$observe("axis",function(e){return void 0!==e?("false"!==e?"left"===e||"right"===e?s.axisOrient(e).showAxis(!0):s.axisOrient("left").showAxis(!0):s.showAxis(!1).axisOrient(void 0),s.update(!0)):void 0}),n.observeAxisAttributes(a,s,t),n.observeLegendAttributes(a,s,l),n.observerRangeAttributes(a,s)):void e.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("area",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return w=l.me,p=void 0,d={},f=!1,s=!1,y=!1,x=0,c="area"+i++,g=void 0,k=void 0,u=0,h=.5,D=n(),b=a(),A=r(),C=function(e,t,r,n,a){return D.keyScale(r).valueScale(n).data(e),D.isInitial()?void 0:(k=D.animationStartLayers(),m.apply(this,[!1,k,t,r,n,a]))},S=function(e,t,r,n,a){return b.active(f),k=D.animationEndLayers(),m.apply(this,[!0,k,t,r,n,a])},m=function(e,t,r,n,a,i){var o,l,c,d;return d=function(e){var t,r,n;return r=d3.select(this),r.style(s),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},x=n.isOrdinal()?n.scale().rangeBand()/2:0,p&&(p.data(t),A.layout(t)),g=d3.svg.area().x(function(e){return n.scale()(e.targetKey)}).y(function(e){return a.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).y1(function(){return a.scale()(0)}),y&&g.interpolate("cardinal"),l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),o=l.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-area-path").attr("d",function(e){return g(e.values)}).style("opacity",u).style("pointer-events","none"),c=l.select(".wk-chart-area-path").attr("transform","translate("+x+")").each(d),c=e?c.transition().duration(r.duration):c,c.attr("d",function(e){return g(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:h}),l.exit().remove(),b.x(function(e){return n.scale()(e.targetKey)+(n.isOrdinal()?n.scale().rangeBand()/2:0)}).y(function(e){return a.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(n.scale()),l.call(b,e)},v=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return g(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),b.brush(this,t),A.brushRange(t)):(r.attr("d",function(e){return g(e.values)}),b.brush(this))},w.lifeCycle().on("configure",function(){return d=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),p=w.behavior().tooltip,A.keyScale(d.x).valueScale(d.y).colorScale(d.color).value(function(e){return e.value}),p.markerScale(d.x),p.on("enter."+c,A.enter),p.on("moveData."+c,A.moveData),p.on("moveMarker."+c,A.moveMarkers)}),w.lifeCycle().on("brushDraw."+c,v),w.lifeCycle().on("animationStartState."+c,C),w.lifeCycle().on("animationEndState."+c,S),w.lifeCycle().on("destroy."+c,function(){return w.lifeCycle().on("."+c,null),p.on("."+c,null)}),o.$observe("markers",function(e){return f=""===e||"true"===e?!0:!1,w.lifeCycle().update()}),o.$observe("spline",function(e){return y=""===e||"true"===e?!0:!1,w.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?s=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("areaStacked",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(t,o,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L,M,O;return w=s.me,B=d3.layout.stack(),C="zero",k=null,f=!1,y=!1,L=[],g=void 0,c=void 0,p=void 0,d={},A=void 0,S=0,u="areaStacked"+i++,h=.5,O=n(),x=a(),b=void 0,M=r(),B.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.value}).x(function(e){return e.targetKey}),$=function(e,t,r,n,a){return O.keyScale(r).valueScale(n).data(e),O.isInitial()?void 0:(b=O.animationStartLayers(),m.apply(this,[!1,b,t,r,n,a]))},D=function(e,t,r,n,a){return x.active(f),b=O.animationEndLayers(),m.apply(this,[!0,b,t,r,n,a])},m=function(t,r,n,a,i,o){var l,s,u,d;return u=function(e){var t,r,n;return r=d3.select(this),r.style(c),n=o.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},L=B(r),S=a.isOrdinal()?a.scale().rangeBand()/2:0,e.log("offset",S),p&&(p.data(r),M.layout(r)),k||(k=this.selectAll(".wk-chart-layer")),"expand"===C?(A=i.scale().copy(),A.domain([0,1])):A=i.scale(),g=d3.svg.area().x(function(e){return a.scale()(e.targetKey)}).y0(function(e){return A(e.y0+e.y)}).y1(function(e){return A(e.y0)}),y&&g.interpolate("cardinal"),k=k.data(L,function(e){return e.layerKey}),l=k.enter().append("g").attr("class","wk-chart-layer"),l.append("path").attr("class","wk-chart-area-path").style("pointer-events","none").style("opacity",0),s=k.select(".wk-chart-area-path").attr("transform","translate("+S+")").each(u),d=t?s.transition().duration(n.duration):s,d.attr("d",function(e){return g(e.values)}).style("opacity",h),k.exit().remove(),x.x(function(e){return a.scale()(e.targetKey)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}).y(function(e){return A(e.y+e.y0)}).color(function(e){var t;return t=o.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(a.scale()),k.call(x,t)},v=function(e,t){return k=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(k.attr("d",function(e){return g(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),x.brush(this,t),M.brushRange(t)):(k.attr("d",function(e){return g(e.values)}),x.brush(this))},w.lifeCycle().on("configure",function(){return d=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),p=w.behavior().tooltip,M.keyScale(d.x).valueScale(d.y).isStacked(!0).colorScale(d.color).value(function(e){return e.y+e.y0}),p.markerScale(d.x),p.on("enter."+u,M.enter),p.on("moveData."+u,M.moveData),p.on("moveMarker."+u,M.moveMarkers)}),w.lifeCycle().on("brushDraw."+u,v),w.lifeCycle().on("animationStartState."+u,$),w.lifeCycle().on("animationEndState."+u,D),w.lifeCycle().on("destroy."+u,function(){return w.lifeCycle().on("."+u,null),p.on("."+u,null)}),l.$observe("areaStacked",function(e){return C="zero"===e||"silhouette"===e||"expand"===e||"wiggle"===e?e:"zero",B.offset(C),w.lifeCycle().update()}),l.$observe("markers",function(e){return f=""===e||"true"===e?!0:!1,w.lifeCycle().update()}),l.$observe("spline",function(e){return y=""===e||"true"===e?!0:!1,w.lifeCycle().update()}),l.$observe("areaStyle",function(e){return e?c=t.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("areaStackedVertical",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L;return m=l.me,D=d3.layout.stack(),S="zero",w=null,d=!1,s={},h=!1,$=[],p=void 0,y=void 0,u={},x=0,c="areaStackedVert"+i++,f=.5,L=n(),b=a(),B=r(),k=void 0,D.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.value}).x(function(e){return e.targetKey}),A=function(e,t,r,n,a){return L.keyScale(n).valueScale(r).data(e),L.isInitial()?void 0:(k=L.animationStartLayers(),v.apply(this,[!1,k,t,r,n,a]))},C=function(e,t,r,n,a){return b.active(d),k=L.animationEndLayers(),v.apply(this,[!0,k,t,r,n,a])},v=function(e,t,r,n,a,i){var o,l,c,u,d;return u=function(e){var t,r,n;return r=d3.select(this),r.style(s),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},$=D(t),x=a.isOrdinal()?a.scale().rangeBand()/2:0,y&&(y.data(t),B.layout(t)),w||(w=this.selectAll(".wk-chart-layer")),"expand"===S?(c=n.scale().copy(),c.domain([0,1])):c=n.scale(),p=d3.svg.area().x(function(e){return-a.scale()(e.targetKey)}).y0(function(e){return c(e.y0+e.y)}).y1(function(e){return c(e.y0)}),h&&p.interpolate("cardinal"),w=w.data($,function(e){return e.layerKey}),o=w.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-area-path").style("pointer-events","none").style("opacity",0),l=w.select(".wk-chart-area-path").attr("transform","translate("+x+")rotate(-90)").each(u),d=e?l.transition().duration(r.duration):l,d.attr("d",function(e){return p(e.values)}).style("opacity",f),w.exit().remove(),b.x(function(e){return c(e.y+e.y0)}).y(function(e){return a.scale()(e.targetKey)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(a.scale()).isVertical(!0),w.call(b,e)},g=function(e,t){return w=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(w.attr("d",function(e){return p(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),b.brush(this,t),B.brushRange(t)):(w.attr("d",function(e){return p(e.values)}),b.brush(this))},m.lifeCycle().on("configure",function(){return u=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).domainCalc("extent"),y=m.behavior().tooltip,B.keyScale(u.y).valueScale(u.x).isStacked(!0).colorScale(u.color).value(function(e){return e.y+e.y0}),y.markerScale(u.y),y.on("enter."+c,B.enter),y.on("moveData."+c,B.moveData),y.on("moveMarker."+c,B.moveMarkers)}),m.lifeCycle().on("brushDraw."+c,g),m.lifeCycle().on("animationStartState."+c,A),m.lifeCycle().on("animationEndState."+c,C),m.lifeCycle().on("destroy."+c,function(){return m.lifeCycle().on("."+c,null),y.on("."+c,null)}),o.$observe("areaStackedVertical",function(e){return S="zero"===e||"silhouette"===e||"expand"===e||"wiggle"===e?e:"zero",D.offset(S),m.lifeCycle().update()}),o.$observe("markers",function(e){return d=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),o.$observe("spline",function(e){return h=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?s=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("areaVertical",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B;return b=l.me,g=void 0,v=void 0,c=void 0,f={},p=!1,h=!1,s={},C=0,m=void 0,u="areaVertical"+i++,y=.5,x=void 0,d=0,B=n(),S=a(),$=r(),D=function(e,t,r,n,a){return B.keyScale(n).valueScale(r).data(e),B.isInitial()?void 0:(x=B.animationStartLayers(),k.apply(this,[!1,x,t,r,n,a]))},A=function(e,t,r,n,a){return S.active(h),x=B.animationEndLayers(),k.apply(this,[!0,x,t,r,n,a])},k=function(e,t,r,n,a,i){var o,l,c,u;return u=function(e){var t,r,n;return r=d3.select(this),r.style(s),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},C=a.isOrdinal()?a.scale().rangeBand()/2:0,g&&(g.data(t),$.layout(t)),m=d3.svg.area().x(function(e){return-a.scale()(e.targetKey)}).y(function(e){return n.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).y1(function(){return n.scale()(0)}),p&&m.interpolate("cardinal"),l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),o=l.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-area-path").attr("d",function(e){return m(e.values)}).style("opacity",d).style("pointer-events","none"),c=l.select(".wk-chart-area-path").attr("transform","translate(0,"+C+")rotate(-90)").style("pointer-events","none"),c.each(u),c=e?c.transition().duration(r.duration):c,c.attr("d",function(e){return m(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:y}),l.exit().remove(),S.isVertical(!0).x(function(e){return n.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).y(function(e){return a.scale()(e.targetKey)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(a.scale()),l.call(S,e)},w=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return m(e.values.slice(t[0],t[1]+1))}).attr("transform","translate(0,"+e.scale().rangeBand()/2+")rotate(-90)"),S.brush(this,t),$.brushRange(t)):(r.attr("d",function(e){return m(e.values)}),S.brush(this))},b.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),g=b.behavior().tooltip,$.keyScale(f.y).valueScale(f.x).colorScale(f.color).value(function(e){return e.value}),g.markerScale(f.y),g.on("enter."+u,$.enter),g.on("moveData."+u,$.moveData),g.on("moveMarker."+u,$.moveMarkers)}),b.lifeCycle().on("brushDraw."+u,w),b.lifeCycle().on("animationStartState."+u,D),b.lifeCycle().on("animationEndState."+u,A),b.lifeCycle().on("destroy."+u,function(){return b.lifeCycle().on("."+u,null),g.on("."+u,null)}),o.$observe("markers",function(e){return h=""===e||"true"===e?!0:!1,b.lifeCycle().update()}),o.$observe("spline",function(e){return p=""===e||"true"===e?!0:!1,b.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?s=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("bars",["$log","utils","barConfig","dataLabelFactory","dataManagerFactory","tooltipHelperFactory",function(e,t,r,n,a,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return x=c.me,d="bars"+o++,v=null,g=0,p=0,f={},h=void 0,u={},w=_.clone(r,!0),D=a(),A=i(),k=n(),y=void 0,C=function(e,t,r,n,a){var i;return D.keyScale(n).valueScale(r).data(e,!0),D.isInitial()?void 0:(i=D.animationStartLayers(),b.apply(this,[!1,i,t,r,n,a]))},S=function(e,t,r,n,a){var i;return i=D.animationEndLayers(),k.duration(t.duration).active(x.showDataLabels()),b.apply(this,[!0,i,t,r,n,a])},b=function(e,t,r,n,a,i){var o,l,s,c,d,f,p,g;return g=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=0===i.property().length?i.scale()(e.layerKey):i.map(e.data),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},o=!i.property()&&i.isOrdinal(),A.colorByKey(o),v||(v=this.selectAll(".wk-chart-layer")),l=a.scale().rangeBand(),c=l/(1-w.paddingLeft)*w.paddingLeft,s=l/(1-w.outerPaddingLeft)*w.outerPaddingLeft,f=function(e){if(a.reverse()){if(e.deleted&&e.highBorder)return l+c/2;if(e.deleted)return-c/2;if(e.added&&e.atBorder)return l+c/2;if(e.added)return-c/2}else{if(e.deleted&&e.highBorder)return-c/2;if(e.deleted)return l+c/2;if(e.added&&e.atBorder)return-c/2;if(e.added)return l+c/2}return 0},v=v.data(t[0].values,function(e){return e.key}),d=v.enter().append("g").attr("class","wk-chart-layer").attr("transform",function(e){return"translate("+n.scale()(0)+", "+(a.scale()(e.targetKey)+f(e))+")"}),d.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(e){return e.added||e.deleted?0:l}).style("opacity",0).call(y.tooltip).call(h),(e?v.transition().duration(r.duration):v).attr("transform",function(e){return"translate("+n.scale()(0)+", "+(a.scale()(e.targetKey)+f(e))+") scale(1,1)"}),p=v.select("rect").each(g),(e?p.transition().duration(r.duration):p).attr("height",function(e){return e.added||e.deleted?0:l}).attr("width",function(e){return Math.abs(n.scale()(0)-n.scale()(e.targetValue))}).style("opacity",1),v.exit().remove(),v.call(k,e,x.dataLabelStyle())},m=function(e){return v.attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()}),k.brush(v)},x.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(w).scaleType("ordinal"),y=x.behavior().tooltip,h=x.behavior().selected,A.keyScale(f.y).valueScale(f.x).colorScale(f.color).value(function(e){return e.value}),y.on("enter."+d,A.enter),k.keyScale(f.y).valueScale(f.x)}),x.lifeCycle().on("brushDraw."+d,m),x.lifeCycle().on("animationStartState."+d,C),x.lifeCycle().on("animationEndState."+d,S),x.lifeCycle().on("destroy."+d,function(){return x.lifeCycle().on("."+d,null),y.on("."+d,null)}),s.$observe("padding",function(e){return w=t.parsePadding(e,w,r),f.y.rangePadding(w),x.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?x.showDataLabels(!1):("true"===e||""===e)&&x.showDataLabels("x"),x.lifeCycle().update()}),s.$observe("labelStyle",function(t){return t&&x.dataLabelStyle(e.$eval(t)),x.lifeCycle().update()}),s.$observe("barStyle",function(t){return t?u=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("barClustered",["$log","utils","barConfig","dataManagerFactory","tooltipHelperFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"^layout",link:function(o,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L;return x=c.me,d="clusteredBar"+i++,C=null,u={},m=void 0,v=0,g=0,p=0,w=_.clone(r,!0),L=n(),B=a(),S=!0,$=d3.layout.stack(),$.values(function(e){return e.values}).y(function(e){return e.layerDeleted||e.layerAdded||e.deleted||e.added?0:p}).x(function(e){return e.layerKey}),y=void 0,h=void 0,f={},D=function(e,t,r,n,a){var i;return L.keyScale(n).valueScale(r).data(e,!0),L.isInitial()?void 0:(i=L.animationStartLayers(),b.apply(this,[!1,i,t,r,n,a]))},A=function(e,t,r,n,a){var i;return i=L.animationEndLayers(),b.apply(this,[!0,i,t,r,n,a])},b=function(t,r,n,a,i,o){var l,s,c,d,f,k,b,x;return b=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=o.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},f=r.filter(function(e){return!e.added&&!e.deleted}).map(function(e){return e.layerKey}),c=i.scale().rangeBand(),m=d3.scale.ordinal().domain(f).rangeBands([0,c],0,0),p=m.rangeBand(),d=c/(1-w.paddingLeft)*w.paddingLeft,l=c/(1-w.outerPaddingLeft)*w.outerPaddingLeft,k=function(e){if(i.reverse()){if(e.deleted&&e.highBorder)return c+d/2;if(e.deleted)return-d/2;if(e.added&&e.atBorder)return c+d/2;if(e.added)return-d/2}else{if(e.deleted&&e.highBorder)return-d/2;if(e.deleted)return c+d/2;if(e.added&&e.atBorder)return-d/2;if(e.added)return c+d/2}return 0},x=$(r),e.log(x),C||(C=this.selectAll(".wk-chart-layer")),C=C.data(x,function(e){return e.layerKey}),C.enter().append("g").attr("class","wk-chart-layer"),C.exit().remove(),s=C.selectAll(".wk-chart-rect").data(function(e){return e.values},function(e){return e.layerKey+"|"+e.key}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).call(y.tooltip).call(h),s.each(b),(t?s.transition().duration(n.duration):s).attr("y",function(e){return i.scale()(e.targetKey)+e.y0+k(e)
}).attr("height",function(e){return e.y}).attr("width",function(e){return Math.abs(a.scale()(e.targetValue)||0)}).attr("x",function(e){return Math.min(a.scale()(0),a.scale()(e.targetValue))}).style("opacity",1),s.exit().remove(),S=!1,v=d,g=l},k=function(e,t){var r,n;return m.rangeBands([0,e.scale().rangeBand()],0,0),n=m.rangeBand(),r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("y",function(t){var r;return(r=e.scale()(t.targetKey))>=0?r+m(t.layerKey):-1e3}).attr("height",function(){return n}),B.brushRange(t)):void 0},x.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(w).scaleType("ordinal"),this.layerScale("color"),y=x.behavior().tooltip,y.on("enter."+d,B.enter),h=x.behavior().selected,B.keyScale(f.y).valueScale(f.x).colorScale(f.color).value(function(e){return e.value})}),x.lifeCycle().on("brushDraw."+d,k),x.lifeCycle().on("animationStartState."+d,D),x.lifeCycle().on("animationEndState."+d,A),x.lifeCycle().on("destroy."+d,function(){return x.lifeCycle().on("."+d,null),y.on("."+d,null)}),s.$observe("padding",function(e){return w=t.parsePadding(e,w,r),f.y.rangePadding(w),x.lifeCycle().update()}),s.$observe("barStyle",function(e){return e?u=o.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("barStacked",["$log","utils","barConfig","dataManagerFactory","tooltipHelperFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,o,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return v=s.me,u="stackedBar"+i++,m=null,h=void 0,d={},f=void 0,c={},p=_.clone(r,!0),S=n(),x=a(),b=d3.layout.stack(),b.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.targetValue}).x(function(e){return e.targetKey}),k=function(e,t,r,n,a){var i;return S.keyScale(n).valueScale(r).data(e,!0),S.isInitial()?void 0:(i=S.animationStartLayers(),g.apply(this,[!1,i,t,r,n,a]))},w=function(e,t,r,n,a){var i;return i=S.animationEndLayers(),g.apply(this,[!0,i,t,r,n,a])},g=function(e,t,r,n,a,i){var o,l,s,u,d,y;return d=function(e){var t,r,n;return r=d3.select(this),r.style(c),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},m||(m=this.selectAll(".wk-chart-layer")),l=a.scale().rangeBand()/(1-p.paddingLeft)*p.paddingLeft,y=b(t),m=m.data(y,function(e){return e.layerKey}),o=a.scale().rangeBand(),u=function(e){if(a.reverse()){if(e.deleted&&e.highBorder)return o+l/2;if(e.deleted)return-l/2;if(e.added&&e.atBorder)return o+l/2;if(e.added)return-l/2}else{if(e.deleted&&e.highBorder)return-l/2;if(e.deleted)return o+l/2;if(e.added&&e.atBorder)return-l/2;if(e.added)return o+l/2}return 0},m.enter().append("g").attr("class","wk-chart-layer"),m.exit().remove(),s=m.selectAll(".wk-chart-rect"),s=s.data(function(e){return e.values},function(e){return e.key.toString()+"|"+e.layerKey.toString()}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).style("opacity",0).call(h.tooltip).call(f),s.each(d),(e?s.transition().duration(r.duration):s).attr("x",function(e){return n.scale()(e.y0)}).attr("width",function(e){return n.scale()(e.y)}).attr("height",function(e){return e.added||e.deleted?0:o}).attr("y",function(e){return a.scale()(e.targetKey)+u(e)}).style("opacity",1),s.exit().remove()},y=function(e,t){var r;return r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("y",function(t){var r;return(r=e.scale()(t.key))>=0?r:-1e3}).attr("height",function(){return e.scale().rangeBand()}),x.brushRange(t)):void 0},v.lifeCycle().on("configure",function(){return d=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(p).scaleType("ordinal"),this.layerScale("color"),h=v.behavior().tooltip,f=v.behavior().selected,h.on("enter."+u,x.enter),x.keyScale(d.y).valueScale(d.x).colorScale(d.color).value(function(e){return e.value})}),v.lifeCycle().on("brushDraw."+u,y),v.lifeCycle().on("animationStartState."+u,k),v.lifeCycle().on("animationEndState."+u,w),v.lifeCycle().on("destroy."+u,function(){return v.lifeCycle().on("."+u,null),h.on("."+u,null)}),l.$observe("padding",function(e){return p=t.parsePadding(e,p,r),d.y.rangePadding(p),v.lifeCycle().update()}),l.$observe("barStyle",function(t){return t?c=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("boxPlot",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,n,a,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return w=c.me,d="boxPlot"+o++,u={},p=void 0,h=void 0,f={},y=!1,x=0,k=void 0,v=_.clone(r,!0),D=n(),b=a(),A=i(),C=function(e,t,r,n,a){return D.keyScale(r).valueScale(n).data(e,!0),D.isInitial()?void 0:(k=D.animationStartLayers(),m.apply(this,[!1,k,t,r,n,a]))},S=function(e,t,r,n,a){return b.active(y),k=D.animationEndLayers(),m.apply(this,[!0,k,t,r,n,a])},m=function(e,t,r,n,a,i){var o,l,s,c,d,f,y,g,m,w,k,b,S,C,D,$,B,L,M,O,K,P,V;for(L=function(e,t){return e.each(function(e){var r,n,a;return n=d3.select(this),n.style(u),a=i.scale()(e[t].property),"string"==typeof a?n.style({fill:a,stroke:a}):(r=a.color,a.fill=r,n.style(a))})},l=n.scale().rangeBand(),o=l/(1-v.paddingLeft)*v.paddingLeft,x=a.isOrdinal()?l/2:0,p&&(p.data(t),A.layout(t)),x=function(e){return e.deleted&&e.atBorder?l:e.deleted?-o/2:e.added&&e.atBorder?l+o/2:e.added?-o/2:0},B=[],d=0,O=!1,M=!1,3===t.length?D=["lq","med","uq"]:5===t.length&&(D=["min","lq","med","uq","max"],O=M=!0),m=a.property();d<t[0].values.length;){for($={},$.key=t[0].values[d].key,$.targetKey=t[0].values[d].targetKey,$.data=t[0].values[d].data,$.added=t[0].values[d].added,$.deleted=t[0].values[d].deleted,f=y=0,w=D.length;w>y;f=++y)C=D[f],$[C]={},$[C].val=t[f].values[d].targetValue,$[C].property=m[f];B.push($),d++}return s=this.selectAll(".wk-chart-box").data(B,function(e){return e.key}),c=s.enter().append("g").attr("class","wk-chart-box wk-chart-selectable").attr("transform",function(e){return"translate("+(n.scale()(e.targetKey)+x(e))+")"}).classed("wk-chart-hidden",!0).style("opacity",0).call(h),c.append("rect").attr("class","wk-chart-box-uq wk-chart-selectable").classed("wk-chart-hidden",!0).style("opacity",0).style("fill","white").style("stroke","black").call(p.tooltip),c.append("rect").attr("class","wk-chart-box-lq  wk-chart-selectable").classed("wk-chart-hidden",!0).style("opacity",0).style("fill","white").style("stroke","black").call(p.tooltip),c.append("line").attr("class","wk-chart-box-med").classed("wk-chart-hidden",!0).style({opacity:0}),c.append("line").attr("class","wk-chart-box-lw").classed("wk-chart-hidden",!0).style({opacity:0}),c.append("line").attr("class","wk-chart-box-lw-conn").classed("wk-chart-hidden",!0).style({opacity:0,"stroke-dasharray":"2.2"}),c.append("line").attr("class","wk-chart-box-uw").classed("wk-chart-hidden",!0).style({stroke:"black",opacity:0}),c.append("line").attr("class","wk-chart-box-uw-conn").classed("wk-chart-hidden",!0).style({opacity:0,"stroke-dasharray":"2.2"}),(e?s.transition().duration(r.duration):s).attr("transform",function(e){return"translate("+(n.scale()(e.targetKey)+x(e))+")"}).style("opacity",function(e){return e.deleted?0:1}),P=s.select(".wk-chart-box-uq").call(L,"uq"),(e?P.transition().duration(r.duration):P).attr("y",function(e){return a.scale()(e.uq.val)}).attr("height",function(e){return Math.abs(a.scale()(e.uq.val)-a.scale()(e.med.val))}).attr("width",function(e){return e.added||e.deleted?0:l}).style("opacity",1),k=s.select(".wk-chart-box-lq").call(L,"lq"),(e?k.transition().duration(r.duration):k).attr("y",function(e){return a.scale()(e.med.val)}).attr("height",function(e){return Math.abs(a.scale()(e.med.val)-a.scale()(e.lq.val))}).attr("width",function(e){return e.added||e.deleted?0:l}).style("opacity",1),S=s.select(".wk-chart-box-med").call(L,"med"),(e?S.transition().duration(r.duration):S).attr("x1",.2*-l).attr("x2",function(e){return e.added||e.deleted?0:1.3*l}).attr("y1",function(e){return a.scale()(e.med.val)}).attr("y2",function(e){return a.scale()(e.med.val)}).style({opacity:1,"stroke-width":2}),g=s.select(".wk-chart-box-lw").call(L,"min"),(e?g.transition().duration(r.duration):g).attr("x1",0).attr("x2",function(e){return e.added||e.deleted?0:l}).attr("y1",function(e){return O?a.scale()(e.min.val):0}).attr("y2",function(e){return O?a.scale()(e.min.val):0}).style({opacity:1,"stroke-width":3}).style("visibility",O?"visible":"none"),b=s.select(".wk-chart-box-lw-conn"),(e?b.transition().duration(r.duration):b).attr("x1",function(e){return e.added||e.deleted?0:l/2}).attr("x2",function(e){return e.added||e.deleted?0:l/2}).attr("y1",function(e){return O?a.scale()(e.lq.val):0}).attr("y2",function(e){return O?a.scale()(e.min.val):0}).style("opacity",1).style("stroke","black").style("visibility",O?"visible":"none"),K=s.select(".wk-chart-box-uw").call(L,"max"),(e?K.transition().duration(r.duration):K).attr("x1",0).attr("x2",function(e){return e.added||e.deleted?0:l}).attr("y1",function(e){return M?a.scale()(e.max.val):0}).attr("y2",function(e){return M?a.scale()(e.max.val):0}).style({opacity:1,"stroke-width":3}).style("visibility",M?"visible":"none"),V=s.select(".wk-chart-box-uw-conn"),(e?V.transition().duration(r.duration):V).attr("x1",function(e){return e.added||e.deleted?0:l/2}).attr("x2",function(e){return e.added||e.deleted?0:l/2}).attr("y1",function(e){return M?a.scale()(e.uq.val):0}).attr("y2",function(e){return M?a.scale()(e.max.val):0}).style("opacity",1).style("stroke","black").style("visibility",M?"visible":"none"),s.exit().remove()},g=function(e){return this.selectAll(".wk-chart-rect").attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.targetKey))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()})},w.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(v).scaleType("ordinal"),p=w.behavior().tooltip,A.keyScale(f.x).valueScale(f.y).colorScale(f.color).value(function(e){return e.value}),h=w.behavior().selected,p.on("enter."+d,A.enter)}),w.lifeCycle().on("brushDraw."+d,g),w.lifeCycle().on("animationStartState."+d,C),w.lifeCycle().on("animationEndState."+d,S),w.lifeCycle().on("destroy."+d,function(){return w.lifeCycle().on("."+d,null),p.on("."+d,null)}),s.$observe("padding",function(e){return v=t.parsePadding(e,v,r),f.x.rangePadding(v),w.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?w.showDataLabels(!1):("true"===e||""===e)&&w.showDataLabels("y"),w.lifeCycle().update()}),s.$observe("boxStyle",function(t){return t?u=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("bubble",["$log","utils",function(){var e;return e=0,{restrict:"A",require:"layout",link:function(t,r,n,a){var i,o,l,s,c,u,d;return u=a.me,s=void 0,o={},i="bubble"+e++,l=void 0,d=function(e){var t,r,n;t=[];for(r in o)n=o[r],t.push(this.layers[n.axisLabel()]={value:n.formattedValue(e),color:"color"===r?{fill:"string"==typeof n.map(e)?n.map(e):n.map(e).color}:{fill:"none"}});return t},c=function(e,t,r,n,a,i){var o,c;return c=function(e){var t,r,n;return r=d3.select(this),n=a.map(e),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},o=this.selectAll(".wk-chart-bubble").data(e,function(e){return a.value(e)}),o.enter().append("circle").attr("class","wk-chart-bubble wk-chart-selectable").style("opacity",0).call(s.tooltip).call(l),o.each(c).transition().duration(t.duration).attr({r:function(e){return i.map(e)},cx:function(e){return r.map(e)},cy:function(e){return n.map(e)}}).style("opacity",1),o.exit().transition().duration(t.duration).style("opacity",0).remove()},u.lifeCycle().on("configure",function(){return o=this.getScales(["x","y","color","size"]),this.getKind("y").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0),s=u.behavior().tooltip,l=u.behavior().selected,s.on("enter."+i,d)}),u.lifeCycle().on("drawChart."+i,c),u.lifeCycle().on("destroy."+i,function(){return u.lifeCycle().on("."+i,null),s.on("."+i,null)})}}}]),angular.module("wk.chart").directive("column",["$log","utils","barConfig","dataManagerFactory","dataLabelFactory","tooltipHelperFactory",function(e,t,r,n,a,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C;return k=c.me,d="column"+o++,g=null,f={},h=void 0,v=_.clone(r,!0),C=n(),S=i(),m=a(),y=void 0,u={"stroke-width":1},x=function(e,t,r,n,a){var i;return C.keyScale(r).valueScale(n).data(e,!0),C.isInitial()?void 0:(i=C.animationStartLayers(),w.apply(this,[!1,i,t,r,n,a]))},b=function(e,t,r,n,a){var i;return i=C.animationEndLayers(),m.duration(t.duration).active(k.showDataLabels()),w.apply(this,[!0,i,t,r,n,a])},w=function(e,t,r,n,a,i){var o,l,s,c,d,f,p;return p=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=0===i.property().length?i.scale()(e.layerKey):i.map(e.data),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},o=!i.property()&&i.isOrdinal(),S.colorByKey(o),g||(g=this.selectAll(".wk-chart-layer")),s=n.scale().rangeBand(),l=s/(1-v.paddingLeft)*v.paddingLeft,d=function(e){if(n.reverse()){if(e.deleted&&e.highBorder)return-l/2;if(e.deleted)return s+l/2;if(e.added&&e.atBorder)return-l/2;if(e.added)return s+l/2}else{if(e.deleted&&e.highBorder)return s;if(e.deleted)return-l/2;if(e.added&&e.atBorder)return s+l/2;if(e.added)return-l/2}return 0},g=g.data(t[0].values,function(e){return e.key}),c=g.enter().append("g").attr("class","wk-chart-layer").attr("transform",function(e){return"translate("+n.scale()(e.targetKey)+")"}),c.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("width",function(e){return e.added||e.deleted?0:s}).style("opacity",0).call(y.tooltip).call(h),(e?g.transition().duration(r.duration):g).attr("transform",function(e){return"translate("+(n.scale()(e.targetKey)+d(e))+")"}),f=g.select("rect").each(p),(e?f.transition().duration(r.duration):f).attr("width",function(e){return e.added||e.deleted?0:s}).attr("height",function(e){return Math.abs(a.scale()(0)-a.scale()(e.targetValue))}).attr("y",function(e){return Math.min(a.scale()(0),a.scale()(e.targetValue))}).style("opacity",1),g.call(m,e,k.dataLabelStyle()),g.exit().remove()},p=function(e){return g.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("width",function(){return e.scale().rangeBand()}),m.brush(g)},k.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(v).scaleType("ordinal"),y=k.behavior().tooltip,h=k.behavior().selected,S.keyScale(f.x).valueScale(f.y).colorScale(f.color).value(function(e){return e.value}),m.keyScale(f.x).valueScale(f.y),y.on("enter."+d,S.enter)}),k.lifeCycle().on("brushDraw."+d,p),k.lifeCycle().on("animationStartState."+d,x),k.lifeCycle().on("animationEndState."+d,b),k.lifeCycle().on("destroy."+d,function(){return k.lifeCycle().on("."+d,null),y.on("."+d,null)}),s.$observe("padding",function(e){return v=t.parsePadding(e,v,r),f.x.rangePadding(v),k.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?k.showDataLabels(!1):("true"===e||""===e)&&k.showDataLabels("y"),k.lifeCycle().update()}),s.$observe("labelStyle",function(t){return t&&k.dataLabelStyle(e.$eval(t)),k.lifeCycle().update()}),s.$observe("columnStyle",function(t){return t?u=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("columnClustered",["$log","utils","barConfig","dataManagerFactory","tooltipHelperFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"^layout",link:function(o,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L;return x=c.me,d="clusteredColumn"+i++,u={},C=null,m=void 0,g=0,p=0,v=0,w=_.clone(r,!0),L=n(),B=a(),S=!0,$=d3.layout.stack(),$.values(function(e){return e.values}).y(function(e){return e.layerDeleted||e.layerAdded||e.deleted||e.added?0:v}).x(function(e){return e.layerKey}),y=void 0,h=void 0,f={},D=function(e,t,r,n,a){var i;return L.keyScale(r).valueScale(n).data(e,!0),L.isInitial()?void 0:(i=L.animationStartLayers(),b.apply(this,[!1,i,t,r,n,a]))},A=function(e,t,r,n,a){var i;return i=L.animationEndLayers(),b.apply(this,[!0,i,t,r,n,a])},b=function(t,r,n,a,i,o){var l,s,c,d,f,k,b,x;return b=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=o.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},f=r.filter(function(e){return!e.added&&!e.deleted}).map(function(e){return e.layerKey}),d=a.scale().rangeBand(),m=d3.scale.ordinal().domain(f).rangeBands([0,d],0,0),v=m.rangeBand(),c=d/(1-w.paddingLeft)*w.paddingLeft,l=d/(1-w.outerPaddingLeft)*w.outerPaddingLeft,k=function(e){if(a.reverse()){if(e.deleted&&e.highBorder)return c/2;if(e.deleted)return d+c/2;if(e.added&&e.atBorder)return c/2;if(e.added)return d+c/2}else{if(e.deleted&&e.highBorder)return d;if(e.deleted)return 0-c/2;if(e.added&&e.atBorder)return d+c/2;if(e.added)return 0-c/2}return 0},x=$(r),e.log(x),C||(C=this.selectAll(".wk-chart-layer")),C=C.data(x,function(e){return e.layerKey}),C.enter().append("g").attr("class","wk-chart-layer"),C.exit().remove(),s=C.selectAll(".wk-chart-rect").data(function(e){return e.values},function(e){return e.layerKey+"|"+e.key}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).call(y.tooltip).call(h),s.each(b),(t?s.transition().duration(n.duration):s).attr("x",function(e){return a.scale()(e.targetKey)+e.y0+k(e)}).attr("width",function(e){return e.y}).attr("height",function(e){return Math.abs(i.scale()(0)-i.scale()(e.targetValue))}).attr("y",function(e){return Math.min(i.scale()(0),i.scale()(e.targetValue))}).style("opacity",1),s.exit().remove(),S=!1,g=c,p=l},k=function(e,t){var r,n;return m.rangeBands([0,e.scale().rangeBand()],0,0),n=m.rangeBand(),r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("x",function(t){var r;return(r=e.scale()(t.targetKey))>=0?r+m(t.layerKey):-1e3}).attr("width",function(){return n}),B.brushRange(t)):void 0},x.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(w).scaleType("ordinal"),this.layerScale("color"),y=x.behavior().tooltip,y.on("enter."+d,B.enter),h=x.behavior().selected,B.keyScale(f.x).valueScale(f.y).colorScale(f.color).value(function(e){return e.value})}),x.lifeCycle().on("brushDraw."+d,k),x.lifeCycle().on("animationStartState."+d,D),x.lifeCycle().on("animationEndState."+d,A),x.lifeCycle().on("destroy."+d,function(){return x.lifeCycle().on("."+d,null),y.on("."+d,null)}),s.$observe("padding",function(e){return w=t.parsePadding(e,w,r),f.x.rangePadding(w),x.lifeCycle().update()}),s.$observe("columnStyle",function(e){return e?u=o.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("columnStacked",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,n,a,i){var o;return o=0,{restrict:"A",require:"layout",link:function(e,a,l,s){var c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return v=s.me,u="stackedColumn"+o++,m=null,c={},h=void 0,d={},f=void 0,p=_.clone(r,!0),S=n(),x=i(),b=d3.layout.stack(),b.values(function(e){return e.values}).y(function(e){return e.layerAdded||e.layerDeleted?0:e.targetValue}).x(function(e){return e.targetKey}),k=function(e,t,r,n,a){var i;return S.keyScale(r).valueScale(n).data(e,!0),S.isInitial()?void 0:(i=S.animationStartLayers(),g.apply(this,[!1,i,t,r,n,a]))},w=function(e,t,r,n,a){var i;return i=S.animationEndLayers(),g.apply(this,[!0,i,t,r,n,a])},g=function(e,t,r,n,a,i){var o,l,s,u,d,y;return d=function(e){var t,r,n;return r=d3.select(this),r.style(c),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},l=n.scale().rangeBand(),o=l/(1-p.paddingLeft)*p.paddingLeft,u=function(e){if(n.reverse()){if(e.deleted&&e.highBorder)return-o/2;if(e.deleted)return l+o/2;if(e.added&&e.atBorder)return-o/2;if(e.added)return l+o/2}else{if(e.deleted&&e.highBorder)return l;if(e.deleted)return-o/2;if(e.added&&e.atBorder)return l+o/2;if(e.added)return-o/2}return 0},m||(m=this.selectAll(".wk-chart-layer")),y=b(t),m=m.data(y,function(e){return e.layerKey}),m.enter().append("g").attr("class","wk-chart-layer"),m.exit().remove(),s=m.selectAll(".wk-chart-rect"),s=s.data(function(e){return e.values},function(e){return e.key.toString()+"|"+e.layerKey.toString()}),s.enter().append("rect").attr("class","wk-chart-rect wk-chart-selectable").style("opacity",0).call(h.tooltip).call(f),s.each(d),(e?s.transition().duration(r.duration):s).attr("y",function(e){return a.scale()(e.y0+e.y)}).attr("height",function(e){return a.scale()(0)-a.scale()(e.y)}).attr("width",function(e){return e.added||e.deleted?0:l}).attr("x",function(e){return n.scale()(e.targetKey)+u(e)}).style("opacity",1),s.exit().remove()},y=function(e,t){var r;return r=this.selectAll(".wk-chart-rect"),e.isOrdinal()?(r.attr("x",function(t){var r;return(r=e.scale()(t.key))>=0?r:-1e3}).attr("width",function(){return e.scale().rangeBand()}),x.brushRange(t)):void 0},v.lifeCycle().on("configure",function(){return d=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(p).scaleType("ordinal"),this.layerScale("color"),h=v.behavior().tooltip,f=v.behavior().selected,h.on("enter."+u,x.enter),x.keyScale(d.x).valueScale(d.y).colorScale(d.color).value(function(e){return e.value})}),v.lifeCycle().on("brushDraw."+u,y),v.lifeCycle().on("animationStartState."+u,k),v.lifeCycle().on("animationEndState."+u,w),v.lifeCycle().on("destroy."+u,function(){return v.lifeCycle().on("."+u,null),h.on("."+u,null)}),l.$observe("padding",function(e){return p=t.parsePadding(e,p,r),d.x.rangePadding(p),v.lifeCycle().update()}),l.$observe("columnStyle",function(t){return t?c=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("gauge",["$log","utils",function(e,t){return{restrict:"A",require:"^layout",controller:["$scope","$attrs",function(e,r){var n;return n={chartType:"GaugeChart",id:t.getId()},r.$set("chart-id",n.id),n}],link:function(t,r,n,a){var i,o,l;return l=a.me,o=!0,i=function(t,r,n,a,i){var l,s,c,u,d,f,h,y,p,g;for(e.info("drawing Gauge Chart"),u=[t],g=a.scale().domain(),c=angular.copy(i.scale().domain()),c.unshift(g[0]),c.push(g[1]),y=[],d=f=1,p=c.length-1;p>=1?p>=f:f>=p;d=p>=1?++f:--f)y.push({from:+c[d-1],to:+c[d]});return s=this.selectAll(".wk-chart-bar"),s=s.data(y,function(e,t){return t}),o?s.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50).style("opacity",0):s.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50),s.transition().duration(r.duration).attr("height",function(e){return a.scale()(0)-a.scale()(e.to-e.from)}).attr("y",function(e){return a.scale()(e.to)}).style("fill",function(e){return i.scale()(e.from)}).style("opacity",1),s.exit().remove(),l=function(e){return e.append("rect").attr("width",55).attr("height",4).style("fill","black"),e.append("circle").attr("r",10).attr("cx",65).attr("cy",2).style("stroke","black")},h=this.selectAll(".wk-chart-marker"),h=h.data(u,function(){return"wk-chart-marker"}),h.enter().append("g").attr("class","wk-chart-marker").call(l),o&&h.attr("transform",function(e){return"translate(0,"+a.scale()(e.value)+")"}).style("opacity",0),h.transition().duration(r.duration).attr("transform",function(e){return"translate(0,"+a.scale()(e.value)+")"}).style("fill",function(e){return i.scale()(e.value)}).style("opacity",1),o=!1},l.lifeCycle().on("configure",function(){return this.requiredScales(["y","color"]),this.getKind("color").resetOnNewData(!0)}),l.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("geoMap",["$log","utils",function(e){var t,r;return t=0,r=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),t=t.map(function(e){return isNaN(e)?e:+e}),1===t.length?t[0]:t):void 0},{restrict:"A",require:"layout",scope:{geojson:"=",projection:"="},link:function(r,n,a,i){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return b=i.me,v=void 0,g=void 0,p={},c="geoMap"+t++,o=d3.map(),y=1,h=[0,0],u="",S=function(e){var t,r;return r=o.get(e.properties[u[0]]),t=p.color.map(r),this.layers[r.RS]={value:r.DES,color:{fill:"string"==typeof t?t:t.color}}},x=[],f=d3.geo.orthographic(),m=0,s=0,d=void 0,w=d3.geo.zoom().projection(f).on("zoom.redraw",function(){return d3.event.sourceEvent.preventDefault(),x.attr("d",d)}),l=void 0,k=function(e,t,r,n,a){var i,c,h,y;if(y=function(e){var t,r,n,i;return r=d3.select(this),i=o.get(e.properties[u[0]]),n=a.map(i),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},m=t.width,s=t.height,e&&e[0].hasOwnProperty(u[1]))for(c=0,h=e.length;h>c;c++)i=e[c],o.set(i[u[1]],i);return l?(f.translate([m/2,s/2]),x=this.selectAll("path").data(l.features,function(e){return e.properties[u[0]]}),x.enter().append("svg:path").style("fill","lightgrey").style("stroke","darkgrey").call(v.tooltip).call(g).call(w),x.attr("d",d).each(y),x.exit().remove()):void 0},b.lifeCycle().on("configure",function(){return p=this.getScales(["color"]),p.color.resetOnNewData(!0)}),b.lifeCycle().on("drawChart",k),v=b.behavior().tooltip,g=b.behavior().selected,v.on("enter."+c,S),b.lifeCycle().on("destroy."+c,function(){return b.lifeCycle().on("."+c,null),v.on("."+c,null),r.$destroy()}),r.$watch("projection",function(t){return void 0!==t&&(e.log("setting Projection params",t),d3.geo.hasOwnProperty(t.projection))?(f=d3.geo[t.projection](),f.center(t.center).scale(t.scale).rotate(t.rotate).clipAngle(t.clipAngle),u=t.idMap,f.parallels&&f.parallels(t.parallels),y=f.scale(),h=f.rotate(),d=d3.geo.path().projection(f),w.projection(f),b.lifeCycle().update()):void 0},!0),r.$watch("geojson",function(e){return void 0!==e&&""!==e?(l=e,b.lifeCycle().update()):void 0})}}}]),angular.module("wk.chart").directive("columnHistogramOld",["$log","barConfig","utils","wkChartMargins",function(e,t,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(e,i,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k;return v=l.me,s="histogram"+a++,u={},y=void 0,w=void 0,p={},f=void 0,d=void 0,p=_.clone(t,!0),c=r.mergeData().key(function(e){return e.xVal}),m=!0,f=void 0,k=function(e){var t,r,n;return this.headerName=u.rangeX.axisLabel(),this.headerValue=u.y.axisLabel(),t=u.rangeX.formatValue(u.rangeX.lowerValue(e.data)),u.rangeX.upperProperty()?(n=u.rangeX.formatValue(u.rangeX.upperValue(e.data)),r=t+" - "+n):r=u.rangeX.formatValue(u.rangeX.lowerValue(e.data)),this.layers.push({name:r,value:u.y.formattedValue(e.data),color:{"background-color":u.color.map(e.data)}})},g=function(e,t,r,a,i,o,l,s){var u,h,p,g,w;return s.upperProperty()?h=e.map(function(e){return{x:s.scale()(s.lowerValue(e)),xVal:s.lowerValue(e),width:s.scale()(s.upperValue(e))-s.scale()(s.lowerValue(e)),y:a.map(e),height:t.height-a.map(e),color:i.map(e),data:e}}):e.length>0&&(p=s.lowerValue(e[0]),g=s.lowerValue(e[1])-p,w=t.width/e.length,h=e.map(function(e,r){return{x:s.scale()(p+g*r),xVal:s.lowerValue(e),width:w,y:a.map(e),height:t.height-a.map(e),color:i.map(e),data:e}})),c(h).first({x:0,width:0}).last({x:t.width,width:0}),y||(y=this.selectAll(".wk-chart-bucket")),y=y.data(h,function(e){return e.xVal}),u=y.enter().append("g").attr("class","wk-chart-bucket").attr("transform",function(e){return"translate("+(m?e.x:c.addedPred(e).x+c.addedPred(e).width)+","+e.y+") scale("+(m?1:0)+",1)"}),u.append("rect").attr("class","wk-chart-selectable").attr("height",function(e){return e.height}).attr("width",function(e){return e.width}).style("fill",function(e){return e.color}).style("opacity",m?0:1).call(f.tooltip).call(d),u.append("text").attr("class","wk-chart-data-label").attr("x",function(e){return e.width/2}).attr("y",-n.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),y.transition().duration(t.duration).attr("transform",function(e){return"translate("+e.x+", "+e.y+") scale(1,1)"}),y.select("rect").transition().duration(t.duration).attr("width",function(e){return e.width}).attr("height",function(e){return e.height}).style("fill",function(e){return e.color}).style("opacity",1),y.select("text").text(function(e){return a.formattedValue(e.data)}).transition().duration(t.duration).attr("x",function(e){return e.width/2}).style("opacity",v.showDataLabels()?1:0),y.exit().transition().duration(t.duration).attr("transform",function(e){return"translate("+c.deletedSucc(e).x+","+e.y+") scale(0,1)"}).remove(),m=!1},h=function(e,t,r){var n;return n=function(e,n){return e.upperProperty()?e.scale()(e.upperValue(n.data))-e.scale()(e.lowerValue(n.data)):r/Math.max(t[1]-t[0]+1,1)},y.attr("transform",function(t){var r;return"translate("+((r=e.scale()(t.xVal))>=0?r:-1e3)+", "+t.y+")"}),y.select("rect").attr("width",function(t){return n(e,t)}),y.selectAll("text").attr("x",function(t){return n(e,t)/2})},v.lifeCycle().on("configure",function(){return u=this.getScales(["rangeX","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("rangeX").resetOnNewData(!0).scaleType("linear").domainCalc("rangeExtent"),this.getKind("color").resetOnNewData(!0),f=v.behavior().tooltip,d=v.behavior().selected,f.on("enter."+s,k)}),v.lifeCycle().on("drawChart",g),v.lifeCycle().on("brushDraw",h),o.$observe("labels",function(e){return"false"===e?v.showDataLabels(!1):("true"===e||""===e)&&v.showDataLabels("y"),v.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("line",["$log","behavior","utils","dataManagerFactory","tooltipHelperFactory","markerFactory","timing",function(e,t,r,n,a,i,o){var l;return l=0,{restrict:"A",require:"layout",link:function(t,r,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return m=c.me,p=void 0,h=!1,y=!1,d={"stroke-width":1},f={},x=0,u="line"+l++,k=void 0,b=void 0,w=void 0,D=n(),b=i(),A=a(),C=function(e,t,r,n,a){return o.init(),o.start("chart"),D.keyScale(r).valueScale(n).data(e),D.isInitial()?void 0:(w=D.animationStartLayers(),v.apply(this,[!1,w,t,r,n,a]))},S=function(e,t,r,n,a){return b.active(h),w=D.animationEndLayers(),v.apply(this,[!0,w,t,r,n,a]),o.stop("chart"),o.report()},v=function(t,r,n,a,i,o){var l,s,c,u,f;return f=function(e){var t,r,n;return r=d3.select(this),r.style(d),n=o.scale()(e.layerKey),"string"==typeof n?r.style({stroke:n}):(t=n.color,n.stroke=t,r.style(n))},e.debug("data",r),x=a.isOrdinal()?a.scale().rangeBand()/2:0,p&&(p.data(r),A.layout(r)),c=n.width/r[0].values.length*2,k=d3.svg.line().y(function(e){return i.scale()(e.layerAdded||e.layerDeleted?0:e.value)}),y&&k.interpolate("cardinal"),k.x(a.isOrdinal()?function(e){return(e.highBorder?n.width+c:e.lowBorder?-c:a.scale()(e.targetKey))+x}:function(e){return a.scale()(e.targetKey)}),s=this.selectAll(".wk-chart-layer").data(r,function(e){return e.layerKey}),l=s.enter().append("g").attr("class","wk-chart-layer"),l.append("path").attr("class","wk-chart-line").attr("d",function(e){return k(e.values)}).style("opacity",0).style("pointer-events","none"),u=s.select(".wk-chart-line"),u.each(f),(t?u.transition().duration(n.duration):u).attr("d",function(e){return k(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}).style("pointer-events","none"),s.exit().remove(),b.y(function(e){return i.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).color(function(e){var t;return t=o.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(a.scale()),b.x(a.isOrdinal()?function(e){return e.highBorder?n.width+c:e.lowBorder?-c:a.scale()(e.targetKey)+a.scale().rangeBand()/2}:function(e){return a.scale()(e.targetKey)}),s.call(b,t)},g=function(e,t){var r;return r=this.selectAll(".wk-chart-line"),e.isOrdinal()?(r.attr("d",function(e){return k(e.values.slice(t[0],t[1]+1))
}).attr("transform","translate("+e.scale().rangeBand()/2+")"),b.brush(this,t),A.brushRange(t)):(r.attr("d",function(e){return k(e.values)}),b.brush(this))},m.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),p=m.behavior().tooltip,A.keyScale(f.x).valueScale(f.y).colorScale(f.color).value(function(e){return e.value}),p.markerScale(f.x),p.on("enter."+u,A.enter),p.on("moveData."+u,A.moveData),p.on("moveMarker."+u,A.moveMarkers)}),m.lifeCycle().on("brushDraw."+u,g),m.lifeCycle().on("animationStartState."+u,C),m.lifeCycle().on("animationEndState."+u,S),m.lifeCycle().on("destroy."+u,function(){return m.lifeCycle().on("."+u,null),p.on("."+u,null)}),s.$observe("markers",function(e){return h=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),s.$observe("spline",function(e){return y=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),s.$observe("lineStyle",function(e){return e?d=t.$eval(e):void 0})}}}]),angular.module("wk.chart").directive("lineVertical",["$log","utils","tooltipHelperFactory","dataManagerFactory","markerFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return v=l.me,p=0,h=void 0,d=!1,f=!1,u={},b=0,s="lineVertical"+i++,m=void 0,w=void 0,c={},A=n(),k=a(),C=r(),S=function(e,t,r,n,a){return A.keyScale(n).valueScale(r).data(e),A.isInitial()?void 0:(m=A.animationStartLayers(),g.apply(this,[!1,m,t,r,n,a]))},x=function(e,t,r,n,a){return k.active(d),m=A.animationEndLayers(),g.apply(this,[!0,m,t,r,n,a])},g=function(e,t,r,n,a,i){var o,l,s,u,d;return d=function(e){var t,r,n;return r=d3.select(this),r.style(c),n=i.scale()(e.layerKey),"string"==typeof n?r.style({stroke:n}):(t=n.color,n.stroke=t,r.style(n))},b=a.isOrdinal()?a.scale().rangeBand()/2:0,h&&(h.data(t),C.layout(t)),s=r.height/t[0].values.length*2,w=d3.svg.line().x(function(e){return n.scale()(e.layerAdded||e.layerDeleted?0:e.value)}),f&&w.interpolate("cardinal"),w.y(a.isOrdinal()?function(e){return e.lowBorder?r.height+s:e.highBorder?-s:a.scale()(e.targetKey)}:function(e){return a.scale()(e.targetKey)}),l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),o=l.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-line").attr("d",function(e){return w(e.values)}).style("opacity",0).style("pointer-events","none").style("stroke",function(e){return i.scale()(e.layerKey)}),u=l.select(".wk-chart-line").attr("transform","translate(0,"+b+")"),u.each(d),(e?u.transition().duration(r.duration):u).attr("d",function(e){return w(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}).style("pointer-events","none"),l.exit().remove(),k.isVertical(!0).x(function(e){return n.scale()(e.layerAdded||e.layerDeleted?0:e.value)}).color(function(e){var t;return t=i.scale()(e.layerKey),"string"==typeof t?t:t.color}).keyScale(a.scale()),k.y(a.isOrdinal()?function(e){return e.lowBorder?r.height+s:e.highBorder?-s:a.scale()(e.targetKey)+a.scale().rangeBand()/2}:function(e){return a.scale()(e.targetKey)}),l.call(k,e)},y=function(e,t){var r;return r=this.selectAll(".wk-chart-line"),e.isOrdinal()?(r.attr("d",function(e){return w(e.values.slice(t[0],t[1]+1))}).attr("transform","translate(0,"+e.scale().rangeBand()/2+")"),k.brush(this,t),C.brushRange(t)):(r.attr("d",function(e){return w(e.value)}),k.brush(this))},v.lifeCycle().on("configure",function(){return u=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),h=v.behavior().tooltip,C.keyScale(u.y).valueScale(u.x).colorScale(u.color).value(function(e){return e.value}),h.markerScale(u.y),h.on("enter."+s,C.enter),h.on("moveData."+s,C.moveData),h.on("moveMarker."+s,C.moveMarkers)}),v.lifeCycle().on("brushDraw."+s,y),v.lifeCycle().on("animationStartState."+s,S),v.lifeCycle().on("animationEndState."+s,x),v.lifeCycle().on("destroy."+s,function(){return v.lifeCycle().on("."+s,null),h.on("."+s,null)}),o.$observe("markers",function(e){return d=""===e||"true"===e?!0:!1,v.lifeCycle().update()}),o.$observe("spline",function(e){return f=""===e||"true"===e?!0:!1,v.lifeCycle().update()}),o.$observe("lineStyle",function(t){return t?c=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("pie",["$log","utils",function(e,t){var r;return r=0,{restrict:"EA",require:"^layout",link:function(e,n,a,i){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$;return b=i.me,l="pie"+r++,w=void 0,x=void 0,k=void 0,s=void 0,u=void 0,S=void 0,C=void 0,d=[],f=void 0,y=void 0,h=!1,o=!1,D=0,p=0,c=t.mergeData(),$=function(e){var t,r;return this.headerName=d.y.axisLabel(),this.headerValue=d.size.axisLabel(),r={},r.value=d.size.formattedValue(e),t=d.color.map(e),r.color="string"==typeof t?{fill:t,stroke:t}:t,this.layers[r.value]=r},m=!0,g=function(e,t,r,n,a,i){var l,s,g,v,x,A,$,B,L,M,O;return O=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=a.map(e.data),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},p=t.duration,L=Math.min(t.width,t.height)/2,D=.06*L,S||(S=this.append("g").attr("class","wk-chart-pieBox")),S.attr("transform","translate("+t.width/2+","+t.height/2+")"),$=L*(h?.8:.9),g=$*(o?.6:0),s=d3.svg.arc().outerRadius($).innerRadius(g),A=d3.svg.arc().outerRadius(.9*L).innerRadius(.9*L),v=function(e){return d.y.value(e.data)},B=d3.layout.pie().sort(null).value(i.value),l=function(e){var t;return t=d3.interpolate(this._current,e),this._current=t(0),function(e){return s(t(e))}},M=B(e),c.key(v),c(M).first({startAngle:0,endAngle:0}).last({startAngle:2*Math.PI,endAngle:2*Math.PI}),w||(w=S.selectAll(".wk-chart-innerArc")),w=w.data(M,v),w.enter().append("path").each(function(e){return this._current=m?e:{startAngle:c.addedPred(e).endAngle,endAngle:c.addedPred(e).endAngle}}).attr("class","wk-chart-innerArc wk-chart-selectable").call(y.tooltip).call(f),w.each(O).transition().duration(t.duration).attrTween("d",l),w.exit().datum(function(e){return{startAngle:c.deletedSucc(e).startAngle,endAngle:c.deletedSucc(e).startAngle}}).transition().duration(t.duration).attrTween("d",l).remove(),x=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},h?(k=S.selectAll(".wk-chart-data-label").data(M,v),k.enter().append("text").attr("class","wk-chart-data-label").each(function(e){return this._current=e}).attr("dy",".35em").style(b.dataLabelStyle()).style("opacity",0).text(function(e){return i.formattedValue(e.data)}),k.transition().duration(t.duration).style("opacity",1).text(function(e){return i.formattedValue(e.data)}).attrTween("transform",function(e){var t,r;return t=this,r=d3.interpolate(t._current,e),function(e){var n,a;return n=r(e),t._current=n,a=A.centroid(n),a[0]+=15*(x(n)<Math.PI?1:-1),"translate("+a+")"}}).styleTween("text-anchor",function(e){var t;return t=d3.interpolate(this._current,e),function(e){var r;return r=t(e),x(r)<Math.PI?"start":"end"}}),k.exit().transition().duration(t.duration).style("opacity",0).remove(),C=S.selectAll(".wk-chart-polyline").data(M,v),C.enter().append("polyline").attr("class","wk-chart-polyline").style("opacity",0).style("pointer-events","none").each(function(e){return this._current=e}),C.transition().duration(t.duration).style("opacity",function(e){return 0===e.data.value?0:.5}).attrTween("points",function(e){var t,r;return this._current=this._current,r=d3.interpolate(this._current,e),t=this,function(e){var n,a;return n=r(e),t._current=n,a=A.centroid(n),a[0]+=10*(x(n)<Math.PI?1:-1),[s.centroid(n),A.centroid(n),a]}}),C.exit().transition().duration(t.duration).style("opacity",0).remove()):(S.selectAll(".wk-chart-polyline").remove(),S.selectAll(".wk-chart-data-label").remove()),m=!1},v=function(e){var t,r,n,a;return r=d3.select(this),r.classed("wk-chart-selected")?(t=(e.startAngle+e.endAngle)/2,n=Math.sin(t)*D,a=-Math.cos(t)*D,r.transition().duration(p).attr("transform","translate("+n+","+a+")")):r.transition().duration(p).attr("transform","translate(0,0)")},A=function(){return S.selectAll(".wk-chart-innerArc").each(v)},b.lifeCycle().on("configure",function(){return d=this.getScales(["size","y","color"]),d.color.scaleType("category20"),d.y.scaleType("ordinal"),y=b.behavior().tooltip,f=b.behavior().selected,y.on("enter."+l,$)}),b.lifeCycle().on("drawChart."+l,g),b.lifeCycle().on("objectsSelected."+l,A),b.lifeCycle().on("destroy."+l,function(){return b.lifeCycle().on("."+l,null),y.on("."+l,null)}),a.$observe("labels",function(e){return"false"===e?h=!1:("true"===e||""===e)&&(h=!0),b.lifeCycle().update()}),a.$observe("donat",function(e){return"false"===e?o=!1:("true"===e||""===e)&&(o=!0),b.lifeCycle().update()}),a.$observe("labelStyle",function(t){return t&&b.dataLabelStyle(e.$eval(t)),b.lifeCycle().update()}),a.$observe("pieStyle",function(t){return t?u=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeArea",["$log","utils","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return m=l.me,y=void 0,d={},f=!1,h=!1,b=0,c="rangearea"+i++,p=void 0,w=void 0,u=0,s={},A=r(),k=n(),C=a(),S=function(e,t,r,n,a,i,o,l,s){return A.keyScale(r).valueScale(n).data(e),A.isInitial()?void 0:(w=A.animationStartLayers(),v.apply(this,[!1,w,t,r,n,a,i,o,l,s]))},x=function(e,t,r,n,a,i,o,l,s){return k.active(f),w=A.animationEndLayers(),v.apply(this,[!0,w,t,r,n,a,i,o,l,s])},v=function(e,t,r,n,a,i){var o,l,c,d,f;for(f=function(e){var t,r,n;return r=d3.select(this),r.style(s),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},b=n.isOrdinal()?n.scale().rangeBand()/2:0,y&&(y.data(t),C.layout(t)),p=d3.svg.area().x(function(e){return n.scale()(e.targetKey)}).y(function(e){return a.scale()(e.value)}).y1(function(e){return a.scale()(e.value1)}),h&&p.interpolate("cardinal"),o=0,d=[{values:t[1].values,layerKey:t[1].layerKey}];o<d[0].values.length;)d[0].values[o].value1=t[0].values[o].value,o++;return l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),l.enter().append("g").attr("class","wk-chart-layer"),c=this.selectAll(".wk-chart-area-path").data(d,function(e){return e.layerKey}),c.enter().append("path").attr("class","wk-chart-area-path wk-chart-edit-selectable").attr("d",function(e){return p(e.values)}).style("opacity",u).style("pointer-events","none").attr("transform","translate("+b+")"),c.style("stroke",function(e){return i.scale()(e.layerKey)}).style("pointer-events","none").each(f),(e?c.transition().duration(r.duration):c).attr("d",function(e){return p(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}),c.exit().remove(),l.exit().remove(),k.x(function(e){return n.scale()(e.targetKey)+(n.isOrdinal()?n.scale().rangeBand()/2:0)}).y(function(e){return a.scale()(e.value)}).color(function(e){return i.scale()(e.layerKey)}),l.call(k,e)},g=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return p(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),k.brush(this,t),C.brushRange(t)):(r.attr("d",function(e){return p(e.values)}),k.brush(this,t))},m.lifeCycle().on("configure",function(){return d=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),y=m.behavior().tooltip,C.keyScale(d.x).valueScale(d.y).colorScale(d.color).value(function(e){return e.value}),y.markerScale(d.x),y.on("enter."+c,C.moveData),y.on("moveData."+c,C.moveData),y.on("moveMarker."+c,C.moveMarkers)}),m.lifeCycle().on("brushDraw."+c,g),m.lifeCycle().on("animationStartState."+c,S),m.lifeCycle().on("animationEndState."+c,x),m.lifeCycle().on("destroy."+c,function(){return m.lifeCycle().on("."+c,null),y.on("."+c,null)}),o.$observe("markers",function(e){return f=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),o.$observe("spline",function(e){return h=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?s=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeAreaVertical",["$log","utils","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,n,a){var i;return i=0,{restrict:"A",require:"layout",link:function(e,t,o,l){var s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A;return m=l.me,y=void 0,d={},f=!1,h=!1,b=0,c="rangeareavertical"+i++,p=void 0,w=void 0,u=0,s={},A=r(),k=n(),C=a(),S=function(e,t,r,n,a){return A.keyScale(n).valueScale(r).data(e),A.isInitial()?void 0:(w=A.animationStartLayers(),v.apply(this,[!1,w,t,r,n,a]))},x=function(e,t,r,n,a){return k.active(f),w=A.animationEndLayers(),v.apply(this,[!0,w,t,r,n,a])},v=function(e,t,r,n,a,i){var o,l,c,d,f;for(f=function(e){var t,r,n;return r=d3.select(this),r.style(s),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},b=a.isOrdinal()?a.scale().rangeBand()/2:0,y&&(y.data(t),C.layout(t)),p=d3.svg.area().x(function(e){return-a.scale()(e.targetKey)}).y(function(e){return n.scale()(e.value)}).y1(function(e){return n.scale()(e.value1)}),h&&p.interpolate("cardinal"),o=0,d=[{values:t[1].values,layerKey:t[1].layerKey}];o<d[0].values.length;)d[0].values[o].value1=t[0].values[o].value,o++;return l=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),l.enter().append("g").attr("class","wk-chart-layer"),c=this.selectAll(".wk-chart-area-path").data(d,function(e){return e.layerKey}),c.enter().append("path").attr("class","wk-chart-area-path").attr("d",function(e){return p(e.values)}).style("opacity",u).style("pointer-events","none").attr("transform","translate(0,"+b+")rotate(-90)"),c.style("stroke",function(e){return i.scale()(e.layerKey)}).style("pointer-events","none").each(f),(e?c.transition().duration(r.duration):c).attr("d",function(e){return p(e.values)}).style("opacity",function(e){return e.added||e.deleted?0:1}),c.exit().remove(),l.exit().remove(),k.y(function(e){return a.scale()(e.targetKey)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}).x(function(e){return n.scale()(e.value)}).color(function(e){return i.scale()(e.layerKey)}),l.call(k,e)},g=function(e,t){var r;return r=this.selectAll(".wk-chart-area-path"),e.isOrdinal()?(r.attr("d",function(e){return p(e.values.slice(t[0],t[1]+1))}).attr("transform","translate("+e.scale().rangeBand()/2+")"),k.brush(this,t),C.brushRange(t)):(r.attr("d",function(e){return p(e.values)}),k.brush(this,t))},m.lifeCycle().on("configure",function(){return d=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("x").domainCalc("extent").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).domainCalc("extent"),y=m.behavior().tooltip,C.keyScale(d.y).valueScale(d.x).colorScale(d.color).value(function(e){return e.value}),y.markerScale(d.y),y.on("enter."+c,C.moveData),y.on("moveData."+c,C.moveData),y.on("moveMarker."+c,C.moveMarkers)}),m.lifeCycle().on("brushDraw."+c,g),m.lifeCycle().on("animationStartState."+c,S),m.lifeCycle().on("animationEndState."+c,x),m.lifeCycle().on("destroy."+c,function(){return m.lifeCycle().on("."+c,null),y.on("."+c,null)}),o.$observe("markers",function(e){return f=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),o.$observe("spline",function(e){return h=""===e||"true"===e?!0:!1,m.lifeCycle().update()}),o.$observe("areaStyle",function(t){return t?s=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeBars",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,n,a,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return w=c.me,d="rangebars"+o++,u={},p=void 0,h=void 0,f={},y=!1,x=0,k=void 0,v=_.clone(r,!0),D=n(),b=a(),A=i(),C=function(e,t,r,n,a){return D.keyScale(n).valueScale(r).data(e,!0),D.isInitial()?void 0:(k=D.animationStartLayers(),m.apply(this,[!1,k,t,r,n,a]))},S=function(e,t,r,n,a){return b.active(y),k=D.animationEndLayers(),m.apply(this,[!0,k,t,r,n,a])},m=function(e,t,r,n,a,i){var o,l,s,c,d,f,y;for(y=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},o=a.scale().rangeBand(),l=o/(1-v.paddingLeft)*v.paddingLeft,x=a.isOrdinal()?o/2:0,p&&(p.data(t),A.layout(t)),x=function(e){return e.deleted&&e.atBorder?-l/2:e.deleted?o+l/2:e.added&&e.atBorder?-l/2:e.added?o+l/2:0},s=0,f=[{values:t[1].values,layerKey:t[1].layerKey}];s<f[0].values.length;)f[0].values[s].value1=t[0].values[s].targetValue,s++;return c=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),c.enter().append("g").attr("class","wk-chart-layer"),d=this.selectAll(".wk-chart-rect").data(f[0].values,function(e){return e.key}),d.enter().append("rect").attr("class","wk-chart-rect").style("opacity",0).call(p.tooltip).call(h).attr("transform",function(e){return"translate(0, "+a.scale()(e.targetKey)+")"}),d.each(y),(e?d.transition().duration(r.duration):d).attr("transform",function(e){return"translate(0, "+(a.scale()(e.targetKey)+x(e))+")"}).attr("height",function(e){return e.added||e.deleted?0:o}).attr("width",function(e){return Math.abs(n.scale()(e.targetValue)-n.scale()(e.value1))}).attr("x",function(e){return n.scale()(e.value1)}).style("stroke",function(e){return i.scale()(e.layerKey)}).style("opacity",1),d.exit().remove(),c.exit().remove()},g=function(e){return this.selectAll(".wk-chart-rect").attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.targetKey))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()})},w.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("extent").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(v).scaleType("ordinal"),p=w.behavior().tooltip,A.keyScale(f.y).valueScale(f.x).colorScale(f.color).value(function(e){return e.value}),h=w.behavior().selected,p.on("enter."+d,A.enter)}),w.lifeCycle().on("brushDraw."+d,g),w.lifeCycle().on("animationStartState."+d,C),w.lifeCycle().on("animationEndState."+d,S),w.lifeCycle().on("destroy."+d,function(){return w.lifeCycle().on("."+d,null),p.on("."+d,null)}),s.$observe("padding",function(e){return v=t.parsePadding(e,v,r),f.y.rangePadding(v),w.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?w.showDataLabels(!1):("true"===e||""===e)&&w.showDataLabels("x"),w.lifeCycle().update()}),s.$observe("barStyle",function(t){return t?u=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("rangeColumn",["$log","utils","barConfig","dataManagerFactory","markerFactory","tooltipHelperFactory",function(e,t,r,n,a,i){var o;return o=0,{restrict:"A",require:"^layout",link:function(e,l,s,c){var u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D;return w=c.me,d="rangeColumn"+o++,u={},p=void 0,h=void 0,f={},y=!1,x=0,k=void 0,v=_.clone(r,!0),D=n(),b=a(),A=i(),C=function(e,t,r,n,a){return D.keyScale(r).valueScale(n).data(e,!0),D.isInitial()?void 0:(k=D.animationStartLayers(),m.apply(this,[!1,k,t,r,n,a]))},S=function(e,t,r,n,a){return b.active(y),k=D.animationEndLayers(),m.apply(this,[!0,k,t,r,n,a])},m=function(e,t,r,n,a,i){var o,l,s,c,d,f,y;for(y=function(e){var t,r,n;return r=d3.select(this),r.style(u),n=i.scale()(e.layerKey),"string"==typeof n?r.style({fill:n,stroke:n}):(t=n.color,n.fill=t,r.style(n))},o=n.scale().rangeBand(),l=o/(1-v.paddingLeft)*v.paddingLeft,x=a.isOrdinal()?o/2:0,p&&(p.data(t),A.layout(t)),x=function(e){return e.deleted&&e.atBorder?o:e.deleted?-l/2:e.added&&e.atBorder?o+l/2:e.added?-l/2:0},s=0,f=[{values:t[1].values,layerKey:t[1].layerKey}];s<f[0].values.length;)f[0].values[s].value1=t[0].values[s].targetValue,s++;return c=this.selectAll(".wk-chart-layer").data(t,function(e){return e.layerKey}),c.enter().append("g").attr("class","wk-chart-layer"),d=this.selectAll(".wk-chart-rect").data(f[0].values,function(e){return e.key}),d.enter().append("rect").attr("class","wk-chart-rect").style("opacity",0).call(p.tooltip).call(h).attr("transform",function(e){return"translate("+n.scale()(e.targetKey)+")"}),d.each(y),(e?d.transition().duration(r.duration):d).attr("transform",function(e){return"translate("+(n.scale()(e.targetKey)+x(e))+")"}).attr("width",function(e){return e.added||e.deleted?0:o}).attr("height",function(e){return Math.abs(a.scale()(e.targetValue)-a.scale()(e.value1))}).attr("y",function(e){return a.scale()(e.targetValue)}).style("stroke",function(e){return i.scale()(e.layerKey)}).style("opacity",1),d.exit().remove(),c.exit().remove()},g=function(e){return this.selectAll(".wk-chart-rect").attr("transform",function(t){var r;return"translate(0, "+((r=e.scale()(t.targetKey))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return e.scale().rangeBand()})},w.lifeCycle().on("configure",function(){return f=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(v).scaleType("ordinal"),p=w.behavior().tooltip,A.keyScale(f.x).valueScale(f.y).colorScale(f.color).value(function(e){return e.value}),h=w.behavior().selected,p.on("enter."+d,A.enter)}),w.lifeCycle().on("brushDraw."+d,g),w.lifeCycle().on("animationStartState."+d,C),w.lifeCycle().on("animationEndState."+d,S),w.lifeCycle().on("destroy."+d,function(){return w.lifeCycle().on("."+d,null),p.on("."+d,null)}),s.$observe("padding",function(e){return v=t.parsePadding(e,v,r),f.x.rangePadding(v),w.lifeCycle().update()}),s.$observe("labels",function(e){return"false"===e?w.showDataLabels(!1):("true"===e||""===e)&&w.showDataLabels("y"),w.lifeCycle().update()}),s.$observe("columnStyle",function(t){return t?u=e.$eval(t):void 0})}}}]),angular.module("wk.chart").directive("scatter",["$log","utils",function(){var e;return e=0,{restrict:"A",require:"^layout",link:function(t,r,n,a){var i,o,l,s,c,u,d,f;return d=a.me,s=void 0,l=void 0,i="scatter"+e++,o=[],f=function(e){var t,r,n;t=[];for(r in o)n=o[r],t.push(this.layers[n.axisLabel()]={value:n.formattedValue(e),color:"color"===r?{fill:"string"==typeof n.map(e)?n.map(e):n.map(e).color}:{fill:"none"},path:"shape"===r?d3.svg.symbol().type(n.map(e)).size(80)():void 0,"class":"shape"===r?"wk-chart-tt-svg-shape":""});return t},u=0,c=function(e,t,r,n,a,i,o){var c;return c=this.selectAll(".wk-chart-shape").data(e,function(e,t){return t}),c.enter().append("path").attr("class","wk-chart-shape wk-chart-selectable").attr("transform",function(e){return"translate("+r.map(e)+","+n.map(e)+")"}).style("opacity",u).call(s.tooltip).call(l),c.style("fill",function(e){return a.map(e)}).attr("d",d3.svg.symbol().type(function(e){return o.map(e)}).size(function(e){return i.map(e)*i.map(e)})).transition().duration(t.duration).attr("transform",function(e){return"translate("+r.map(e)+","+n.map(e)+")"}).style("opacity",1),u=1,c.exit().remove()},d.lifeCycle().on("configure",function(){return o=this.getScales(["x","y","color","size","shape"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),s=d.behavior().tooltip,l=d.behavior().selected,s.on("enter."+i,f)}),d.lifeCycle().on("drawChart."+i,c),d.lifeCycle().on("destroy."+i,function(){return d.lifeCycle().on("."+i,null),s.on("."+i,null)})}}}]),angular.module("wk.chart").directive("spider",["$log","utils",function(e){var t;return t=0,{restrict:"A",require:"layout",link:function(r,n,a,i){var o,l,s,c,u,d,f,h;return f=i.me,c=void 0,s={},l="spider"+t++,u=d3.svg.axis(),o=void 0,h=function(e){var t,r,n,a,i;for(a=[],r=0,n=o.length;n>r;r++)t=o[r],i=s.color.scale()(e),a.push(this.layers[s.x.value(t)]={value:s.y.formatValue(t[e]),color:{fill:"string"==typeof i?i:i.color}});return a},d=function(t,r,n,a,i){var l,s,d,f,h,y,p,g,v,m,w,k,b,x,S,C;return k=function(e){var t,r,n;return r=d3.select(this),n=i.scale()(e),"string"==typeof n?r.style({fill:"none",stroke:n,"stroke-width":3}):(t=n.color,n.stroke=t,r.style(n))},o=t,e.log(t),f=r.width/2,h=r.height/2,w=.8*d3.min([f,h]),b=20,m=t.length,l=2*Math.PI/m,g=360/m,s=this.select(".wk-chart-axis"),s.empty()&&(s=this.append("g").attr("class","wk-chart-axis")),C=a.scale().ticks(a.ticks()),a.scale().range([w,0]),u.scale(a.scale()).orient("right").tickValues(C).tickFormat(a.tickFormat()),s.call(u).attr("transform","translate("+f+","+(h-w)+")"),a.scale().range([0,w]),v=this.selectAll(".wk-chart-axis-line").data(t,function(e){return n.value(e)}),v.enter().append("line").attr("class","wk-chart-axis-line").style("stroke","darkgrey"),v.attr({x1:0,y1:0,x2:0,y2:w}).attr("transform",function(e,t){return"translate("+f+", "+h+")rotate("+(g*t+180)+")"}),v.exit().remove(),x=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),S=this.selectAll(".wk-chart-tickPath").data(C),S.enter().append("path").attr("class","wk-chart-tickPath").style("fill","none").style("stroke","lightgrey"),S.attr("d",function(e){var r;return r=t.map(function(t,r){return{x:Math.sin(l*r+Math.PI)*a.scale()(e),y:Math.cos(l*r+Math.PI)*a.scale()(e)}}),x(r)+"Z"}).attr("transform","translate("+f+", "+h+")"),S.exit().remove(),d=this.selectAll(".wk-chart-axis-text").data(t,function(e){return n.value(e)}),d.enter().append("text").attr("class","wk-chart-axis-text").style("fill","black").attr("dy","0.8em").attr("text-anchor","middle"),d.attr({x:function(e,t){return f+Math.sin(l*t+Math.PI)*(w+b)},y:function(e,t){return h+Math.cos(l*t+Math.PI)*(w+b)}}).text(function(e){return n.value(e)}),d.exit().remove(),p=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),y=this.selectAll(".wk-chart-data-line").data(a.layerKeys(t)),y.enter().append("path").attr("class","wk-chart-data-line").call(c.tooltip),y.attr("d",function(e){var r;return r=t.map(function(t,r){return{x:Math.sin(l*r+Math.PI)*a.scale()(t[e]),y:Math.cos(l*r+Math.PI)*a.scale()(t[e])}}),p(r)+"Z"}).each(k).attr("transform","translate("+f+", "+h+")")},f.lifeCycle().on("configure",function(){return s=this.getScales(["x","y","color"]),s.y.domainCalc("max"),s.x.resetOnNewData(!0).scaleType("ordinal"),c=f.behavior().tooltip,c.on("enter."+l,h)}),f.lifeCycle().on("drawChart."+l,d),f.lifeCycle().on("destroy."+l,function(){return f.lifeCycle().on("."+l,null),c.on("."+l,null)})}}}]),angular.module("wk.chart").factory("behaviorBrush",["$log","$window","selectionSharing","timing",function(e,t,r,n){var a;return a=function(){var e,a,i,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L,M,O,K,P,V,T,z,E,F,N,G,q,R,I,j,H,U,X,Y;return N=function(){},e=!1,A=void 0,k=void 0,$=void 0,w=void 0,i=void 0,p=void 0,m=void 0,g=void 0,a=void 0,o=void 0,v=void 0,D=void 0,d=void 0,L=void 0,M=void 0,B=void 0,h=!1,f=!1,y=!1,s=void 0,c=void 0,l=[],x=S=b=C=void 0,u=d3.dispatch("brushStart","brush","brushEnd"),F=Y=R=O=X=H=U=j=void 0,G=function(e,t,r,n){var i,o;return o=t-e,i=n-r,h&&(A.selectAll(".wk-chart-n").attr("transform","translate("+e+","+r+")").select("rect").attr("width",o),A.selectAll(".wk-chart-s").attr("transform","translate("+e+","+n+")").select("rect").attr("width",o),A.selectAll(".wk-chart-w").attr("transform","translate("+e+","+r+")").select("rect").attr("height",i),A.selectAll(".wk-chart-e").attr("transform","translate("+t+","+r+")").select("rect").attr("height",i),A.selectAll(".wk-chart-ne").attr("transform","translate("+t+","+r+")"),A.selectAll(".wk-chart-nw").attr("transform","translate("+e+","+r+")"),A.selectAll(".wk-chart-se").attr("transform","translate("+t+","+n+")"),A.selectAll(".wk-chart-sw").attr("transform","translate("+e+","+n+")"),k.attr("width",o).attr("height",i).attr("x",e).attr("y",r)),f&&(A.selectAll(".wk-chart-w").attr("transform","translate("+e+",0)").select("rect").attr("height",i),A.selectAll(".wk-chart-e").attr("transform","translate("+t+",0)").select("rect").attr("height",i),A.selectAll(".wk-chart-e").select("rect").attr("height",a.height),A.selectAll(".wk-chart-w").select("rect").attr("height",a.height),k.attr("width",o).attr("height",a.height).attr("x",e).attr("y",0)),y?(A.selectAll(".wk-chart-n").attr("transform","translate(0,"+r+")").select("rect").attr("width",o),A.selectAll(".wk-chart-s").attr("transform","translate(0,"+n+")").select("rect").attr("width",o),A.selectAll(".wk-chart-n").select("rect").attr("width",a.width),A.selectAll(".wk-chart-s").select("rect").attr("width",a.width),k.attr("width",a.width).attr("height",i).attr("x",0).attr("y",r)):void 0},E=function(){return d3.select(i).selectAll(".wk-chart-resize").style("display","none"),k.attr("width",0).attr("height",0).attr("x",0).attr("y",0).style("display","none")},z=function(){var e,t;return t=k.node().getBoundingClientRect(),D.each(function(){var e,r,n;return e=this.getBoundingClientRect(),r=t.left<e.right-e.width/3&&e.left+e.width/3<t.right,n=t.top<e.bottom-e.height/3&&e.top+e.height/3<t.bottom,d3.select(this).classed("wk-chart-selected",n&&r)}),e=g.selectAll(".wk-chart-selected").data(),g.classed("wk-chart-has-selected-items",e.length>0),e},I=function(e,t,n,a){var i,o,p,g,v,w,k,A,D,$;return f&&(N.x().reverse()&&($=e,e=t,t=$),g=N.x().invert(e),w=N.x().invert(t),(x!==g||S!==w)&&(S=w,x=g,p=N.x().findIndex(g),v=N.x().findIndex(w),s=[p,v],c=N.x().isOrdinal()?m.map(function(e){return N.x().value(e)}).slice(p,v+1):[N.x().value(m[s[0]]),N.x().value(m[v])],l=m.slice(p,v+1),u.brush(s,c,l),r.setSelection(c,s,d))),y&&(N.y().reverse()&&($=n,n=a,a=$),o=N.y().invert(a),A=N.y().invert(n),(b!==o||C!==A)&&(b=o,C=A,i=N.y().findIndex(o),k=N.y().findIndex(A),s=[i,k],c=N.y().isOrdinal()?m.map(function(e){return N.y().value(e)}).slice(i,k+1):[N.y().value(m[i]),N.y().value(m[k])],l=m.slice(i,k+1),u.brush(s,c,l),r.setSelection(c,s,d))),h&&(D=z(),_.xor(l,D).length>0)?(s=[],c=[],l=D,u.brush(s,c,l),r.setSelection(c,s,d)):void 0},T=function(){return s=[],c=[],l=[],D.classed("wk-chart-selected",!1),g.classed("wk-chart-has-selected-items",!1),r.setSelection(c,s,d),_.delay(function(){return u.brush(s,c,l),u.brushEnd(s,c,l)},20)},V=function(){var e;return d3.event.preventDefault(),e=d3.select(d3.event.target),w=e.datum(),e.classed("wk-chart-selectable")&&(w={name:"forwarded"}),a=i.getBBox(),$=d3.mouse(i),X=Y,H=F,U=R,j=O,d3.select(i).selectAll(".wk-chart-resize").style("display",null),d3.select(i).select(".wk-chart-selectable").style("pointer-events","none"),k.style("display",null),d3.select("body").style("cursor",d3.select(d3.event.target).style("cursor")),d3.select(t).on("mousemove.brush",P).on("mouseup.brush",K),B.hide(!0),s=[void 0,void 0],l=[void 0],D=g.selectAll(".wk-chart-selectable"),u.brushStart(),n.clear(),n.init()},K=function(){return d3.select(t).on("mousemove.brush",null),d3.select(t).on("mouseup.brush",null),d3.select(i).style("pointer-events","all").selectAll(".wk-chart-resize").style("display",null),d3.select(i).select(".wk-chart-selectable").style("pointer-events",null),d3.select("body").style("cursor",null),B.hide(!1),u.brushEnd(s,c,l)},P=function(){var e,t,r,n,o,l,s,c,u;switch(l=d3.mouse(i),t=l[0]-$[0],r=l[1]-$[1],o=function(e){return l=H+e,F=l>=0?U>l?l:U:0,R=l<=a.width?U>l?U:l:a.width},s=function(e){return l=U+e,F=l>=0?H>l?l:H:0,R=l<=a.width?H>l?H:l:a.width},c=function(e){return l=X+e,Y=l>=0?j>l?l:j:0,O=l<=a.height?l>j?l:j:a.height},e=function(e){return l=j+e,Y=l>=0?X>l?l:X:0,O=l<=a.height?l>X?l:X:a.height},n=function(e){return H+e>=0?U+e<=a.width?(F=H+e,R=U+e):(R=a.width,F=a.width-(U-H)):(F=0,R=U-H)},u=function(e){return X+e>=0?j+e<=a.height?(Y=X+e,O=j+e):(O=a.height,Y=a.height-(j-X)):(Y=0,O=j-X)},w.name){case"background":case"forwarded":t+$[0]>0?(F=0>t?$[0]+t:$[0],R=F+Math.abs(t)<a.width?F+Math.abs(t):a.width):F=0,r+$[1]>0?(Y=0>r?$[1]+r:$[1],O=Y+Math.abs(r)<a.height?Y+Math.abs(r):a.height):Y=0;break;case"extent":u(r),n(t);break;case"n":c(r);break;case"s":e(r);break;case"w":o(t);break;case"e":s(t);break;case"nw":c(r),o(t);break;case"ne":c(r),s(t);
break;case"sw":e(r),o(t);break;case"se":e(r),s(t)}return G(F,R,Y,O),I(F,R,Y,O)},N.brush=function(t){if(0===arguments.length)return A;if(e)return A=t,h=N.x()&&N.y(),f=N.x()&&!N.y(),y=N.y()&&!N.x(),t.style({"pointer-events":"all",cursor:"crosshair"}),k=t.append("rect").attr({"class":"wk-chart-extent",x:0,y:0,width:0,height:0}).style({cursor:"move"}).datum({name:"extent"}),(y||h)&&(t.append("g").attr("class","wk-chart-resize wk-chart-n").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"n"}),t.append("g").attr("class","wk-chart-resize wk-chart-s").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"s"})),(f||h)&&(t.append("g").attr("class","wk-chart-resize wk-chart-w").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"w"}),t.append("g").attr("class","wk-chart-resize wk-chart-e").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"e"})),h&&(t.append("g").attr("class","wk-chart-resize wk-chart-nw").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"nw"}),t.append("g").attr("class","wk-chart-resize wk-chart-ne").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"ne"}),t.append("g").attr("class","wk-chart-resize wk-chart-sw").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"sw"}),t.append("g").attr("class","wk-chart-resize wk-chart-se").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"se"})),t.on("mousedown.brush",V),N},q=function(){var e,t,r;return a?(t=i.getBBox(),e=a.width/t.width,r=a.height/t.height,Y/=r,X/=r,O/=r,j/=r,F/=e,H/=e,R/=e,U/=e,$[0]=$[0]/e,$[1]=$[1]/r,a=t,G(F,R,Y,O)):void 0},N.chart=function(e){return 0===arguments.length?p:(p=e,p.lifeCycle().on("resize.brush",q),N)},N.active=function(t){return 0===arguments.length?e:(e=t,N)},N.x=function(e){return 0===arguments.length?L:(L=e,N)},N.y=function(e){return 0===arguments.length?M:(M=e,N)},N.area=function(e){return 0===arguments.length?g:(void 0===e?(i=void 0,g=void 0):g||(g=e,i=g.node(),N.brush(g),D=g.selectAll(".wk-chart-selectable")),N)},N.container=function(e){return 0===arguments.length?v:(v=e,N)},N.data=function(e){return 0===arguments.length?m:(m=e,N)},N.brushGroup=function(e){return 0===arguments.length?d:(d=e,r.createGroup(d),N)},N.tooltip=function(e){return 0===arguments.length?B:(B=e,N)},N.on=function(e,t){return u.on(e,t)},N.extent=function(){return s},N.events=function(){return u},N.empty=function(){return 0===l.length},N.clearBrush=function(){return console.log("Brush cleared"),E(),T()},N}}]),angular.module("wk.chart").factory("behavior",["$log","$window","behaviorTooltip","behaviorBrush","behaviorSelect",function(e,t,r,n,a){var i;return i=function(){var e,t,i,o,l,s;return i=r(),e=n(),t=a(),e.tooltip(i),l=function(r){return e.area(r),i.area(r),t.area(r)},s=function(t){return e.container(t),i.container(t)},o=function(t){return e.chart(t),i.chart(t)},{tooltip:i,brush:e,selected:t,chartArea:l,container:s,chart:o}}}]),angular.module("wk.chart").factory("behaviorSelect",["$log",function(e){var t,r;return r=0,t=function(){var t,n,a,i,o,l,s;return a="select"+r++,n=void 0,i=void 0,t=!1,o=d3.dispatch("selected"),l=function(){var e,r,a,l;if(t&&(r=d3.select(this),t))return r.classed("wk-chart-selectable")?(e=r.classed("wk-chart-selected"),r.classed("wk-chart-selected",!e),a=n.selectAll(".wk-chart-selected"),l=a.data().map(function(e){return e.data?e.data:e}),n.classed("wk-chart-has-selected-items",l.length>0),i.lifeCycle().objectsSelected(a),o.selected(l)):void 0},s=function(e){return 0===arguments.length?s:(e.on("click",l),s)},s.id=function(){return a},s.active=function(e){return 0===arguments.length?t:(t=e,s)},s.clearSelection=function(){return e.log("selection Cleared"),n?(n.selectAll(".wk-chart-selected").classed("wk-chart-selected",!1),n.classed("wk-chart-has-selected-items",!1),i.lifeCycle().objectsSelected(n.selectAll(".wk-chart-selected"))):void 0},s.area=function(e){return 0===arguments.length?n:(n=e,s)},s.layout=function(e){return 0===arguments.length?i:(i=e,s)},s.events=function(){return o},s.on=function(e,t){return o.on(e,t),s},s}}]),angular.module("wk.chart").factory("behaviorTooltip",["$log","$document","$rootScope","$compile","$templateCache","wkChartTemplates",function(e,t,r,n,a,i){var o;return o=function(){var r,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L,M,O,K,P,V;return r=!1,g="",f=!1,w=void 0,h=void 0,y=void 0,o=void 0,s=void 0,l=void 0,u=void 0,m=void 0,p=void 0,d=void 0,v=!1,x=d3.dispatch("enter","moveData","moveMarker","leave"),k=i.tooltipTemplate(),b=void 0,c=void 0,S=t.find("body"),C=S[0].getBoundingClientRect(),L=function(){},M=function(){var e,t,r;return r=c[0].getBoundingClientRect(),e=C.right-20>d3.event.clientX+r.width+10?d3.event.clientX+10:d3.event.clientX-r.width-10,t=C.bottom-20>d3.event.clientY+r.height+10?d3.event.clientY+10:d3.event.clientY-r.height-10,_.assign(b.tooltipStyle,{position:"absolute",left:e+"px",top:t+"px","z-index":1500,opacity:1}),b.$apply()},O=function(){return _.assign(b.tooltipStyle,{position:"absolute",left:"0px",top:"0px","z-index":1500,opacity:0}),b.$apply()},K=function(){var e,t,n,a,i,l;if(r&&!f)return b.layers={},w?(t=d3.mouse(this),a=p.invert(p.isHorizontal()?t[0]:t[1]),n=p.find(a),b.ttData=n):(l=d3.select(this).datum(),n=b.ttData=l.data?l.data:l),x.enter.apply(b,[n,n]),i=d3.select(".wk-chart-tooltip"),i.empty()&&(S.append(c),b.tooltipStyle=L.chart().tooltipStyle(),O()),w?(h=u.select(".wk-chart-tooltip-marker"),h.empty()&&(e=o.select(".wk-chart-background").node().getBBox(),h=u.append("g").attr("class","wk-chart-tooltip-marker"),y=h.append("line"),y.attr(p.isHorizontal()?{"class":"wk-chart-marker-line",x0:0,x1:0,y0:0,y1:e.height}:{"class":"wk-chart-marker-line",x0:0,x1:e.width,y0:0,y1:0}),y.style({stroke:"darkgrey","pointer-events":"none"})),x.moveMarker.apply(h,[a,n])):void 0},V=function(){var e,t,n;if(r&&!f){if(e=d3.mouse(l),w){if(!h)return void K.apply(this,arguments);n=p.invert(p.isHorizontal()?e[0]:e[1]),t=p.find(n),x.moveMarker.apply(h,[n,t]),b.ttData=t,x.moveData.apply(b,[n,t])}return M()}},P=function(){return h&&h.remove(),h=void 0,c.remove()},$=function(){var e,t;return e=l,d3.event.target!==e?(t=new Event("mousedown"),t.pageX=d3.event.pageX,t.clientX=d3.event.clientX,t.pageY=d3.event.pageY,t.clientY=d3.event.clientY,e.dispatchEvent(t)):void 0},B=function(t){return e.debug(t,d3.event)},L.hide=function(e){return 0===arguments.length?f:(f=e,h&&h.style("visibility",f?"hidden":"visible"),b.ttHide=f,b.$apply(),L)},L.chart=function(t){return 0===arguments.length?s:(s=t,s.lifeCycle().on("destroy.tooltip",function(){return b&&(e.log("destroying tooltip scope",b.$id,s.id()),b.map=void 0,b.scale=void 0,b.properties=void 0,b.label=void 0,b.value=void 0,b.$destroy()),c=void 0,l=void 0}),L)},L.active=function(e){return 0===arguments.length?r:(r=e,L)},L.template=function(e){var t;return 0===arguments.length?g:(g=e,g.length>0&&(t=a.get(g),k='<div class="wk-chart-tooltip" ng-style="tooltipStyle" ng-hide="ttHide">'+t+"</div>"),L)},L.area=function(e){return 0===arguments.length?o:(void 0===e?(o=e,l=e):(o=e,l=o.node(),w&&L.tooltip(o)),L)},L.container=function(e){return 0===arguments.length?u:(u=e,L)},L.markerScale=function(e){return 0===arguments.length?p:(e?(w=!0,p=e):w=!1,L)},L.data=function(e){return 0===arguments.length?d:(d=e,L)},L.on=function(e,t){return x.on(e,t)},D=function(e){return function(){return b.ttData?e(b.ttData):void 0}},A=function(){var t,r,a;if(!b){b=s.scope().$new(!0),e.log("creating tooltip scope",b.$id,s.id()),b.properties={},b.map={},b.scale={},b.label={},b.value={},b.ttHide=!1,r=s.allScales().allKinds();for(t in r)a=r[t],b.map[t]=D(a.map),b.scale[t]=a.scale(),b.properties[t]=D(a.layerKeys),b.label[t]=a.axisLabel(),b.value[t]=D(a.value)}return c?void 0:c=n(k)(b)},L.tooltip=function(e){return 0===arguments.length?L:(A(k),!w||e.classed("wk-chart-area")?e.on("mouseenter.tooltip",K).on("mousemove.tooltip",V).on("mouseleave.tooltip",P):void 0)},L}}]),angular.module("wk.chart").factory("chart",["$log","scaleList","container","behavior","d3Animation",function(e,t,r,n,a){var i,o;return o=0,i=function(){var i,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B;return y="chart"+o++,B=function(){},p=[],d=void 0,i=void 0,v=void 0,f=void 0,w=!1,m=void 0,C="",x=void 0,k=void 0,h=!1,c=n(),l=a.duration,g=d3.dispatch("configure","resize","prepareData","scaleDomains","rescaleDomains","sizeContainer","drawAxis","drawChart","newData","update","updateAttrs","scopeApply","destroy","animationStartState","animationEndState","editSelected"),u=d3.dispatch("draw","change"),B.id=function(){return y},B.scope=function(e){return 0===arguments.length?m:(m=e,B)},B.showTooltip=function(e){return 0===arguments.length?w:(w=e,c.tooltip.active(w),B)},B.toolTipTemplate=function(e){return 0===arguments.length?C:(C=e,c.tooltip.template(e),B)},A={},B.tooltipStyle=function(e){return 0===arguments.length?A:(_.isObject(e)&&_.assign(A,e),B)},B.title=function(e){return 0===arguments.length?x:(x=e,B)},S={"font-size":"1.8em"},B.titleStyle=function(e){return 0===arguments.length?S:(_.isObject(e)&&_.assign(S,e),B)},B.subTitle=function(e){return 0===arguments.length?k:(k=e,B)},b={"font-size":"1.3em"},B.subTitleStyle=function(e){return 0===arguments.length?b:(_.isObject(e)&&_.assign(b,e),B)},s={position:"relative"},B.backgroundStyle=function(e){return 0===arguments.length?s:(_.isObject(e)&&(_.assign(s,e),s.position="relative"),B)},B.addLayout=function(e){return 0===arguments.length?p:(p.push(e),B)},B.addScale=function(e,t){return i.add(e),t?t.scales().add(e):v.add(e),B},B.prepareScaleHierarchy=function(){var e,t,r,n,a;r=i.getOwned(),n=[];for(e in r)a=r[e],!v.hasScale(a)&&(t=v.getKind(a.kind(),a.orientation()))?(a.parentScale(t),t.rangePadding(a.rangePadding()),n.push(a.reverse()?t.reverse(!0):t.reverse()?a.reverse(!0):void 0)):n.push(void 0);return n},B.animationDuration=function(e){return 0===arguments.length?l:(l=e,B)},B.editMode=function(e){return 0===arguments.length?h:(e!==h&&(h=e,h?B.container().registerEditHooks():B.container().deregisterEditHooks()),B)},B.lifeCycle=function(){return g},B.layouts=function(){return p},B.scales=function(){return v},B.allScales=function(){return i},B.hasScale=function(e){return!!i.has(e)},B.container=function(){return d},B.brush=function(){return u},B.getData=function(){return f},B.behavior=function(){return c},$=function(t,r){return t?(e.log("executing full life cycle"),f=t,m.filteredData=t,m.scales=i,B.prepareScaleHierarchy(),g.prepareData(t,r),g.animationStartState(t),g.scaleDomains(t,r),g.sizeContainer(t,r),g.drawAxis(r),g.animationEndState(t),g.drawChart(t,r),g.scopeApply(),d.registerEditHooks()):void 0},D=_.debounce($,100),B.execLifeCycleFull=$,B.resizeLifeCycle=function(t){return f?(e.log("executing resize life cycle"),g.sizeContainer(f,t),g.drawAxis(t),g.drawChart(f,t),g.scopeApply()):void 0},B.newDataLifeCycle=function(t,r){return t?(e.log("executing new data life cycle"),f=t,m.filteredData=t,g.prepareData(t,r),g.scaleDomains(t,r),g.drawAxis(r),g.drawChart(t,r)):void 0},B.attributeChange=function(t){return f?(e.log("executing attribute change life cycle"),g.sizeContainer(f,t),g.drawAxis(t),g.drawChart(f,t)):void 0},B.brushExtentChanged=function(){return f?(g.drawAxis(!0),g.drawChart(f,!0)):void 0},B.lifeCycle().on("newData.chart",_.debounce($,10)),B.lifeCycle().on("resize.chart",B.resizeLifeCycle),B.lifeCycle().on("update.chart",function(e){return B.execLifeCycleFull(f,e)}),B.lifeCycle().on("updateAttrs",B.attributeChange),B.lifeCycle().on("rescaleDomains",g.scaleDomains(f,!0)),c.chart(B),d=r().chart(B),i=t(),v=t(),B}}]),angular.module("wk.chart").factory("container",["$log","$window","wkChartMargins","wkChartTemplates","$templateCache",function(e,t,r,n){var a,i;return i=0,a=function(){var t,a,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L,M,O,K,P,V,T,z;return P=function(){},c="cntnr"+i++,a=void 0,f=void 0,h=void 0,l=void 0,m=[],w=[],A=void 0,s=void 0,C=void 0,o=void 0,p=void 0,k=angular.copy(r["default"]),v=0,g=0,D=0,u=void 0,b=void 0,t=void 0,d=0,M=0,P.id=function(){return c},P.chart=function(e){return 0===arguments.length?a:(a=e,a.lifeCycle().on("sizeContainer."+P.id(),P.drawChartFrame),P)},P.element=function(t){var r,n;return 0===arguments.length?f:(r=function(){return P.chart().lifeCycle().resize(!0)},f=t,f&&(h=d3.select(f),h.empty()?e.error("Error: Element "+f+" does not exist"):(y(),n=h.select(".wk-chart").node(),new ResizeSensor(n,r))),P)},P.addLayout=function(e){return m.push(e),P},P.height=function(){return g},P.width=function(){return v},P.margins=function(){return k},P.getChartArea=function(){return o},P.getOverlay=function(){return b},P.getContainer=function(){return C},P.registerEditHooks=function(){return a.editMode()?(P.chart().behavior().tooltip.active(!1),s.selectAll(".wk-chart-axis-select").each(function(){var e,t;return t=this.parentElement.getBBox(),e=d3.select(this).attr(t)}),h.selectAll(".wk-chart-axis-select, .wk-chart-line, .wk-chart-area-path, .wk-chart-marker, .wk-chart-legend").style("pointer-events","all"),h.selectAll(".wk-chart-axis-select, .wk-chart-label-text, .wk-chart-data-label, .wk-chart-layer, .wk-chart-innerArc, .wk-chart-legend, .wk-chart-overlay, .wk-chart-bubble, .wk-chart-shape").style("cursor","pointer").on("click",function(t){return e.log("clicked",d3.select(this).attr("class"),t),a.lifeCycle().editSelected(d3.select(this).attr("class"),t)})):s.selectAll(".wk-chart-axis-select, .wk-chart-line, .wk-chart-area-path, .wk-chart-legend").style("pointer-events","none").style("cursor","default")},$=function(e,t,r,n,a){var i;return i=e.select("."+r.replace(" ",".")),i.empty()&&(i=e.append("text").attr({"class":r,"text-anchor":"middle",y:a?a:0})),i.text(t).style(n),i.node().getBBox().height},O=function(e,t){var r,n;return n=0,r=s.select(".wk-chart-title-area"),r.empty()&&(r=s.insert("g",".wk-chart-area").attr("class","wk-chart-title-area wk-center-hor")),e&&(D=$(r,e,"wk-chart-title wk-chart-label-text",a.titleStyle())),t&&$(r,t,"wk-chart-subtitle wk-chart-label-text",a.subTitleStyle(),D),r.node().getBBox().height},V=function(e,t,r,n){var a,i,o,l,s;for(l=t.append("g"),i=0,o=e.length;o>i;i++)s=e[i],l.append("text").attr({"class":r}).text(s).style(n);return a=l.node().getBBox(),l.remove(),a},T=function(e){var t;switch(t=e.rotateTickLabels(),e.axisOrient()){case"bottom":return 0>t?"end":"start";case"top":return t>0?"end":"start";case"right":return Math.abs(t)>=90?"end":"start";case"left":return Math.abs(t)<=90?"end":"start"}},z=function(e){var t;switch(t=e.rotateTickLabels(),e.axisOrient()){case"bottom":return"rotate("+t+", 0, 10)";case"top":return"rotate("+t+", 0, -10)";case"right":return"rotate("+t+", 10, 0)";case"left":return"rotate("+t+", -10, 0)"}},K=function(e){var t,r;return t=s.append("g"),e.range([0,500]),t.call(e.axis()),e.rotateTickLabels()&&t.selectAll("text").attr({dy:"0.35em"}).attr("transform",z(e)).style("text-anchor",T(e)),t.selectAll("text").style(e.tickLabelStyle()),r=t.node().getBBox(),t.remove(),r},B=function(e){var t;return t=s.select(".wk-chart-axis.wk-chart-"+e.axisOrient()),t.empty()&&(t=s.insert("g",".wk-chart-area").attr("class","wk-chart-axis wk-chart-"+e.axisOrient()),t.append("rect").attr("class","wk-chart-axis-select wk-chart-"+e.axisOrient()).style({opacity:0,"pointer-events":"none"})),t.transition().duration(d).call(e.axis()),e.rotateTickLabels()?t.selectAll(".wk-chart-"+e.axisOrient()+".wk-chart-axis text").attr({dy:"0.35em"}).attr("transform",function(){return z(e)}).style("text-anchor",T(e)).style("pointer-events","none").style(e.tickLabelStyle()):t.selectAll(".wk-chart-"+e.axisOrient()+".wk-chart-axis text").attr("transform",null).style("pointer-events","none").style(e.tickLabelStyle())},x=function(e){return s.select(".wk-chart-axis.wk-chart-"+e+", .wk-chart-axis-select.wk-chart-"+e).remove()},S=function(e){return s.select(".wk-chart-label.wk-chart-"+e).remove()},L=function(e,t){var r,n,a,i,o,l;return r=t?0:d,a=e.kind(),o=e.axis().tickValues(),l=o?o:e.isOrdinal()?e.scale().range():e.scale().ticks(),i=e.isOrdinal()?e.scale().rangeBand()/2:0,n=p.selectAll(".wk-chart-grid.wk-chart-"+a).data(l,function(e){return e}),n.enter().append("line").attr("class","wk-chart-grid wk-chart-"+a).style("pointer-events","none").style("opacity",0),n.style(e.gridStyle()),"y"===a?n.transition().duration(r).attr({x1:M,x2:v-2*M,y1:function(t){return e.isOrdinal()?t+i:e.scale()(t)},y2:function(t){return e.isOrdinal()?t+i:e.scale()(t)}}).style("opacity",1):n.transition().duration(r).attr({y1:M,y2:g-2*M,x1:function(t){return e.isOrdinal()?t+i:e.scale()(t)},x2:function(t){return e.isOrdinal()?t+i:e.scale()(t)}}).style("opacity",1),n.exit().transition().duration(r).style("opacity",0).remove()},y=function(){var e;return l=h.append("div").attr("class","wk-chart"),A=l.append("svg").attr("class","wk-chart"),e=A.append("defs"),e.node().innerHTML=n.svgDefTemplate(),e.append("clipPath").attr("id","wk-chart-clip-"+c).append("rect"),s=A.append("g").attr("class","wk-chart-container"),p=s.append("g").attr("class","wk-chart-grid-lines"),o=s.append("g").attr("class","wk-chart-area"),o.append("rect").style("visibility","hidden").attr("class","wk-chart-background").datum({name:"background"}),s.append("g").attr("class","wk-chart-marker-area")},P.drawChartFrame=function(t,n){var i,u,y,w,b,x,S,T,z,E,F,N,_,G,q,R,I,j,H,U,X,Y,W,J,Z;for(T=h.node().getBoundingClientRect(),d=n?0:P.chart().animationDuration(),y=T.height,b=T.width,J=O(a.title(),a.subTitle()),S={top:{height:0,width:0},bottom:{height:0,width:0},left:{height:0,width:0},right:{height:0,width:0}},I={top:0,bottom:0,left:0,right:0},E={width:0,height:0},N={},_=0,H=m.length;H>_;_++)q=m[_],q.showDataLabels()&&(N[q.showDataLabels()]=!0);U=a.allScales().getOwned();for(G in U)W=U[G],W.parentScale()||(W.showAxis()&&(W.axis().scale(W.scale()).orient(W.axisOrient()),x=s.select(".wk-chart-axis.wk-chart-"+W.axisOrient()),S[W.axisOrient()]=K(W),R=s.select(".wk-chart-label.wk-chart-"+W.axisOrient()),W.showLabel()?(R.empty()&&(R=s.insert("g",".wk-chart-area").attr("class","wk-chart-label wk-chart-"+W.axisOrient())),I[W.axisOrient()]=$(R,W.axisLabel(),"wk-chart-label-text wk-chart-"+W.axisOrient(),W.axisLabelStyle())):R.remove()),N[W.kind()]&&(W.isHorizontal()?F=r.dataLabelPadding.hor+V(W.formattedValue(t),s,"wk-chart-data-label",q.dataLabelStyle()).width:z=r.dataLabelPadding.vert+V(W.formattedValue(t),s,"wk-chart-data-label",q.dataLabelStyle()).height));i=J+S.top.height+I.top+S.bottom.height+I.bottom+k.top+k.bottom,u=S.right.width+I.right+S.left.width+I.left+k.left+k.right,g=y>i?y-i:0,v=b>u?b-u:0,X=a.allScales().getOwned();for(G in X)W=X[G],W.parentScale()||("x"===W.kind()?W.range(N.x?W.reverse()?[v-M-F,M]:[M,v-M-F]:W.reverse()?[v-M,M]:[M,v-M]):"y"===W.kind()&&W.range(N.y?W.reverse()?[z+M,g-M]:[g-M,z+M]:W.reverse()?[M,g-M]:[g-M,M]),W.showAxis()&&B(W));j=S.left.width+I.left+k.left,Z=J+S.top.height+I.top+k.top,C=s.attr("transform","translate("+j+", "+Z+")"),A.select("#wk-chart-clip-"+c+" rect").attr("width",v).attr("height",g),w=Math.max(v,g),A.selectAll("defs>mask>rect").attr({x:-w,y:-w,height:2*w,width:2*w}),C.select(".wk-chart-area>.wk-chart-background").attr("width",v).attr("height",g),C.select(".wk-chart-area").style("clip-path","url(#wk-chart-clip-"+c+")"),s.selectAll(".wk-chart-axis.wk-chart-right").attr("transform","translate("+v+", 0)"),s.selectAll(".wk-chart-axis.wk-chart-bottom").attr("transform","translate(0, "+g+")"),s.select(".wk-chart-label.wk-chart-left").attr("transform","translate("+(-S.left.width-I.left/2)+", "+g/2+") rotate(-90)"),s.select(".wk-chart-label.wk-chart-right").attr("transform","translate("+(v+S.right.width+I.right/2)+", "+g/2+") rotate(90)"),s.select(".wk-chart-label.wk-chart-top").attr("transform","translate("+v/2+", "+(-S.top.height-I.top/2)+")"),s.select(".wk-chart-label.wk-chart-bottom").attr("transform","translate("+v/2+", "+(g+S.bottom.height+I.bottom)+")"),s.selectAll(".wk-chart-title-area").attr("transform","translate("+v/2+", "+(-Z+D)+")"),Y=a.allScales().getOwned();for(G in Y)W=Y[G],W.parentScale()||W.showAxis()&&W.showGrid()&&L(W);return l.style(a.backgroundStyle()),a.behavior().chartArea(o),a.behavior().container(s),angular.element(o.node()).on("$destroy",function(){return e.log("removing event listeners from",o.attr("class")),o.on(".tooltip",null),o.on(".brush",null),a.behavior().chartArea(void 0),p=void 0,f=void 0,l=void 0})},P.drawSingleAxis=function(e){var t;return e.showAxis()&&(t=C.select(".wk-chart-axis.wk-chart-"+e.axis().orient()),t.call(e.axis()),e.showGrid()&&L(e,!0)),P},P}}]),angular.module("wk.chart").factory("layout",["$log","scale","scaleList","timing",function(e,t,r){var n,a;return a=0,n=function(){var e,n,i,o,l,s,c,u,d,f,h;return l="layout"+a++,n=void 0,i=void 0,e=void 0,c=r(),u=!1,s=d3.dispatch("configure","drawChart","prepareData","brush","redraw","drawAxis","update","updateAttrs","brushDraw","destroy","objectsSelected","animationStartState","animationEndState"),h=function(){},h.id=function(){return l},h.chart=function(t){return 0===arguments.length?e:(e=t,c.parentScales(t.scales()),e.lifeCycle().on("configure."+h.id(),function(){return s.configure.apply(h.scales())}),e.lifeCycle().on("drawChart."+h.id(),h.draw),e.lifeCycle().on("prepareData."+h.id(),h.prepareData),e.lifeCycle().on("animationStartState.."+h.id(),h.animationStartState),e.lifeCycle().on("animationEndState.."+h.id(),h.animationEndState),e.lifeCycle().on("destroy."+h.id(),function(){return s.destroy(),e.lifeCycle().on("."+h.id(),null)}),h)},h.scales=function(){return c},h.scaleProperties=function(){return h.scales().getScaleProperties()},h.container=function(e){return 0===arguments.length?n:(n=e,h)},h.showDataLabels=function(e){return 0===arguments.length?u:(u=e,h)},o={"font-size":"1.3em"},h.dataLabelStyle=function(e){return 0===arguments.length?o:(_.isObject(e)&&_.assign(o,e),h)},h.behavior=function(){return h.chart().behavior()},h.prepareData=function(e){var t,r,n,a,i;for(t=[],i=["x","y","color","size","shape","rangeX","rangeY"],r=0,a=i.length;a>r;r++)n=i[r],t.push(c.getKind(n));return s.prepareData.apply(e,t)},h.lifeCycle=function(){return s},f=function(){var e,t;return e=n.getChartArea(),t=e.select("."+h.id()),t.empty()&&(t=e.append("g").attr("class",function(){return h.id()})),t},d=function(e,r){var a,i,o,l,s,u;for(s={height:n.height(),width:n.width(),margins:n.margins(),duration:r?0:h.chart().animationDuration()},a=[e,s],u=["x","y","color","size","shape"],i=0,l=u.length;l>i;i++)o=u[i],t=c.getKind(o),a.push(t);return a},h.draw=function(e,t){return i=e,s.drawChart.apply(f(),d(e,t)),s.on("redraw."+l,h.redraw),s.on("update."+l,h.chart().lifeCycle().update),s.on("drawAxis."+l,h.chart().lifeCycle().drawAxis),s.on("updateAttrs."+l,h.chart().lifeCycle().updateAttrs),s.on("brush."+l,function(e,t,r){return n.drawSingleAxis(e),s.brushDraw.apply(f(),[e,r,n.width(),n.height()])}),s.on("destroy."+l,function(){return s.on("."+l,null)})},h.animationStartState=function(e){return s.animationStartState.apply(f(),d(e,!0))},h.animationEndState=function(e){return s.animationEndState.apply(f(),d(e,!1))},h}}]),angular.module("wk.chart").factory("legend",["$log","$compile","$rootScope","$templateCache","wkChartTemplates",function(e,t,r,n,a){var i,o,l;return o=0,l=function(e){var t,r,n,a;for(a={},r=0,n=e.length;n>r;r++)t=e[r],a[t]=0;return Object.keys(a)},i=function(){var i,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S;return c="legend-"+o++,g="top-right",v=void 0,b=void 0,f=void 0,k=a.legendTemplate(),p=void 0,i=void 0,d=void 0,x=void 0,u=void 0,s=void 0,y=void 0,m=!1,w=!1,S={},S.position=function(e){return 0===arguments.length?g:(g=e,S)},S.show=function(n){return 0===arguments.length?m:n===m?S:(m=n,m?(f=r.$new(!0),e.log("creating legend scope",f.$id),p=t(k)(f)):e.log("destroying legend scope",f.$id),S)},S.showValues=function(e){return 0===arguments.length?w:(w=e,S)},S.div=function(e){return 0===arguments.length?d:(d=e,S)},S.layout=function(e){return 0===arguments.length?u:(u=e,S)},S.scale=function(e){return 0===arguments.length?v:(v=e,S)},S.title=function(e){return 0===arguments.length?x:(x=e,S)},S.template=function(e){return 0===arguments.length?b:(b=e,k=n.get(b),S)},h={},S.legendStyle=function(e){return 0===arguments.length?h:(_.isObject(e)&&_.assign(h,e),S)},S.draw=function(e,t){var r,n,a,o,c,u,h,m,w,k;if(s=e,y=t,i=d||d3.select(S.scale().parent().container().element()).select(".wk-chart"),S.show()){if(i.select(".wk-chart-legend").empty()&&angular.element(i.node()).append(p),c=S.showValues()?l(v.value(e)):v.layerKeys(e),k=v.scale(),(null!=(m=S.layout())?m.scales().layerScale():void 0)&&(k=S.layout().scales().layerScale().scale()),n=v.parent().scales().getKind("color").scale(),f.legendRows=c.map("shape"!==v.kind()?function(e){var t,r;return t=n(e),"string"==typeof t?r={fill:t,stroke:t}:(r=t,r.fill=t.color),{value:e,color:r}}:function(e){return{value:e,path:d3.svg.symbol().type(k(e)).size(80)()}}),f.showLegend=!0,f.legendStyle=S.legendStyle(),f.legendStyle.position=d?"relative":"absolute",!d)for(a=i.node().getBoundingClientRect(),r=i.select(".wk-chart-area .wk-chart-background").node().getBoundingClientRect(),w=g.split("-"),o=0,u=w.length;u>o;o++)h=w[o],f.legendStyle[h]=Math.abs(a[h]-r[h])+"px";f.title=x}else p.remove();return S},S.register=function(e){return e.lifeCycle().on("drawChart."+c,S.draw),e.lifeCycle().on("destroy."+c,function(){return f.$destroy(),p.remove(),p=void 0,i=void 0,d=void 0,e.lifeCycle().on("."+c,null)}),S},S.redraw=function(){return s&&y&&S.draw(s,y),S},S}}]);var indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").factory("scale",["$log","legend","formatDefaults","wkChartScales","wkChartLocale","maxTicks",function(e,t,r,n,a,i){var o;return o=function(){var o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L,M,O,K,P,V,T,z,E,F,N,G,q,R,I,j,H,U,X,Y,W,J,Z,Q,et,tt,rt,nt,at,it,ot,lt,st,ct,ut,dt,ft,ht;return w="",K=void 0,U=d3.scale.linear(),X="linear",v=1,S=!1,h=void 0,y=void 0,d=void 0,I=!1,E=d3.set(),B="",$=[],O="",at="",F=void 0,q=.1,R=.1,N=0,G=0,b=void 0,k=function(e){return isNaN(+e)||_.isDate(e)?e:+e},Y=!1,c=void 0,u=void 0,o=void 0,rt=void 0,Z=void 0,Q=void 0,tt=void 0,H=void 0,J=!1,l=void 0,W=!1,j=!1,x=!1,A=!1,D=void 0,T=void 0,z=void 0,f=void 0,L=void 0,M=t(),V=void 0,P=void 0,nt=a.timeFormat.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!==e.getDate()}],["%b %d",function(e){return 1!==e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",function(){return!0}]]),dt=function(){},lt=function(e){return _.isArray(e)?_.reject(_.keys(e[0]),function(e){return"$$hashKey"===e}):_.reject(_.keys(e),function(e){return"$$hashKey"===e})},ut=function(e,t){return t.reduce(function(t,r){return+t+ +dt.layerValue(e,r)},0)},st=function(e,t){return d3.max(e,function(e){return d3.max(t,function(t){return dt.layerValue(e,t)})})},ct=function(e,t){return d3.min(e,function(e){return d3.min(t,function(t){return dt.layerValue(e,t)})})},ft=function(e){return k.parse?k.parse(e):k(e)},it={extent:function(e){var t;return t=dt.layerKeys(e),[ct(e,t),st(e,t)]},max:function(e){var t;return t=dt.layerKeys(e),[0,st(e,t)]},min:function(e){var t;return t=dt.layerKeys(e),[0,ct(e,t)]},totalExtent:function(e){var t;return e[0].hasOwnProperty("total")?d3.extent(e.map(function(e){return e.total})):(t=dt.layerKeys(e),d3.extent(e.map(function(e){return ut(e,t)})))},total:function(e){var t;return e[0].hasOwnProperty("total")?[0,d3.max(e.map(function(e){return e.total}))]:(t=dt.layerKeys(e),[0,d3.max(e.map(function(e){return ut(e,t)}))])},rangeExtent:function(e){var t,r;return dt.upperProperty()?[d3.min(dt.lowerValue(e)),d3.max(dt.upperValue(e))]:e.length>1?(t=dt.lowerValue(e[0]),r=dt.lowerValue(e[1])-t,[dt.lowerValue(e[0]),t+r*e.length]):void 0},rangeMin:function(e){return[0,d3.min(dt.lowerValue(e))]},rangeMax:function(e){var t,r;return dt.upperProperty()?[0,d3.max(dt.upperValue(e))]:(t=dt.lowerValue(e[0]),r=dt.lowerValue(e[1])-t,[0,t+r*e.length])}},ht=function(e,t){var r,n,a,o,l,s;for(s=[1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],o=["seconds","minutes","hours","days","weeks","months","years"],a=o.indexOf(e),-1===a&&(a=3),r=+dt.domainMax()-dt.domainMin();;){if(n=r/s[a],l=n/t,a>=o.length||i>=l)break;a++}return o[a]!==e?d3.time[o[a]](dt.domainMin(),dt.domainMax()):d3.time[o[a]](dt.domainMin(),dt.domainMax(),t)},ot=function(){var e,t,r,n,a;if(!S&&dt.tickInterval()&&void 0!==dt.domainMax()&&void 0!==dt.domainMin()){if("time"===X)t=dt.tickInterval().split(":"),n=2===t.length&&d3.time.hasOwnProperty(t[0])?ht(t[0],t[1]):void 0;else for(a=Math.abs(Math.floor((dt.domainMax()-dt.domainMin())/dt.tickInterval())),a>i&&dt.tickInterval(Math.floor(dt.domainMax()-dt.domainMin())/i),r=Math.ceil(1+dt.domainMin()/dt.tickInterval())*dt.tickInterval(),n=[],e=0;r<dt.domainMax();)n[e]=r,e++,r+=dt.tickInterval();return dt.tickValues(n)}},dt.id=function(){return D+"."+K+"."+T.id()},dt.orientation=function(e){return 0===arguments.length?K:(K=e,dt)},dt.kind=function(e){return 0===arguments.length?D:(D=e,dt)},dt.parent=function(e){return 0===arguments.length?T:(T=e,dt)},dt.chart=function(e){return 0===arguments.length?f:(f=e,dt)},dt.layout=function(e){return 0===arguments.length?L:(L=e,dt)},C=!1,dt.isParentScale=function(e){return 0===arguments.length?C:(C=e,dt)},dt.parentScale=function(e){return 0===arguments.length?z:(z=e,z.isParentScale(!0),dt)},dt.scale=function(){return U},dt.legend=function(){return M},dt.isOrdinal=function(){return S},dt.isHorizontal=function(e){return 0===arguments.length?x:(x=e,e&&(dt.axisOrient()||dt.axisOrient("bottom"),A=!1),dt)},dt.isVertical=function(e){return 0===arguments.length?A:(A=e,e&&(dt.axisOrient()||dt.axisOrient("left"),x=!1),dt)},dt.scaleType=function(t){return 0===arguments.length?X:(d3.scale.hasOwnProperty(t)?(U=d3.scale[t](),X=t,dt.format(r.number)):"time"===t?(U=d3.time.scale(),X="time",b&&dt.dataFormat(b),dt.format(r.date)):n.hasOwnProperty(t)?(X=t,U=n[t]()):e.error("Error: illegal scale type:",t),S=_.has(U,"rangeBand"),F&&dt.range(F),Y&&o.scale(U),v&&"pow"===X&&U.exponent(v),dt)},dt.exponent=function(e){return 0===arguments.length?v:(v=e,"pow"===X&&U.exponent(v),dt)},dt.scaleMapFn=function(e){return 0===arguments.length?U.mapFn?U.mapFn():void 0:(_.isFunction(e)&&U.mapFn&&U.mapFn(e),dt)},dt.domain=function(e){return 0===arguments.length?h:(h=e,_.isArray(h)&&U.domain(h),dt)},dt.domainCalc=function(t){return 0===arguments.length?S?void 0:y:(it.hasOwnProperty(t)?y=t:e.error("illegal domain calculation rule:",t," expected",_.keys(it)),dt)},g=void 0,dt.domainMin=function(e){return 0===arguments.length?g||d[0]:(g=ft(e),dt)},p=void 0,p=void 0,dt.domainMax=function(e){return 0===arguments.length?p||d[1]:(p=ft(e),dt)},dt.getDomain=function(e){return 0===arguments.length?U.domain():!h&&dt.domainCalc()?(g&&(d[0]=g),p&&(d[1]=p),ot(),d):h?h:dt.value(e)},dt.resetOnNewData=function(e){return 0===arguments.length?I:(I=e,dt)},dt.range=function(e){var t;return 0===arguments.length?U.range():(F=e,!S||"x"!==(t=dt.kind())&&"y"!==t?"category10"!==X&&"category20"!==X&&"category20b"!==X&&"category20c"!==X&&U.range(e):"ordinalPadding"!==X?U.rangeBands(e,q,N):U.rangeBands(e),dt)},dt.rangePadding=function(e){return 0===arguments.length?{paddingLeft:q,paddingRight:R,outerPaddingLeft:N,outerPaddingRight:G}:(q=e.paddingLeft,R=e.paddingRight,N=e.outerPaddingLeft,G=e.outerPaddingRight,"ordinalPadding"===X&&(U.padding(q,R),U.outerPadding(N,G)),dt)},dt.property=function(e){return 0===arguments.length?E.values():(e&&dt.addProperty(e),dt)},dt.addProperty=function(e){var t,r,n,a;
if(_.isArray(e)){for(a=[],t=0,r=e.length;r>t;t++)n=e[t],a.push(E.add(n));return a}return E.add(e)},dt.layerProperty=function(e){return 0===arguments.length?B:(B=e,dt)},dt.layerExclude=function(e){return 0===arguments.length?$:($=e,dt)},dt.layerKeys=function(e){return E.size()>0?_.intersection(E.values(),lt(e)):_.reject(lt(e),function(e){return indexOf.call($,e)>=0})},dt.lowerProperty=function(e){return 0===arguments.length?O:(O=e,dt)},dt.upperProperty=function(e){return 0===arguments.length?at:(at=e,dt)},dt.dataFormat=function(e){return 0===arguments.length?b:(b=e,k="time"===X?a.timeFormat(e):function(e){return e},dt)},dt.value=function(e){var t;return t=E.values()[0],e?B?_.isArray(e)?e.map(function(e){return ft(e[t][B])}):ft(e[t][B]):_.isArray(e)?e.map(function(e){return ft(e[t])}):ft(e[t]):void 0},dt.layerValue=function(e,t){return e?ft(B?e[t][B]:e[t]):void 0},dt.formattedValue=function(e){return _.isArray(e)?e.map(function(e){return dt.formatValue(dt.value(e))}):dt.formatValue(dt.value(e))},dt.formattedLayerValue=function(e,t){return _.isArray(e)?e.map(function(e){return dt.formatValue(dt.layerValue(e,t))}):dt.formatValue(dt.layerValue(e,t))},dt.formatValue=function(e){return V&&e&&(e.getUTCDate||!isNaN(e))?P(e):e},dt.map=function(e,t){return t?Array.isArray(e)?e.map(function(){return U(dt.layerValue(e,t))}):U(dt.layerValue(e,t)):Array.isArray(e)?e.map(function(){return U(dt.value(e))}):U(dt.value(e))},dt.invert=function(e){var t,r,n,a,i;return _.has(dt.scale(),"invert")?(n=(U.range()[1]-U.range()[0])/f.getData().length,U.invert(e-n/2)):_.has(dt.scale(),"invertExtent")?dt.scale().invertExtent(e):dt.isOrdinal()&&dt.resetOnNewData()?(t=U.domain(),i=U.range(),i[0]>i[1]?(a=i[0]-i[1],r=i.length-Math.floor(e/a)-1,0>r&&(r=0)):(a=i[1]-i[0],r=Math.floor(e/a),r>=i.length&&(r=i.length-1)),t[r]):void 0},dt.findIndex=function(e){var t,r,n;return t=dt.chart().getData(),S?_.findIndex(t,function(t){return e===dt.value(t)}):_.isArray(e)&&2===e.length?void 0:(r=d3.bisector(dt.value).left,n=r(t,e),n=0>n?0:n>=t.length?t.length-1:n)},dt.find=function(e){return dt.chart().getData()[dt.findIndex(e)]},dt.showAxis=function(e){return 0===arguments.length?Y:(Y=e,e?(o=d3.svg.axis(),"time"===dt.scaleType()&&o.tickFormat(nt)):o=void 0,dt)},dt.axisOrient=function(e){return 0===arguments.length?c:(u=c,c=e,dt)},dt.axisOrientOld=function(e){return 0===arguments.length?u:(u=e,dt)},dt.axis=function(){return o},dt.ticks=function(e){return 0===arguments.length?rt:(rt=e,dt.axis()&&dt.axis().ticks(rt),dt)},dt.tickInterval=function(e){return 0===arguments.length?Q:(S||("time"!==X?Q=ft(e):/\w+:\d+/.test(e)&&(Q=e)),dt)},dt.tickFormat=function(e){return 0===arguments.length?Z:(Z=e,dt.axis()&&dt.axis().tickFormat(e),dt)},dt.tickValues=function(e){return 0===arguments.length?tt:(tt=e,dt.axis()&&dt.axis().tickValues(e),dt)},et={"font-size":"1em"},dt.tickLabelStyle=function(e){return 0===arguments.length?et:(_.isObject(e)&&_.assign(et,e),dt)},dt.showLabel=function(e){return 0===arguments.length?J:(J=e,dt)},dt.axisLabel=function(e){return 0===arguments.length?l?l:dt.property()[0]:(l=e,dt)},s={"font-size":"1.5em"},dt.axisLabelStyle=function(e){return 0===arguments.length?s:(_.isObject(e)&&_.assign(s,e),dt)},dt.rotateTickLabels=function(e){return 0===arguments.length?H:(H=e,dt)},dt.format=function(e){return 0===arguments.length?V:(V=e.length>0?e:"time"===dt.scaleType()?r.date:r.number,P="time"===dt.scaleType()?a.timeFormat(V):a.numberFormat(V),dt)},dt.showGrid=function(e){return 0===arguments.length?W:(W=e,dt)},m={stroke:"lightgrey","stroke-width":1},dt.gridStyle=function(e){return 0===arguments.length?m:(_.isObject(e)&&_.assign(m,e),dt)},dt.reverse=function(e){return 0===arguments.length?j:(j=e,dt)},dt.register=function(){return dt.chart().lifeCycle().on("scaleDomains."+dt.id(),function(t){var r;return dt.parentScale()?U=dt.parentScale().scale():dt.resetOnNewData()?(r=dt.getDomain(t),"linear"===X&&_.some(r,isNaN)?e.error("Scale "+dt.kind()+", Type '"+X+"': cannot compute domain for property '"+E+"' . Possible reasons: property not set, data not compatible with defined type. Domain:"+r):U.domain(r)):void 0}),dt.chart().lifeCycle().on("prepareData."+dt.id(),function(e){var t,r,n,a,i,o,l,s,c,u;l=dt.chart().allScales().getOwned();for(n in l)u=l[n],u.parentScale()&&u.parentScale().addProperty(u.property());r=d3.set(),s=dt.chart().allScales().getOwned();for(n in s)if(u=s[n],u!==dt&&u.parentScale()!==dt)for(c=u.property(),a=0,i=c.length;i>a;a++)o=c[a],r.add(o);return dt.layerExclude(r.values()),t=dt.domainCalc(),t&&it[t]?d=it[t](e):void 0}),dt.chart().lifeCycle().on("destroy."+dt.id(),function(){return dt.chart().lifeCycle().on("."+dt.id(),null)})},dt.update=function(e){return dt.parent().lifeCycle().update(e),dt},dt.updateAttrs=function(){return dt.parent().lifeCycle().updateAttrs()},dt.drawAxis=function(){return dt.parent().lifeCycle().drawAxis(),dt},dt}}]),angular.module("wk.chart").factory("scaleList",["$log",function(e){var t;return t=function(){var t,r,n,a,i,o,l;return n={},t={},i={},a=void 0,o=[],r=void 0,l=function(){},l.owner=function(e){return 0===arguments.length?a:(a=e,l)},l.add=function(r){return n[r.id()]&&e.error("scaleList.add: scale "+r.id()+" already defined in scaleList of "+a.id()+". Duplicate scales are not allowed"),n[r.id()]=r,t[r.kind()]=r,l},l.hasScale=function(e){return n.hasOwnProperty(e.id())},l.getKind=function(e,r){var a,o;if(r){for(a in n)if(o=n[a],o.kind()===e&&o.orientation()===r)return o;return void 0}return t[e]?t[e]:i.getKind?i.getKind(e):void 0},l.hasKind=function(e,t){var r,a;if(t){for(r in n)if(a=n[r],a.kind()===e&&a.orientation()===t)return!0;return!1}return!!l.getKind(e)},l.remove=function(t){return n[t.id()]?(delete n[t.id()],delete l[t.id],l):(e.warn("scaleList.delete: scale "+t.id()+" not defined in scaleList of "+a.id()+". Ignoring"),l)},l.parentScales=function(e){return 0===arguments.length?i:(i=e,l)},l.getOwned=function(){return n},l.allKinds=function(){var e,r,n,a;if(n={},i.allKinds){r=i.allKinds();for(e in r)a=r[e],n[e]=a}for(e in t)a=t[e],n[e]=a;return n},l.requiredScales=function(e){var t,r,n;if(0===arguments.length)return o;for(o=e,t=0,n=e.length;n>t;t++)if(r=e[t],!l.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";return l},l.getScales=function(e){var t,r,n,a;for(n={},t=0,a=e.length;a>t;t++){if(r=e[t],!l.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";n[r]=l.getKind(r)}return n},l.getScaleProperties=function(){var e,t,r,n,a;t=[],n=l.allKinds();for(e in n)a=n[e],r=a.property(),r.length>0&&t.concat(r);return t},l.layerScale=function(e){return 0===arguments.length?r?l.getKind(r):void 0:(r=e,l)},l}}]),angular.module("wk.chart").provider("wkChartLocale",function(){var e,t;return e="en_US",t={de_DE:d3.locale({decimal:",",thousands:".",grouping:[3],currency:[""," €"],dateTime:"%A, der %e. %B %Y, %X",date:"%e.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),en_US:d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},this.setLocale=function(r){if(_.has(t,r))return e=r;throw"unknowm locale '"+r+"' using 'en-US' instead"},this.addLocaleDefinition=function(e,r){return t[e]=d3.locale(r)},this.$get=["$log",function(){return t[e]}],this}),angular.module("wk.chart").provider("wkChartScales",function(){var e,t,r,n,a,i,o,l,s,c;return e=["red","orange","yellow","green","blue"],t=void 0,s=function(){var e,t;return e=d3.scale.ordinal(),t=function(e){return 0===arguments.length?t:e},t.invert=function(e){return e},t.domain=d3.scale.domain,t.range=d3.scale.domain,t},l=function(){var e,t,r;return t=d3.scale.ordinal(),e=function(e){var r,n,a,i,o,l;for(r=0,i=t.range().length-1,l=[],n=a=0,o=e.length;o>=0?o>=a:a>=o;n=o>=0?++a:--a)l.push(r=(31*r+e.charAt(n))%i);return l},r=function(n){return arguments?t(e(n)):r},r.range=function(e){return arguments?(t.domain(d3.range(e.length)),t.range(e)):t.range()},r.domain=t.domain,r.rangePoint=t.rangePoints,r.rangeBands=t.rangeBands,r.rangeRoundBands=t.rangeRoundBands,r.rangeBand=t.rangeBand,r.rangeExtent=t.rangeExtent,r.hash=function(t){return arguments?(e=t,r):e},r},o=function(){var e,r,n;return e=d3.scale.ordinal(),r=t||e,n=function(e){return arguments?r.apply(n,[e,n.domain()]):n},n.mapFn=function(e){return arguments?(_.isFunction(e)&&(r=e),n):r},n.domain=e.domain,n.range=e.range,n.rangePoint=e.rangePoints,n.rangeBands=e.rangeBands,n.rangeRoundBands=e.rangeRoundBands,n.rangeBand=e.rangeBand,n.rangeExtent=e.rangeExtent,n},c=function(){var e,t,r,n,a,i,o,l,s,c,u;return c=d3.scale.ordinal(),i=0,o=0,n=0,a=0,t=[],r=void 0,e=!0,l=[],s=0,u=function(t){return arguments?e?c(t):l[r.get(t)]:u},u.range=function(t){return 0===arguments.length?e?c.range():l:c.range(t)},u.domain=function(n){var a,i,o,l;for(arguments.length||e&&c.domain(),c.domain(n),t=[],r=d3.map(),a=-1,i=n.length,o=[];++a<i;)o.push(r.has(l=n[a])?void 0:r.set(l,t.push(l)-1));return o},u.rangePoint=c.rangePoints,u.rangeBands=function(r){var d,f,h,y,p,g,v,m,w;if(c.rangeBands.apply(this,arguments),arguments.length=1){for(e=!1,d=r[1]<r[0],d?(m=r[1],w=r[0]):(m=r[0],w=r[1]),f=(w-m)/(t.length+n+a),s=f*(1-i-o),p=d?o+a:i+n,g=m+f*p,h=y=0,v=t.length-1;v>=0?v>=y:y>=v;h=v>=0?++y:--y)l[h]=g+h*f;return d&&l.reverse(),u}},u.rangeRoundBands=c.rangeRoundBands,u.rangeBand=function(){return e?c.rangeBand():s},u.rangeExtent=c.rangeExtent,u.copy=c.copy,u.padding=function(e,t){return i=e,o=2===arguments.length?t:i},u.outerPadding=function(e,t){return n=e,a=2===arguments.length?t:n},u},a=function(){return d3.scale.ordinal().range(e)},r=function(){return d3.scale.ordinal().range(d3.scale.category20().range().map(function(e){return"url(#lgrad-"+e.replace("#","")+")"}))},n=function(){return d3.scale.ordinal().range(d3.scale.category20().range().map(function(e){return"url(#rgrad-"+e.replace("#","")+")"}))},i=function(){return l().range(e)},this.colors=function(t){return e=t},this.customMapFn=function(e){var t;return _.isFunction(e)?t=e:void 0},this.$get=["$log",function(){return{hashed:l,customCategory:a,customCategoryHashed:i,customScale:o,category20Linear:r,category20Radial:n,ordinalIdentity:s,ordinalPadding:c}}],this}),angular.module("wk.chart").provider("wkChartTemplates",function(){var e,t,r;return r="templates/toolTip.html",e="templates/legend.html",t="templates/patterns.html",this.setTooltipTemplate=function(e){return r=e},this.setLegendTemplate=function(t){return e=t},this.setSVGDefsUrl=function(e){return t=e},this.$get=["$log","$templateCache",function(n,a){return{tooltipTemplate:function(){return a.get(r)},legendTemplate:function(){return a.get(e)},svgDefTemplate:function(){return a.get(t)}}}],this}),angular.module("wk.chart").service("selectionSharing",["$log",function(){var e,t,r;return e={},t={},r={},this.createGroup=function(){},this.setSelection=function(n,a,i){var o,l,s,c,u;if(i&&(e[i]=n,t[i]=a,r[i])){for(c=r[i],u=[],l=0,s=c.length;s>l;l++)o=c[l],u.push(o(n,a));return u}},this.getSelection=function(e){var t;return t=e||"default",selection[t]},this.register=function(e,t){return e&&(r[e]||(r[e]=[]),!_.contains(r[e],t))?r[e].push(t):void 0},this.unregister=function(e,t){var n;return r[e]&&(n=r[e].indexOf(t),n>=0)?r[e].splice(n,1):void 0},this}]),angular.module("wk.chart").service("timing",["$log",function(e){var t,r,n;return n={},r=0,t=0,this.init=function(){return r=Date.now()},this.start=function(e){var t;return t=n[e],t||(t=n[e]={name:e,start:0,total:0,callCnt:0,active:!1}),t.start=Date.now(),t.active=!0},this.stop=function(e){var a;return(a=n[e])&&(a.active=!1,a.total+=Date.now()-a.start,a.callCnt+=1),t=Date.now()-r},this.report=function(){var r,a;for(r in n)a=n[r],a.avg=a.total/a.callCnt;return e.info(n),e.info("Elapsed Time (ms)",t),n},this.clear=function(){return n={}},this}]),angular.module("wk.chart").factory("dataLabelFactory",["$log","wkChartMargins",function(e,t){var r,n;return n=0,r=function(){var e,r,n,a,i,o,l,s,c,u,d;return o=void 0,e=!1,i=void 0,u=void 0,a=void 0,c=void 0,r=void 0,l=void 0,n=void 0,s={"font-size":"1.3em"},d=function(t,s,d){var f,h;return o=t,f=i.scale().rangeBand(),h=t.select("text"),h.empty()&&(h=t.append("text").attr("class","wk-chart-data-label").attr(r).style("opacity",0).attr(a,function(e){return e.added||e.deleted?0:f/2}).attr(c,function(e){return l+("x"===c?Math.abs(u.scale()(0)-u.scale()(e.targetValue)):Math.min(u.scale()(0),u.scale()(e.targetValue)))})),h.text(function(e){return u.formatValue(e.targetValue)}).style(d),(s?h.transition().duration(n):h).attr(a,function(e){return e.added||e.deleted?0:f/2}).attr(c,function(e){return l+("x"===c?Math.abs(u.scale()(0)-u.scale()(e.targetValue)):Math.min(u.scale()(0),u.scale()(e.targetValue)))}).style("opacity",function(t){return t.added||t.deleted||!e?0:1})},d.brush=function(e){return e.select("text").attr(a,i.scale().rangeBand()/2)},d.active=function(t){return 0===arguments.length?e:(e=t,d)},d.keyScale=function(e){return 0===arguments.length?i:(i=e,i.isHorizontal()?(a="x",c="y",r={"text-anchor":"middle"},l=-t.dataLabelPadding.vert):(a="y",c="x",r={"text-anchor":"start",dy:"0.35em"},l=t.dataLabelPadding.hor),d)},d.valueScale=function(e){return 0===arguments.length?u:(u=e,d)},d.duration=function(e){return 0===arguments.length?n:(n=e,d)},d.style=function(e){return 0===arguments.length?s:(s=e,d)},d}}]),angular.module("wk.chart").factory("layeredData",["$log",function(){var e;return e=function(){var e,t,r,n,a,i,o,l,s;return t=[],r=[],l=void 0,e=!1,a=1/0,n=-1/0,o=1/0,i=-1/0,s=function(){},s.data=function(e){return arguments.length(Is(0))?t:(t=e,s)},s.layerKeys=function(e){return 0===arguments.length?r:(r=e,s)},s.x=function(e){return 0===arguments.length?l:(l=e,s)},s.calcTotal=function(t){return 0===arguments.length?e:(e=t,s)},s.min=function(){return a},s.max=function(){return n},s.minTotal=function(){return o},s.maxTotal=function(){return i},s.extent=function(){return[s.min(),s.max()]},s.totalExtent=function(){return[s.minTotal(),s.maxTotal()]},s.columns=function(t){var c,u,d,f,h,y,p,g,v,m,w,k,b,x;if(1===arguments.length){for(w=[],a=1/0,n=-1/0,o=1/0,i=-1/0,u=d=0,y=r.length;y>d;u=++d)f=r[u],w[u]={key:f,value:[],min:1/0,max:-1/0};for(u=v=0,p=t.length;p>v;u=++v){for(c=t[u],k=0,x="string"==typeof l?c[l]:l(c),m=0,g=w.length;g>m;m++)h=w[m],b=+c[h.key],h.value.push({x:x,value:b,key:h.key}),h.max<b&&(h.max=b),h.min>b&&(h.min=b),b>n&&(n=b),a>b&&(a=b),e&&(k+=+b);e&&(k>i&&(i=k),o>k&&(o=k))}return{min:a,max:n,totalMin:o,totalMax:i,data:w}}return s},s.rows=function(e){return 1===arguments.length?e.map(function(e){return{x:e[l],layers:layerKeys.map(function(t){return{key:t,value:e[t],x:e[l]}})}}):s},s}}]),angular.module("wk.chart").factory("markerFactory",["$log","d3Animation",function(e,t){var r,n;return n=0,r=function(){var e,r,a,i,o,l,s,c,u,d,f,h;return d=void 0,f=void 0,r=void 0,e=!1,u=0,o=0,a=t.duration,l=!1,s=void 0,c=void 0,i=n++,h=function(t,n){var l,s,h;return c=t,e?(l=t.selectAll(".wk-chart-marker-"+i).data(function(e){return e.values},function(e,t){return t}),l.enter().append("circle").attr("class","wk-chart-marker-"+i).style("fill",r).attr("r",5).style("pointer-events","none").style("opacity",o),h=n?l.transition().duration(a):l,h.attr("cx",d).attr("cy",f).style("opacity",function(e){return(e.added||e.deleted||e.layerAdded||e.layerDeleted?0:1)*u}),s=n?l.exit().transition().duration(a):l.exit(),s.remove()):t.selectAll(".wk-chart-marker-"+i).transition().duration(a).style("opacity",0).remove()},h.brush=function(t,r){var n,a,o;return e?(l?(n="cy",o=f):(n="cx",o=d),r?c.selectAll(".wk-chart-marker-"+i).attr(n,o).style("opacity",function(e,t){return r[0]<=t&&t<=r[1]?1:0}):(a=s.domain(),c.selectAll(".wk-chart-marker-"+i).attr(n,o).style("opacity",function(e){return a[0]<=e.key&&e.key<=a[1]?1:0}))):void 0},h.active=function(t){return 0===arguments.length?e:(o=!e&&t?0:1,e=t,u=e?1:0,h)},h.x=function(e){return 0===arguments.length?d:(d=e,h)},h.y=function(e){return 0===arguments.length?f:(f=e,h)},h.color=function(e){return 0===arguments.length?r:(r=e,h)},h.opacity=function(e){return 0===arguments.length?u:(u=e,h)},h.duration=function(e){return 0===arguments.length?a:(a=e,h)},h.isVertical=function(e){return 0===arguments.length?l:(l=e,h)},h.keyScale=function(e){return 0===arguments.length?s:(s=e,h)},h}}]),angular.module("wk.chart").directive("svgIcon",["$log",function(e){return{restrict:"E",template:'<svg ng-style="style"><path></path></svg>',scope:{path:"@",width:"@"},link:function(t,r,n){return t.style={height:"20px",width:t.width+"px","vertical-align":"middle"},n.$observe("path",function(e){return e?d3.select(r[0]).select("path").attr("d",e).attr("transform","translate(8,8)"):void 0}),t.$on("$destroy",function(){return e.log("svgIcon scope destroyed")})}}}]),angular.module("wk.chart").factory("tooltipHelperFactory",["$log",function(){var e,t;return e=0,t=function(){var t,r,n,a,i,o,l,s,c,u,d,f;return s=void 0,d=void 0,l=!1,a=void 0,n=!1,c=void 0,u=void 0,o=void 0,t=[],r=void 0,i=e++,f={},f.keyScale=function(e){return 0===arguments.length?s:(s=e,f)},f.valueScale=function(e){var t;return 0===arguments.length?d:(d=e,t="rangeX"===d.kind()||"rangeY"===d.kind(),f)},f.isStacked=function(e){return 0===arguments.length?l:(l=e,f)},f.colorScale=function(e){return 0===arguments.length?a:(a=e,f)},f.colorByKey=function(e){return 0===arguments.length?n:(n=e,f)},f.layout=function(e){var r,n,a,i,l;if(0===arguments.length)return c;for(c=e,o=[],t=[0,c[0].values.length-1],l=c[0].values,n=a=0,i=l.length;i>a;n=++a)r=l[n],r.deleted||o.push(n);return f},f.brushRange=function(e){return 0===arguments.length?t:t=e},f.value=function(e){return 0===arguments.length?u:(u=e,f)},f.enter=function(e){var t,r,i,o,l,c,u;for(this.headerName=s.axisLabel(),this.headerValue=s.formattedValue(e),o=d.parentScale()?d.parentScale().layerKeys(e):d.layerKeys(e),c=[],r=0,l=o.length;l>r;r++)i=o[r],this.layers[i]={},this.layers[i].value=d.formattedLayerValue(e,i),t="",t=a.property().length>0?a.map(e):a.scale()(n?s.value(e):i),"string"==typeof t?u={fill:t,stroke:t}:(u=t,u.fill=t.color),c.push(this.layers[i].color=u);return c},f.moveData=function(e,t){return f.enter.apply(this,[t])},f.moveMarkers=function(e,t){var n,o,c,u,f,h,y,p,g,v;if(e&&t){if(p=s.value(t),h=d.layerKeys(t),o=h.map(function(e){return{key:e,value:d.layerValue(t,e)}}),l)for(v=0,u=0,y=o.length;y>u;u++)f=o[u],v+=f.value,f.value=v;return r=this.selectAll(".wk-chart-tt-marker-"+i).data(o,function(e){return e.key}),c=r.enter().append("g").attr("class","wk-chart-tt-marker-"+i),c.append("circle").attr("class","wk-chart-tt-marker").attr("r",9).style("fill",function(e){var t;return t=a.scale()(e.key),"string"==typeof t?t:t.color}).style("fill-opacity",.3).style("stroke",function(e){return a.scale()(e.key)}).style("pointer-events","none"),c.append("circle").attr("class","wk-chart-tt-inner-marker").attr("r",4).style("fill",function(e){var t;return t=a.scale()(e.key),"string"==typeof t?t:t.color}).style("fill-opacity",.6).style("stroke","white").style("pointer-events","none"),n=s.isHorizontal()?"cy":"cx",r.select(".wk-chart-tt-marker").attr(n,function(e){return d.scale()(e.value)}),r.select(".wk-chart-tt-inner-marker").attr(n,function(e){return d.scale()(e.value)}),r.exit().remove(),g=s.isOrdinal()?s.scale().rangeBand()/2:0,s.isHorizontal()?(isNaN(s.scale()(p)+g),this.attr("transform","translate("+(s.scale()(p)+g)+")")):this.attr("transform","translate(0,"+(s.scale()(p)+g)+")")}},f}}]),angular.module("wk.chart").service("utils",["$log",function(){var e;return this.diff=function(e,t,r){var n,a,i,o;for(i=function(e){return t.indexOf(e)<0},o={},n=0;n<e.length;){if(i(e[n]))for(o[e[n]]=void 0,a=n+r;a>=0&&a<e.length;){if(!i(e[a])){o[e[n]]=e[a];break}a+=r}n++}return o},e=0,this.getId=function(){return"Chart"+e++},this.parseList=function(e){var t;return e?(t=e.trim().replace(/^\[|\]$/g,"").split(",").map(function(e){return e.replace(/^[\"|']|[\"|']$/g,"")}),1===t.length?t[0]:t):void 0},this.parseTrueFalse=function(e){return""===e||"true"===e?!0:"false"===e?!1:void 0},this.parsePadding=function(e,t,r){var n;return"false"===e?(t.paddingLeft=t.paddingRight=0,t.outerPaddingLeft=t.outerpaddingRight=0):"true"===e?t=_.clone(r,!0):(n=this.parseList(e),n&&(1===n.length?(t.paddingLeft=t.paddingRight=n[0]/100,t.outerPaddingLeft=t.outerpaddingRight=n[0]/100):2===n.length?(t.paddingLeft=t.paddingRight=n[0]/100,t.outerPaddingLeft=t.outerpaddingRight=n[1]/100):3===n.length?(t.paddingLeft=n[0]/100,t.paddingRight=n[1]/100,t.outerPaddingLeft=t.outerpaddingRight=n[2]/100):4===n.length&&(t.paddingLeft=n[0]/100,t.paddingRight=n[1]/100,t.outerPaddingLeft=n[2]/100,t.outerpaddingRight=n[3]/100)),t)},this.mergeData=function(){var e,t,r,n,a,i,o,l,s,c,u;return s=[],t=[],c={},n={},l=[],e=[],r=void 0,i=void 0,a=function(e){return e},o=function(e){return e},u=function(r){var i,o,d,f,h,y,p,g;for(s=[],c={},o=f=0,y=t.length;y>f;o=++f)i=t[o],s[o]=i,c[a(i)]=o;for(l=[],e=[],n={},t=r,d=g=0,p=t.length;p>g;d=++g)i=t[d],h=a(i),n[h]=d,c.hasOwnProperty(h)&&(l[c[h]]=!0,e[d]=!0);return u},u.key=function(e){return arguments?(a=e,u):a},u.first=function(e){return arguments?(r=e,u):r},u.last=function(e){return arguments?(i=e,u):i},u.added=function(){var r,n,a,i,o;for(o=[],n=a=0,i=t.length;i>a;n=++a)r=t[n],e[n]||o.push(_d);return o},u.deleted=function(){var e,t,r,n,a;for(a=[],e=t=0,r=s.length;r>t;e=++t)n=s[e],l[e]||a.push(s[e]);return a},u.current=function(e){return t[n[e]]},u.prev=function(e){return s[c[e]]},u.addedPred=function(i){var o;for(o=n[a(i)];!e[o];)if(o--<0)return r;return s[c[a(t[o])]]},u.addedPred.left=function(e){return u.addedPred(e).x},u.addedPred.right=function(e){var t;return t=u.addedPred(e),_.has(t,"width")?t.x+t.width:t.x},u.deletedSucc=function(e){var r;for(r=c[a(e)];!l[r];)if(r++>=s.length)return i;return t[n[a(s[r])]]},u},this.mergeSeriesSorted=function(e,t){var r,n,a,i,o,l;for(n=0,r=0,o=e.length-1,i=t.length-1,a=Math.max(o,i),l=[];o>=n&&i>=r;)+e[n]===+t[r]?(l.push([n,Math.min(r,i),e[n]]),n++,r++):+e[n]<+t[r]?(l.push([n,void 0,e[n]]),n++):(l.push([void 0,Math.min(r,i),t[r]]),r++);for(;o>=n;)l.push([n,void 0,e[n]]),n++;for(;i>=r;)l.push([void 0,Math.min(r,i),t[r]]),r++;return l},this.mergeSeriesUnsorted=function(e,t){var r,n,a,i,o,l;for(n=0,r=0,o=e.length-1,i=t.length-1,a=Math.max(o,i),l=[];o>=n&&i>=r;)e[n]===t[r]?(l.push([n,Math.min(r,i),e[n]]),n++,r++):t.indexOf(e[n])<0?(l.push([n,void 0,e[n]]),n++):(l.push([void 0,Math.min(r,i),t[r]]),r++);for(;o>=n;)l.push([n,void 0,e[n]]),n++;for(;i>=r;)l.push([void 0,Math.min(r,i),t[r]]),r++;return l},this}]),angular.module("wk.chart").directive("chartGenerator",["$log","chartFactory","modelTypes",function(e,t){return{restrict:"E",scope:{markup:"=",properties:"=",error:"&",warning:"&"},link:function(e,r,n){return n.properties&&(e.properties=t.create()),e.$watch("properties",function(){if(t.verify()){if(n.markup&&(e.markup=t.generateMarkup(e.properties)),n.warning&&t.hasWarnings)return e.warning({warnings:t.warnings})}else if(n.error)return e.error({errors:t.errors})},!0)}}}]),angular.module("wk.chart").service("modelUtils",["$log","$templateCache","modelTypes",function(e,t,r){var n;return this.camelToDash=n=function(e){return e.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(e){return e.replace(/\W+(.)/g,function(e,t){return t.toUpperCase()})},this.addProperty=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r].value},set:function(e){return t[r].value=e},enumerable:!0})},this.addGetter=function(e,t,r){return Object.defineProperty(e,r,{get:function(){return t[r]},enumerable:!0})},this.addProperties=function(e,t,n){var a,i;for(i in e)a=e[i],_.has(n,i)||(t[i]={},this.addProperty(n,t,i),_.isString(a)?t[i].validator=r.getValidator(a):"enum"===a.type&&(t[i]["enum"]=a.values,t[i].validator=r.getValidator(a)));return n.validate=function(e,r){return t[e].validator.apply(t[e],[r])},n.acceptedValues=function(e){return t[e]["enum"]}},this.addDecorator=function(e,t,n){return t[e.name]={},t[e.key]={},this.addProperty(n,t,e.key),_.has(e,"value")&&(this.addProperty(n,t,e.name),_.isString(e.value)&&(t[e.name].validator=r.getValidator(e.value)),"enum"===e.value.type&&(t[e.name]["enum"]=e.value.values,t[e.name].validator=r.getValidator(e.value))),this.addProperties(e.properties,t,n)},this.addDecorators=function(e,t,r){var n,a,i,o;if(e){for(o=[],a=0,i=e.length;i>a;a++)n=e[a],o.push(this.addDecorator(n,t,r));return o}},this.generateProperties=function(e,t){var r,a,i;r="";for(a in e)i=e[a],void 0!==t[a]&&null!==t[a]&&""!==t[a]&&(r+=_.has(e[a],"generator")?e[a].generator(t[a]):_.isObject(t[a])?" "+n(a)+'="'+t[a].toString()+'"':" "+n(a)+'="'+t[a]+'"');return r},this.generateDecorators=function(e,t){var r,a,i,o;if(o="",e){for(a=0,i=e.length;i>a;a++)r=e[a],t[r.key]&&(o+=_.has(r,"generator")?r.generator(t[r.name]):t[r.name]?" "+n(r.name)+'="'+t[r.name]+'"':" "+n(r.name),o+=this.generateProperties(r.properties,t));return o}return""},this}]),angular.module("wk.chart").service("chartFactory",["$log","modelTypes","dimensionFactory","layoutFactory","modelUtils",function(e,t,r,n,a){var i;return i=function(e){return function(e){var i,o;return i={},i.dimensions={},i.layouts={},i.properties=[],o={},a.addProperties(e.properties,i,o),a.addDecorators(e.decorators,i,o),a.addGetter(o,i,"dimensions"),a.addGetter(o,i,"layouts"),a.addGetter(o,i,"properties"),o.availableDimensions=function(){return _.keys(t.dimension)},o.addDimension=function(e){return i.dimensions[e]=r.create(e),i.dimensions[e]},o.removeDimension=function(e){return void delete i.dimensions[e]},o.availableLayouts=function(){return _.keys(t.layouts)},o.addLayout=function(e,t){var r;return r=n.create(t),i.layouts[e]=r,i.layouts[e].layoutName=e,r},o.removeLayout=function(e){return void delete i.layouts[e]},o.addProperty=function(e,t,r){var n,a,l,s,c;return l=i.dimensions[t]?r+"."+t:r,n=i.layouts[l],n||(n=o.addLayout(l,r)),a=n.dimensions[t],a||(a=n.addDimension(t)),s=a.property,s?(c=s.split(","),c.indexOf(e.trim())<0?(c.push(e.trim()),a.property=c.join(","),i.properties.push({property:e,dimName:t,dimension:a,layoutName:r,layout:n})):void 0):(a.property=e.trim(),i.properties.push({property:e,dimName:t,dimension:a,layoutName:r,layout:n}))},o.removeProperty=function(e,t,r){var n,a,l,s,c,u,d,f;for(l=i.layouts[r],s=l.dimensions[t],u=s.property,d=u.split(","),d.splice(d.indexOf(e),1),d.length>0?s.property=d.join(","):(s.property="",l.removeDimension(t),0===_.keys(l.dimensions).length&&o.removeLayout(r)),f=i.properties.filter(function(n){return n.property===e&&n.dimName===t&&(n.layoutName=r)}),a=0,c=f.length;c>a;a++)n=f[a],i.properties.splice(i.properties.indexOf(n),1)},o.getDescriptor=function(){return e},o}(e)},this.create=function(){return i(t.chart)},this.verify=function(){return!0},this.generateMarkup=function(e){var t,i;return t=e.getDescriptor(),i="<"+t.name,i+=a.generateProperties(t.properties,e),i+=a.generateDecorators(t.decorators,e),i+=">",i+=r.generateMarkup(e.dimensions),i+=n.generateMarkup(e.layouts),i+="\n</"+t.name+">"},this.hasErrors=!1,this.errors=[],this.hasWarnings=!1,this.warnings=[],this}]),angular.module("wk.chart").service("dimensionFactory",["$log","modelUtils","modelTypes",function(e,t,r){var n;return n=function(e){return function(e){var r,n;return r={},n={},t.addProperties(e.properties,r,n),t.addDecorators(e.decorators,r,n),n.getDescriptor=function(){return e},n}(e)},this.create=function(e){return _.has(r.dimension,e)?n(r.dimension[e]):void 0},this.generateMarkup=function(e){var r,n,a,i;a="";for(i in e)n=e[i],r=n.getDescriptor(),a+="\n		<"+r.name,a+=t.generateProperties(r.properties,n),a+=t.generateDecorators(r.decorators,n),a+=" />";return a},this}]),angular.module("wk.chart").service("layoutFactory",["$log","dimensionFactory","modelTypes","modelUtils",function(e,t,r,n){var a;return a=function(e){return function(e){var r,a,i,o,l;r={},r.dimensions={},r.layout=e.name,i={},n.addProperties(e.properties,r,i),n.addDecorators(e.decorators,r,i),l=e.dimensions;for(o in l)a=l[o],r.dimensions[o]=t.create(o);return n.addGetter(i,r,"dimensions"),n.addGetter(i,r,"layout"),i.addDimension=function(e){return r.dimensions[e]=t.create(e),r.dimensions[e]},i.removeDimension=function(e){return void delete r.dimensions[e]},i.getDescriptor=function(){return e},i}(e)},this.create=function(e){return _.has(r.layouts,e)?a(r.layouts[e]):void 0},this.generateMarkup=function(e){var r,a,i,o;i="";for(o in e)a=e[o],r=a.getDescriptor(),i+="\n	<layout",a[n.dashToCamel(r.name)]||(i+=" "+n.camelToDash(r.name)),i+=n.generateProperties(r.properties,a),i+=n.generateDecorators(r.decorators,a),i+=">",i+=t.generateMarkup(a.dimensions),i+="\n	</layout>";return i},this}]);var indexOf=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("wk.chart").service("modelTypes",["$log","wkChartScales",function(e,t){var r,n,a,i,o,l,s,c,u,d,f,h,y,p,g,v,m,w,k,b,x,S,C,A,D,$,B,L,M;return y=function(e,t,r,n){var i;return i={name:e,clazz:"layout",layerDimension:t,properties:a(r),decorators:n}},c=function(e,t,r){return{clazz:"dimension",name:e,properties:a(t),decorators:r}},f=function(){return _.keys(d3.scale).concat("time").concat(_.keys(t))},a=function(e){return _.assign.apply(this,[{}].concat(e))},x={string:"string",number:"number",bool:"boolean",list:"list","enum":function(e){return{type:"enum",values:e}},object:"scope variable",event:"scope event",callback:"callback",objArray:"scope variable"},this.getValidator=function(e){switch(e){case x.string:return _.isString;case x.number:return _.isNumber;case x.bool:return _.isBoolean;case x.list:return function(e){return/^\[(.*)\]$|^[^\[](?=[^\]\[]*$)/.test(e)};default:return _.isObject(e)&&"enum"===e.type?function(e){return indexOf.call(this["enum"],e)>=0}:function(){return!0}}},v={markers:x.bool},u={donut:x.bool},w={padding:x.number},m={outerPadding:x.number},r={areaStacked:x["enum"](["zero","silhouette","expand","wiggle"])},n={areaStackedVertical:x["enum"](["zero","silhouette","expand","wiggle"])},d={geojson:x.object},k={projection:x.object},D={spline:x.bool},g={mapFunction:x.string},b={property:x.list},$={rotateTickLabels:x.number},S={lowerProperty:x.string,upperProperty:x.string},o={type:x["enum"](f()),dateFormat:x.string,domain:x.list,domainMin:x.string,domainMax:x.string,reset:x.bool,range:x.list,domainRange:x["enum"](["min","max","extent","total"]),label:x.string,labelStyle:x.object,exponent:x.number,reverse:x.bool},C={name:"right",clazz:"decorator",key:"right"},L={name:"top",clazz:"decorator",key:"top"},B={name:"tooltips",clazz:"decorator",key:"tooltips",properties:{tooltipsTemplate:x.string}},i={name:"axis",clazz:"decorator",key:"axis",properties:{grid:x.bool,gridStyle:x.object,format:x.string,showLabel:x.bool,ticks:x.number,tickInterval:x.number,tickFormat:x.string,tickLabelStyle:x.object,axisFormatter:x.object}},p={name:"legend",clazz:"decorator",key:"legend$set",value:x["enum"](["top-left","top-right","bottom-left","bottom-right"]),properties:{templateUrl:x.string,legendStyle:x.object}},M={name:"valuesLegend",clazz:"decorator",key:"valuesLegend$set",value:x["enum"](["top-left","top-right","bottom-left","bottom-right"]),properties:{templateUrl:x.string,legendStyle:x.object}},A={name:"selection",clazz:"decorator",key:"selection",properties:{selectedDomain:x.object,clearSelection:x.callback,selectedDomainChange:x.event}},l={name:"brush",key:"brush$set",clazz:"decorator",value:x.string,properties:{selectedDomain:x.object,selectedValues:x.object,brushExtent:x.object,selectedDomainChange:x.event,brushStart:x.event,brushEnd:x.event,clearBrush:x.callback}},s={name:"brushed",clazz:"decorator",key:"brushed$set",value:x.string},h={name:"labels",clazz:"decorator",key:"labels$set",properties:{labelStyle:x.object}},this.chart={name:"chart",clazz:"chart",properties:{data:x.objArray,header:x.string,headerStyle:x.object,subHeader:x.string,subHeaderStyle:x.object,deepWatch:x.bool,filter:x.string,edit:x.bool,editSelected:x.event,animationDuration:x.number,backgroundStyle:x.object},decorators:[B],dimensions:{},layouts:[]},this.layouts={line:y("line","y",[v,D]),lineVertical:y("lineVertical","x",[v,D]),area:y("area","x",[v,D]),areaVertical:y("areaVertical","y",[v,D]),areaStacked:y("areaStacked",!1,"y",[r,v,D]),areaStackedVertical:y("areaStackedVertical",!1,"x",[n,v,D]),bars:y("bars",!1,[w,m],[h,A]),barStacked:y("barStacked","x",[w,m],[A]),barClustered:y("barClustered","x",[w,m],[A]),column:y("column",!1,[w,m],[h,A]),columnStacked:y("columnStacked","y",[w,m],[A]),columnClustered:y("columnClustered","y",[w,m],[A]),rangeArea:y("rangeArea",!1,[],[A]),rangeAreaVertical:y("rangeAreaVertical",!1,[],[A]),rangeBars:y("rangeBars",!1,[],[h,A]),rangeColumn:y("rangeColumn",!1,[],[h,A]),histogram:y("histogram",!1,[],[h,A]),pie:y("pie",!1,[donat],[h,A]),spider:y("spider",!1,[],[A]),bubble:y("bubble",!1,[],[A,l]),scatter:y("scatter",!1,[],[A,l]),geoMap:y("geo-map",!1,[d,k],[A])},this.dimension={x:c("x",[b,o,$],[i,l,s]),"x top":c("x top",[b,o,$],[i,l,s]),y:c("y",[b,o,$],[i,l,s]),"y right":c("y right",[b,o,$],[i,l,s]),color:c("color",[b,o,g],[p,M]),size:c("size",[b,o],[p,M]),shape:c("shape",[b,o],[p,M])},this
}]);