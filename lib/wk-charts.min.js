angular.module("wk.chart",[]),angular.module("wk.chart").constant("d3OrdinalScales",["ordinal","category10","category20","category20b","category20c"]),angular.module("wk.chart").constant("wkChartMargins",{top:10,left:50,bottom:40,right:20,topBottomMargin:{axis:25,label:18},leftRightMargin:{axis:40,label:20},minMargin:8,"default":{top:8,left:8,bottom:8,right:10},axis:{top:25,bottom:25,left:40,right:40},label:{top:18,bottom:18,left:20,right:20},dataLabelPadding:{hor:5,vert:5}}),angular.module("wk.chart").constant("d3Shapes",["circle","cross","triangle-down","triangle-up","square","diamond"]),angular.module("wk.chart").constant("axisConfig",{labelFontSize:"1.6em",x:{axisPositions:["top","bottom"],axisOffset:{bottom:"height"},axisPositionDefault:"bottom",direction:"horizontal",measure:"width",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{top:"1em",bottom:"-0.8em"}},y:{axisPositions:["left","right"],axisOffset:{right:"width"},axisPositionDefault:"left",direction:"vertical",measure:"height",labelPositions:["outside","inside"],labelPositionDefault:"outside",labelOffset:{left:"1.2em",right:"1.2em"}}}),angular.module("wk.chart").constant("d3Animation",{duration:500}),angular.module("wk.chart").constant("templateDir","templates/"),angular.module("wk.chart").constant("formatDefaults",{date:"%x",number:",.2f"}),angular.module("wk.chart").constant("barConfig",{padding:.1,outerPadding:0}),function(){this.ResizeSensor=function(t,e){function r(){this.q=[],this.add=function(t){this.q.push(t)};var t,e;this.call=function(){for(t=0,e=this.q.length;e>t;t++)this.q[t].call()}}function n(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}function a(t,e){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new r,t.resizedAttached.add(e);t.resizeSensor=document.createElement("div"),t.resizeSensor.className="wk-chart-resize-sensor";var a="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;",i="position: absolute; left: 0; top: 0;";t.resizeSensor.style.cssText=a,t.resizeSensor.innerHTML='<div class="wk-chart-resize-sensor-expand" style="'+a+'"><div style="'+i+'"></div></div><div class="wk-chart-resize-sensor-shrink" style="'+a+'"><div style="'+i+' width: 200%; height: 200%"></div></div>',t.appendChild(t.resizeSensor),{fixed:1,absolute:1}[n(t,"position")]||(t.style.position="relative");var o,l,u=t.resizeSensor.childNodes[0],c=u.childNodes[0],s=t.resizeSensor.childNodes[1],d=(s.childNodes[0],function(){c.style.width=u.offsetWidth+10+"px",c.style.height=u.offsetHeight+10+"px",u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,o=t.offsetWidth,l=t.offsetHeight});d();var h=function(){t.resizedAttached.call()},f=function(t,e,r){t.attachEvent?t.attachEvent("on"+e,r):t.addEventListener(e,r)};f(u,"scroll",function(){(t.offsetWidth>o||t.offsetHeight>l)&&h(),d()}),f(s,"scroll",function(){(t.offsetWidth<o||t.offsetHeight<l)&&h(),d()})}if("[object Array]"===Object.prototype.toString.call(t)||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements)for(var i=0,o=t.length;o>i;i++)a(t[i],e);else a(t,e)}}(),angular.module("wk.chart").directive("brush",["$log","selectionSharing","behavior",function(){return{restrict:"A",require:["^chart","^layout","?x","?y","?rangeX","?rangeY"],scope:{brushExtent:"=",selectedValues:"=",selectedDomain:"=",selectedDomainChange:"&",brushStart:"&",brushEnd:"&",clearBrush:"="},link:function(t,e,r,n){var a,i,o,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b;return i=n[0].me,o=null!=(v=n[1])?v.me:void 0,s=null!=(m=n[2])?m.me:void 0,h=null!=(w=n[3])?w.me:void 0,l=null!=(k=n[4])?k.me:void 0,u=null!=(x=n[5])?x.me:void 0,d=void 0,f=void 0,b=void 0,y=void 0,p=!s&&!h,g=void 0,a=i.behavior().brush,s||h||l||u?(a.x(s||l),a.y(h||u)):(c=o.scales().getScales(["x","y"]),a.x(c.x),a.y(c.y)),a.active(!0),t.$watch("clearBrush",function(){return r.clearBrush?t.clearBrush=a.clearBrush:void 0}),r.$observe("brush",function(t){return a.brushGroup(_.isString(t)&&t.length>0?t:void 0)}),a.events().on("brushStart",function(){return t.brushStart(),t.$apply()}),a.events().on("brush",function(e,n,a){return r.brushExtent&&(t.brushExtent=e),r.selectedValues&&(t.selectedValues=n),r.selectedDomain&&(t.selectedDomain=a),t.selectedDomainChange({domain:a}),t.$apply()}),a.events().on("brushEnd",function(e,r,n){return t.brushEnd({domain:n}),t.$apply()}),o.lifeCycle().on("drawChart.brush",function(t){return a.data(t)})}}}]),angular.module("wk.chart").run(["$templateCache",function(t){t.put("templates/legend.html",'\n<div ng-style="position" ng-show="showLegend" class="wk-chart-legend">\n  <div ng-show="title" class="legend-title">{{title}}</div>\n  <ul class="list-unstyled">\n    <li ng-repeat="legendRow in legendRows track by legendRow.value" class="wk-chart-legend-item"><span ng-if="legendRow.color" ng-style="legendRow.color">&nbsp;&nbsp;&nbsp;</span>\n      <svg-icon ng-if="legendRow.path" path="legendRow.path" width="20"></svg-icon><span> &nbsp;{{legendRow.value}}</span>\n    </li>\n  </ul>\n</div>'),t.put("templates/toolTip.html",'\n<div ng-style="position" class="wk-chart-tooltip">\n  <table class="table table-condensed table-bordered">\n    <thead ng-show="headerValue">\n      <tr>\n        <th colspan="2">{{headerName}}</th>\n        <th>{{headerValue}}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="ttRow in layers track by ttRow.name">\n        <td ng-style="ttRow.color" ng-class="ttRow.class">\n          <svg-icon ng-if="ttRow.path" path="ttRow.path" width="15"></svg-icon>\n        </td>\n        <td>{{ttRow.name}}</td>\n        <td>{{ttRow.value}}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>')}]),function(){function t(t,e,r){var n=t.translate(),a=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(r[1]-n[1],r[0]-n[0]);return[Math.cos(a/2),0,0,Math.sin(a/2)]}function e(t,e){var r=(t.translate(),t.invert(e));return r&&isFinite(r[0])&&isFinite(r[1])&&o(r)}function r(t){var e=.5*t[0]*c,r=.5*t[1]*c,n=.5*t[2]*c,a=Math.sin(e),i=Math.cos(e),o=Math.sin(r),l=Math.cos(r),u=Math.sin(n),s=Math.cos(n);return[i*l*s+a*o*u,a*l*s-i*o*u,i*o*s+a*l*u,i*l*u-a*o*s]}function n(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=e[0],l=e[1],u=e[2],c=e[3];return[r*o-n*l-a*u-i*c,r*l+n*o+a*c-i*u,r*u-n*c+a*o+i*l,r*c+n*u-a*l+i*o]}function a(t,e){if(t&&e){var r=u(t,e),n=Math.sqrt(l(r,r)),a=.5*Math.acos(Math.max(-1,Math.min(1,l(t,e)))),i=Math.sin(a)/n;return n&&[Math.cos(a),r[2]*i,-r[1]*i,r[0]*i]}}function i(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*s,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*s,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*s]}function o(t){var e=t[0]*c,r=t[1]*c,n=Math.cos(r);return[n*Math.cos(e),n*Math.sin(e),Math.sin(r)]}function l(t,e){for(var r=0,n=t.length,a=0;n>r;++r)a+=t[r]*e[r];return a}function u(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}var c=Math.PI/180,s=180/Math.PI;d3.geo.zoom=function(){var o,l,u=d3.dispatch("zoomstart","zoom","zoomend"),c=d3.behavior.zoom().on("zoomstart",function(){var d=d3.mouse(this),h=r(o.rotate()),f=e(o,d);f&&(l=f),s.call(c,"zoom",function(){o.scale(d3.event.scale);var r=d3.mouse(this),c=a(l,e(o,r));o.rotate(i(h=c?n(h,c):n(t(o,d,r),h))),d=r,u.zoom.apply(this,arguments)}),u.zoomstart.apply(this,arguments)}).on("zoomend",function(){s.call(c,"zoom",null),u.zoomend.apply(this,arguments)}),s=c.on;return c.projection=function(t){return arguments.length?c.scale((o=t).scale()):o},d3.rebind(c,u,"on")}}(),angular.module("wk.chart").directive("brushed",["$log","selectionSharing","timing",function(t,e){var r;return r=0,{restrict:"A",require:["^chart","?^layout","?x","?y","?rangeX","?rangeY"],link:function(t,r,n,a){var i,o,l,u,c,s,d,h,f,y,g,p,v,m;return l=a[0].me,u=null!=(y=a[1])?y.me:void 0,d=null!=(g=a[2])?g.me:void 0,h=null!=(p=a[3])?p.me:void 0,c=null!=(v=a[4])?v.me:void 0,s=null!=(m=a[5])?m.me:void 0,i=d||h||c||s,f=void 0,o=function(t,e){var r,n,a,o,u;if(i){for(t.length>0?i.domain(t).scale().domain(t):(i.domain(void 0),i.scale().domain(i.getDomain(l.getData())),i.isOrdinal()&&(e=[0,i.scale().domain().length-1])),o=l.layouts(),u=[],n=0,a=o.length;a>n;n++)r=o[n],r.scales().hasScale(i)&&u.push(r.lifeCycle().brush(i,!0,e));return u}},n.$observe("brushed",function(t){return _.isString(t)&&t.length>0?(f=t,e.register(f,o)):f=void 0}),t.$on("$destroy",function(){return e.unregister(f,o)})}}}]),function(){function t(t){var e=document.querySelectorAll("svg image"),r=e.length;0==r&&t();for(var n=0;n<e.length;n++)!function(e){if(e.getAttribute("xlink:href")){var n=e.getAttribute("xlink:href").value;if(/^http/.test(n)&&!new RegExp("^"+window.location.host).test(n))throw new Error("Cannot render embedded images linking to external hosts.")}var a=document.createElement("canvas"),i=a.getContext("2d"),o=new Image;o.src=e.getAttribute("xlink:href"),o.onload=function(){a.width=o.width,a.height=o.height,i.drawImage(o,0,0),e.setAttribute("xlink:href",a.toDataURL("image/png")),r--,0==r&&t()}}(e[n])}function e(){for(var t="",e=document.styleSheets,r=0;r<e.length;r++){var n=e[r].cssRules;if(null!=n)for(var a=0;a<n.length;a++){var i=n[a];"undefined"!=typeof i.style&&(t+=i.selectorText+" { "+i.style.cssText+" }\n")}}var o=document.createElement("style");o.setAttribute("type","text/css"),o.innerHTML="<![CDATA[\n"+t+"\n]]>";var l=document.createElement("defs");return l.appendChild(o),l}var r="undefined"!=typeof exports&&exports||this,n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';r.svgAsDataUri=function(a,i,o){i=i||1,t(function(){var t=document.createElement("div"),l=a.cloneNode(!0),u=parseInt(l.getAttribute("width")||l.style.width||r.getComputedStyle(a).getPropertyValue("width")),c=parseInt(l.getAttribute("height")||l.style.height||r.getComputedStyle(a).getPropertyValue("height")),s="http://www.w3.org/2000/xmlns/";l.setAttribute("version","1.1"),l.setAttributeNS(s,"xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(s,"xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("width",u*i),l.setAttribute("height",c*i),l.setAttribute("viewBox","0 0 "+u+" "+c),t.appendChild(l),l.insertBefore(e(l),l.firstChild);var d=n+t.innerHTML,h="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(d)));o&&o(h)})},r.saveSvgAsPng=function(t,e,n){r.svgAsDataUri(t,n,function(t){var r=new Image;r.src=t,r.onload=function(){var t=document.createElement("canvas");t.width=r.width,t.height=r.height;var n=t.getContext("2d");n.drawImage(r,0,0);var a=document.createElement("a");a.download=e,a.href=t.toDataURL("image/png"),document.body.appendChild(a),a.click()}})}}(),angular.module("wk.chart").directive("chart",["$log","chart","$filter",function(t,e,r){var n;return n=0,{restrict:"E",require:"chart",scope:{data:"=",filter:"="},controller:["$scope",function(t){return this.me=e(),this.me.scope(t)}],link:function(e,n,a,i){var o,l,u,c,s,d;return u=i.me,l=!1,c=void 0,n.addClass(u.id()),s=void 0,d=void 0,u.container().element(n[0]),u.lifeCycle().configure(),u.lifeCycle().on("scopeApply",function(){return e.$apply()}),a.$observe("animationDuration",function(t){return t&&_.isNumber(+t)&&+t>=0?u.animationDuration(t):void 0}),a.$observe("title",function(t){return u.title(t?t:void 0)}),a.$observe("subtitle",function(t){return u.subTitle(t?t:void 0)}),e.$watch("filter",function(t){if(t){if(d=t,s)return u.lifeCycle().newData(r("filter")(s,d))}else if(d=void 0,s)return u.lifeCycle().newData(s)}),a.$observe("deepWatch",function(t){return l=void 0!==t&&"false"!==t?!0:!1,c&&c(),c=e.$watch("data",o,l)}),o=function(t){if(t){if(s=t,_.isArray(s)&&0===s.length)return;return u.lifeCycle().newData(d?r("filter")(t,d):t)}},c=e.$watch("data",o,l),n.on("$destroy",function(){return c&&c(),t.log("Destroying chart"),u.lifeCycle().destroy()})}}}]),angular.module("wk.chart").directive("layout",["$log","layout","container",function(t,e){var r;return r=0,{restrict:"AE",require:["layout","^chart"],controller:["$element",function(){return this.me=e()}],link:function(t,e,r,n){var a,i;return i=n[0].me,a=n[1].me,i.chart(a),e.addClass(i.id()),a.addLayout(i),a.container().addLayout(i),i.container(a.container())}}}]),angular.module("wk.chart").directive("printButton",["$log",function(t){return{require:"chart",restrict:"A",link:function(e,r,n,a){var i,o;return i=a.me,o=function(){var e;return e=d3.select(i.container().element()).select("div.wk-chart"),e.append("button").attr("class","wk-chart-print-button").style({position:"absolute",top:0,right:0}).text("Print").on("click",function(){var r;return t.log("Clicked Print Button"),r=e.select("svg.wk-chart").node(),saveSvgAsPng(r,"print.png",5)})},i.lifeCycle().on("drawChart.print",o)}}}]),angular.module("wk.chart").directive("selection",["$log",function(){var t;return t=0,{restrict:"A",scope:{selectedDomain:"=",selectedDomainChange:"&",clearSelection:"="},require:"layout",link:function(t,e,r,n){var a;return a=n.me,a.lifeCycle().on("configure.selection",function(){var e;return e=a.behavior().selected,t.$watch("clearSelection",function(){return t.clearSelection=e.clearSelection}),e.active(!0),e.on("selected",function(e){return t.selectedDomain&&(t.selectedDomain=e),t.selectedDomainChange({domain:e}),t.$apply()})})}}}]),angular.module("wk.chart").directive("tooltips",["$log","behavior",function(){return{restrict:"A",require:"chart",link:function(t,e,r,n){var a;return a=n.me,r.$observe("tooltips",function(t){return a.toolTipTemplate(""),void 0===t||""!==t&&"true"!==t?t.length>0&&"false"!==t?(a.toolTipTemplate(t),a.showTooltip(!0)):a.showTooltip(!1):a.showTooltip(!0)})}}}]),angular.module("wk.chart").directive("area",["$log","utils","tooltipUtils",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O;return d=o.me,h=[],k=[],m=[],A=[],b=[],x=[],D=void 0,O=void 0,v=void 0,C={},S=!1,f=0,w="line"+n++,l=void 0,u=void 0,y=function(t){return x=_.toArray(b),g.apply(this,[t])},g=function(t){var e;return e=x.map(function(e){return{name:e[t].key,value:C.y.formatValue(e[t].yv),color:{"background-color":e[t].color},xv:e[t].xv}}),this.headerName=C.x.axisLabel(),this.headerValue=C.x.formatValue(e[0].xv),this.layers=this.layers.concat(e)},p=function(t){return v=this.selectAll(".wk-chart-marker-"+w).data(x,function(e){return e[t].key}),v.enter().append("g").attr("class","wk-chart-marker-"+w).call(r.styleTooltipMarker,t),v.selectAll("circle").attr("cy",function(e){return e[t].y}),v.exit().remove(),this.attr("transform","translate("+(C.x.scale()(x[0][t].xv)+f)+")")},s=function(t,r,n,a,i){var o,l,c,s,d,h,y,g,p,v,w,x,C,S,O,$,P;for(g=e.mergeSeriesSorted(n.value(m),n.value(t)),O=a.layerKeys(t),k=[],b={},C=0,$=O.length;$>C;C++){for(d=O[C],b[d]=t.map(function(t){return{x:n.map(t),y:a.scale()(a.layerValue(t,d)),xv:n.value(t),yv:a.layerValue(t,d),key:d,color:i.scale()(d),data:t}}),v=p=void 0,h={key:d,color:i.scale()(d),value:[]},s=0;s<g.length;){if(void 0!==g[s][0]){v=A[d][g[s][0]];break}s++}for(;s<g.length;){if(void 0!==g[s][1]){p=b[d][g[s][1]];break}s++}for(s=S=0,P=g.length;P>S;s=++S)x=g[s],w={color:h.color,x:x[2]},void 0===x[1]?(w.yNew=p.y,w.xNew=p.x,w.deleted=!0):(w.yNew=b[d][x[1]].y,w.xNew=b[d][x[1]].x,p=b[d][x[1]],w.deleted=!1),m.length>0?void 0===x[0]?(w.yOld=v.y,w.xOld=v.x):(w.yOld=A[d][x[0]].y,w.xOld=A[d][x[0]].x,v=A[d][x[0]]):(w.xOld=w.xNew,w.yOld=w.yNew),h.value.push(w);k.push(h)}return f=n.isOrdinal()?n.scale().rangeBand()/2:0,D&&D.data(t),l=d3.svg.area().x(function(t){return t.xOld}).y0(function(t){return t.yOld}).y1(function(){return a.scale()(0)}),o=d3.svg.area().x(function(t){return t.xNew}).y0(function(t){return t.yNew}).y1(function(){return a.scale()(0)}),u=d3.svg.area().x(function(t){return n.scale()(t.x)}).y0(function(t){return t.yNew}).y1(function(){return a.scale()(0)}),y=this.selectAll(".wk-chart-layer").data(k,function(t){return t.key}),c=y.enter().append("g").attr("class","wk-chart-layer"),c.append("path").attr("class","wk-chart-line").style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}).style("opacity",0).style("pointer-events","none"),y.select(".wk-chart-line").attr("transform","translate("+f+")").attr("d",function(t){return l(t.value)}).transition().duration(r.duration).attr("d",function(t){return o(t.value)}).style("opacity",.7).style("pointer-events","none"),y.exit().transition().duration(r.duration).style("opacity",0).remove(),m=t,A=b},c=function(t,e){var r;return r=this.select(".wk-chart-line"),t.isOrdinal()?r.attr("d",function(t){return u(t.value.slice(e[0],e[1]+1))}):r.attr("d",function(t){return u(t.value)})},d.lifeCycle().on("configure",function(){return C=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),D=d.behavior().tooltip,D.markerScale(C.x),D.on("enter."+w,y),D.on("moveData."+w,g),D.on("moveMarker."+w,p)}),d.lifeCycle().on("drawChart",s),d.lifeCycle().on("brushDraw",c),i.$observe("markers",function(t){return S=""===t||"true"===t?!0:!1})}}}]),angular.module("wk.chart").directive("areaStacked",["$log","utils","tooltipUtils",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V,M,N;return f=o.me,A=d3.layout.stack(),x="zero",v=null,V=!1,g=[],y=[],m=[],w=[],p=[],u=void 0,s={},l={},M=void 0,N=void 0,O=void 0,P={},b=void 0,k=0,$="areaStacked"+n++,S=function(t){var e;return e=y.map(function(e){return{name:e.key,value:P.y.formatValue(e.layer[t].yy),color:{"background-color":e.color}}}),this.headerName=P.x.axisLabel(),this.headerValue=P.x.formatValue(y[0].layer[t].x),this.layers=this.layers.concat(e)},D=function(t){return O=this.selectAll(".wk-chart-marker-"+$).data(y,function(t){return t.key}),O.enter().append("g").attr("class","wk-chart-marker-"+$).call(r.styleTooltipMarker),O.selectAll("circle").attr("cy",function(e){return b(e.layer[t].y+e.layer[t].y0)}),O.exit().remove(),this.attr("transform","translate("+(P.x.scale()(y[0].layer[t].x)+k)+")")},h=function(t,e){var r,n,a;for(n=0,a=e.length;a>n;n++)if(r=e[n],r.key===t)return r},C=A.values(function(t){return t.layer}).y(function(t){return t.yy}),d=function(t,r,n,a,i){return g=a.layerKeys(t),s=e.diff(p,g,1),l=e.diff(g,p,-1),y=g.map(function(){return function(e){return{key:e,color:i.scale()(e),layer:t.map(function(t){return{x:n.value(t),yy:+a.layerValue(t,e),y0:0,data:t}})}}}(this)),m=C(y),k=n.isOrdinal()?n.scale().rangeBand()/2:0,M&&M.data(t),v||(v=this.selectAll(".wk-chart-layer")),"expand"===x?(b=a.scale().copy(),b.domain([0,1])):b=a.scale(),u=d3.svg.area().x(function(t){return n.scale()(t.x)}).y0(function(t){return b(t.y0+t.y)}).y1(function(t){return b(t.y0)}),v=v.data(m,function(t){return t.key}),0===w.length?v.enter().append("path").attr("class","wk-chart-area").style("fill",function(t){return i.scale()(t.key)}).style("opacity",0).style("pointer-events","none").style("opacity",.7):v.enter().append("path").attr("class","wk-chart-area").attr("d",function(t){return l[t.key]?h(l[t.key],w).path:u(t.layer.map(function(t){return{x:t.x,y:0,y0:0}}))}).style("fill",function(t){return i.scale()(t.key)}).style("pointer-events","none").style("opacity",.7),v.attr("transform","translate("+k+")").transition().duration(r.duration).attr("d",function(t){return u(t.layer)}).style("fill",function(t){return i.scale()(t.key)}),v.exit().transition().duration(r.duration).attr("d",function(t){var e;return e=s[t.key],u(e?h(e,m).layer.map(function(t){return{x:t.x,y:0,y0:t.y0}}):m[m.length-1].layer.map(function(t){return{x:t.x,y:0,y0:t.y0+t.y}}))}).remove(),w=m.map(function(t){return{key:t.key,path:u(t.layer.map(function(t){return{x:t.x,y:0,y0:t.y+t.y0}}))}}),p=g},c=function(){return v=this.selectAll(".wk-chart-area"),v.attr("d",function(t){return u(t.layer)})},f.lifeCycle().on("configure",function(){return P=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),M=f.behavior().tooltip,M.markerScale(P.x),M.on("enter."+$,S),M.on("moveData."+$,S),M.on("moveMarker."+$,D)}),f.lifeCycle().on("drawChart",d),i.$observe("areaStacked",function(t){return x="zero"===t||"silhouette"===t||"expand"===t||"wiggle"===t?t:"zero",A.offset(x),f.lifeCycle().update()}),i.$observe("markers",function(t){return V=""===t||"true"===t?!0:!1})}}}]),angular.module("wk.chart").directive("areaStackedVertical",["$log","utils","tooltipUtils",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V,M;return h=o.me,A=d3.layout.stack(),x="zero",p=null,P=!1,y=[],f=[],m=[],w=[],g=[],u=void 0,c={},l={},V=void 0,M=void 0,D=void 0,$={},b=void 0,k=0,O="area-stacked-vert"+n++,C=function(t){var e;return e=f.map(function(e){return{name:e.key,value:$.x.formatValue(e.layer[t].xx),color:{"background-color":e.color}}}),this.headerName=$.y.axisLabel(),this.headerValue=$.y.formatValue(f[0].layer[t].yy),this.layers=this.layers.concat(e)},S=function(t){return D=this.selectAll(".wk-chart-marker-"+O).data(f,function(t){return t.key}),D.enter().append("g").attr("class","wk-chart-marker-"+O).call(r.styleTooltipMarker),D.selectAll("circle").attr("cx",function(e){return b(e.layer[t].y+e.layer[t].y0)}),D.exit().remove(),this.attr("transform","translate(0,"+($.y.scale()(f[0].layer[t].yy)+k)+")")},d=function(t,e){var r,n,a;for(n=0,a=e.length;a>n;n++)if(r=e[n],r.key===t)return r},v=A.values(function(t){return t.layer}).y(function(t){return t.xx}),s=function(t,r,n,a,i){return y=n.layerKeys(t),c=e.diff(g,y,1),l=e.diff(y,g,-1),f=y.map(function(){return function(e){return{key:e,color:i.scale()(e),layer:t.map(function(t){return{yy:a.value(t),xx:+n.layerValue(t,e),y0:0,data:t}})}}}(this)),m=v(f),k=a.isOrdinal()?a.scale().rangeBand()/2:0,V&&V.data(t),p||(p=this.selectAll(".wk-chart-layer")),"expand"===x?(b=n.scale().copy(),b.domain([0,1])):b=n.scale(),u=d3.svg.area().x(function(t){return a.scale()(t.yy)}).y0(function(t){return b(t.y0+t.y)}).y1(function(t){return b(t.y0)}),p=p.data(m,function(t){return t.key}),0===w.length?p.enter().append("path").attr("class","wk-chart-area").style("fill",function(t){return i.scale()(t.key)}).style("opacity",0).style("pointer-events","none").style("opacity",.7):p.enter().append("path").attr("class","wk-chart-area").attr("d",function(t){return l[t.key]?d(l[t.key],w).path:u(t.layer.map(function(t){return{yy:t.yy,y:0,y0:0}}))}).style("fill",function(t){return i.scale()(t.key)}).style("pointer-events","none").style("opacity",.7),p.attr("transform","rotate(90) scale(1,-1)").transition().duration(r.duration).attr("d",function(t){return u(t.layer)}).style("fill",function(t){return i.scale()(t.key)}),p.exit().transition().duration(r.duration).attr("d",function(t){var e;return e=c[t.key],u(e?d(e,m).layer.map(function(t){return{yy:t.yy,y:0,y0:t.y0}}):m[m.length-1].layer.map(function(t){return{yy:t.yy,y:0,y0:t.y0+t.y}}))}).remove(),w=m.map(function(t){return{key:t.key,path:u(t.layer.map(function(t){return{yy:t.yy,y:0,y0:t.y+t.y0}}))}}),g=y},h.lifeCycle().on("configure",function(){return $=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).domainCalc("extent"),V=h.behavior().tooltip,V.markerScale($.y),V.on("enter."+O,C),V.on("moveData."+O,C),V.on("moveMarker."+O,S)}),h.lifeCycle().on("drawChart",s),i.$observe("areaStackedVertical",function(t){return x="zero"===t||"silhouette"===t||"expand"===t||"wiggle"===t?t:"zero",A.offset(x),h.lifeCycle().update()}),i.$observe("markers",function(t){return P=""===t||"true"===t?!0:!1})}}}]),angular.module("wk.chart").directive("areaVertical",["$log","utils","tooltipUtils",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O;return d=o.me,h=[],k=[],m=[],A=[],b=[],x=[],D=void 0,O=void 0,v=void 0,C={},S=!1,f=0,l=void 0,c=0,w="area"+n++,y=function(t){return x=_.toArray(b),g.apply(this,[t])},g=function(t){var e,r;return e=t+c,r=x.map(function(t){return{name:t[e].key,value:C.x.formatValue(t[e].xv),color:{"background-color":t[e].color},yv:t[e].yv}}),this.headerName=C.y.axisLabel(),this.headerValue=C.y.formatValue(r[0].yv),this.layers=this.layers.concat(r)},p=function(t){var e,n,a;return n=t+c,v=this.selectAll(".wk-chart-marker-"+w).data(x,function(t){return t[n].key}),a=v.enter().append("g").attr("class","wk-chart-marker-"+w).call(r.styleTooltipMarker,n),v.selectAll("circle").attr("cx",function(t){return t[n].x}),v.exit().remove(),e=C.y.isOrdinal?C.y.scale().rangeBand()/2:0,this.attr("transform","translate(0,"+(C.y.scale()(x[0][n].yv)+e)+")")},s=function(t,r,n,a,i){var o,u,c,s,d,h,y,g,p,v,w,x,C,S,O,$;for(y=a.isOrdinal()?e.mergeSeriesUnsorted(a.value(m),a.value(t)):e.mergeSeriesSorted(a.value(m),a.value(t)),S=n.layerKeys(t),k=[],b={},x=0,O=S.length;O>x;x++){for(s=S[x],b[s]=t.map(function(t){return{y:a.map(t),x:n.scale()(n.layerValue(t,s)),yv:a.value(t),xv:n.layerValue(t,s),key:s,color:i.scale()(s),data:t}}),d={key:s,color:i.scale()(s),value:[]},c=0;c<y.length;){if(void 0!==y[c][0]){p=A[s][y[c][0]];break}c++}for(;c<y.length;){if(void 0!==y[c][1]){g=b[s][y[c][1]];break}c++}for(c=C=0,$=y.length;$>C;c=++C)w=y[c],v={color:d.color,y:w[2]},void 0===w[1]?(v.yNew=g.y,v.xNew=g.x,v.deleted=!0):(v.yNew=b[s][w[1]].y,v.xNew=b[s][w[1]].x,g=b[s][w[1]],v.deleted=!1),m.length>0?void 0===w[0]?(v.yOld=p.y,v.xOld=p.x):(v.yOld=A[s][w[0]].y,v.xOld=A[s][w[0]].x,p=A[s][w[0]]):(v.xOld=v.xNew,v.yOld=v.yNew),d.value.push(v);k.push(d)}return f=a.isOrdinal()?a.scale().rangeBand()/2:0,D&&D.data(t),u=d3.svg.area().x(function(t){return r.width-t.yOld}).y0(function(t){return t.xOld}).y1(function(){return n.scale()(0)}),o=d3.svg.area().x(function(t){return r.width-t.yNew}).y0(function(t){return t.xNew}).y1(function(){return n.scale()(0)}),l=d3.svg.area().x(function(t){return r.width-a.scale()(t.y)}).y0(function(t){return t.xNew}).y1(function(){return n.scale()(0)}),h=this.selectAll(".wk-chart-layer").data(k,function(t){return t.key}),h.enter().append("g").attr("class","wk-chart-layer").append("path").attr("class","wk-chart-line").style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}).style("opacity",0).style("pointer-events","none"),h.select(".wk-chart-line").attr("transform","translate(0,"+(r.width+f)+")rotate(-90)").attr("d",function(t){return u(t.value)}).transition().duration(r.duration).attr("d",function(t){return o(t.value)}).style("opacity",.7).style("pointer-events","none"),h.exit().transition().duration(r.duration).style("opacity",0).remove(),m=t,A=b},u=function(t,e,r){var n;return n=this.selectAll(".wk-chart-line"),t.isOrdinal()?(n.attr("transform","translate(0,"+(r+t.scale().rangeBand()/2)+")rotate(-90)"),n.attr("d",function(t){return l(t.value.slice(e[0],e[1]+1))}),c=e[0]):n.attr("d",function(t){return l(t.value)})},d.lifeCycle().on("configure",function(){return C=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),D=d.behavior().tooltip,D.markerScale(C.y),D.on("enter."+w,y),D.on("moveData."+w,g),D.on("moveMarker."+w,p)}),d.lifeCycle().on("drawChart",s),d.lifeCycle().on("brushDraw",u),i.$observe("markers",function(t){return S=""===t||"true"===t?!0:!1})}}}]),angular.module("wk.chart").directive("bars",["$log","utils","barConfig","wkChartMargins",function(t,e,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(t,i,o,l){var u,c,s,d,h,f,y,g,p,v,m,w,k,x;return y=l.me,v="bars"+a++,s=null,c=0,u=0,w={},k=void 0,m=e.mergeData(),m([]).key(function(t){return t.key}),g=!0,h=_.clone(r,!0),x=void 0,p=function(t){return this.headerName=w.y.axisLabel(),this.headerValue=w.x.axisLabel(),this.layers.push({name:w.color.formattedValue(t.data),value:w.x.formattedValue(t.data),color:{"background-color":w.color.map(t.data)}})},f=function(t,e,r,a,i){var o,l,d,f;return s||(s=this.selectAll(".wk-chart-bars")),l=a.scale().rangeBand()/(1-h.padding)*h.padding,o=a.scale().rangeBand()/(1-h.outerPadding)*h.outerPadding,f=t.map(function(t){return{key:a.value(t),x:r.map(t),y:a.map(t),color:i.map(t),height:a.scale().rangeBand(a.value(t)),data:t}}),m(f).first({y:e.height+c/2-o}).last({y:0,height:u-c/2}),s=s.data(f,function(t){return t.key}),d=s.enter().append("g").attr("class","wk-chart-bar").attr("transform",function(t){return"translate(0, "+(g?t.y:m.addedPred(t).y-c/2)+") scale(1, "+(g?1:0)+")"}),d.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(t){return t.height}).style("opacity",g?0:1).call(x.tooltip).call(k),d.append("text").attr({"class":"wk-chart-data-label"}).attr("y",function(t){return t.height/2}).attr("x",function(t){return t.x+n.dataLabelPadding.hor}).attr({dy:"0.35em","text-anchor":"start"}).style({opacity:0}),s.transition().duration(e.duration).attr("transform",function(t){return"translate(0, "+t.y+") scale(1,1)"}),s.select("rect").style("fill",function(t){return t.color}).transition().duration(e.duration).attr("height",function(t){return t.height}).attr("width",function(t){return Math.abs(r.scale()(0)-t.x)}).style("opacity",1),s.select("text").text(function(t){return r.formattedValue(t.data)}).transition().duration(e.duration).attr("y",function(t){return t.height/2}).attr("x",function(t){return t.x+n.dataLabelPadding.hor}).style("opacity",y.showDataLabels()?1:0),s.exit().transition().duration(e.duration).attr("transform",function(t){return"translate(0,"+(m.deletedSucc(t).y+m.deletedSucc(t).height+l/2)+") scale(1,0)"}).attr("height",0).remove(),g=!1,c=l,u=o},d=function(t){return s.attr("transform",function(e){var r;return"translate(0, "+((r=t.scale()(e.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-rect").attr("height",function(){return t.scale().rangeBand()}),s.selectAll("text").attr("y",t.scale().rangeBand()/2)},y.lifeCycle().on("configure",function(){return w=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(h).scaleType("ordinal"),x=y.behavior().tooltip,k=y.behavior().selected,x.on("enter."+v,p)}),y.lifeCycle().on("drawChart",f),y.lifeCycle().on("brushDraw",d),o.$observe("padding",function(t){var n;return"false"===t?(h.padding=0,h.outerPadding=0):"true"===t?h=_.clone(r,!0):(n=e.parseList(t),n&&(1===n.length&&(h.padding=n[0]/100,h.outerPadding=n[0]/100),2===n.length&&(h.padding=n[0]/100,h.outerPadding=n[1]/100))),w.y.rangePadding(h),y.lifeCycle().update()}),o.$observe("labels",function(t){return"false"===t?y.showDataLabels(!1):("true"===t||""===t)&&y.showDataLabels("x"),y.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("barClustered",["$log","utils","barConfig",function(t,e,r){var n;return n=0,{restrict:"A",require:"^layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x;return f=o.me,v="clusteredBar"+n++,g=null,c=void 0,m=e.mergeData().key(function(t){return t.key}),w=e.mergeData().key(function(t){return t.layerKey}),u=0,l=0,s=_.clone(r,!0),y=!0,x=void 0,k={},p=function(t){var e;return e=t.layers.map(function(t){return{name:t.layerKey,value:k.x.formatValue(t.value),color:{"background-color":t.color}}}),this.headerName=k.y.axisLabel(),this.headerValue=k.y.formatValue(t.key),this.layers=this.layers.concat(e)},d=function(t,e,r,n,a){var i,o,d,h,f;return o=n.scale().rangeBand()/(1-s.padding)*s.padding,i=n.scale().rangeBand()/(1-s.outerPadding)*s.outerPadding,f=r.layerKeys(t),c=d3.scale.ordinal().domain(r.layerKeys(t)).rangeBands([0,n.scale().rangeBand()],0,0),h=t.map(function(t){var e;return e={key:n.value(t),data:t,y:n.map(t),height:n.scale().rangeBand(n.value(t)),layers:f.map(function(e){return{layerKey:e,color:a.scale()(e),key:n.value(t),value:t[e],y:c(e),x:r.scale()(t[e]),width:r.scale()(t[e]),height:c.rangeBand(e)}
})}}),m(h).first({y:e.height+u/2-i,height:n.scale().rangeBand()}).last({y:0,height:l-u/2}),w(h[0].layers).first({y:0,height:0}).last({y:h[0].height,height:0}),g||(g=this.selectAll(".wk-chart-layer")),g=g.data(h,function(t){return t.key}),g.enter().append("g").attr("class","wk-chart-layer").call(x.tooltip).attr("transform",function(t){return"translate(0, "+(y?t.y:m.addedPred(t).y-u/2)+") scale(1,"+(y?1:0)+")"}).style("opacity",y?0:1),g.transition().duration(e.duration).attr("transform",function(t){return"translate(0,"+t.y+") scale(1,1)"}).style("opacity",1),g.exit().transition().duration(e.duration).attr("transform",function(t){return"translate(0, "+(m.deletedSucc(t).y+m.deletedSucc(t).height+o/2)+") scale(1,0)"}).remove(),d=g.selectAll(".wk-chart-bar").data(function(t){return t.layers},function(t){return t.layerKey+"|"+t.key}),d.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("y",function(t){return y?t.y:w.addedPred(t).y+w.addedPred(t).height}).attr("height",function(t){return y?t.height:0}).attr("x",r.scale()(0)),d.style("fill",function(t){return a.scale()(t.layerKey)}).transition().duration(e.duration).attr("width",function(t){return t.width}).attr("y",function(t){return t.y}).attr("x",function(t){return Math.min(r.scale()(0),t.x)}).attr("height",function(t){return Math.abs(t.height)}),d.exit().transition().duration(e.duration).attr("height",0).attr("y",function(t){return w.deletedSucc(t).y}).remove(),y=!1,u=o,l=i},h=function(t){var e;return c.rangeBands([0,t.scale().rangeBand()],0,0),e=c.rangeBand(),g.attr("transform",function(e){var r;return"translate(0, "+((r=t.scale()(e.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-bar").attr("height",e).attr("y",function(t){return c(t.layerKey)})},f.lifeCycle().on("configure",function(){return k=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("max").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(s).scaleType("ordinal"),this.layerScale("color"),x=f.behavior().tooltip,x.on("enter."+v,p)}),f.lifeCycle().on("drawChart",d),f.lifeCycle().on("brushDraw",h),i.$observe("padding",function(t){var n;return"false"===t?(s.padding=0,s.outerPadding=0):"true"===t?s=_.clone(r,!0):(n=e.parseList(t),n&&(1===n.length&&(s.padding=n[0]/100,s.outerPadding=n[0]/100),2===n.length&&(s.padding=n[0]/100,s.outerPadding=n[1]/100))),k.y.rangePadding(s),f.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("barStacked",["$log","utils","barConfig",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b;return h=o.me,v="stackedColumn"+n++,y=null,g=[],b=function(){},k={},x=void 0,u=0,l=0,m=e.mergeData().key(function(t){return t.key}),w=e.mergeData(),f=!0,c=_.clone(r,!0),p=function(t){var e;return e=t.layers.map(function(t){return{name:t.layerKey,value:k.y.formatValue(t.value),color:{"background-color":t.color}}}),this.headerName=k.x.axisLabel(),this.headerValue=k.x.formatValue(t.key),this.layers=this.layers.concat(e)},s=function(t,e,r,n,a){var i,o,s,d,h,p,v,k,A;for(y||(y=this.selectAll(".wk-chart-layer")),o=n.scale().rangeBand()/(1-c.padding)*c.padding,i=n.scale().rangeBand()/(1-c.outerPadding)*c.outerPadding,p=r.layerKeys(t),g=[],k=0,A=t.length;A>k;k++)d=t[k],v=0,h={key:n.value(d),layers:[],data:d,y:n.map(d),height:n.scale().rangeBand?n.scale().rangeBand():1},void 0!==h.y&&(h.layers=p.map(function(t){var e;return e={layerKey:t,key:h.key,value:d[t],width:r.scale()(+d[t]),height:n.scale().rangeBand?n.scale().rangeBand():1,x:r.scale()(+v),color:a.scale()(t)},v+=+d[t],e}),g.push(h));return m(g).first({y:e.height+u/2-i,height:0}).last({y:0,height:l-u/2}),w(p),y=y.data(g,function(t){return t.key}),y.enter().append("g").attr("class","wk-chart-layer").attr("transform",function(t){return"translate(0,"+(f?t.y:m.addedPred(t).y-u/2)+") scale(1,"+(f?1:0)+")"}).style("opacity",f?0:1).call(b.tooltip),y.transition().duration(e.duration).attr("transform",function(t){return"translate(0, "+t.y+") scale(1,1)"}).style("opacity",1),y.exit().transition().duration(e.duration).attr("transform",function(t){return"translate(0,"+(m.deletedSucc(t).y+m.deletedSucc(t).height+o/2)+") scale(1,0)"}).remove(),s=y.selectAll(".wk-chart-bar").data(function(t){return t.layers},function(t){return t.layerKey+"|"+t.key}),s.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("x",function(t){var e;return m.prev(t.key)?(e=p.indexOf(w.addedPred(t.layerKey)),e>=0?m.prev(t.key).layers[e].x+m.prev(t.key).layers[e].width:r.scale()(0)):t.x}).attr("width",function(t){return m.prev(t.key)?0:t.width}).attr("height",function(t){return t.height}).call(x),s.style("fill",function(t){return t.color}).transition().duration(e.duration).attr("x",function(t){return t.x}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),s.exit().transition().duration(e.duration).attr("x",function(t){var e;return e=p.indexOf(w.deletedSucc(t.layerKey)),e>=0?m.current(t.key).layers[e].x:m.current(t.key).layers[p.length-1].x+m.current(t.key).layers[p.length-1].width}).attr("width",0).remove(),f=!1,u=o,l=i},d=function(t){return y.attr("transform",function(e){var r;return"translate(0, "+((r=t.scale()(e.key))>=0?r:-1e3)+")"}).selectAll(".wk-chart-bar").attr("height",function(){return t.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return k=this.getScales(["x","y","color"]),this.getKind("x").domainCalc("total").resetOnNewData(!0),this.getKind("y").resetOnNewData(!0).rangePadding(c).scaleType("ordinal"),this.layerScale("color"),b=h.behavior().tooltip,x=h.behavior().selected,b.on("enter."+v,p)}),h.lifeCycle().on("drawChart",s),h.lifeCycle().on("brushDraw",d),i.$observe("padding",function(t){var n;return"false"===t?(c.padding=0,c.outerPadding=0):"true"===t?c=_.clone(r,!0):(n=e.parseList(t),n&&(1===n.length&&(c.padding=n[0]/100,c.outerPadding=n[0]/100),2===n.length&&(c.padding=n[0]/100,c.outerPadding=n[1]/100))),k.y.rangePadding(c),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("bubble",["$log","utils",function(){var t;return t=0,{restrict:"A",require:"layout",link:function(e,r,n,a){var i,o,l,u,c,s,d;return o=a.me,d=void 0,c={},u="bubble"+t++,s=void 0,l=function(t){var e,r,n;n=[];for(e in c)r=c[e],n.push(this.layers.push({name:r.axisLabel(),value:r.formattedValue(t),color:"color"===e?{"background-color":r.map(t)}:void 0}));return n},i=function(t,e,r,n,a,i){var o;return o=this.selectAll(".wk-chart-bubble").data(t,function(t){return a.value(t)}),o.enter().append("circle").attr("class","wk-chart-bubble wk-chart-selectable").style("opacity",0).call(d.tooltip).call(s),o.style("fill",function(t){return a.map(t)}).transition().duration(e.duration).attr({r:function(t){return i.map(t)},cx:function(t){return r.map(t)},cy:function(t){return n.map(t)}}).style("opacity",1),o.exit().transition().duration(e.duration).style("opacity",0).remove()},o.lifeCycle().on("configure",function(){return c=this.getScales(["x","y","color","size"]),this.getKind("y").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0),d=o.behavior().tooltip,s=o.behavior().selected,d.on("enter."+u,l)}),o.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("column",["$log","utils","barConfig","wkChartMargins",function(t,e,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(t,i,o,l){var u,c,s,d,h,f,y,g,p,v,m,w,k,x;return y=l.me,v="simpleColumn"+a++,d=null,w={},k=void 0,m=e.mergeData(),m([]).key(function(t){return t.key}),g=!0,c=0,u=0,h=_.clone(r,!0),x=void 0,p=function(t){return this.headerName=w.x.axisLabel(),this.headerValue=w.y.axisLabel(),this.layers.push({name:w.color.formattedValue(t.data),value:w.y.formattedValue(t.data),color:{"background-color":w.color.map(t.data)}})},f=function(t,e,r,a,i){var o,l,s,f;return d||(d=this.selectAll(".wk-chart-column")),l=r.scale().rangeBand()/(1-h.padding)*h.padding,o=r.scale().rangeBand()/(1-h.outerPadding)*h.outerPadding,f=t.map(function(t){return{data:t,key:r.value(t),x:r.map(t),y:Math.min(a.scale()(0),a.map(t)),color:i.map(t),width:r.scale().rangeBand(r.value(t)),height:Math.abs(a.scale()(0)-a.map(t))}}),m(f).first({x:0,width:0}).last({x:e.width+l/2-u,width:o}),d=d.data(f,function(t){return t.key}),s=d.enter().append("g").attr("class","wk-chart-column").attr("transform",function(t,e){return"translate("+(g?t.x:m.addedPred(t).x+m.addedPred(t).width+(e?c/2:u))+","+t.y+") scale("+(g?1:0)+",1)"}),s.append("rect").attr("class","wk-chart-rect wk-chart-selectable").attr("height",function(t){return t.height}).attr("width",function(t){return t.width}).style("fill",function(t){return t.color}).style("opacity",g?0:1).call(x.tooltip).call(k),s.append("text").attr("class","wk-chart-data-label").attr("x",function(t){return t.width/2}).attr("y",-n.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),d.transition().duration(e.duration).attr("transform",function(t){return"translate("+t.x+", "+t.y+") scale(1,1)"}),d.select("rect").transition().duration(e.duration).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).style("opacity",1),d.select("text").text(function(t){return a.formattedValue(t.data)}).transition().duration(e.duration).attr("x",function(t){return t.width/2}).style("opacity",y.showDataLabels()?1:0),d.exit().transition().duration(e.duration).attr("transform",function(t){return"translate("+(m.deletedSucc(t).x-l/2)+","+t.y+") scale(0,1)"}).remove(),g=!1,c=l,u=o},s=function(t){return d.attr("transform",function(e){var r;return"translate("+((r=t.scale()(e.key))>=0?r:-1e3)+", "+e.y+")"}).selectAll(".wk-chart-rect").attr("width",function(){return t.scale().rangeBand()}),d.selectAll("text").attr("x",t.scale().rangeBand()/2)},y.lifeCycle().on("configure",function(){return w=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(h).scaleType("ordinal"),x=y.behavior().tooltip,k=y.behavior().selected,x.on("enter."+v,p)}),y.lifeCycle().on("drawChart",f),y.lifeCycle().on("brushDraw",s),o.$observe("padding",function(t){var n;return"false"===t?(h.padding=0,h.outerPadding=0):"true"===t?h=_.clone(r,!0):(n=e.parseList(t),n&&(1===n.length&&(h.padding=n[0]/100,h.outerPadding=n[0]/100),2===n.length&&(h.padding=n[0]/100,h.outerPadding=n[1]/100))),w.x.rangePadding(h),y.lifeCycle().update()}),o.$observe("labels",function(t){return"false"===t?y.showDataLabels(!1):("true"===t||""===t)&&y.showDataLabels("y"),y.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("columnClustered",["$log","utils","barConfig",function(t,e,r){var n;return n=0,{restrict:"A",require:"^layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x;return f=o.me,v="clusteredColumn"+n++,g=null,m=e.mergeData().key(function(t){return t.key}),w=e.mergeData().key(function(t){return t.layerKey}),u=0,l=0,s=_.clone(r,!0),h=void 0,c=void 0,y=!0,x=void 0,k={},p=function(t){var e;return e=t.layers.map(function(t){return{name:t.layerKey,value:k.y.formatValue(t.value),color:{"background-color":t.color}}}),this.headerName=k.x.axisLabel(),this.headerValue=k.x.formatValue(t.key),this.layers=this.layers.concat(e)},d=function(t,e,r,n,a){var i,o,d,h,f;return o=r.scale().rangeBand()/(1-s.padding)*s.padding,i=r.scale().rangeBand()/(1-s.outerPadding)*s.outerPadding,f=n.layerKeys(t),c=d3.scale.ordinal().domain(n.layerKeys(t)).rangeBands([0,r.scale().rangeBand()],0,0),h=t.map(function(t){var e;return e={key:r.value(t),data:t,x:r.map(t),width:r.scale().rangeBand(r.value(t)),layers:f.map(function(e){return{layerKey:e,color:a.scale()(e),key:r.value(t),value:t[e],x:c(e),y:n.scale()(t[e]),height:n.scale()(0)-n.scale()(t[e]),width:c.rangeBand(e)}})}}),m(h).first({x:u/2-i,width:0}).last({x:e.width+o/2-l,width:0}),w(h[0].layers).first({x:0,width:0}).last({x:h[0].width,width:0}),g||(g=this.selectAll(".wk-chart-layer")),g=g.data(h,function(t){return t.key}),g.enter().append("g").attr("class","wk-chart-layer").call(x.tooltip).attr("transform",function(t){return"translate("+(y?t.x:m.addedPred(t).x+m.addedPred(t).width+u/2)+",0) scale("+(y?1:0)+", 1)"}).style("opacity",y?0:1),g.transition().duration(e.duration).attr("transform",function(t){return"translate("+t.x+",0) scale(1,1)"}).style("opacity",1),g.exit().transition().duration(e.duration).attr("transform",function(t){return"translate("+(m.deletedSucc(t).x-o/2)+", 0) scale(0,1)"}).remove(),d=g.selectAll(".wk-chart-bar").data(function(t){return t.layers},function(t){return t.layerKey+"|"+t.key}),d.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("x",function(t){return y?t.x:w.addedPred(t).x+w.addedPred(t).width}).attr("width",function(t){return y?t.width:0}),d.style("fill",function(t){return a.scale()(t.layerKey)}).transition().duration(e.duration).attr("width",function(t){return t.width}).attr("x",function(t){return t.x}).attr("y",function(t){return Math.min(n.scale()(0),t.y)}).attr("height",function(t){return Math.abs(t.height)}),d.exit().transition().duration(e.duration).attr("width",0).attr("x",function(t){return w.deletedSucc(t).x}).remove(),y=!1,u=o,l=i},h=function(t){var e;return c.rangeBands([0,t.scale().rangeBand()],0,0),e=c.rangeBand(),g.attr("transform",function(e){var r;return"translate("+((r=t.scale()(e.key))>=0?r:-1e3)+",0)"}).selectAll(".wk-chart-bar").attr("width",e).attr("x",function(t){return c(t.layerKey)})},f.lifeCycle().on("configure",function(){return k=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(s).scaleType("ordinal"),this.layerScale("color"),x=f.behavior().tooltip,x.on("enter."+v,p)}),f.lifeCycle().on("drawChart",d),f.lifeCycle().on("brushDraw",h),i.$observe("padding",function(t){var n;return"false"===t?(s.padding=0,s.outerPadding=0):"true"===t?s=_.clone(r,!0):(n=e.parseList(t),n&&(1===n.length&&(s.padding=n[0]/100,s.outerPadding=n[0]/100),2===n.length&&(s.padding=n[0]/100,s.outerPadding=n[1]/100))),k.x.rangePadding(s),f.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("columnStacked",["$log","utils","barConfig",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b;return h=o.me,v="stackedColumn"+n++,y=null,g=[],b=function(){},k={},x=void 0,u=0,l=0,m=e.mergeData().key(function(t){return t.key}),w=e.mergeData(),f=!0,c=_.clone(r,!0),p=function(t){var e;return e=t.layers.map(function(t){return{name:t.layerKey,value:k.y.formatValue(t.value),color:{"background-color":t.color}}}),this.headerName=k.x.axisLabel(),this.headerValue=k.x.formatValue(t.key),this.layers=this.layers.concat(e)},s=function(t,e,r,n,a){var i,o,s,d,h,p,v,k,A;for(y||(y=this.selectAll(".layer")),o=r.scale().rangeBand()/(1-c.padding)*c.padding,i=r.scale().rangeBand()/(1-c.outerPadding)*c.outerPadding,p=n.layerKeys(t),g=[],k=0,A=t.length;A>k;k++)d=t[k],v=0,h={key:r.value(d),layers:[],data:d,x:r.map(d),width:r.scale().rangeBand?r.scale().rangeBand():1},void 0!==h.x&&(h.layers=p.map(function(t){var e;return e={layerKey:t,key:h.key,value:d[t],height:n.scale()(0)-n.scale()(+d[t]),width:r.scale().rangeBand?r.scale().rangeBand():1,y:n.scale()(+v+ +d[t]),color:a.scale()(t)},v+=+d[t],e}),g.push(h));return m(g).first({x:u/2-i,width:0}).last({x:e.width+o/2-l,width:0}),w(p),y=y.data(g,function(t){return t.key}),y.enter().append("g").attr("transform",function(t){return"translate("+(f?t.x:m.addedPred(t).x+m.addedPred(t).width+u/2)+",0) scale("+(f?1:0)+", 1)"}).style("opacity",f?0:1).call(b.tooltip),y.transition().duration(e.duration).attr("transform",function(t){return"translate("+t.x+",0) scale(1,1)"}).style("opacity",1),y.exit().transition().duration(e.duration).attr("transform",function(t){return"translate("+(m.deletedSucc(t).x-o/2)+", 0) scale(0,1)"}).remove(),s=y.selectAll(".wk-chart-bar").data(function(t){return t.layers},function(t){return t.layerKey+"|"+t.key}),s.enter().append("rect").attr("class","wk-chart-bar wk-chart-selectable").attr("y",function(t){var e;return m.prev(t.key)?(e=p.indexOf(w.addedPred(t.layerKey)),e>=0?m.prev(t.key).layers[e].y:n.scale()(0)):t.y}).attr("height",function(t){return t.height}).call(x),s.style("fill",function(t){return t.color}).transition().duration(e.duration).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),s.exit().transition().duration(e.duration).attr("height",0).attr("y",function(t){var e;return e=p.indexOf(w.deletedSucc(t.layerKey)),e>=0?m.current(t.key).layers[e].y+m.current(t.key).layers[e].height:m.current(t.key).layers[p.length-1].y}).remove(),f=!1,u=o,l=i},d=function(t){return y.attr("transform",function(e){var r;return"translate("+((r=t.scale()(e.key))>=0?r:-1e3)+",0)"}).selectAll(".wk-chart-bar").attr("width",function(){return t.scale().rangeBand()})},h.lifeCycle().on("configure",function(){return k=this.getScales(["x","y","color"]),this.getKind("y").domainCalc("total").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).rangePadding(c).scaleType("ordinal"),this.layerScale("color"),b=h.behavior().tooltip,x=h.behavior().selected,b.on("enter."+v,p)}),h.lifeCycle().on("drawChart",s),h.lifeCycle().on("brushDraw",d),i.$observe("padding",function(t){var n;return"false"===t?(c.padding=0,c.outerPadding=0):"true"===t?c=_.clone(r,!0):(n=e.parseList(t),n&&(1===n.length&&(c.padding=n[0]/100,c.outerPadding=n[0]/100),2===n.length&&(c.padding=n[0]/100,c.outerPadding=n[1]/100))),k.x.rangePadding(c),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("gauge",["$log","utils",function(t,e){return{restrict:"A",require:"^layout",controller:["$scope","$attrs",function(t,r){var n;return n={chartType:"GaugeChart",id:e.getId()},r.$set("chart-id",n.id),n}],link:function(e,r,n,a){var i,o,l;return l=a.me,o=!0,i=function(e,r,n,a,i){var l,u,c,s,d,h,f,y,g,p;for(t.info("drawing Gauge Chart"),s=[e],y=a.scale().domain(),c=angular.copy(i.scale().domain()),c.unshift(y[0]),c.push(y[1]),f=[],d=g=1,p=c.length-1;p>=1?p>=g:g>=p;d=p>=1?++g:--g)f.push({from:+c[d-1],to:+c[d]});return u=this.selectAll(".wk-chart-bar"),u=u.data(f,function(t,e){return e}),o?u.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50).style("opacity",0):u.enter().append("rect").attr("class","wk-chart-bar").attr("x",0).attr("width",50),u.transition().duration(r.duration).attr("height",function(t){return a.scale()(0)-a.scale()(t.to-t.from)}).attr("y",function(t){return a.scale()(t.to)}).style("fill",function(t){return i.scale()(t.from)}).style("opacity",1),u.exit().remove(),l=function(t){return t.append("rect").attr("width",55).attr("height",4).style("fill","black"),t.append("circle").attr("r",10).attr("cx",65).attr("cy",2).style("stroke","black")},h=this.selectAll(".wk-chart-marker"),h=h.data(s,function(){return"wk-chart-marker"}),h.enter().append("g").attr("class","wk-chart-marker").call(l),o&&h.attr("transform",function(t){return"translate(0,"+a.scale()(t.value)+")"}).style("opacity",0),h.transition().duration(r.duration).attr("transform",function(t){return"translate(0,"+a.scale()(t.value)+")"}).style("fill",function(t){return i.scale()(t.value)}).style("opacity",1),o=!1},l.lifeCycle().on("configure",function(){return this.requiredScales(["y","color"]),this.getKind("color").resetOnNewData(!0)}),l.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("geoMap",["$log","utils",function(t){var e,r;return e=0,r=function(t){var e;return t?(e=t.trim().replace(/^\[|\]$/g,"").split(",").map(function(t){return t.replace(/^[\"|']|[\"|']$/g,"")}),e=e.map(function(t){return isNaN(t)?t:+t}),1===e.length?e[0]:e):void 0},{restrict:"A",require:"layout",scope:{geojson:"=",projection:"="},link:function(r,n,a,i){var o,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A;return l=i.me,x=void 0,k=void 0,w={},f="geoMap"+e++,s=d3.map(),m=1,v=[0,0],y="",c=function(t){var e;return e=s.get(t.properties[y[0]]),this.layers.push({name:e.RS,value:e.DES})},u=[],p=d3.geo.orthographic(),b=0,h=0,g=void 0,A=d3.geo.zoom().projection(p).on("zoom.redraw",function(){return d3.event.sourceEvent.preventDefault(),u.attr("d",g)}),d=void 0,o=function(t,e,r,n,a){var i,o,l;if(b=e.width,h=e.height,t&&t[0].hasOwnProperty(y[1]))for(o=0,l=t.length;l>o;o++)i=t[o],s.set(i[y[1]],i);return d?(p.translate([b/2,h/2]),u=this.selectAll("path").data(d.features,function(t){return t.properties[y[0]]}),u.enter().append("svg:path").style("fill","lightgrey").style("stroke","darkgrey").call(x.tooltip).call(k).call(A),u.attr("d",g).style("fill",function(t){var e;return e=s.get(t.properties[y[0]]),a.map(e)}),u.exit().remove()):void 0},l.lifeCycle().on("configure",function(){return w=this.getScales(["color"]),w.color.resetOnNewData(!0)}),l.lifeCycle().on("drawChart",o),x=l.behavior().tooltip,k=l.behavior().selected,x.on("enter."+f,c),r.$watch("projection",function(e){return void 0!==e&&(t.log("setting Projection params",e),d3.geo.hasOwnProperty(e.projection))?(p=d3.geo[e.projection](),p.center(e.center).scale(e.scale).rotate(e.rotate).clipAngle(e.clipAngle),y=e.idMap,p.parallels&&p.parallels(e.parallels),m=p.scale(),v=p.rotate(),g=d3.geo.path().projection(p),A.projection(p),l.lifeCycle().update()):void 0},!0),r.$watch("geojson",function(t){return void 0!==t&&""!==t?(d=t,l.lifeCycle().update()):void 0})}}}]),angular.module("wk.chart").directive("columnHistogram",["$log","barConfig","utils","wkChartMargins",function(t,e,r,n){var a;return a=0,{restrict:"A",require:"^layout",link:function(t,i,o,l){var u,c,s,d,h,f,y,g,p,v,m,w,k;return h=l.me,p="histogram"+a++,m={},c=void 0,y=void 0,s={},k=void 0,w=void 0,s=_.clone(e,!0),v=r.mergeData().key(function(t){return t.xVal}),f=!0,k=void 0,g=function(t){var e,r,n;return this.headerName=m.rangeX.axisLabel(),this.headerValue=m.y.axisLabel(),e=m.rangeX.formatValue(m.rangeX.lowerValue(t.data)),m.rangeX.upperProperty()?(n=m.rangeX.formatValue(m.rangeX.upperValue(t.data)),r=e+" - "+n):r=m.rangeX.formatValue(m.rangeX.lowerValue(t.data)),this.layers.push({name:r,value:m.y.formattedValue(t.data),color:{"background-color":m.color.map(t.data)}})},d=function(t,e,r,a,i,o,l,u){var s,d,y,g,p;return u.upperProperty()?d=t.map(function(t){return{x:u.scale()(u.lowerValue(t)),xVal:u.lowerValue(t),width:u.scale()(u.upperValue(t))-u.scale()(u.lowerValue(t)),y:a.map(t),height:e.height-a.map(t),color:i.map(t),data:t}}):t.length>0&&(y=u.lowerValue(t[0]),g=u.lowerValue(t[1])-y,p=e.width/t.length,d=t.map(function(t,r){return{x:u.scale()(y+g*r),xVal:u.lowerValue(t),width:p,y:a.map(t),height:e.height-a.map(t),color:i.map(t),data:t}})),v(d).first({x:0,width:0}).last({x:e.width,width:0}),c||(c=this.selectAll(".wk-chart-bucket")),c=c.data(d,function(t){return t.xVal}),s=c.enter().append("g").attr("class","wk-chart-bucket").attr("transform",function(t){return"translate("+(f?t.x:v.addedPred(t).x+v.addedPred(t).width)+","+t.y+") scale("+(f?1:0)+",1)"}),s.append("rect").attr("class","wk-chart-selectable").attr("height",function(t){return t.height}).attr("width",function(t){return t.width}).style("fill",function(t){return t.color}).style("opacity",f?0:1).call(k.tooltip).call(w),s.append("text").attr("class","wk-chart-data-label").attr("x",function(t){return t.width/2}).attr("y",-n.dataLabelPadding.vert).attr({"text-anchor":"middle"}).style({opacity:0}),c.transition().duration(e.duration).attr("transform",function(t){return"translate("+t.x+", "+t.y+") scale(1,1)"}),c.select("rect").transition().duration(e.duration).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).style("fill",function(t){return t.color}).style("opacity",1),c.select("text").text(function(t){return a.formattedValue(t.data)}).transition().duration(e.duration).attr("x",function(t){return t.width/2}).style("opacity",h.showDataLabels()?1:0),c.exit().transition().duration(e.duration).attr("transform",function(t){return"translate("+v.deletedSucc(t).x+","+t.y+") scale(0,1)"}).remove(),f=!1},u=function(t,e,r){var n;return n=function(t,n){return t.upperProperty()?t.scale()(t.upperValue(n.data))-t.scale()(t.lowerValue(n.data)):r/Math.max(e[1]-e[0]+1,1)},c.attr("transform",function(e){var r;return"translate("+((r=t.scale()(e.xVal))>=0?r:-1e3)+", "+e.y+")"}),c.select("rect").attr("width",function(e){return n(t,e)}),c.selectAll("text").attr("x",function(e){return n(t,e)/2})},h.lifeCycle().on("configure",function(){return m=this.getScales(["rangeX","y","color"]),this.getKind("y").domainCalc("max").resetOnNewData(!0),this.getKind("rangeX").resetOnNewData(!0).scaleType("linear").domainCalc("rangeExtent"),this.getKind("color").resetOnNewData(!0),k=h.behavior().tooltip,w=h.behavior().selected,k.on("enter."+p,g)}),h.lifeCycle().on("drawChart",d),h.lifeCycle().on("brushDraw",u),o.$observe("labels",function(t){return"false"===t?h.showDataLabels(!1):("true"===t||""===t)&&h.showDataLabels("y"),h.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("line",["$log","behavior","utils","tooltipUtils","timing",function(t,e,r,n){var a;return a=0,{restrict:"A",require:"layout",link:function(t,e,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V;return c=o.me,b=[],A=[],w=[],D=[],S=[],C=[],x=0,P=void 0,V=void 0,m=void 0,$=!1,O={},y=0,k="line"+a++,s=void 0,h=void 0,f=void 0,d=void 0,g=function(t){return C=_.toArray(S),p.apply(this,[t])},p=function(t){var e;return e=C.map(function(e){return{name:e[t].key,value:O.y.formatValue(e[t].yv),color:{"background-color":e[t].color},xv:e[t].xv}}),this.headerName=O.x.axisLabel(),this.headerValue=O.x.formatValue(e[0].xv),this.layers=this.layers.concat(e)},v=function(t){return m=this.selectAll(".wk-chart-marker-"+k).data(C,function(e){return e[t].key}),m.enter().append("g").attr("class","wk-chart-marker-"+k).call(n.styleTooltipMarker,t),m.selectAll("circle").attr("cy",function(e){return e[t].y}),m.exit().remove(),this.attr("transform","translate("+(O.x.scale()(C[0][t].xv)+y)+")")},u=function(t,e,n,a,i){var o,l,u,c,s,g,p,v,m,k,C,O,V,M,N,B;for(v=r.mergeSeriesSorted(n.value(w),n.value(t)),b=a.layerKeys(t),A=[],S={},V=0,N=b.length;N>V;V++){for(u=b[V],S[u]=t.map(function(t){return{x:n.map(t),y:a.scale()(a.layerValue(t,u)),xv:n.value(t),yv:a.layerValue(t,u),key:u,color:i.scale()(u),data:t}}),c={key:u,color:i.scale()(u),value:[]},l=0;l<v.length;){if(void 0!==v[l][0]){k=D[u][v[l][0]];break}l++}for(;l<v.length;){if(void 0!==v[l][1]){m=S[u][v[l][1]];break}l++}for(l=M=0,B=v.length;B>M;l=++M)O=v[l],C={color:c.color,x:O[2]},void 0===O[1]?(C.yNew=m.y,C.xNew=m.x,C.deleted=!0):(C.yNew=S[u][O[1]].y,C.xNew=S[u][O[1]].x,m=S[u][O[1]],C.deleted=!1),w.length>0?void 0===O[0]?(C.yOld=k.y,C.xOld=k.x):(C.yOld=D[u][O[0]].y,C.xOld=D[u][O[0]].x,k=D[u][O[0]]):(C.xOld=C.xNew,C.yOld=C.yNew),c.value.push(C);A.push(c)}return y=n.isOrdinal()?n.scale().rangeBand()/2:0,P&&P.data(t),h=function(t,e){var r;return $?(r=t.selectAll(".wk-chart-marker").data(function(t){return t.value},function(t){return t.x}),r.enter().append("circle").attr("class","wk-chart-marker wk-chart-selectable").attr("r",5).style("pointer-events","none").style("opacity",0).style("fill",function(t){return t.color}),r.attr("cy",function(t){return t.yOld}).attr("cx",function(t){return t.xOld+y}).classed("wk-chart-deleted",function(t){return t.deleted}).transition().duration(e).attr("cy",function(t){return t.yNew}).attr("cx",function(t){return t.xNew+y}).style("opacity",function(t){return t.deleted?0:1}),r.exit().remove()):t.selectAll(".wk-chart-marker").transition().duration(e).style("opacity",0).remove()},f=function(t){return $?t.attr("cx",function(t){return n.scale()(t.x)}):void 0},p=d3.svg.line().x(function(t){return t.xOld}).y(function(t){return t.yOld}),g=d3.svg.line().x(function(t){return t.xNew}).y(function(t){return t.yNew}),d=d3.svg.line().x(function(t){return n.scale()(t.x)}).y(function(t){return t.yNew}),s=this.selectAll(".wk-chart-layer").data(A,function(t){return t.key}),o=s.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-line").attr("d",function(t){return g(t.value)}).style("opacity",x).style("pointer-events","none"),s.select(".wk-chart-line").attr("transform","translate("+y+")").attr("d",function(t){return p(t.value)}).transition().duration(e.duration).attr("d",function(t){return g(t.value)}).style("stroke",function(t){return t.color}).style("opacity",1).style("pointer-events","none"),s.exit().transition().duration(e.duration).style("opacity",0).remove(),s.call(h,e.duration),x=0,w=t,D=S},l=function(t,e){var r;return r=this.selectAll(".wk-chart-line"),t.isOrdinal()?r.attr("d",function(t){return d(t.value.slice(e[0],e[1]+1))}):r.attr("d",function(t){return d(t.value)}),h=this.selectAll(".wk-chart-marker").call(f)},c.lifeCycle().on("configure",function(){return O=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),P=c.behavior().tooltip,P.markerScale(O.x),P.on("enter."+k,g),P.on("moveData."+k,p),P.on("moveMarker."+k,v)}),c.lifeCycle().on("drawChart",u),c.lifeCycle().on("brushDraw",l),i.$observe("markers",function(t){return $=""===t||"true"===t?!0:!1,c.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("lineVertical",["$log","utils","tooltipUtils",function(t,e,r){var n;return n=0,{restrict:"A",require:"layout",link:function(t,a,i,o){var l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V;return s=o.me,d=[],A=[],x=[],D=[],S=[],C=[],h=void 0,y=void 0,u=0,P=void 0,V=void 0,k=void 0,$=!1,O={},g=0,b="line"+n++,p=function(){},v=function(t){return C=_.toArray(S),m.apply(this,[t])},m=function(t){var e,r;return e=t+u,r=C.map(function(t){return{name:t[e].key,value:O.x.formatValue(t[e].xv),color:{"background-color":t[e].color},yv:t[e].yv}}),this.headerName=O.y.axisLabel(),this.headerValue=O.y.formatValue(r[0].yv),this.layers=this.layers.concat(r)},w=function(t){var e,n;return n=t+u,k=this.selectAll(".wk-chart-marker-"+b).data(C,function(t){return t[n].key}),k.enter().append("g").attr("class","wk-chart-marker-"+b).call(r.styleTooltipMarker,n),k.selectAll("circle").attr("cx",function(t){return t[n].x}),k.exit().remove(),e=O.y.isOrdinal?O.y.scale().rangeBand()/2:0,this.attr("transform","translate(0,"+(O.y.scale()(C[0][n].yv)+e)+")")},f=function(t,e){var r;return $?(r=t.selectAll(".wk-chart-marker").data(function(t){return t.value},function(t){return t.y}),r.enter().append("circle").attr("class","wk-chart-marker wk-chart-selectable").attr("r",5).style("pointer-events","none").style("opacity",0).style("fill",function(t){return t.color}),r.attr("cy",function(t){return t.yOld+g}).attr("cx",function(t){return t.xOld}).classed("wk-chart-deleted",function(t){return t.deleted}).transition().duration(e).attr("cy",function(t){return t.yNew+g}).attr("cx",function(t){return t.xNew}).style("opacity",function(t){return t.deleted?0:1}),r.exit().remove()):t.selectAll(".wk-chart-marker").transition().duration(e).style("opacity",0).remove()},c=function(t,r,n,a,i){var o,l,u,c,s,d,p,v,m,w,k,b,C,O,V,M,N;for(v=a.isOrdinal()?e.mergeSeriesUnsorted(a.value(x),a.value(t)):e.mergeSeriesSorted(a.value(x),a.value(t)),V=n.layerKeys(t),A=[],S={},C=0,M=V.length;M>C;C++){for(u=V[C],S[u]=t.map(function(t){return{y:a.map(t),x:n.scale()(n.layerValue(t,u)),yv:a.value(t),xv:n.layerValue(t,u),key:u,color:i.scale()(u),data:t}}),c={key:u,color:i.scale()(u),value:[]},l=0;l<v.length;){if(void 0!==v[l][0]){w=D[u][v[l][0]];break}l++}for(;l<v.length;){if(void 0!==v[l][1]){m=S[u][v[l][1]];break}l++}for(l=O=0,N=v.length;N>O;l=++O)b=v[l],k={color:c.color,y:b[2]},void 0===b[1]?(k.yNew=m.y,k.xNew=m.x,k.deleted=!0):(k.yNew=S[u][b[1]].y,k.xNew=S[u][b[1]].x,m=S[u][b[1]],k.deleted=!1),x.length>0?void 0===b[0]?(k.yOld=w.y,k.xOld=w.x):(k.yOld=D[u][b[0]].y,k.xOld=D[u][b[0]].x,w=D[u][b[0]]):(k.xOld=k.xNew,k.yOld=k.yNew),c.value.push(k);A.push(c)}return g=a.isOrdinal()?a.scale().rangeBand()/2:0,y=function(t){return $?t.attr("cy",function(t){return a.scale()(t.y)+(a.isOrdinal()?a.scale().rangeBand()/2:0)}):void 0},P&&P.data(t),p=d3.svg.line().x(function(t){return t.xOld
}).y(function(t){return t.yOld}),d=d3.svg.line().x(function(t){return t.xNew}).y(function(t){return t.yNew}),h=d3.svg.line().x(function(t){return t.xNew}).y(function(t){return a.scale()(t.y)}),s=this.selectAll(".wk-chart-layer").data(A,function(t){return t.key}),o=s.enter().append("g").attr("class","wk-chart-layer"),o.append("path").attr("class","wk-chart-line").style("stroke",function(t){return t.color}).style("opacity",0).style("pointer-events","none"),s.select(".wk-chart-line").attr("transform","translate(0,"+g+")").attr("d",function(t){return p(t.value)}).transition().duration(r.duration).attr("d",function(t){return d(t.value)}).style("opacity",1).style("pointer-events","none"),s.exit().transition().duration(r.duration).style("opacity",0).remove(),s.call(f,r.duration),x=t,D=S},l=function(t,e){var r;return r=this.selectAll(".wk-chart-line"),t.isOrdinal()?(u=e[0],r.attr("d",function(t){return h(t.value.slice(e[0],e[1]+1))}).attr("transform","translate(0,"+t.scale().rangeBand()/2+")")):r.attr("d",function(t){return h(t.value)}),f=this.selectAll(".wk-chart-marker").call(y)},s.lifeCycle().on("configure",function(){return O=this.getScales(["x","y","color"]),this.layerScale("color"),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),P=s.behavior().tooltip,P.markerScale(O.y),P.on("enter."+b,v),P.on("moveData."+b,m),P.on("moveMarker."+b,w)}),s.lifeCycle().on("drawChart",c),s.lifeCycle().on("brushDraw",l),i.$observe("markers",function(t){return $=""===t||"true"===t?!0:!1,s.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("pie",["$log","utils",function(t,e){var r;return r=0,{restrict:"EA",require:"^layout",link:function(t,n,a,i){var o,l,u,c,s,d,h,f,y,g,p,v,m,w,k;return s=i.me,g="pie"+r++,u=void 0,d=void 0,c=void 0,h=void 0,f=void 0,v=[],m=void 0,k=void 0,w=!1,p=e.mergeData(),y=function(t){return this.headerName=v.color.axisLabel(),this.headerValue=v.size.axisLabel(),this.layers.push({name:v.color.formattedValue(t.data),value:v.size.formattedValue(t.data),color:{"background-color":v.color.map(t.data)}})},l=!0,o=function(t,e,r,n,a,i){var o,s,d,y,g,x,b,A;return b=Math.min(e.width,e.height)/2,h||(h=this.append("g").attr("class","wk-chart-pieBox")),h.attr("transform","translate("+e.width/2+","+e.height/2+")"),s=d3.svg.arc().outerRadius(b*(w?.8:1)).innerRadius(0),g=d3.svg.arc().outerRadius(.9*b).innerRadius(.9*b),d=function(t){return v.color.value(t.data)},x=d3.layout.pie().sort(null).value(i.value),o=function(t){var e;return e=d3.interpolate(this._current,t),this._current=e(0),function(t){return s(e(t))}},A=x(t),p.key(d),p(A).first({startAngle:0,endAngle:0}).last({startAngle:2*Math.PI,endAngle:2*Math.PI}),u||(u=h.selectAll(".wk-chart-innerArc")),u=u.data(A,d),u.enter().append("path").each(function(t){return this._current=l?t:{startAngle:p.addedPred(t).endAngle,endAngle:p.addedPred(t).endAngle}}).attr("class","wk-chart-innerArc wk-chart-selectable").style("fill",function(t){return a.map(t.data)}).style("stroke",function(t){return a.map(t.data)}).style("opacity",l?0:1).call(k.tooltip).call(m),u.transition().duration(e.duration).style("opacity",1).attrTween("d",o),u.exit().datum(function(t){return{startAngle:p.deletedSucc(t).startAngle,endAngle:p.deletedSucc(t).startAngle}}).transition().duration(e.duration).attrTween("d",o).remove(),y=function(t){return t.startAngle+(t.endAngle-t.startAngle)/2},w?(c=h.selectAll(".wk-chart-data-label").data(A,d),c.enter().append("text").attr("class","wk-chart-data-label").each(function(t){return this._current=t}).attr("dy",".35em").style("font-size","1.3em").style("opacity",0).text(function(t){return i.formattedValue(t.data)}),c.transition().duration(e.duration).style("opacity",1).text(function(t){return i.formattedValue(t.data)}).attrTween("transform",function(t){var e,r;return r=this,e=d3.interpolate(r._current,t),function(t){var n,a;return n=e(t),r._current=n,a=g.centroid(n),a[0]+=15*(y(n)<Math.PI?1:-1),"translate("+a+")"}}).styleTween("text-anchor",function(t){var e;return e=d3.interpolate(this._current,t),function(t){var r;return r=e(t),y(r)<Math.PI?"start":"end"}}),c.exit().transition().duration(e.duration).style("opacity",0).remove(),f=h.selectAll(".wk-chart-polyline").data(A,d),f.enter().append("polyline").attr("class","wk-chart-polyline").style("opacity",0).each(function(t){return this._current=t}),f.transition().duration(e.duration).style("opacity",function(t){return 0===t.data.value?0:.5}).attrTween("points",function(t){var e,r;return this._current=this._current,e=d3.interpolate(this._current,t),r=this,function(t){var n,a;return n=e(t),r._current=n,a=g.centroid(n),a[0]+=10*(y(n)<Math.PI?1:-1),[s.centroid(n),g.centroid(n),a]}}),f.exit().transition().duration(e.duration).style("opacity",0).remove()):(h.selectAll(".wk-chart-polyline").remove(),h.selectAll(".wk-chart-data-label").remove()),l=!1},s.lifeCycle().on("configure",function(){return v=this.getScales(["size","color"]),v.color.scaleType("category20"),k=s.behavior().tooltip,m=s.behavior().selected,k.on("enter."+g,y)}),s.lifeCycle().on("drawChart",o),a.$observe("labels",function(t){return"false"===t?w=!1:("true"===t||""===t)&&(w=!0),s.lifeCycle().update()})}}}]),angular.module("wk.chart").directive("scatter",["$log","utils",function(){var t;return t=0,{restrict:"A",require:"^layout",link:function(e,r,n,a){var i,o,l,u,c,s,d,h;return l=a.me,h=void 0,d=void 0,c="scatter"+t++,s=[],u=function(t){var e,r,n;n=[];for(e in s)r=s[e],n.push(this.layers.push({name:r.axisLabel(),value:r.formattedValue(t),color:"color"===e?{"background-color":r.map(t)}:void 0,path:"shape"===e?d3.svg.symbol().type(r.map(t)).size(80)():void 0,"class":"shape"===e?"wk-chart-tt-svg-shape":""}));return n},o=!0,i=function(t,e,r,n,a,i,l){var u,c;return u=function(t){return o&&t.style("fill",a.map).attr("transform",function(t){return"translate("+r.map(t)+","+n.map(t)+")"}).style("opacity",1),o=!1},c=this.selectAll(".wk-chart-points").data(t),c.enter().append("path").attr("class","wk-chart-points wk-chart-selectable").attr("transform",function(t){return"translate("+r.map(t)+","+n.map(t)+")"}).call(u).call(h.tooltip).call(d),c.transition().duration(e.duration).attr("d",d3.svg.symbol().type(function(t){return l.map(t)}).size(function(t){return i.map(t)*i.map(t)})).style("fill",a.map).attr("transform",function(t){return"translate("+r.map(t)+","+n.map(t)+")"}).style("opacity",1),c.exit().remove()},l.lifeCycle().on("configure",function(){return s=this.getScales(["x","y","color","size","shape"]),this.getKind("y").domainCalc("extent").resetOnNewData(!0),this.getKind("x").resetOnNewData(!0).domainCalc("extent"),h=l.behavior().tooltip,d=l.behavior().selected,h.on("enter."+c,u)}),l.lifeCycle().on("drawChart",i)}}}]),angular.module("wk.chart").directive("spider",["$log","utils",function(t){var e;return e=0,{restrict:"A",require:"layout",link:function(r,n,a,i){var o,l,u,c,s,d,h,f;return u=i.me,f=void 0,h={},d="spider"+e++,o=d3.svg.axis(),s=void 0,c=function(t){return this.layers=s.map(function(e){return{name:h.x.value(e),value:h.y.formatValue(e[t]),color:{"background-color":h.color.scale()(t)}}})},l=function(e,r,n,a,i){var l,u,c,d,h,y,g,p,v,m,w,k,x,b,A;return s=e,t.log(e),d=r.width/2,h=r.height/2,w=.8*d3.min([d,h]),k=20,m=e.length,l=2*Math.PI/m,p=360/m,u=this.select(".wk-chart-axis"),u.empty()&&(u=this.append("g").attr("class","wk-chart-axis")),A=a.scale().ticks(a.ticks()),a.scale().range([w,0]),o.scale(a.scale()).orient("right").tickValues(A).tickFormat(a.tickFormat()),u.call(o).attr("transform","translate("+d+","+(h-w)+")"),a.scale().range([0,w]),v=this.selectAll(".wk-chart-axis-line").data(e,function(t){return t.axis}),v.enter().append("line").attr("class","wk-chart-axis-line").style("stroke","darkgrey"),v.attr({x1:0,y1:0,x2:0,y2:w}).attr("transform",function(t,e){return"translate("+d+", "+h+")rotate("+p*e+")"}),v.exit().remove(),x=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),b=this.selectAll(".wk-chart-tickPath").data(A),b.enter().append("path").attr("class","wk-chart-tickPath").style("fill","none").style("stroke","lightgrey"),b.attr("d",function(t){var r;return r=e.map(function(e,r){return{x:Math.sin(l*r)*a.scale()(t),y:Math.cos(l*r)*a.scale()(t)}}),x(r)+"Z"}).attr("transform","translate("+d+", "+h+")"),b.exit().remove(),c=this.selectAll(".wk-chart-axis-text").data(e,function(t){return n.value(t)}),c.enter().append("text").attr("class","wk-chart-axis-text").style("fill","black").attr("dy","0.8em").attr("text-anchor","middle"),c.attr({x:function(t,e){return d+Math.sin(l*e)*(w+k)},y:function(t,e){return h+Math.cos(l*e)*(w+k)}}).text(function(t){return n.value(t)}),g=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}),y=this.selectAll(".wk-chart-data-line").data(a.layerKeys(e)),y.enter().append("path").attr("class","wk-chart-data-line").style({stroke:function(t){return i.scale()(t)},fill:function(t){return i.scale()(t)},"fill-opacity":.2,"stroke-width":2}).call(f.tooltip),y.attr("d",function(t){var r;return r=e.map(function(e,r){return{x:Math.sin(l*r)*a.scale()(e[t]),y:Math.cos(l*r)*a.scale()(e[t])}}),g(r)+"Z"}).attr("transform","translate("+d+", "+h+")")},u.lifeCycle().on("configure",function(){return h=this.getScales(["x","y","color"]),h.y.domainCalc("max"),h.x.resetOnNewData(!0).scaleType("ordinal"),f=u.behavior().tooltip,f.on("enter."+d,c)}),u.lifeCycle().on("drawChart",l)}}}]),angular.module("wk.chart").directive("color",["$log","scale","legend","scaleUtils",function(t,e,r,n){var a;return a=0,{restrict:"E",require:["color","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],scope:{mapFunction:"="},link:function(e,r,a,i){var o,l,u,c,s,d;return c=i[0].me,o=i[1].me,u=null!=(d=i[2])?d.me:void 0,l=void 0,o||u?(s="color",c.kind(s),c.parent(u||o),c.chart(o),c.scaleType("category20"),r.addClass(c.id()),o.addScale(c,u),c.register(),n.observeSharedAttributes(a,c),n.observeLegendAttributes(a,c,u),e.$watch("mapFunction",function(t){return t&&_.isFunction(t)?c.scaleMapFn(t):void 0})):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").service("scaleUtils",["$log","wkChartScales","utils",function(t,e,r){var n;return n=function(t){var e;return t?(e=t.trim().replace(/^\[|\]$/g,"").split(",").map(function(t){return t.replace(/^[\"|']|[\"|']$/g,"")}),e=e.map(function(t){return isNaN(t)?t:+t}),1===e.length?e[0]:e):void 0},{observeSharedAttributes:function(a,i){return a.$observe("type",function(r){return void 0!==r?(d3.scale.hasOwnProperty(r)||"time"===r||e.hasOwnProperty(r)?i.scaleType(r):""!==r&&t.error("Error: illegal scale value: "+r+". Using 'linear' scale instead"),i.update()):void 0}),a.$observe("exponent",function(t){return"pow"===i.scaleType()&&_.isNumber(+t)?i.exponent(+t).update():void 0}),a.$observe("property",function(t){return i.property(n(t)).update()}),a.$observe("layerProperty",function(t){return t&&t.length>0?i.layerProperty(t).update():void 0}),a.$observe("range",function(t){var e;return e=n(t),Array.isArray(e)?i.range(e).update():void 0}),a.$observe("dateFormat",function(t){return t&&"time"===i.scaleType()?i.dataFormat(t).update():void 0}),a.$observe("domain",function(e){var r;return e?(t.info("domain",e),r=n(e),Array.isArray(r)?i.domain(r).update():t.error("domain: must be array, or comma-separated list, got",e)):i.domain(void 0).update()}),a.$observe("domainRange",function(t){return t?i.domainCalc(t).update():void 0}),a.$observe("label",function(t){return void 0!==t?i.axisLabel(t).updateAttrs():void 0}),a.$observe("format",function(t){return void 0!==t?i.format(t):void 0}),a.$observe("reset",function(t){return i.resetOnNewData(r.parseTrueFalse(t))})},observeAxisAttributes:function(t,e,r){return t.$observe("tickFormat",function(t){return void 0!==t?e.tickFormat(d3.format(t)).update():void 0}),t.$observe("ticks",function(t){return void 0!==t&&(e.ticks(+t),e.axis())?e.updateAttrs():void 0}),t.$observe("grid",function(t){return void 0!==t?e.showGrid(""===t||"true"===t).updateAttrs():void 0}),t.$observe("showLabel",function(t){return void 0!==t?e.showLabel(""===t||"true"===t).update(!0):void 0}),r.$watch(t.axisFormatters,function(t){return _.isObject(t)?(_.has(t,"tickFormat")&&_.isFunction(t.tickFormat)?e.tickFormat(t.tickFormat):_.isString(t.tickFormat)&&e.tickFormat(d3.format(t)),_.has(t,"tickValues")&&_.isArray(t.tickValues)&&e.tickValues(t.tickValues),e.update()):void 0})},observeLegendAttributes:function(e,r,n){return e.$observe("legend",function(e){var a,i;if(void 0!==e){switch(a=r.legend(),a.showValues(!1),e){case"false":a.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":a.position(e).div(void 0).show(!0);break;case"true":case"":a.position("top-right").show(!0).div(void 0);break;default:i=d3.select(e),i.empty()?(t.warn("legend reference does not exist:",e),a.div(void 0).show(!1)):a.div(i).position("top-left").show(!0)}return a.scale(r).layout(n),r.parent()&&a.register(r.parent()),a.redraw()}}),e.$observe("valuesLegend",function(e){var a,i;if(void 0!==e){switch(a=r.legend(),a.showValues(!0),e){case"false":a.show(!1);break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":a.position(e).div(void 0).show(!0);break;case"true":case"":a.position("top-right").show(!0).div(void 0);break;default:i=d3.select(e),i.empty()?(t.warn("legend reference does not exist:",e),a.div(void 0).show(!1)):a.div(i).position("top-left").show(!0)}return a.scale(r).layout(n),r.parent()&&a.register(r.parent()),a.redraw()}}),e.$observe("legendTitle",function(t){return void 0!==t?r.legend().title(t).redraw():void 0})},observerRangeAttributes:function(t,e){return t.$observe("lowerProperty",function(t){return e.lowerProperty(n(t)).update()}),t.$observe("upperProperty",function(t){return e.upperProperty(n(t)).update()})}}}]),angular.module("wk.chart").directive("shape",["$log","scale","d3Shapes","scaleUtils",function(t,e,r,n){var a;return a=0,{restrict:"E",require:["shape","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],link:function(e,a,i,o){var l,u,c,s,d;return c=o[0].me,l=o[1].me,u=null!=(d=o[2])?d.me:void 0,l||u?(s="shape",c.kind(s),c.parent(u||l),c.chart(l),c.scaleType("ordinal"),c.scale().range(r),a.addClass(c.id()),l.addScale(c,u),c.register(),n.observeSharedAttributes(i,c),n.observeLegendAttributes(i,c,u)):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("size",["$log","scale","scaleUtils",function(t,e,r){var n;return n=0,{restrict:"E",require:["size","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],link:function(e,n,a,i){var o,l,u,c,s;return u=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(c="size",u.kind(c),u.parent(l||o),u.chart(o),u.scaleType("linear"),u.resetOnNewData(!0),n.addClass(u.id()),o.addScale(u,l),u.register(),r.observeSharedAttributes(a,u),r.observeLegendAttributes(a,u,l)):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("x",["$log","scale","scaleUtils",function(t,e,r){var n;return n=0,{restrict:"E",require:["x","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],link:function(e,n,a,i){var o,l,u,c,s;return u=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(c="x",u.kind(c),u.parent(l||o),u.chart(o),u.scaleType("linear"),u.resetOnNewData(!0),u.isHorizontal(!0),u.register(),n.addClass(u.id()),o.addScale(u,l),r.observeSharedAttributes(a,u),a.$observe("axis",function(t){return void 0!==t?("false"!==t?"top"===t||"bottom"===t?u.axisOrient(t).showAxis(!0):u.axisOrient("bottom").showAxis(!0):u.showAxis(!1).axisOrient(void 0),u.update(!0)):void 0}),r.observeAxisAttributes(a,u,e),r.observeLegendAttributes(a,u,l),a.$observe("rotateTickLabels",function(t){return u.rotateTickLabels(t&&_.isNumber(+t)?+t:void 0),u.update(!0)})):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeX",["$log","scale","scaleUtils",function(t,e,r){var n;return n=0,{restrict:"E",require:["rangeX","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],link:function(e,n,a,i){var o,l,u,c,s;return u=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(c="rangeX",u.kind(c),u.parent(l||o),u.chart(o),u.scaleType("linear"),u.resetOnNewData(!0),u.isHorizontal(!0),u.register(),n.addClass(u.id()),o.addScale(u,l),r.observeSharedAttributes(a,u),a.$observe("axis",function(t){return void 0!==t?("false"!==t?"top"===t||"bottom"===t?u.axisOrient(t).showAxis(!0):u.axisOrient("bottom").showAxis(!0):u.showAxis(!1).axisOrient(void 0),u.update(!0)):void 0}),r.observeAxisAttributes(a,u,e),r.observeLegendAttributes(a,u,l),r.observerRangeAttributes(a,u),a.$observe("rotateTickLabels",function(t){return u.rotateTickLabels(t&&_.isNumber(+t)?+t:void 0),u.update(!0)})):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("y",["$log","scale","legend","scaleUtils",function(t,e,r,n){var a;return a=0,{restrict:"E",require:["y","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],link:function(e,r,a,i){var o,l,u,c,s;return u=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(c="y",u.kind(c),u.parent(l||o),u.chart(o),u.scaleType("linear"),u.isVertical(!0),u.resetOnNewData(!0),r.addClass(u.id()),o.addScale(u,l),u.register(),n.observeSharedAttributes(a,u),a.$observe("axis",function(t){return void 0!==t?("false"!==t?"left"===t||"right"===t?u.axisOrient(t).showAxis(!0):u.axisOrient("left").showAxis(!0):u.showAxis(!1).axisOrient(void 0),u.update(!0)):void 0}),n.observeAxisAttributes(a,u,e),n.observeLegendAttributes(a,u,l)):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").directive("rangeY",["$log","scale","legend","scaleUtils",function(t,e,r,n){var a;return a=0,{restrict:"E",require:["rangeY","^chart","?^layout"],controller:["$element",function(){return this.me=e()}],link:function(e,r,a,i){var o,l,u,c,s;return u=i[0].me,o=i[1].me,l=null!=(s=i[2])?s.me:void 0,o||l?(c="rangeY",u.kind(c),u.parent(l||o),u.chart(o),u.scaleType("linear"),u.isVertical(!0),u.resetOnNewData(!0),r.addClass(u.id()),o.addScale(u,l),u.register(),n.observeSharedAttributes(a,u),a.$observe("axis",function(t){return void 0!==t?("false"!==t?"left"===t||"right"===t?u.axisOrient(t).showAxis(!0):u.axisOrient("left").showAxis(!0):u.showAxis(!1).axisOrient(void 0),u.update(!0)):void 0}),n.observeAxisAttributes(a,u,e),n.observeLegendAttributes(a,u,l),n.observerRangeAttributes(a,u)):void t.error("scale needs to be contained in a chart or layout directive ")}}}]),angular.module("wk.chart").factory("behaviorBrush",["$log","$window","selectionSharing","timing",function(t,e,r,n){var a;return a=function(){var t,a,i,o,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V,M,N,B,L,T,z,K,E,F,R,q,X,U,Y;return d=function(){},x=!1,F=void 0,E=void 0,q=void 0,K=void 0,b=void 0,L=void 0,z=void 0,C=void 0,A=void 0,S=void 0,T=void 0,R=void 0,V=void 0,U=void 0,Y=void 0,X=void 0,N=!1,M=!1,B=!1,O=void 0,$=void 0,D=[],P=d3.dispatch("brushStart","brush","brushEnd"),s=k=y=t=w=v=m=p=void 0,h=function(t,e,r,n){var a,i;return i=e-t,a=n-r,N&&(F.selectAll(".wk-chart-n").attr("transform","translate("+t+","+r+")").select("rect").attr("width",i),F.selectAll(".wk-chart-s").attr("transform","translate("+t+","+n+")").select("rect").attr("width",i),F.selectAll(".wk-chart-w").attr("transform","translate("+t+","+r+")").select("rect").attr("height",a),F.selectAll(".wk-chart-e").attr("transform","translate("+e+","+r+")").select("rect").attr("height",a),F.selectAll(".wk-chart-ne").attr("transform","translate("+e+","+r+")"),F.selectAll(".wk-chart-nw").attr("transform","translate("+t+","+r+")"),F.selectAll(".wk-chart-se").attr("transform","translate("+e+","+n+")"),F.selectAll(".wk-chart-sw").attr("transform","translate("+t+","+n+")"),E.attr("width",i).attr("height",a).attr("x",t).attr("y",r)),M&&(F.selectAll(".wk-chart-w").attr("transform","translate("+t+",0)").select("rect").attr("height",a),F.selectAll(".wk-chart-e").attr("transform","translate("+e+",0)").select("rect").attr("height",a),F.selectAll(".wk-chart-e").select("rect").attr("height",A.height),F.selectAll(".wk-chart-w").select("rect").attr("height",A.height),E.attr("width",i).attr("height",A.height).attr("x",t).attr("y",0)),B?(F.selectAll(".wk-chart-n").attr("transform","translate(0,"+r+")").select("rect").attr("width",i),F.selectAll(".wk-chart-s").attr("transform","translate(0,"+n+")").select("rect").attr("width",i),F.selectAll(".wk-chart-n").select("rect").attr("width",A.width),F.selectAll(".wk-chart-s").select("rect").attr("width",A.width),E.attr("width",A.width).attr("height",a).attr("x",0).attr("y",r)):void 0},c=function(){return d3.select(b).selectAll(".wk-chart-resize").style("display","none"),E.attr("width",0).attr("height",0).attr("x",0).attr("y",0).style("display","none")},u=function(){var t,e;return e=E.node().getBoundingClientRect(),R.each(function(){var t,r,n;return t=this.getBoundingClientRect(),r=e.left<t.right-t.width/3&&t.left+t.width/3<e.right,n=e.top<t.bottom-t.height/3&&t.top+t.height/3<e.bottom,d3.select(this).classed("wk-chart-selected",n&&r)}),t=T.selectAll(".wk-chart-selected").data(),T.classed("wk-chart-has-selected-items",t.length>0),t},g=function(t,e,n,a){var i,o,l,c,s,h;return M&&(c=d.x().invert(t),s=d.x().invert(e),(O[0]!==c||O[1]!==s)&&(O=[c,s],d.x().isOrdinal()?$=z.map(function(t){return d.x().value(t)}).slice(c,s+1):"rangeX"===d.x().kind()?d.x().upperProperty()?$=[d.x().lowerValue(z[c]),d.x().upperValue(z[s])]:(o=d.x().lowerValue(z[1])-d.x().lowerValue(z[0]),$=[d.x().lowerValue(z[c]),d.x().lowerValue(z[s])+o]):$=[d.x().value(z[O[0]]),d.x().value(z[s])],D=z.slice(c,s+1),P.brush(O,$,D),r.setSelection($,O,V))),B&&(l=d.y().invert(a),h=d.y().invert(n),(O[0]!==l||O[1]!==h)&&(O=[l,h],d.y().isOrdinal()?$=z.map(function(t){return d.y().value(t)}).slice(l,h+1):"rangeY"===d.y().kind()?(o=d.y().lowerValue(z[1])-d.y().lowerValue(z[0]),$=[d.y().lowerValue(z[l]),d.y().lowerValue(z[h])+o]):$=[d.y().value(z[l]),d.y().value(z[h])],D=z.slice(l,h+1),P.brush(O,$,D),r.setSelection($,O,V))),N&&(i=u(),_.xor(D,i).length>0)?(O=[],$=[],D=i,P.brush(O,$,D),r.setSelection($,O,V)):void 0},l=function(){return O=[],$=[],D=[],R.classed("wk-chart-selected",!1),T.classed("wk-chart-has-selected-items",!1),r.setSelection($,O,V),_.delay(function(){return P.brush(O,$,D),P.brushEnd(O,$,D)},20)},o=function(){return d3.event.preventDefault(),K=d3.select(d3.event.target).datum(),_(K?void 0:K={name:"forwarded"}),A=b.getBBox(),q=d3.mouse(b),w=k,v=s,m=y,p=t,d3.select(b).style("pointer-events","none").selectAll(".wk-chart-resize").style("display",null),E.style("display",null),d3.select("body").style("cursor",d3.select(d3.event.target).style("cursor")),d3.select(e).on("mousemove.brush",i).on("mouseup.brush",a),X.hide(!0),O=[void 0,void 0],D=[void 0],R=T.selectAll(".wk-chart-selectable"),P.brushStart(),n.clear(),n.init()},a=function(){return d3.select(e).on("mousemove.brush",null),d3.select(e).on("mouseup.brush",null),d3.select(b).style("pointer-events","all").selectAll(".wk-chart-resize").style("display",null),d3.select("body").style("cursor",null),X.hide(!1),P.brushEnd(O,$,D)},i=function(){var e,r,n,a,i,o,l,u,c;switch(o=d3.mouse(b),r=o[0]-q[0],n=o[1]-q[1],i=function(t){return o=v+t,s=o>=0?m>o?o:m:0,y=o<=A.width?m>o?m:o:A.width},l=function(t){return o=m+t,s=o>=0?v>o?o:v:0,y=o<=A.width?v>o?v:o:A.width},u=function(e){return o=w+e,k=o>=0?p>o?o:p:0,t=o<=A.height?o>p?o:p:A.height},e=function(e){return o=p+e,k=o>=0?w>o?o:w:0,t=o<=A.height?o>w?o:w:A.height},a=function(t){return v+t>=0?m+t<=A.width?(s=v+t,y=m+t):(y=A.width,s=A.width-(m-v)):(s=0,y=m-v)},c=function(e){return w+e>=0?p+e<=A.height?(k=w+e,t=p+e):(t=A.height,k=A.height-(p-w)):(k=0,t=p-w)},K.name){case"background":case"forwarded":r+q[0]>0?(s=0>r?q[0]+r:q[0],y=s+Math.abs(r)<A.width?s+Math.abs(r):A.width):s=0,n+q[1]>0?(k=0>n?q[1]+n:q[1],t=k+Math.abs(n)<A.height?k+Math.abs(n):A.height):k=0;break;case"extent":c(n),a(r);break;case"n":u(n);break;case"s":e(n);break;case"w":i(r);break;case"e":l(r);break;case"nw":u(n),i(r);break;case"ne":u(n),l(r);break;case"sw":e(n),i(r);break;case"se":e(n),l(r)}return h(s,y,k,t),g(s,y,k,t)},d.brush=function(t){if(0===arguments.length)return F;if(x)return F=t,N=d.x()&&d.y(),M=d.x()&&!d.y(),B=d.y()&&!d.x(),t.style({"pointer-events":"all",cursor:"crosshair"}),E=t.append("rect").attr({"class":"wk-chart-extent",x:0,y:0,width:0,height:0}).style("cursor","move").datum({name:"extent"}),(B||N)&&(t.append("g").attr("class","wk-chart-resize wk-chart-n").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"n"}),t.append("g").attr("class","wk-chart-resize wk-chart-s").style({cursor:"ns-resize",display:"none"}).append("rect").attr({x:0,y:-3,width:0,height:6}).datum({name:"s"})),(M||N)&&(t.append("g").attr("class","wk-chart-resize wk-chart-w").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"w"}),t.append("g").attr("class","wk-chart-resize wk-chart-e").style({cursor:"ew-resize",display:"none"}).append("rect").attr({y:0,x:-3,width:6,height:0}).datum({name:"e"})),N&&(t.append("g").attr("class","wk-chart-resize wk-chart-nw").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"nw"}),t.append("g").attr("class","wk-chart-resize wk-chart-ne").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"ne"}),t.append("g").attr("class","wk-chart-resize wk-chart-sw").style({cursor:"nesw-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"sw"}),t.append("g").attr("class","wk-chart-resize wk-chart-se").style({cursor:"nwse-resize",display:"none"}).append("rect").attr({x:-3,y:-3,width:6,height:6}).datum({name:"se"})),t.on("mousedown.brush",o),d},f=function(){var e,r,n;return A?(r=b.getBBox(),e=A.width/r.width,n=A.height/r.height,k/=n,w/=n,t/=n,p/=n,s/=e,v/=e,y/=e,m/=e,q[0]=q[0]/e,q[1]=q[1]/n,A=r,h(s,y,k,t)):void 0},d.chart=function(t){return 0===arguments.length?L:(L=t,L.lifeCycle().on("resize.brush",f),d)},d.active=function(t){return 0===arguments.length?x:(x=t,d)},d.x=function(t){return 0===arguments.length?U:(U=t,d)},d.y=function(t){return 0===arguments.length?Y:(Y=t,d)},d.area=function(t){return 0===arguments.length?C:(C||(C=t,b=C.node(),d.brush(C)),d)},d.container=function(t){return 0===arguments.length?T:(T=t,R=T.selectAll(".wk-chart-selectable"),d)},d.data=function(t){return 0===arguments.length?z:(z=t,d)},d.brushGroup=function(t){return 0===arguments.length?V:(V=t,r.createGroup(V),d)},d.tooltip=function(t){return 0===arguments.length?X:(X=t,d)},d.on=function(t,e){return P.on(t,e)},d.extent=function(){return O},d.events=function(){return P},d.empty=function(){return 0===D.length},d.clearBrush=function(){return console.log("Brush cleared"),c(),l()},d}}]),angular.module("wk.chart").factory("behaviorSelect",["$log",function(t){var e,r;return r=0,e=function(){var e,n,a,i,o,l;return o="select"+r++,i=void 0,a=!1,l=d3.dispatch("selected"),e=function(){var t,e,r;if(a&&(r=d3.select(this),a))return r.classed("wk-chart-selectable")?(e=r.classed("wk-chart-selected"),r.classed("wk-chart-selected",!e),t=i.selectAll(".wk-chart-selected").data().map(function(t){return t.data?t.data:t}),i.classed("wk-chart-has-selected-items",t.length>0),l.selected(t)):void 0},n=function(t){return 0===arguments.length?n:(t.on("click",e),n)},n.id=function(){return o},n.active=function(t){return 0===arguments.length?a:(a=t,n)},n.clearSelection=function(){return t.log("selection Cleared"),i.selectAll(".wk-chart-selected").classed("wk-chart-selected",!1),i.classed("wk-chart-has-selected-items",!1),_.delay(function(){return l.selected([])},20)},n.container=function(t){return 0===arguments.length?i:(i=t,n)},n.events=function(){return l},n.on=function(t,e){return l.on(t,e),n},n}}]),angular.module("wk.chart").factory("behaviorTooltip",["$log","$document","$rootScope","$compile","$templateCache","wkChartTemplates",function(t,e,r,n,a,i){var o;return o=function(){var t,r,o,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V,M;return g=!1,D="",b=!1,$=void 0,A=void 0,C=void 0,v=void 0,m=void 0,p=void 0,k=void 0,O=void 0,S=void 0,x=void 0,M=d3.dispatch("enter","moveData","moveMarker","leave"),P=i.tooltipTemplate(),V=void 0,w=void 0,t=e.find("body"),r=t[0].getBoundingClientRect(),c=function(){},s=function(){var t,e,n;return n=w[0].getBoundingClientRect(),t=r.right-20>d3.event.clientX+n.width+10?d3.event.clientX+10:d3.event.clientX-n.width-10,e=r.bottom-20>d3.event.clientY+n.height+10?d3.event.clientY+10:d3.event.clientY-n.height-10,V.position={position:"absolute",left:t+"px",top:e+"px","z-index":1500,opacity:1},V.$apply()},d=function(){return V.position={position:"absolute",left:"0px",top:"0px","z-index":1500,opacity:0},V.$apply(),_.throttle(s,200)},h=function(){var e,r,n;if(g&&!b)return t.append(w),V.layers=[],$?(n=d3.mouse(this),e=S.invert(S.isHorizontal()?n[0]:n[1]),V.ttData=c.data()[e]):(e=d3.select(this).datum(),V.ttData=e.data?e.data:e),M.enter.apply(V,[e]),d(),$?(r=v.select(".wk-chart-background").node().getBBox(),n=d3.mouse(p),A=v.append("g").attr("class","wk-chart-tooltip-marker"),C=A.append("line"),C.attr(S.isHorizontal()?{"class":"wk-chart-marker-line",x0:0,x1:0,y0:0,y1:r.height}:{"class":"wk-chart-marker-line",x0:0,x1:r.width,y0:0,y1:0}),C.style({stroke:"darkgrey","pointer-events":"none"}),M.moveMarker.apply(A,[e])):void 0},y=function(){var t,e;if(g&&!b)return e=d3.mouse(p),s(),$&&(t=S.invert(S.isHorizontal()?e[0]:e[1]),M.moveMarker.apply(A,[t]),V.layers=[],V.ttData=c.data()[t],M.moveData.apply(V,[t])),V.$apply()},f=function(){return A&&A.remove(),A=void 0,w.remove()},u=function(){var t,e;return t=d3.select(k.node().parentElement).select(".wk-chart-overlay").node(),d3.event.target!==t?(e=new Event("mousedown"),e.pageX=d3.event.pageX,e.clientX=d3.event.clientX,e.pageY=d3.event.pageY,e.clientY=d3.event.clientY,t.dispatchEvent(e)):void 0},c.hide=function(t){return 0===arguments.length?b:(b=t,A&&A.style("visibility",b?"hidden":"visible"),V.ttShow=!b,V.$apply(),c)},c.chart=function(t){return 0===arguments.length?m:(m=t,c)},c.active=function(t){return 0===arguments.length?g:(g=t,c)},c.template=function(t){var e;return 0===arguments.length?D:(D=t,D.length>0&&(e=a.get(D),P='<div class="wk-chart-tooltip" ng-style="position">'+e+"</div>"),c)},c.area=function(t){return 0===arguments.length?v:(v=t,p=v.node(),$&&c.tooltip(v),c)},c.container=function(t){return 0===arguments.length?k:(k=t,c)},c.markerScale=function(t){return 0===arguments.length?S:(t?($=!0,S=t):$=!1,c)},c.data=function(t){return 0===arguments.length?x:(x=t,c)},c.on=function(t,e){return M.on(t,e)},l=function(t){return function(){return V.ttData?t(V.ttData):void 0}},o=function(){var t,e,r;if(!V){V=m.scope().$parent.$new(!0),V.properties={},V.map={},V.scale={},V.label={},V.value={},r=m.allScales().allKinds();for(t in r)e=r[t],V.map[t]=l(e.map),V.scale[t]=e.scale(),V.properties[t]=l(e.layerKeys),V.label[t]=e.axisLabel(),V.value[t]=l(e.value)}return w?void 0:w=n(P)(V)},c.tooltip=function(t){return 0===arguments.length?c:(o(P),c.chart().lifeCycle().on("destroy.tooltip",f),t.on("mouseenter.tooltip",h).on("mousemove.tooltip",y).on("mouseleave.tooltip",f),t.empty()||t.classed("wk-chart-overlay")?void 0:t.on("mousedown.tooltip",u))},c}}]),angular.module("wk.chart").factory("behavior",["$log","$window","behaviorTooltip","behaviorBrush","behaviorSelect",function(t,e,r,n,a){var i;return i=function(){var t,e,i,o,l,u;return u=r(),o=n(),l=a(),o.tooltip(u),t=function(t){return o.area(t),u.area(t)},i=function(t){return o.container(t),l.container(t),u.container(t)},e=function(t){return o.chart(t),u.chart(t)},{tooltip:u,brush:o,selected:l,overlay:t,container:i,chart:e}}}]),angular.module("wk.chart").factory("chart",["$log","scaleList","container","behavior","d3Animation",function(t,e,r,n,a){var i,o;
return o=0,i=function(){var i,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A;return g="chart"+o++,u=function(){},p=[],f=void 0,c=void 0,m=void 0,y=void 0,k=!1,w=void 0,A="",b=void 0,x=void 0,d=n(),s=a.duration,v=d3.dispatch("configure","resize","prepareData","scaleDomains","rescaleDomains","sizeContainer","drawAxis","drawChart","newData","update","updateAttrs","scopeApply","destroy"),h=d3.dispatch("draw","change"),u.id=function(){return g},u.scope=function(t){return 0===arguments.length?w:(w=t,u)},u.showTooltip=function(t){return 0===arguments.length?k:(k=t,d.tooltip.active(k),u)},u.toolTipTemplate=function(t){return 0===arguments.length?A:(A=t,d.tooltip.template(t),u)},u.title=function(t){return 0===arguments.length?b:(b=t,u)},u.subTitle=function(t){return 0===arguments.length?x:(x=t,u)},u.addLayout=function(t){return 0===arguments.length?p:(p.push(t),u)},u.addScale=function(t,e){return c.add(t),e?e.scales().add(t):m.add(t),u},u.animationDuration=function(t){return 0===arguments.length?s:(s=t,u)},u.lifeCycle=function(){return v},u.layouts=function(){return p},u.scales=function(){return m},u.allScales=function(){return c},u.hasScale=function(t){return!!c.has(t)},u.container=function(){return f},u.brush=function(){return h},u.getData=function(){return y},u.behavior=function(){return d},l=function(e,r){return e?(t.log("executing full life cycle"),y=e,w.filteredData=e,w.scales=c,v.prepareData(e,r),v.scaleDomains(e,r),v.sizeContainer(e,r),v.drawAxis(r),v.drawChart(e,r),v.scopeApply()):void 0},i=_.debounce(l,100),u.execLifeCycleFull=i,u.resizeLifeCycle=function(e){return y?(t.log("executing resize life cycle"),v.sizeContainer(y,e),v.drawAxis(e),v.drawChart(y,e),v.scopeApply()):void 0},u.newDataLifeCycle=function(e,r){return e?(t.log("executing new data life cycle"),y=e,w.filteredData=e,v.prepareData(e,r),v.scaleDomains(e,r),v.drawAxis(r),v.drawChart(e,r)):void 0},u.attributeChange=function(e){return y?(t.log("executing attribute change life cycle"),v.sizeContainer(y,e),v.drawAxis(e),v.drawChart(y,e)):void 0},u.brushExtentChanged=function(){return y?(v.drawAxis(!0),v.drawChart(y,!0)):void 0},u.lifeCycle().on("newData.chart",u.execLifeCycleFull),u.lifeCycle().on("resize.chart",u.resizeLifeCycle),u.lifeCycle().on("update.chart",function(t){return u.execLifeCycleFull(y,t)}),u.lifeCycle().on("updateAttrs",u.attributeChange),u.lifeCycle().on("rescaleDomains",v.scaleDomains(y,!0)),d.chart(u),f=r().chart(u),c=e(),m=e(),u}}]),angular.module("wk.chart").factory("container",["$log","$window","wkChartMargins","scaleList","axisConfig","d3Animation","behavior",function(t,e,r){var n,a;return a=0,n=function(){var e,n,i,o,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V,M;return u=function(){},y="cntnr"+a++,d=void 0,v=void 0,m=void 0,A=[],C=[],V=void 0,f=void 0,P=void 0,h=void 0,k=void 0,S=angular.copy(r["default"]),b=0,x=0,M=0,g=void 0,D=void 0,s=void 0,p=0,u.id=function(){return y},u.chart=function(t){return 0===arguments.length?d:(d=t,d.lifeCycle().on("sizeContainer."+u.id(),u.drawChartFrame),u)},u.element=function(e){var r,n;return 0===arguments.length?v:(n=function(){return u.chart().lifeCycle().resize(!0)},v=e,m=d3.select(v),m.empty()?t.error("Error: Element "+v+" does not exist"):(w(),r=m.select(".wk-chart").node(),new ResizeSensor(r,n)),u)},u.addLayout=function(t){return A.push(t),u},u.height=function(){return x},u.width=function(){return b},u.margins=function(){return S},u.getChartArea=function(){return h},u.getOverlay=function(){return D},u.getContainer=function(){return P},e=function(t,e,r,n,a){var i;return i=t.select("."+r),i.empty()&&(i=t.append("text").attr({"class":r,"text-anchor":"middle",y:a?a:0}).style("font-size",n)),i.text(e),i.node().getBBox().height},o=function(t,r){var n,a;return a=0,n=f.select(".wk-chart-title-area"),n.empty()&&(n=f.append("g").attr("class","wk-chart-title-area wk-center-hor")),t&&(M=e(n,t,"wk-chart-title","2em")),r&&e(n,r,"wk-chart-subtitle","1.8em",M),n.node().getBBox().height},c=function(t,e,r){var n,a,i,o,l;for(a=e.append("g"),o=0,l=t.length;l>o;o++)i=t[o],a.append("text").attr({"class":r}).text(i);return n=a.node().getBBox(),a.remove(),n},l=function(t){var e,r;return e=f.append("g"),t.range([0,500]),e.call(t.axis()),t.rotateTickLabels()&&e.selectAll("text").attr({dy:"0.35em"}).attr("transform","rotate("+t.rotateTickLabels()+", 0, "+("bottom"===t.axisOrient()?10:-10)+")").style("text-anchor","bottom"===t.axisOrient()?"end":"start"),r=e.node().getBBox(),e.remove(),r},n=function(t){var e;return e=f.select(".wk-chart-axis.wk-chart-"+t.axisOrient()),e.empty()&&(e=f.append("g").attr("class","wk-chart-axis wk-chart-"+t.axisOrient())),e.transition().duration(p).call(t.axis()),t.rotateTickLabels()?e.selectAll(".wk-chart-"+t.axisOrient()+".wk-chart-axis text").attr({dy:"0.35em"}).attr("transform","rotate("+t.rotateTickLabels()+", 0, "+("bottom"===t.axisOrient()?10:-10)+")").style("text-anchor","bottom"===t.axisOrient()?"end":"start"):e.selectAll(".wk-chart-"+t.axisOrient()+".wk-chart-axis text").attr("transform",null)},O=function(t){return f.select(".wk-chart-axis.wk-chart-"+t).remove()},$=function(t){return f.select(".wk-chart-label.wk-chart-"+t).remove()},i=function(t,e){var r,n,a,i,o;return r=e?0:p,a=t.kind(),o=t.isOrdinal()?t.scale().range():t.scale().ticks(),i=t.isOrdinal()?t.scale().rangeBand()/2:0,n=k.selectAll(".wk-chart-grid.wk-chart-"+a).data(o,function(t){return t}),n.enter().append("line").attr("class","wk-chart-grid wk-chart-"+a).style("pointer-events","none").style("opacity",0),"y"===a?n.transition().duration(r).attr({x1:0,x2:b,y1:function(e){return t.isOrdinal()?e+i:t.scale()(e)},y2:function(e){return t.isOrdinal()?e+i:t.scale()(e)}}).style("opacity",1):n.transition().duration(r).attr({y1:0,y2:x,x1:function(e){return t.isOrdinal()?e+i:t.scale()(e)},x2:function(e){return t.isOrdinal()?e+i:t.scale()(e)}}).style("opacity",1),n.exit().transition().duration(r).style("opacity",0).remove()},w=function(){return V=m.append("div").attr("class","wk-chart").append("svg").attr("class","wk-chart"),V.append("defs").append("clipPath").attr("id","wk-chart-clip-"+y).append("rect"),f=V.append("g").attr("class","wk-chart-container"),D=f.append("g").attr("class","wk-chart-overlay").style("pointer-events","all"),D.append("rect").style("visibility","hidden").attr("class","wk-chart-background").datum({name:"background"}),k=f.append("g").attr("class","wk-chart-grid-lines"),h=f.append("g").attr("class","wk-chart-area")},u.drawChartFrame=function(t,a){var s,g,v,w,k,C,N,B,L,T,z,K,_,E,F,R,q,X,U,Y,I,H,j,G,J,W,Q;for(v=m.node().getBoundingClientRect(),p=a?0:u.chart().animationDuration(),q=v.height,Q=v.width,_=o(d.title(),d.subTitle()),g={top:{height:0,width:0},bottom:{height:0,width:0},left:{height:0,width:0},right:{height:0,width:0}},T={top:0,bottom:0,left:0,right:0},k={width:0,height:0},X=0,I=A.length;I>X;X++){B=A[X],w=C=0,G=B.scales().allKinds();for(N in G)K=G[N],K.showAxis()&&(K.axis().scale(K.scale()).orient(K.axisOrient()),s=f.select(".wk-chart-axis.wk-chart-"+K.axisOrient()),g[K.axisOrient()]=l(K),L=f.select(".wk-chart-label.wk-chart-"+K.axisOrient()),K.showLabel()?(L.empty()&&(L=f.append("g").attr("class","wk-chart-label wk-chart-"+K.axisOrient())),T[K.axisOrient()]=e(L,K.axisLabel(),"wk-chart-label-text","1.5em")):L.remove()),K.axisOrientOld()&&K.axisOrientOld()!==K.axisOrient()&&(O(K.axisOrientOld()),$(K.axisOrientOld())),B.showDataLabels()===N&&(K.isHorizontal()?C=r.dataLabelPadding.hor+c(K.formattedValue(t),f,"wk-chart-data-label").width:w=r.dataLabelPadding.vert+c(K.formattedValue(t),f,"wk-chart-data-label").height)}for(F=_+g.top.height+T.top+g.bottom.height+T.bottom+S.top+S.bottom,R=g.right.width+T.right+g.left.width+T.left+S.left+S.right,x=q>F?q-F:0,b=Q>R?Q-R:0,U=0,H=A.length;H>U;U++){B=A[U],J=B.scales().allKinds();for(N in J)K=J[N],"x"===N||"rangeX"===N?K.range("x"===B.showDataLabels()?[0,b-C]:[0,b]):("y"===N||"rangeY"===N)&&K.range("y"===B.showDataLabels()?[x,w]:[x,0]),K.showAxis()&&n(K)}for(z=g.left.width+T.left+S.left,E=_+g.top.height+T.top+S.top,P=f.attr("transform","translate("+z+", "+E+")"),V.select("#wk-chart-clip-"+y+" rect").attr("width",b).attr("height",x),P.select(".wk-chart-overlay>.wk-chart-background").attr("width",b).attr("height",x),P.select(".wk-chart-area").style("clip-path","url(#wk-chart-clip-"+y+")"),f.selectAll(".wk-chart-axis.wk-chart-right").attr("transform","translate("+b+", 0)"),f.selectAll(".wk-chart-axis.wk-chart-bottom").attr("transform","translate(0, "+x+")"),f.select(".wk-chart-label.wk-chart-left").attr("transform","translate("+(-g.left.width-T.left/2)+", "+x/2+") rotate(-90)"),f.select(".wk-chart-label.wk-chart-right").attr("transform","translate("+(b+g.right.width+T.right/2)+", "+x/2+") rotate(90)"),f.select(".wk-chart-label.wk-chart-top").attr("transform","translate("+b/2+", "+(-g.top.height-T.top/2)+")"),f.select(".wk-chart-label.wk-chart-bottom").attr("transform","translate("+b/2+", "+(x+g.bottom.height+T.bottom)+")"),f.selectAll(".wk-chart-title-area").attr("transform","translate("+b/2+", "+(-E+M)+")"),Y=0,j=A.length;j>Y;Y++){B=A[Y],W=B.scales().allKinds();for(N in W)K=W[N],K.showAxis()&&K.showGrid()&&i(K)}return d.behavior().overlay(D),d.behavior().container(h)},u.drawSingleAxis=function(t){var e;return t.showAxis()&&(e=P.select(".wk-chart-axis.wk-chart-"+t.axis().orient()),e.call(t.axis()),t.showGrid()&&i(t,!0)),u},u}}]),angular.module("wk.chart").factory("layout",["$log","scale","scaleList","timing",function(t,e,r){var n,a;return a=0,n=function(){var t,e,n,i,o,l,u,c,s,d;return u="layout"+a++,o=void 0,l=void 0,i=void 0,s=r(),d=!1,c=d3.dispatch("configure","drawChart","prepareData","brush","redraw","drawAxis","update","updateAttrs","brushDraw"),n=function(){},n.id=function(){return u},n.chart=function(t){return 0===arguments.length?i:(i=t,s.parentScales(t.scales()),i.lifeCycle().on("configure."+n.id(),function(){return c.configure.apply(n.scales())}),i.lifeCycle().on("drawChart."+n.id(),n.draw),i.lifeCycle().on("prepareData."+n.id(),n.prepareData),n)},n.scales=function(){return s},n.scaleProperties=function(){return n.scales().getScaleProperties()},n.container=function(t){return 0===arguments.length?o:(o=t,n)},n.showDataLabels=function(t){return 0===arguments.length?d:(d=t,n)},n.behavior=function(){return n.chart().behavior()},n.prepareData=function(t){var e,r,n,a,i;for(e=[],i=["x","y","color","size","shape","rangeX","rangeY"],n=0,a=i.length;a>n;n++)r=i[n],e.push(s.getKind(r));return c.prepareData.apply(t,e)},n.lifeCycle=function(){return c},e=function(){var t,e;return t=o.getChartArea(),e=t.select("."+n.id()),e.empty()&&(e=t.append("g").attr("class",function(){return n.id()})),e},t=function(t,e){var r,a,i,l,u,c;for(i={height:o.height(),width:o.width(),margins:o.margins(),duration:e?0:n.chart().animationDuration()},r=[t,i],c=["x","y","color","size","shape","rangeX","rangeY"],l=0,u=c.length;u>l;l++)a=c[l],r.push(s.getKind(a));return r},n.draw=function(r,a){return l=r,c.drawChart.apply(e(),t(r,a)),c.on("redraw",n.redraw),c.on("update",n.chart().lifeCycle().update),c.on("drawAxis",n.chart().lifeCycle().drawAxis),c.on("updateAttrs",n.chart().lifeCycle().updateAttrs),c.on("brush",function(t,r,n){return o.drawSingleAxis(t),c.brushDraw.apply(e(),[t,n,o.width(),o.height()])})},n}}]),angular.module("wk.chart").factory("legend",["$log","$compile","$rootScope","$templateCache","wkChartTemplates",function(t,e,r,n,a){var i,o,l;return o=0,l=function(t){var e,r,n,a;for(r={},n=0,a=t.length;a>n;n++)e=t[n],r[e]=0;return Object.keys(r)},i=function(){var t,i,u,c,s,d,h,f,y,g,p,v,m,w,k,x;return c="legend-"+o++,g="top-right",p=void 0,k=void 0,h=r.$new(!0),w=void 0,y=void 0,i=void 0,d=void 0,x=void 0,s=void 0,u=void 0,f=void 0,v=!1,m=!1,t={},t.position=function(e){return 0===arguments.length?g:(g=e,t)},t.show=function(e){return 0===arguments.length?v:(v=e,t)},t.showValues=function(e){return 0===arguments.length?m:(m=e,t)},t.div=function(e){return 0===arguments.length?d:(d=e,t)},t.layout=function(e){return 0===arguments.length?s:(s=e,t)},t.scale=function(e){return 0===arguments.length?p:(p=e,t)},t.title=function(e){return 0===arguments.length?x:(x=e,t)},t.template=function(r){return 0===arguments.length?k:(k=r,w=n.get(k),y=e(w)(h),t)},t.draw=function(e,r){var n,a,o,c,s,v,m,w,k;if(u=e,f=r,i=d||d3.select(t.scale().parent().container().element()).select(".wk-chart"),t.show()){if(i.select(".wk-chart-legend").empty()&&angular.element(i.node()).append(y),o=t.showValues()?l(p.value(e)):p.layerKeys(e),s=p.scale(),(null!=(w=t.layout())?w.scales().layerScale():void 0)&&(s=t.layout().scales().layerScale().scale()),h.legendRows=o.map("shape"!==p.kind()?function(t){return{value:t,color:{"background-color":s(t)}}}:function(t){return{value:t,path:d3.svg.symbol().type(s(t)).size(80)()}}),h.showLegend=!0,h.position={position:d?"relative":"absolute"},!d)for(a=i.node().getBoundingClientRect(),n=i.select(".wk-chart-overlay rect").node().getBoundingClientRect(),k=g.split("-"),v=0,m=k.length;m>v;v++)c=k[v],h.position[c]=""+Math.abs(a[c]-n[c])+"px";h.title=x}else y.remove();return t},y=e(a.legendTemplate())(h),t.register=function(e){return e.lifeCycle().on("drawChart."+c,t.draw),t},t.redraw=function(){return u&&f&&t.draw(u,f),t},t}}]);var __indexOf=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};angular.module("wk.chart").factory("scale",["$log","legend","formatDefaults","wkChartScales","wkChartLocale",function(t,e,r,n,a){var i;return i=function(){var i,o,l,u,c,s,d,h,f,y,g,p,v,m,w,k,x,b,A,C,S,D,O,$,P,V,M,N,B,L,T,z,K,E,F,R,q,X,U,Y,I,H,j,G,J,W;return x="",X=d3.scale.linear(),U="linear",k=1,S=!1,m=void 0,w=void 0,p=void 0,R=!1,z="",P="",$=[],N="",W="",K=void 0,F=.3,E=.3,A=void 0,b=function(t){return isNaN(+t)||_.isDate(t)?t:+t},Y=!1,y=void 0,g=void 0,h=void 0,J=void 0,j=void 0,G=void 0,q=void 0,H=!1,f=void 0,I=!1,C=!1,D=!1,O=void 0,T=void 0,v=void 0,V=void 0,M=e(),L=void 0,B=void 0,j=a.timeFormat.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!==t.getDate()}],["%b %d",function(t){return 1!==t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]]),s=function(){},o=function(t){return _.isArray(t)?_.reject(_.keys(t[0]),function(t){return"$$hashKey"===t}):_.reject(_.keys(t),function(t){return"$$hashKey"===t})},c=function(t,e){return e.reduce(function(e,r){return+e+ +s.layerValue(t,r)},0)},l=function(t,e){return d3.max(t,function(t){return d3.max(e,function(e){return s.layerValue(t,e)})})},u=function(t,e){return d3.min(t,function(t){return d3.min(e,function(e){return s.layerValue(t,e)})})},d=function(t){return b.parse?b.parse(t):b(t)},i={extent:function(t){var e;return e=s.layerKeys(t),[u(t,e),l(t,e)]},max:function(t){var e;return e=s.layerKeys(t),[0,l(t,e)]},min:function(t){var e;return e=s.layerKeys(t),[0,u(t,e)]},totalExtent:function(t){var e;return t[0].hasOwnProperty("total")?d3.extent(t.map(function(t){return t.total})):(e=s.layerKeys(t),d3.extent(t.map(function(t){return c(t,e)})))},total:function(t){var e;return t[0].hasOwnProperty("total")?[0,d3.max(t.map(function(t){return t.total}))]:(e=s.layerKeys(t),[0,d3.max(t.map(function(t){return c(t,e)}))])},rangeExtent:function(t){var e,r;return s.upperProperty()?[d3.min(s.lowerValue(t)),d3.max(s.upperValue(t))]:t.length>1?(e=s.lowerValue(t[0]),r=s.lowerValue(t[1])-e,[s.lowerValue(t[0]),e+r*t.length]):void 0},rangeMin:function(t){return[0,d3.min(s.lowerValue(t))]},rangeMax:function(t){var e,r;return s.upperProperty()?[0,d3.max(s.upperValue(t))]:(e=s.lowerValue(t[0]),r=s.lowerValue(t[1])-e,[0,e+r*t.length])}},s.id=function(){return O+"."+T.id()},s.kind=function(t){return 0===arguments.length?O:(O=t,s)},s.parent=function(t){return 0===arguments.length?T:(T=t,s)},s.chart=function(t){return 0===arguments.length?v:(v=t,s)},s.layout=function(t){return 0===arguments.length?V:(V=t,s)},s.scale=function(){return X},s.legend=function(){return M},s.isOrdinal=function(){return S},s.isHorizontal=function(t){return 0===arguments.length?C:(C=t,t&&(D=!1),s)},s.isVertical=function(t){return 0===arguments.length?D:(D=t,t&&(C=!1),s)},s.scaleType=function(e){return 0===arguments.length?U:(d3.scale.hasOwnProperty(e)?(X=d3.scale[e](),U=e,s.format(r.number)):"time"===e?(X=d3.time.scale(),U="time",A&&s.dataFormat(A),s.format(r.date)):n.hasOwnProperty(e)?(U=e,X=n[e]()):t.error("Error: illegal scale type:",e),S=_.has(X,"rangeBand"),K&&s.range(K),Y&&h.scale(X),k&&"pow"===U&&X.exponent(k),s)},s.exponent=function(t){return 0===arguments.length?k:(k=t,"pow"===U&&X.exponent(k),s)},s.scaleMapFn=function(t){return 0===arguments.length?X.mapFn?X.mapFn():void 0:(_.isFunction(t)&&X.mapFn&&X.mapFn(t),s)},s.domain=function(t){return 0===arguments.length?m:(m=t,_.isArray(m)&&X.domain(m),s)},s.domainCalc=function(e){return 0===arguments.length?S?void 0:w:(i.hasOwnProperty(e)?w=e:t.error("illegal domain calculation rule:",e," expected",_.keys(i)),s)},s.getDomain=function(t){return 0===arguments.length?X.domain():!m&&s.domainCalc()?p:m?m:s.value(t)},s.resetOnNewData=function(t){return 0===arguments.length?R:(R=t,s)},s.range=function(t){var e;return 0===arguments.length?X.range():(K=t,!S||"x"!==(e=s.kind())&&"y"!==e&&"rangeX"!==e&&"rangeY"!==e?"category10"!==U&&"category20"!==U&&"category20b"!==U&&"category20c"!==U&&X.range(t):X.rangeBands(t,F,E),s)},s.rangePadding=function(t){return 0===arguments.length?{padding:F,outerPadding:E}:(F=t.padding,E=t.outerPadding,s)},s.property=function(t){return 0===arguments.length?z:(z=t,s)},s.layerProperty=function(t){return 0===arguments.length?P:(P=t,s)},s.layerExclude=function(t){return 0===arguments.length?$:($=t,s)},s.layerKeys=function(t){return z?_.isArray(z)?_.intersection(z,o(t)):[z]:_.reject(o(t),function(t){return __indexOf.call($,t)>=0})},s.lowerProperty=function(t){return 0===arguments.length?N:(N=t,s)},s.upperProperty=function(t){return 0===arguments.length?W:(W=t,s)},s.dataFormat=function(t){return 0===arguments.length?A:(A=t,b="time"===U?a.timeFormat(t):function(t){return t},s)},s.value=function(t){return P?_.isArray(t)?t.map(function(t){return d(t[z][P])}):d(t[z][P]):_.isArray(t)?t.map(function(t){return d(t[z])}):d(t[z])},s.layerValue=function(t,e){return d(P?t[e][P]:t[e])},s.lowerValue=function(t){return _.isArray(t)?t.map(function(t){return d(t[N])}):d(t[N])},s.upperValue=function(t){return _.isArray(t)?t.map(function(t){return d(t[W])}):d(t[W])},s.formattedValue=function(t){return _.isArray(t)?t.map(function(t){return s.formatValue(s.value(t))}):s.formatValue(s.value(t))},s.formatValue=function(t){return L&&t&&(t.getUTCDate||!isNaN(t))?B(t):t},s.map=function(t){return Array.isArray(t)?t.map(function(){return X(s.value(t))}):X(s.value(t))},s.invert=function(t){var e,r,n,a,i,o,l,u;return _.has(s.scale(),"invert")?(u=s.chart().getData(),"rangeX"===s.kind()||"rangeY"===s.kind()?(l=s.scale().invert(t),s.upperProperty()?e=d3.bisector(s.upperValue).left:(o=s.lowerValue(u[1])-s.lowerValue(u[0]),e=d3.bisector(function(t){return s.lowerValue(t)+o}).left)):(i=X.range(),a=(i[1]-i[0])/u.length,l=s.scale().invert(t-a/2),e=d3.bisector(s.value).left),n=e(u,l),n=0>n?0:n>=u.length?u.length-1:n):_.has(s.scale(),"invertExtent")?s.scale().invertExtent(t):s.resetOnNewData()?(r=X.domain(),i=X.range(),D?(a=i[0]-i[1],n=i.length-Math.floor(t/a)-1,0>n&&(n=0)):(a=i[1]-i[0],n=Math.floor(t/a),n>=i.length&&(n=i.length-1)),n):void 0},s.invertOrdinal=function(t){var e;return s.isOrdinal()&&s.resetOnNewData()?(e=s.invert(t),X.domain()[e]):void 0},s.showAxis=function(t){return 0===arguments.length?Y:(Y=t,t?(h=d3.svg.axis(),"time"===s.scaleType()&&h.tickFormat(j)):h=void 0,s)},s.axisOrient=function(t){return 0===arguments.length?y:(g=y,y=t,s)},s.axisOrientOld=function(t){return 0===arguments.length?g:(g=t,s)},s.axis=function(){return h},s.ticks=function(t){return 0===arguments.length?J:(J=t,s.axis()&&s.axis().ticks(J),s)},s.tickFormat=function(t){return 0===arguments.length?j:(j=t,s.axis()&&s.axis().tickFormat(t),s)},s.tickValues=function(t){return 0===arguments.length?G:(G=t,s.axis()&&s.axis().tickValues(t),s)},s.showLabel=function(t){return 0===arguments.length?H:(H=t,s)},s.axisLabel=function(t){return 0===arguments.length?f?f:s.property():(f=t,s)},s.rotateTickLabels=function(t){return 0===arguments.length?q:(q=t,s)},s.format=function(t){return 0===arguments.length?L:(L=t.length>0?t:"time"===s.scaleType()?r.date:r.number,B="time"===s.scaleType()?a.timeFormat(L):a.numberFormat(L),s)},s.showGrid=function(t){return 0===arguments.length?I:(I=t,s)},s.register=function(){return s.chart().lifeCycle().on("scaleDomains."+s.id(),function(t){var e;if(s.resetOnNewData()){if(e=s.getDomain(t),"linear"===U&&_.some(e,isNaN))throw"Scale "+s.kind()+", Type '"+U+"': cannot compute domain for property '"+z+"' . Possible reasons: property not set, data not compatible with defined type. Domain:"+e;return X.domain(e)}}),s.chart().lifeCycle().on("prepareData."+s.id(),function(t){var e;return e=s.domainCalc(),s.parent().scaleProperties&&s.layerExclude(s.parent().scaleProperties()),e&&i[e]?p=i[e](t):void 0})},s.update=function(t){return s.parent().lifeCycle().update(t),s},s.updateAttrs=function(){return s.parent().lifeCycle().updateAttrs()},s.drawAxis=function(){return s.parent().lifeCycle().drawAxis(),s},s}}]),angular.module("wk.chart").factory("scaleList",["$log",function(t){var e;return e=function(){var e,r,n,a,i,o,l;return a={},r={},o={},i=void 0,l=[],n=void 0,e=function(){},e.owner=function(t){return 0===arguments.length?i:(i=t,e)},e.add=function(n){return a[n.id()]&&t.error("scaleList.add: scale "+n.id()+" already defined in scaleList of "+i.id()+". Duplicate scales are not allowed"),a[n.id()]=n,r[n.kind()]=n,e},e.hasScale=function(t){var r;return r=e.getKind(t.kind()),r.id()===t.id()},e.getKind=function(t){return r[t]?r[t]:o.getKind?o.getKind(t):void 0},e.hasKind=function(t){return!!e.getKind(t)},e.remove=function(r){return a[r.id()]?(delete a[r.id()],delete e[r.id],e):(t.warn("scaleList.delete: scale "+r.id()+" not defined in scaleList of "+i.id()+". Ignoring"),e)},e.parentScales=function(t){return 0===arguments.length?o:(o=t,e)},e.getOwned=function(){return a},e.allKinds=function(){var t,e,n,a;if(e={},o.allKinds){a=o.allKinds();for(t in a)n=a[t],e[t]=n}for(t in r)n=r[t],e[t]=n;return e},e.requiredScales=function(t){var r,n,a;if(0===arguments.length)return l;for(l=t,n=0,a=t.length;a>n;n++)if(r=t[n],!e.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";return e},e.getScales=function(t){var r,n,a,i;for(n={},a=0,i=t.length;i>a;a++){if(r=t[a],!e.hasKind(r))throw"Fatal Error: scale '"+r+"' required but not defined";n[r]=e.getKind(r)}return n},e.getScaleProperties=function(){var t,r,n,a,i;r=[],i=e.allKinds();for(t in i)a=i[t],n=a.property(),n&&(Array.isArray(n)?r.concat(n):r.push(n));return r},e.layerScale=function(t){return 0===arguments.length?n?e.getKind(n):void 0:(n=t,e)},e}}]),angular.module("wk.chart").provider("wkChartLocale",function(){var t,e;return t="en_US",e={de_DE:d3.locale({decimal:",",thousands:".",grouping:[3],currency:[""," "],dateTime:"%A, der %e. %B %Y, %X",date:"%e.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),en_US:d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})},this.setLocale=function(r){if(_.has(e,r))return t=r;throw"unknowm locale '"+r+"' using 'en-US' instead"},this.addLocaleDefinition=function(t,r){return e[t]=d3.locale(r)},this.$get=["$log",function(){return e[t]}],this}),angular.module("wk.chart").provider("wkChartScales",function(){var t,e,r,n,a,i;return a=["red","orange","yellow","green","blue"],i=void 0,n=function(){var t,e,r;return t=d3.scale.ordinal(),r=function(e){var r,n,a,i,o,l;for(r=0,a=t.range().length-1,l=[],n=i=0,o=e.length;o>=0?o>=i:i>=o;n=o>=0?++i:--i)l.push(r=(31*r+e.charAt(n))%a);return l},e=function(n){return arguments?t(r(n)):e},e.range=function(e){return arguments?(t.domain(d3.range(e.length)),t.range(e)):t.range()},e.domain=t.domain,e.rangePoint=t.rangePoints,e.rangeBands=t.rangeBands,e.rangeRoundBands=t.rangeRoundBands,e.rangeBand=t.rangeBand,e.rangeExtent=t.rangeExtent,e.hash=function(t){return arguments?(r=t,e):r},e},r=function(){var t,e,r;return t=d3.scale.ordinal(),e=i||t,r=function(t){return arguments?e.apply(r,[t]):r},r.mapFn=function(t){return arguments?(_.isFunction(t)&&(e=t),r):e},r.domain=t.domain,r.range=t.range,r.rangePoint=t.rangePoints,r.rangeBands=t.rangeBands,r.rangeRoundBands=t.rangeRoundBands,r.rangeBand=t.rangeBand,r.rangeExtent=t.rangeExtent,r},t=function(){return d3.scale.ordinal().range(a)},e=function(){return n().range(a)},this.colors=function(t){return a=t},this.customMapFn=function(t){var e;return _.isFunction(t)?e=t:void 0},this.$get=["$log",function(){return{hashed:n,customCategory:t,customCategoryHashed:e,customScale:r}}],this}),angular.module("wk.chart").provider("wkChartTemplates",function(){var t,e;return e="templates/toolTip.html",t="templates/legend.html",this.setTooltipTemplate=function(t){return e=t},this.setLegendTemplate=function(e){return t=e},this.$get=["$log","$templateCache",function(r,n){return{tooltipTemplate:function(){return n.get(e)},legendTemplate:function(){return n.get(t)}}}],this}),angular.module("wk.chart").service("selectionSharing",["$log",function(){var t,e,r;return e={},r={},t={},this.createGroup=function(){},this.setSelection=function(n,a,i){var o,l,u,c,s;if(i&&(e[i]=n,r[i]=a,t[i])){for(c=t[i],s=[],l=0,u=c.length;u>l;l++)o=c[l],s.push(o(n,a));return s}},this.getSelection=function(t){var e;return e=t||"default",selection[e]},this.register=function(e,r){return e&&(t[e]||(t[e]=[]),!_.contains(t[e],r))?t[e].push(r):void 0},this.unregister=function(e,r){var n;return t[e]&&(n=t[e].indexOf(r),n>=0)?t[e].splice(n,1):void 0},this}]),angular.module("wk.chart").service("timing",["$log",function(t){var e,r,n;return n={},r=0,e=0,this.init=function(){return r=Date.now()},this.start=function(t){var e;return e=n[t],e||(e=n[t]={name:t,start:0,total:0,callCnt:0,active:!1}),e.start=Date.now(),e.active=!0},this.stop=function(t){var a;return(a=n[t])&&(a.active=!1,a.total+=Date.now()-a.start,a.callCnt+=1),e=Date.now()-r},this.report=function(){var r,a;for(r in n)a=n[r],a.avg=a.total/a.callCnt;return t.info(n),t.info("Elapsed Time (ms)",e),n},this.clear=function(){return n={}},this}]),angular.module("wk.chart").factory("layeredData",["$log",function(){var t;return t=function(){var t,e,r,n,a,i,o,l,u;return r=[],n=[],u=void 0,e=!1,i=1/0,a=-1/0,l=1/0,o=-1/0,t=function(){},t.data=function(e){return arguments.length(Is(0))?r:(r=e,t)},t.layerKeys=function(e){return 0===arguments.length?n:(n=e,t)},t.x=function(e){return 0===arguments.length?u:(u=e,t)},t.calcTotal=function(r){return 0===arguments.length?e:(e=r,t)},t.min=function(){return i},t.max=function(){return a},t.minTotal=function(){return l},t.maxTotal=function(){return o},t.extent=function(){return[t.min(),t.max()]},t.totalExtent=function(){return[t.minTotal(),t.maxTotal()]},t.columns=function(r){var c,s,d,h,f,y,g,p,v,m,w,k,x,b;if(1===arguments.length){for(f=[],i=1/0,a=-1/0,l=1/0,o=-1/0,s=v=0,k=n.length;k>v;s=++v)d=n[s],f[s]={key:d,value:[],min:1/0,max:-1/0};for(s=m=0,x=r.length;x>m;s=++m){for(c=r[s],y=0,p="string"==typeof u?c[u]:u(c),w=0,b=f.length;b>w;w++)h=f[w],g=+c[h.key],h.value.push({x:p,value:g,key:h.key}),h.max<g&&(h.max=g),h.min>g&&(h.min=g),g>a&&(a=g),i>g&&(i=g),e&&(y+=+g);e&&(y>o&&(o=y),l>y&&(l=y))}return{min:i,max:a,totalMin:l,totalMax:o,data:f}}return t},t.rows=function(e){return 1===arguments.length?e.map(function(t){return{x:t[u],layers:layerKeys.map(function(e){return{key:e,value:t[e],x:t[u]}})}}):t},t}}]),angular.module("wk.chart").directive("svgIcon",["$log",function(){return{restrict:"E",template:'<svg ng-style="style"><path></path></svg>',scope:{path:"=",width:"@"},link:function(t,e){return t.style={height:"20px",width:t.width+"px","vertical-align":"middle"},t.$watch("path",function(t){return t?d3.select(e[0]).select("path").attr("d",t).attr("transform","translate(8,8)"):void 0})}}}]),angular.module("wk.chart").service("tooltipUtils",["$log",function(){return this.styleTooltipMarker=function(t,e){return t.append("circle").attr("r",9).style("fill",function(t){return e?t[e].color:t.color}).style("fill-opacity",.3).style("pointer-events","none"),t.append("circle").attr("r",4).style("fill",function(t){return e?t[e].color:t.color}).style("fill-opacity",.6).style("stroke","white").style("pointer-events","none")},this}]),angular.module("wk.chart").service("utils",["$log",function(){var t;return this.diff=function(t,e,r){var n,a,i,o;for(i=function(t){return e.indexOf(t)<0},o={},n=0;n<t.length;){if(i(t[n]))for(o[t[n]]=void 0,a=n+r;a>=0&&a<t.length;){if(!i(t[a])){o[t[n]]=t[a];break}a+=r}n++}return o},t=0,this.getId=function(){return"Chart"+t++},this.parseList=function(t){var e;return t?(e=t.trim().replace(/^\[|\]$/g,"").split(",").map(function(t){return t.replace(/^[\"|']|[\"|']$/g,"")}),1===e.length?e[0]:e):void 0},this.parseTrueFalse=function(t){return""===t||"true"===t?!0:"false"===t?!1:void 0},this.mergeData=function(){var t,e,r,n,a,i,o,l,u,c,s;return c=[],r=[],s={},a={},u=[],e=[],n=void 0,o=void 0,i=function(t){return t},l=function(t){return t},t=function(n){var o,l,d,h,f,y,g,p;for(c=[],s={},l=f=0,g=r.length;g>f;l=++f)o=r[l],c[l]=o,s[i(o)]=l;for(u=[],e=[],a={},r=n,d=y=0,p=r.length;p>y;d=++y)o=r[d],h=i(o),a[h]=d,s.hasOwnProperty(h)&&(u[s[h]]=!0,e[d]=!0);return t},t.key=function(e){return arguments?(i=e,t):i},t.first=function(e){return arguments?(n=e,t):n},t.last=function(e){return arguments?(o=e,t):o},t.added=function(){var t,n,a,i,o;for(a=[],n=i=0,o=r.length;o>i;n=++i)t=r[n],e[n]||a.push(_d);return a},t.deleted=function(){var t,e,r,n,a;for(r=[],t=n=0,a=c.length;a>n;t=++n)e=c[t],u[t]||r.push(c[t]);return r},t.current=function(t){return r[a[t]]},t.prev=function(t){return c[s[t]]},t.addedPred=function(t){var o;for(o=a[i(t)];!e[o];)if(o--<0)return n;return c[s[i(r[o])]]},t.addedPred.left=function(e){return t.addedPred(e).x},t.addedPred.right=function(e){var r;return r=t.addedPred(e),_.has(r,"width")?r.x+r.width:r.x},t.deletedSucc=function(t){var e;for(e=s[i(t)];!u[e];)if(e++>=c.length)return o;return r[a[i(c[e])]]},t},this.mergeSeriesSorted=function(t,e){var r,n,a,i,o,l;for(n=0,r=0,o=t.length-1,i=e.length-1,a=Math.max(o,i),l=[];o>=n&&i>=r;)+t[n]===+e[r]?(l.push([n,Math.min(r,i),t[n]]),n++,r++):+t[n]<+e[r]?(l.push([n,void 0,t[n]]),n++):(l.push([void 0,Math.min(r,i),e[r]]),r++);for(;o>=n;)l.push([n,void 0,t[n]]),n++;for(;i>=r;)l.push([void 0,Math.min(r,i),e[r]]),r++;return l},this.mergeSeriesUnsorted=function(t,e){var r,n,a,i,o,l;for(n=0,r=0,o=t.length-1,i=e.length-1,a=Math.max(o,i),l=[];o>=n&&i>=r;)t[n]===e[r]?(l.push([n,Math.min(r,i),t[n]]),n++,r++):e.indexOf(t[n])<0?(l.push([n,void 0,t[n]]),n++):(l.push([void 0,Math.min(r,i),e[r]]),r++);for(;o>=n;)l.push([n,void 0,t[n]]),n++;for(;i>=r;)l.push([void 0,Math.min(r,i),e[r]]),r++;return l},this}]);